(function t(e,i){if(typeof exports==="object"&&typeof module==="object")module.exports=i();else if(typeof define==="function"&&define.amd)define("app",[],i);else if(typeof exports==="object")exports["app"]=i();else e["app"]=i()})(typeof self!=="undefined"?self:this,function(){return function(t){var e={};function i(r){if(e[r]){return e[r].exports}var s=e[r]={i:r,l:false,exports:{}};t[r].call(s.exports,s,s.exports,i);s.l=true;return s.exports}i.m=t;i.c=e;i.d=function(t,e,r){if(!i.o(t,e)){Object.defineProperty(t,e,{configurable:false,enumerable:true,get:r})}};i.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};i.d(e,"a",e);return e};i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};i.p="";return i(i.s=6)}([function(t,e,i){"use strict";t.exports={}},function(t,e,i){(function(i){var r;var r;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*
* @overview
*
* Phaser - http://phaser.io
*
* v2.6.2 "Kore Springs" - Built: Fri Aug 26 2016 01:02:57
*
* By Richard Davey http://www.photonstorm.com @photonstorm
*
* Phaser is a fun, free and fast 2D game framework for making HTML5 games
* for desktop and mobile web browsers, supporting Canvas and WebGL rendering.
*
* Phaser uses Pixi.js for rendering, created by Mat Groves http://matgroves.com @Doormat23
* Phaser uses p2.js for full-body physics, created by Stefan Hedman https://github.com/schteppe/p2.js @schteppe
* Phaser contains a port of N+ Physics, converted by Richard Davey, original by http://www.metanetsoftware.com
*
* Many thanks to Adam Saltsman (@ADAMATOMIC) for releasing Flixel, from which both Phaser and my love of framework development originate.
*
* Follow development at http://phaser.io and on our forum
*
* "If you want your children to be intelligent,  read them fairy tales."
* "If you want them to be more intelligent, read them more fairy tales."
*                                                     -- Albert Einstein
*/
!function(e){if(true)t.exports=e();else if("function"==typeof define&&false)define(e);else{var i;"undefined"!=typeof window?i=window:"undefined"!=typeof global?i=global:"undefined"!=typeof self&&(i=self),i.p2=e()}}(function(){var t,e,i;return function t(e,i,s){function n(o,h){if(!i[o]){if(!e[o]){var l=typeof r=="function"&&r;if(!h&&l)return r(o,!0);if(a)return a(o,!0);throw new Error("Cannot find module '"+o+"'")}var u=i[o]={exports:{}};e[o][0].call(u.exports,function(t){var i=e[o][1][t];return n(i?i:t)},u,u.exports,t,e,i,s)}return i[o].exports}var a=typeof r=="function"&&r;for(var o=0;o<s.length;o++)n(s[o]);return n}({1:[function(t,e,i){var r=t("./Scalar");e.exports=s;function s(){}s.lineInt=function(t,e,i){i=i||0;var s=[0,0];var n,a,o,h,l,u,c;n=t[1][1]-t[0][1];a=t[0][0]-t[1][0];o=n*t[0][0]+a*t[0][1];h=e[1][1]-e[0][1];l=e[0][0]-e[1][0];u=h*e[0][0]+l*e[0][1];c=n*l-h*a;if(!r.eq(c,0,i)){s[0]=(l*o-a*u)/c;s[1]=(n*u-h*o)/c}return s};s.segmentsIntersect=function(t,e,i,r){var s=e[0]-t[0];var n=e[1]-t[1];var a=r[0]-i[0];var o=r[1]-i[1];if(a*n-o*s==0)return false;var h=(s*(i[1]-t[1])+n*(t[0]-i[0]))/(a*n-o*s);var l=(a*(t[1]-i[1])+o*(i[0]-t[0]))/(o*s-a*n);return h>=0&&h<=1&&l>=0&&l<=1}},{"./Scalar":4}],2:[function(t,e,i){e.exports=r;function r(){}r.area=function(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])};r.left=function(t,e,i){return r.area(t,e,i)>0};r.leftOn=function(t,e,i){return r.area(t,e,i)>=0};r.right=function(t,e,i){return r.area(t,e,i)<0};r.rightOn=function(t,e,i){return r.area(t,e,i)<=0};var s=[],n=[];r.collinear=function(t,e,i,a){if(!a)return r.area(t,e,i)==0;else{var o=s,h=n;o[0]=e[0]-t[0];o[1]=e[1]-t[1];h[0]=i[0]-e[0];h[1]=i[1]-e[1];var l=o[0]*h[0]+o[1]*h[1],u=Math.sqrt(o[0]*o[0]+o[1]*o[1]),c=Math.sqrt(h[0]*h[0]+h[1]*h[1]),f=Math.acos(l/(u*c));return f<a}};r.sqdist=function(t,e){var i=e[0]-t[0];var r=e[1]-t[1];return i*i+r*r}},{}],3:[function(t,e,i){var r=t("./Line"),s=t("./Point"),n=t("./Scalar");e.exports=a;function a(){this.vertices=[]}a.prototype.at=function(t){var e=this.vertices,i=e.length;return e[t<0?t%i+i:t%i]};a.prototype.first=function(){return this.vertices[0]};a.prototype.last=function(){return this.vertices[this.vertices.length-1]};a.prototype.clear=function(){this.vertices.length=0};a.prototype.append=function(t,e,i){if(typeof e=="undefined")throw new Error("From is not given!");if(typeof i=="undefined")throw new Error("To is not given!");if(i-1<e)throw new Error("lol1");if(i>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var r=e;r<i;r++){this.vertices.push(t.vertices[r])}};a.prototype.makeCCW=function(){var t=0,e=this.vertices;for(var i=1;i<this.vertices.length;++i){if(e[i][1]<e[t][1]||e[i][1]==e[t][1]&&e[i][0]>e[t][0]){t=i}}if(!s.left(this.at(t-1),this.at(t),this.at(t+1))){this.reverse()}};a.prototype.reverse=function(){var t=[];for(var e=0,i=this.vertices.length;e!==i;e++){t.push(this.vertices.pop())}this.vertices=t};a.prototype.isReflex=function(t){return s.right(this.at(t-1),this.at(t),this.at(t+1))};var o=[],h=[];a.prototype.canSee=function(t,e){var i,n,a=o,l=h;if(s.leftOn(this.at(t+1),this.at(t),this.at(e))&&s.rightOn(this.at(t-1),this.at(t),this.at(e))){return false}n=s.sqdist(this.at(t),this.at(e));for(var u=0;u!==this.vertices.length;++u){if((u+1)%this.vertices.length===t||u===t)continue;if(s.leftOn(this.at(t),this.at(e),this.at(u+1))&&s.rightOn(this.at(t),this.at(e),this.at(u))){a[0]=this.at(t);a[1]=this.at(e);l[0]=this.at(u);l[1]=this.at(u+1);i=r.lineInt(a,l);if(s.sqdist(this.at(t),i)<n){return false}}}return true};a.prototype.copy=function(t,e,i){var r=i||new a;r.clear();if(t<e){for(var s=t;s<=e;s++)r.vertices.push(this.vertices[s])}else{for(var s=0;s<=e;s++)r.vertices.push(this.vertices[s]);for(var s=t;s<this.vertices.length;s++)r.vertices.push(this.vertices[s])}return r};a.prototype.getCutEdges=function(){var t=[],e=[],i=[],r=new a;var s=Number.MAX_VALUE;for(var n=0;n<this.vertices.length;++n){if(this.isReflex(n)){for(var o=0;o<this.vertices.length;++o){if(this.canSee(n,o)){e=this.copy(n,o,r).getCutEdges();i=this.copy(o,n,r).getCutEdges();for(var h=0;h<i.length;h++)e.push(i[h]);if(e.length<s){t=e;s=e.length;t.push([this.at(n),this.at(o)])}}}}}return t};a.prototype.decomp=function(){var t=this.getCutEdges();if(t.length>0)return this.slice(t);else return[this]};a.prototype.slice=function(t){if(t.length==0)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&t[0].length==2&&t[0][0]instanceof Array){var e=[this];for(var i=0;i<t.length;i++){var r=t[i];for(var s=0;s<e.length;s++){var n=e[s];var a=n.slice(r);if(a){e.splice(s,1);e.push(a[0],a[1]);break}}}return e}else{var r=t;var i=this.vertices.indexOf(r[0]);var s=this.vertices.indexOf(r[1]);if(i!=-1&&s!=-1){return[this.copy(i,s),this.copy(s,i)]}else{return false}}};a.prototype.isSimple=function(){var t=this.vertices;for(var e=0;e<t.length-1;e++){for(var i=0;i<e-1;i++){if(r.segmentsIntersect(t[e],t[e+1],t[i],t[i+1])){return false}}}for(var e=1;e<t.length-2;e++){if(r.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1])){return false}}return true};function l(t,e,i,r,s){s=s||0;var a=e[1]-t[1];var o=t[0]-e[0];var h=a*t[0]+o*t[1];var l=r[1]-i[1];var u=i[0]-r[0];var c=l*i[0]+u*i[1];var f=a*u-l*o;if(!n.eq(f,0,s))return[(u*h-o*c)/f,(a*c-l*h)/f];else return[0,0]}a.prototype.quickDecomp=function(t,e,i,r,n,o){n=n||100;o=o||0;r=r||25;t=typeof t!="undefined"?t:[];e=e||[];i=i||[];var h=[0,0],u=[0,0],c=[0,0];var f=0,d=0,p=0,g=0;var v=0,m=0,y=0;var x=new a,b=new a;var w=this,_=this.vertices;if(_.length<3)return t;o++;if(o>n){console.warn("quickDecomp: max level ("+n+") reached.");return t}for(var P=0;P<this.vertices.length;++P){if(w.isReflex(P)){e.push(w.vertices[P]);f=d=Number.MAX_VALUE;for(var T=0;T<this.vertices.length;++T){if(s.left(w.at(P-1),w.at(P),w.at(T))&&s.rightOn(w.at(P-1),w.at(P),w.at(T-1))){c=l(w.at(P-1),w.at(P),w.at(T),w.at(T-1));if(s.right(w.at(P+1),w.at(P),c)){p=s.sqdist(w.vertices[P],c);if(p<d){d=p;u=c;m=T}}}if(s.left(w.at(P+1),w.at(P),w.at(T+1))&&s.rightOn(w.at(P+1),w.at(P),w.at(T))){c=l(w.at(P+1),w.at(P),w.at(T),w.at(T+1));if(s.left(w.at(P-1),w.at(P),c)){p=s.sqdist(w.vertices[P],c);if(p<f){f=p;h=c;v=T}}}}if(m==(v+1)%this.vertices.length){c[0]=(u[0]+h[0])/2;c[1]=(u[1]+h[1])/2;i.push(c);if(P<v){x.append(w,P,v+1);x.vertices.push(c);b.vertices.push(c);if(m!=0){b.append(w,m,w.vertices.length)}b.append(w,0,P+1)}else{if(P!=0){x.append(w,P,w.vertices.length)}x.append(w,0,v+1);x.vertices.push(c);b.vertices.push(c);b.append(w,m,P+1)}}else{if(m>v){v+=this.vertices.length}g=Number.MAX_VALUE;if(v<m){return t}for(var T=m;T<=v;++T){if(s.leftOn(w.at(P-1),w.at(P),w.at(T))&&s.rightOn(w.at(P+1),w.at(P),w.at(T))){p=s.sqdist(w.at(P),w.at(T));if(p<g){g=p;y=T%this.vertices.length}}}if(P<y){x.append(w,P,y+1);if(y!=0){b.append(w,y,_.length)}b.append(w,0,P+1)}else{if(P!=0){x.append(w,P,_.length)}x.append(w,0,y+1);b.append(w,y,P+1)}}if(x.vertices.length<b.vertices.length){x.quickDecomp(t,e,i,r,n,o);b.quickDecomp(t,e,i,r,n,o)}else{b.quickDecomp(t,e,i,r,n,o);x.quickDecomp(t,e,i,r,n,o)}return t}}t.push(this);return t};a.prototype.removeCollinearPoints=function(t){var e=0;for(var i=this.vertices.length-1;this.vertices.length>3&&i>=0;--i){if(s.collinear(this.at(i-1),this.at(i),this.at(i+1),t)){this.vertices.splice(i%this.vertices.length,1);i--;e++}}return e}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(t,e,i){e.exports=r;function r(){}r.eq=function(t,e,i){i=i||0;return Math.abs(t-e)<i}},{}],5:[function(t,e,i){e.exports={Polygon:t("./Polygon"),Point:t("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(t,e,i){e.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(t,e,i){var r=t("../math/vec2"),s=t("../utils/Utils");e.exports=n;function n(t){this.lowerBound=r.create();if(t&&t.lowerBound){r.copy(this.lowerBound,t.lowerBound)}this.upperBound=r.create();if(t&&t.upperBound){r.copy(this.upperBound,t.upperBound)}}var a=r.create();n.prototype.setFromPoints=function(t,e,i,s){var n=this.lowerBound,o=this.upperBound;if(typeof i!=="number"){i=0}if(i!==0){r.rotate(n,t[0],i)}else{r.copy(n,t[0])}r.copy(o,n);var h=Math.cos(i),l=Math.sin(i);for(var u=1;u<t.length;u++){var c=t[u];if(i!==0){var f=c[0],d=c[1];a[0]=h*f-l*d;a[1]=l*f+h*d;c=a}for(var p=0;p<2;p++){if(c[p]>o[p]){o[p]=c[p]}if(c[p]<n[p]){n[p]=c[p]}}}if(e){r.add(this.lowerBound,this.lowerBound,e);r.add(this.upperBound,this.upperBound,e)}if(s){this.lowerBound[0]-=s;this.lowerBound[1]-=s;this.upperBound[0]+=s;this.upperBound[1]+=s}};n.prototype.copy=function(t){r.copy(this.lowerBound,t.lowerBound);r.copy(this.upperBound,t.upperBound)};n.prototype.extend=function(t){var e=2;while(e--){var i=t.lowerBound[e];if(this.lowerBound[e]>i){this.lowerBound[e]=i}var r=t.upperBound[e];if(this.upperBound[e]<r){this.upperBound[e]=r}}};n.prototype.overlaps=function(t){var e=this.lowerBound,i=this.upperBound,r=t.lowerBound,s=t.upperBound;return(r[0]<=i[0]&&i[0]<=s[0]||e[0]<=s[0]&&s[0]<=i[0])&&(r[1]<=i[1]&&i[1]<=s[1]||e[1]<=s[1]&&s[1]<=i[1])};n.prototype.containsPoint=function(t){var e=this.lowerBound,i=this.upperBound;return e[0]<=t[0]&&t[0]<=i[0]&&e[1]<=t[1]&&t[1]<=i[1]};n.prototype.overlapsRay=function(t){var e=0;var i=1/t.direction[0];var r=1/t.direction[1];var s=(this.lowerBound[0]-t.from[0])*i;var n=(this.upperBound[0]-t.from[0])*i;var a=(this.lowerBound[1]-t.from[1])*r;var o=(this.upperBound[1]-t.from[1])*r;var h=Math.max(Math.max(Math.min(s,n),Math.min(a,o)));var l=Math.min(Math.min(Math.max(s,n),Math.max(a,o)));if(l<0){return-1}if(h>l){return-1}return h}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(t,e,i){var r=t("../math/vec2");var s=t("../objects/Body");e.exports=n;function n(t){this.type=t;this.result=[];this.world=null;this.boundingVolumeType=n.AABB}n.AABB=1;n.BOUNDING_CIRCLE=2;n.prototype.setWorld=function(t){this.world=t};n.prototype.getCollisionPairs=function(t){};var a=r.create();n.boundingRadiusCheck=function(t,e){r.sub(a,t.position,e.position);var i=r.squaredLength(a),s=t.boundingRadius+e.boundingRadius;return i<=s*s};n.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())};n.prototype.boundingVolumeCheck=function(t,e){var i;switch(this.boundingVolumeType){case n.BOUNDING_CIRCLE:i=n.boundingRadiusCheck(t,e);break;case n.AABB:i=n.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return i};n.canCollide=function(t,e){var i=s.KINEMATIC;var r=s.STATIC;if(t.type===r&&e.type===r){return false}if(t.type===i&&e.type===r||t.type===r&&e.type===i){return false}if(t.type===i&&e.type===i){return false}if(t.sleepState===s.SLEEPING&&e.sleepState===s.SLEEPING){return false}if(t.sleepState===s.SLEEPING&&e.type===r||e.sleepState===s.SLEEPING&&t.type===r){return false}return true};n.NAIVE=1;n.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(t,e,i){var r=t("../shapes/Circle"),s=t("../shapes/Plane"),n=t("../shapes/Shape"),a=t("../shapes/Particle"),o=t("../collision/Broadphase"),h=t("../math/vec2");e.exports=l;function l(){o.call(this,o.NAIVE)}l.prototype=new o;l.prototype.constructor=l;l.prototype.getCollisionPairs=function(t){var e=t.bodies,i=this.result;i.length=0;for(var r=0,s=e.length;r!==s;r++){var n=e[r];for(var a=0;a<r;a++){var h=e[a];if(o.canCollide(n,h)&&this.boundingVolumeCheck(n,h)){i.push(n,h)}}}return i};l.prototype.aabbQuery=function(t,e,i){i=i||[];var r=t.bodies;for(var s=0;s<r.length;s++){var n=r[s];if(n.aabbNeedsUpdate){n.updateAABB()}if(n.aabb.overlaps(e)){i.push(n)}}return i}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(t,e,i){var r=t("../math/vec2"),s=r.sub,n=r.add,a=r.dot,o=t("../utils/Utils"),h=t("../utils/ContactEquationPool"),l=t("../utils/FrictionEquationPool"),u=t("../utils/TupleDictionary"),c=t("../equations/Equation"),f=t("../equations/ContactEquation"),d=t("../equations/FrictionEquation"),p=t("../shapes/Circle"),g=t("../shapes/Convex"),v=t("../shapes/Shape"),m=t("../objects/Body"),y=t("../shapes/Box");e.exports=G;var x=r.fromValues(0,1);var b=r.fromValues(0,0),w=r.fromValues(0,0),_=r.fromValues(0,0),P=r.fromValues(0,0),T=r.fromValues(0,0),C=r.fromValues(0,0),S=r.fromValues(0,0),A=r.fromValues(0,0),E=r.fromValues(0,0),I=r.fromValues(0,0),M=r.fromValues(0,0),R=r.fromValues(0,0),B=r.fromValues(0,0),L=r.fromValues(0,0),k=r.fromValues(0,0),O=r.fromValues(0,0),F=r.fromValues(0,0),D=r.fromValues(0,0),U=[];function G(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=true;this.enabledEquations=true;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.contactEquationPool=new h({size:32});this.frictionEquationPool=new l({size:64});this.restitution=0;this.stiffness=c.DEFAULT_STIFFNESS;this.relaxation=c.DEFAULT_RELAXATION;this.frictionStiffness=c.DEFAULT_STIFFNESS;this.frictionRelaxation=c.DEFAULT_RELAXATION;this.enableFrictionReduction=true;this.collidingBodiesLastStep=new u;this.contactSkinSize=.01}var N=r.create();var X=r.create();G.prototype.bodiesOverlap=function(t,e){var i=N;var r=X;for(var s=0,n=t.shapes.length;s!==n;s++){var a=t.shapes[s];t.toWorldFrame(i,a.position);for(var o=0,h=e.shapes.length;o!==h;o++){var l=e.shapes[o];e.toWorldFrame(r,l.position);if(this[a.type|l.type](t,a,i,a.angle+t.angle,e,l,r,l.angle+e.angle,true)){return true}}}return false};G.prototype.collidedLastStep=function(t,e){var i=t.id|0,r=e.id|0;return!!this.collidingBodiesLastStep.get(i,r)};G.prototype.reset=function(){this.collidingBodiesLastStep.reset();var t=this.contactEquations;var e=t.length;while(e--){var i=t[e],r=i.bodyA.id,s=i.bodyB.id;this.collidingBodiesLastStep.set(r,s,true)}var n=this.contactEquations,a=this.frictionEquations;for(var o=0;o<n.length;o++){this.contactEquationPool.release(n[o])}for(var o=0;o<a.length;o++){this.frictionEquationPool.release(a[o])}this.contactEquations.length=this.frictionEquations.length=0};G.prototype.createContactEquation=function(t,e,i,r){var s=this.contactEquationPool.get();s.bodyA=t;s.bodyB=e;s.shapeA=i;s.shapeB=r;s.restitution=this.restitution;s.firstImpact=!this.collidedLastStep(t,e);s.stiffness=this.stiffness;s.relaxation=this.relaxation;s.needsUpdate=true;s.enabled=this.enabledEquations;s.offset=this.contactSkinSize;return s};G.prototype.createFrictionEquation=function(t,e,i,r){var s=this.frictionEquationPool.get();s.bodyA=t;s.bodyB=e;s.shapeA=i;s.shapeB=r;s.setSlipForce(this.slipForce);s.frictionCoefficient=this.frictionCoefficient;s.relativeVelocity=this.surfaceVelocity;s.enabled=this.enabledEquations;s.needsUpdate=true;s.stiffness=this.frictionStiffness;s.relaxation=this.frictionRelaxation;s.contactEquations.length=0;return s};G.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);r.copy(e.contactPointA,t.contactPointA);r.copy(e.contactPointB,t.contactPointB);r.rotate90cw(e.t,t.normalA);e.contactEquations.push(t);return e};G.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1];var i=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB);var s=e.bodyA;var n=e.bodyB;r.set(i.contactPointA,0,0);r.set(i.contactPointB,0,0);r.set(i.t,0,0);for(var a=0;a!==t;a++){e=this.contactEquations[this.contactEquations.length-1-a];if(e.bodyA===s){r.add(i.t,i.t,e.normalA);r.add(i.contactPointA,i.contactPointA,e.contactPointA);r.add(i.contactPointB,i.contactPointB,e.contactPointB)}else{r.sub(i.t,i.t,e.normalA);r.add(i.contactPointA,i.contactPointA,e.contactPointB);r.add(i.contactPointB,i.contactPointB,e.contactPointA)}i.contactEquations.push(e)}var o=1/t;r.scale(i.contactPointA,i.contactPointA,o);r.scale(i.contactPointB,i.contactPointB,o);r.normalize(i.t,i.t);r.rotate90cw(i.t,i.t);return i};G.prototype[v.LINE|v.CONVEX]=G.prototype.convexLine=function(t,e,i,r,s,n,a,o,h){if(h){return false}else{return 0}};G.prototype[v.LINE|v.BOX]=G.prototype.lineBox=function(t,e,i,r,s,n,a,o,h){if(h){return false}else{return 0}};function j(t,e){r.set(t.vertices[0],-e.length*.5,-e.radius);r.set(t.vertices[1],e.length*.5,-e.radius);r.set(t.vertices[2],e.length*.5,e.radius);r.set(t.vertices[3],-e.length*.5,e.radius)}var W=new y({width:1,height:1}),z=r.create();G.prototype[v.CAPSULE|v.CONVEX]=G.prototype[v.CAPSULE|v.BOX]=G.prototype.convexCapsule=function(t,e,i,s,n,a,o,h,l){var u=z;r.set(u,a.length/2,0);r.rotate(u,u,h);r.add(u,u,o);var c=this.circleConvex(n,a,u,h,t,e,i,s,l,a.radius);r.set(u,-a.length/2,0);r.rotate(u,u,h);r.add(u,u,o);var f=this.circleConvex(n,a,u,h,t,e,i,s,l,a.radius);if(l&&(c||f)){return true}var d=W;j(d,a);var p=this.convexConvex(t,e,i,s,n,d,o,h,l);return p+c+f};G.prototype[v.CAPSULE|v.LINE]=G.prototype.lineCapsule=function(t,e,i,r,s,n,a,o,h){if(h){return false}else{return 0}};var V=r.create();var q=r.create();var H=new y({width:1,height:1});G.prototype[v.CAPSULE|v.CAPSULE]=G.prototype.capsuleCapsule=function(t,e,i,s,n,a,o,h,l){var u;var c=V,f=q;var d=0;for(var p=0;p<2;p++){r.set(c,(p===0?-1:1)*e.length/2,0);r.rotate(c,c,s);r.add(c,c,i);for(var g=0;g<2;g++){r.set(f,(g===0?-1:1)*a.length/2,0);r.rotate(f,f,h);r.add(f,f,o);if(this.enableFrictionReduction){u=this.enableFriction;this.enableFriction=false}var v=this.circleCircle(t,e,c,s,n,a,f,h,l,e.radius,a.radius);if(this.enableFrictionReduction){this.enableFriction=u}if(l&&v){return true}d+=v}}if(this.enableFrictionReduction){u=this.enableFriction;this.enableFriction=false}var m=H;j(m,e);var y=this.convexCapsule(t,m,i,s,n,a,o,h,l);if(this.enableFrictionReduction){this.enableFriction=u}if(l&&y){return true}d+=y;if(this.enableFrictionReduction){var u=this.enableFriction;this.enableFriction=false}j(m,a);var x=this.convexCapsule(n,m,o,h,t,e,i,s,l);if(this.enableFrictionReduction){this.enableFriction=u}if(l&&x){return true}d+=x;if(this.enableFrictionReduction){if(d&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(d))}}return d};G.prototype[v.LINE|v.LINE]=G.prototype.lineLine=function(t,e,i,r,s,n,a,o,h){if(h){return false}else{return 0}};G.prototype[v.PLANE|v.LINE]=G.prototype.planeLine=function(t,e,i,o,h,l,u,c,f){var d=b,p=w,g=_,v=P,m=T,y=C,I=S,M=A,R=E,B=U,L=0;r.set(d,-l.length/2,0);r.set(p,l.length/2,0);r.rotate(g,d,c);r.rotate(v,p,c);n(g,g,u);n(v,v,u);r.copy(d,g);r.copy(p,v);s(m,p,d);r.normalize(y,m);r.rotate90cw(R,y);r.rotate(M,x,o);B[0]=d;B[1]=p;for(var k=0;k<B.length;k++){var O=B[k];s(I,O,i);var F=a(I,M);if(F<0){if(f){return true}var D=this.createContactEquation(t,h,e,l);L++;r.copy(D.normalA,M);r.normalize(D.normalA,D.normalA);r.scale(I,M,F);s(D.contactPointA,O,I);s(D.contactPointA,D.contactPointA,t.position);s(D.contactPointB,O,u);n(D.contactPointB,D.contactPointB,u);s(D.contactPointB,D.contactPointB,h.position);this.contactEquations.push(D);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(D))}}}}if(f){return false}if(!this.enableFrictionReduction){if(L&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(L))}}return L};G.prototype[v.PARTICLE|v.CAPSULE]=G.prototype.particleCapsule=function(t,e,i,r,s,n,a,o,h){return this.circleLine(t,e,i,r,s,n,a,o,h,n.radius,0)};G.prototype[v.CIRCLE|v.LINE]=G.prototype.circleLine=function(t,e,i,o,h,l,u,c,f,d,p){var d=d||0,p=typeof p!=="undefined"?p:e.radius,g=b,v=w,m=_,y=P,x=T,k=C,O=S,F=A,D=E,G=I,N=M,X=R,j=B,W=L,z=U;r.set(F,-l.length/2,0);r.set(D,l.length/2,0);r.rotate(G,F,c);r.rotate(N,D,c);n(G,G,u);n(N,N,u);r.copy(F,G);r.copy(D,N);s(k,D,F);r.normalize(O,k);r.rotate90cw(x,O);s(X,i,F);var V=a(X,x);s(y,F,u);s(j,i,u);var q=p+d;if(Math.abs(V)<q){r.scale(g,x,V);s(m,i,g);r.scale(v,x,a(x,j));r.normalize(v,v);r.scale(v,v,d);n(m,m,v);var H=a(O,m);var Y=a(O,F);var K=a(O,D);if(H>Y&&H<K){if(f){return true}var $=this.createContactEquation(t,h,e,l);r.scale($.normalA,g,-1);r.normalize($.normalA,$.normalA);r.scale($.contactPointA,$.normalA,p);n($.contactPointA,$.contactPointA,i);s($.contactPointA,$.contactPointA,t.position);s($.contactPointB,m,u);n($.contactPointB,$.contactPointB,u);s($.contactPointB,$.contactPointB,h.position);this.contactEquations.push($);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact($))}return 1}}z[0]=F;z[1]=D;for(var J=0;J<z.length;J++){var Z=z[J];s(X,Z,i);if(r.squaredLength(X)<Math.pow(q,2)){if(f){return true}var $=this.createContactEquation(t,h,e,l);r.copy($.normalA,X);r.normalize($.normalA,$.normalA);r.scale($.contactPointA,$.normalA,p);n($.contactPointA,$.contactPointA,i);s($.contactPointA,$.contactPointA,t.position);s($.contactPointB,Z,u);r.scale(W,$.normalA,-d);n($.contactPointB,$.contactPointB,W);n($.contactPointB,$.contactPointB,u);s($.contactPointB,$.contactPointB,h.position);this.contactEquations.push($);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact($))}return 1}}return 0};G.prototype[v.CIRCLE|v.CAPSULE]=G.prototype.circleCapsule=function(t,e,i,r,s,n,a,o,h){return this.circleLine(t,e,i,r,s,n,a,o,h,n.radius)};G.prototype[v.CIRCLE|v.CONVEX]=G.prototype[v.CIRCLE|v.BOX]=G.prototype.circleConvex=function(t,e,i,a,o,h,l,u,c,f){var f=typeof f==="number"?f:e.radius;var d=b,p=w,g=_,v=P,m=T,y=C,x=S,F=A,D=E,U=I,G=M,N=-1,X=null,j=R,W=B,z=L,V=k,q=O,H=false,Y=Number.MAX_VALUE;var K=0;var $=h.vertices;for(var J=0;J!==$.length+1;J++){var Q=$[J%$.length],tt=$[(J+1)%$.length];r.rotate(d,Q,u);r.rotate(p,tt,u);n(d,d,l);n(p,p,l);s(g,p,d);r.normalize(v,g);r.rotate90cw(m,v);r.scale(z,m,-e.radius);n(z,z,i);if(Z(z,h,l,u)){r.sub(V,d,z);var et=Math.abs(r.dot(V,m));if(et<Y){r.copy(q,z);Y=et;r.scale(W,m,et);r.add(W,W,z);H=true}}}if(H){if(c){return true}var it=this.createContactEquation(t,o,e,h);r.sub(it.normalA,q,i);r.normalize(it.normalA,it.normalA);r.scale(it.contactPointA,it.normalA,f);n(it.contactPointA,it.contactPointA,i);s(it.contactPointA,it.contactPointA,t.position);s(it.contactPointB,W,l);n(it.contactPointB,it.contactPointB,l);s(it.contactPointB,it.contactPointB,o.position);this.contactEquations.push(it);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(it))}return 1}if(f>0){for(var J=0;J<$.length;J++){var rt=$[J];r.rotate(G,rt,u);n(G,G,l);s(U,G,i);if(r.squaredLength(U)<Math.pow(f,2)){if(c){return true}var it=this.createContactEquation(t,o,e,h);r.copy(it.normalA,U);r.normalize(it.normalA,it.normalA);r.scale(it.contactPointA,it.normalA,f);n(it.contactPointA,it.contactPointA,i);s(it.contactPointA,it.contactPointA,t.position);s(it.contactPointB,G,l);n(it.contactPointB,it.contactPointB,l);s(it.contactPointB,it.contactPointB,o.position);this.contactEquations.push(it);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(it))}return 1}}}return 0};var Y=r.create(),K=r.create(),$=r.create(),J=r.create();function Z(t,e,i,a){var o=Y,h=K,l=$,u=J,c=t,f=e.vertices,d=null;for(var p=0;p!==f.length+1;p++){var g=f[p%f.length],v=f[(p+1)%f.length];r.rotate(o,g,a);r.rotate(h,v,a);n(o,o,i);n(h,h,i);s(l,o,c);s(u,h,c);var m=r.crossLength(l,u);if(d===null){d=m}if(m*d<=0){return false}d=m}return true}G.prototype[v.PARTICLE|v.CONVEX]=G.prototype[v.PARTICLE|v.BOX]=G.prototype.particleConvex=function(t,e,i,o,h,l,u,c,f){var d=b,p=w,g=_,v=P,m=T,y=C,x=S,U=A,G=E,N=I,X=M,j=-1,W=null,z=R,V=B,q=L,H=k,Y=O,K=F,$=D,J=Number.MAX_VALUE;var Q=0,tt=false,et=l.vertices;if(!Z(i,l,u,c)){return 0}if(f){return true}var it=null;for(var rt=0;rt!==et.length+1;rt++){var st=et[rt%et.length],nt=et[(rt+1)%et.length];r.rotate(d,st,c);r.rotate(p,nt,c);n(d,d,u);n(p,p,u);s(g,p,d);r.normalize(v,g);r.rotate90cw(m,v);s(N,i,d);var at=a(N,m);s(y,d,u);s(x,i,u);r.sub(K,d,i);var ot=Math.abs(r.dot(K,m));if(ot<J){J=ot;r.scale(V,m,ot);r.add(V,V,i);r.copy($,m);tt=true}}if(tt){var ht=this.createContactEquation(t,h,e,l);r.scale(ht.normalA,$,-1);r.normalize(ht.normalA,ht.normalA);r.set(ht.contactPointA,0,0);n(ht.contactPointA,ht.contactPointA,i);s(ht.contactPointA,ht.contactPointA,t.position);s(ht.contactPointB,V,u);n(ht.contactPointB,ht.contactPointB,u);s(ht.contactPointB,ht.contactPointB,h.position);this.contactEquations.push(ht);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(ht))}return 1}return 0};G.prototype[v.CIRCLE]=G.prototype.circleCircle=function(t,e,i,a,o,h,l,u,c,f,d){var p=b,f=f||e.radius,d=d||h.radius;s(p,i,l);var g=f+d;if(r.squaredLength(p)>Math.pow(g,2)){return 0}if(c){return true}var v=this.createContactEquation(t,o,e,h);s(v.normalA,l,i);r.normalize(v.normalA,v.normalA);r.scale(v.contactPointA,v.normalA,f);r.scale(v.contactPointB,v.normalA,-d);n(v.contactPointA,v.contactPointA,i);s(v.contactPointA,v.contactPointA,t.position);n(v.contactPointB,v.contactPointB,l);s(v.contactPointB,v.contactPointB,o.position);this.contactEquations.push(v);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(v))}return 1};G.prototype[v.PLANE|v.CONVEX]=G.prototype[v.PLANE|v.BOX]=G.prototype.planeConvex=function(t,e,i,o,h,l,u,c,f){var d=b,p=w,g=_;var v=0;r.rotate(p,x,o);for(var m=0;m!==l.vertices.length;m++){var y=l.vertices[m];r.rotate(d,y,c);n(d,d,u);s(g,d,i);if(a(g,p)<=0){if(f){return true}v++;var P=this.createContactEquation(t,h,e,l);s(g,d,i);r.copy(P.normalA,p);var T=a(g,P.normalA);r.scale(g,P.normalA,T);s(P.contactPointB,d,h.position);s(P.contactPointA,d,g);s(P.contactPointA,P.contactPointA,t.position);this.contactEquations.push(P);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(P))}}}}if(this.enableFrictionReduction){if(this.enableFriction&&v){this.frictionEquations.push(this.createFrictionFromAverage(v))}}return v};G.prototype[v.PARTICLE|v.PLANE]=G.prototype.particlePlane=function(t,e,i,n,o,h,l,u,c){var f=b,d=w;u=u||0;s(f,i,l);r.rotate(d,x,u);var p=a(f,d);if(p>0){return 0}if(c){return true}var g=this.createContactEquation(o,t,h,e);r.copy(g.normalA,d);r.scale(f,g.normalA,p);s(g.contactPointA,i,f);s(g.contactPointA,g.contactPointA,o.position);s(g.contactPointB,i,t.position);this.contactEquations.push(g);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(g))}return 1};G.prototype[v.CIRCLE|v.PARTICLE]=G.prototype.circleParticle=function(t,e,i,a,o,h,l,u,c){var f=b;s(f,l,i);if(r.squaredLength(f)>Math.pow(e.radius,2)){return 0}if(c){return true}var d=this.createContactEquation(t,o,e,h);r.copy(d.normalA,f);r.normalize(d.normalA,d.normalA);r.scale(d.contactPointA,d.normalA,e.radius);n(d.contactPointA,d.contactPointA,i);s(d.contactPointA,d.contactPointA,t.position);s(d.contactPointB,l,o.position);this.contactEquations.push(d);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(d))}return 1};var Q=new p({radius:1}),tt=r.create(),et=r.create(),it=r.create();G.prototype[v.PLANE|v.CAPSULE]=G.prototype.planeCapsule=function(t,e,i,s,a,o,h,l,u){var c=tt,f=et,d=Q,p=it;r.set(c,-o.length/2,0);r.rotate(c,c,l);n(c,c,h);r.set(f,o.length/2,0);r.rotate(f,f,l);n(f,f,h);d.radius=o.radius;var g;if(this.enableFrictionReduction){g=this.enableFriction;this.enableFriction=false}var v=this.circlePlane(a,d,c,0,t,e,i,s,u),m=this.circlePlane(a,d,f,0,t,e,i,s,u);if(this.enableFrictionReduction){this.enableFriction=g}if(u){return v||m}else{var y=v+m;if(this.enableFrictionReduction){if(y){this.frictionEquations.push(this.createFrictionFromAverage(y))}}return y}};G.prototype[v.CIRCLE|v.PLANE]=G.prototype.circlePlane=function(t,e,i,o,h,l,u,c,f){var d=t,p=e,g=i,v=h,m=l,y=u,P=c;P=P||0;var T=b,C=w,S=_;s(T,g,y);r.rotate(C,x,P);var A=a(C,T);if(A>p.radius){return 0}if(f){return true}var E=this.createContactEquation(v,d,l,e);r.copy(E.normalA,C);r.scale(E.contactPointB,E.normalA,-p.radius);n(E.contactPointB,E.contactPointB,g);s(E.contactPointB,E.contactPointB,d.position);r.scale(S,E.normalA,A);s(E.contactPointA,T,S);n(E.contactPointA,E.contactPointA,y);s(E.contactPointA,E.contactPointA,v.position);this.contactEquations.push(E);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(E))}return 1};G.prototype[v.CONVEX]=G.prototype[v.CONVEX|v.BOX]=G.prototype[v.BOX]=G.prototype.convexConvex=function(t,e,i,o,h,l,u,c,f,d){var p=b,g=w,v=_,m=P,y=T,x=C,I=S,M=A,R=E,B=0,d=typeof d==="number"?d:0;var L=G.findSeparatingAxis(e,i,o,l,u,c,p);if(!L){return 0}s(M,u,i);if(a(p,M)>0){r.scale(p,p,-1)}var k=G.getClosestEdge(e,o,p,true),O=G.getClosestEdge(l,c,p);if(k===-1||O===-1){return 0}for(var F=0;F<2;F++){var D=k,U=O,N=e,X=l,j=i,W=u,z=o,V=c,q=t,H=h;if(F===0){var Y;Y=D;D=U;U=Y;Y=N;N=X;X=Y;Y=j;j=W;W=Y;Y=z;z=V;V=Y;Y=q;q=H;H=Y}for(var K=U;K<U+2;K++){var $=X.vertices[(K+X.vertices.length)%X.vertices.length];r.rotate(g,$,V);n(g,g,W);var J=0;for(var Z=D-1;Z<D+2;Z++){var Q=N.vertices[(Z+N.vertices.length)%N.vertices.length],tt=N.vertices[(Z+1+N.vertices.length)%N.vertices.length];r.rotate(v,Q,z);r.rotate(m,tt,z);n(v,v,j);n(m,m,j);s(y,m,v);r.rotate90cw(R,y);r.normalize(R,R);s(M,g,v);var et=a(R,M);if(Z===D&&et<=d||Z!==D&&et<=0){J++}}if(J>=3){if(f){return true}var it=this.createContactEquation(q,H,N,X);B++;var Q=N.vertices[D%N.vertices.length],tt=N.vertices[(D+1)%N.vertices.length];r.rotate(v,Q,z);r.rotate(m,tt,z);n(v,v,j);n(m,m,j);s(y,m,v);r.rotate90cw(it.normalA,y);r.normalize(it.normalA,it.normalA);s(M,g,v);var et=a(it.normalA,M);r.scale(I,it.normalA,et);s(it.contactPointA,g,j);s(it.contactPointA,it.contactPointA,I);n(it.contactPointA,it.contactPointA,j);s(it.contactPointA,it.contactPointA,q.position);s(it.contactPointB,g,W);n(it.contactPointB,it.contactPointB,W);s(it.contactPointB,it.contactPointB,H.position);this.contactEquations.push(it);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(it))}}}}}if(this.enableFrictionReduction){if(this.enableFriction&&B){this.frictionEquations.push(this.createFrictionFromAverage(B))}}return B};var rt=r.fromValues(0,0);G.projectConvexOntoAxis=function(t,e,i,s,n){var o=null,h=null,l,u,c=rt;r.rotate(c,s,-i);for(var f=0;f<t.vertices.length;f++){l=t.vertices[f];u=a(l,c);if(o===null||u>o){o=u}if(h===null||u<h){h=u}}if(h>o){var d=h;h=o;o=d}var p=a(e,s);r.set(n,h+p,o+p)};var st=r.fromValues(0,0),nt=r.fromValues(0,0),at=r.fromValues(0,0),ot=r.fromValues(0,0),ht=r.fromValues(0,0),lt=r.fromValues(0,0);G.findSeparatingAxis=function(t,e,i,n,a,o,h){var l=null,u=false,c=false,f=st,d=nt,p=at,g=ot,v=ht,m=lt;if(t instanceof y&&n instanceof y){for(var x=0;x!==2;x++){var b=t,w=i;if(x===1){b=n;w=o}for(var _=0;_!==2;_++){if(_===0){r.set(g,0,1)}else if(_===1){r.set(g,1,0)}if(w!==0){r.rotate(g,g,w)}G.projectConvexOntoAxis(t,e,i,g,v);G.projectConvexOntoAxis(n,a,o,g,m);var P=v,T=m,C=false;if(v[0]>m[0]){T=v;P=m;C=true}var S=T[0]-P[1];u=S<=0;if(l===null||S>l){r.copy(h,g);l=S;c=u}}}}else{for(var x=0;x!==2;x++){var b=t,w=i;if(x===1){b=n;w=o}for(var _=0;_!==b.vertices.length;_++){r.rotate(d,b.vertices[_],w);r.rotate(p,b.vertices[(_+1)%b.vertices.length],w);s(f,p,d);r.rotate90cw(g,f);r.normalize(g,g);G.projectConvexOntoAxis(t,e,i,g,v);G.projectConvexOntoAxis(n,a,o,g,m);var P=v,T=m,C=false;if(v[0]>m[0]){T=v;P=m;C=true}var S=T[0]-P[1];u=S<=0;if(l===null||S>l){r.copy(h,g);l=S;c=u}}}}return c};var ut=r.fromValues(0,0),ct=r.fromValues(0,0),ft=r.fromValues(0,0);G.getClosestEdge=function(t,e,i,n){var o=ut,h=ct,l=ft;r.rotate(o,i,-e);if(n){r.scale(o,o,-1)}var u=-1,c=t.vertices.length,f=-1;for(var d=0;d!==c;d++){s(h,t.vertices[(d+1)%c],t.vertices[d%c]);r.rotate90cw(l,h);r.normalize(l,l);var p=a(l,o);if(u===-1||p>f){u=d%c;f=p}}return u};var dt=r.create(),pt=r.create(),gt=r.create(),vt=r.create(),mt=r.create(),yt=r.create(),xt=r.create();G.prototype[v.CIRCLE|v.HEIGHTFIELD]=G.prototype.circleHeightfield=function(t,e,i,a,o,h,l,u,c,f){var d=h.heights,f=f||e.radius,p=h.elementWidth,g=pt,v=dt,m=mt,y=xt,x=yt,b=gt,w=vt;var _=Math.floor((i[0]-f-l[0])/p),P=Math.ceil((i[0]+f-l[0])/p);if(_<0){_=0}if(P>=d.length){P=d.length-1}var T=d[_],C=d[P];for(var S=_;S<P;S++){if(d[S]<C){C=d[S]}if(d[S]>T){T=d[S]}}if(i[1]-f>T){return c?false:0}var A=false;for(var S=_;S<P;S++){r.set(b,S*p,d[S]);r.set(w,(S+1)*p,d[S+1]);r.add(b,b,l);r.add(w,w,l);r.sub(x,w,b);r.rotate(x,x,Math.PI/2);r.normalize(x,x);r.scale(v,x,-f);r.add(v,v,i);r.sub(g,v,b);var E=r.dot(g,x);if(v[0]>=b[0]&&v[0]<w[0]&&E<=0){if(c){return true}A=true;r.scale(g,x,-E);r.add(m,v,g);r.copy(y,x);var I=this.createContactEquation(o,t,h,e);r.copy(I.normalA,y);r.scale(I.contactPointB,I.normalA,-f);n(I.contactPointB,I.contactPointB,i);s(I.contactPointB,I.contactPointB,t.position);r.copy(I.contactPointA,m);r.sub(I.contactPointA,I.contactPointA,o.position);this.contactEquations.push(I);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(I))}}}A=false;if(f>0){for(var S=_;S<=P;S++){r.set(b,S*p,d[S]);r.add(b,b,l);r.sub(g,i,b);if(r.squaredLength(g)<Math.pow(f,2)){if(c){return true}A=true;var I=this.createContactEquation(o,t,h,e);r.copy(I.normalA,g);r.normalize(I.normalA,I.normalA);r.scale(I.contactPointB,I.normalA,-f);n(I.contactPointB,I.contactPointB,i);s(I.contactPointB,I.contactPointB,t.position);s(I.contactPointA,b,l);n(I.contactPointA,I.contactPointA,l);s(I.contactPointA,I.contactPointA,o.position);this.contactEquations.push(I);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(I))}}}}if(A){return 1}return 0};var bt=r.create(),wt=r.create(),_t=r.create(),Pt=new g({vertices:[r.create(),r.create(),r.create(),r.create()]});G.prototype[v.BOX|v.HEIGHTFIELD]=G.prototype[v.CONVEX|v.HEIGHTFIELD]=G.prototype.convexHeightfield=function(t,e,i,s,n,a,o,h,l){var u=a.heights,c=a.elementWidth,f=bt,d=wt,p=_t,g=Pt;var v=Math.floor((t.aabb.lowerBound[0]-o[0])/c),m=Math.ceil((t.aabb.upperBound[0]-o[0])/c);if(v<0){v=0}if(m>=u.length){m=u.length-1}var y=u[v],x=u[m];for(var b=v;b<m;b++){if(u[b]<x){x=u[b]}if(u[b]>y){y=u[b]}}if(t.aabb.lowerBound[1]>y){return l?false:0}var w=false;var _=0;for(var b=v;b<m;b++){r.set(f,b*c,u[b]);r.set(d,(b+1)*c,u[b+1]);r.add(f,f,o);r.add(d,d,o);var P=100;r.set(p,(d[0]+f[0])*.5,(d[1]+f[1]-P)*.5);r.sub(g.vertices[0],d,p);r.sub(g.vertices[1],f,p);r.copy(g.vertices[2],g.vertices[1]);r.copy(g.vertices[3],g.vertices[0]);g.vertices[2][1]-=P;g.vertices[3][1]-=P;_+=this.convexConvex(t,e,i,s,n,g,p,0,l)}return _}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(t,e,i){e.exports=o;var r=t("../math/vec2");var s=t("../collision/RaycastResult");var n=t("../shapes/Shape");var a=t("../collision/AABB");function o(t){t=t||{};this.from=t.from?r.fromValues(t.from[0],t.from[1]):r.create();this.to=t.to?r.fromValues(t.to[0],t.to[1]):r.create();this.checkCollisionResponse=t.checkCollisionResponse!==undefined?t.checkCollisionResponse:true;this.skipBackfaces=!!t.skipBackfaces;this.collisionMask=t.collisionMask!==undefined?t.collisionMask:-1;this.collisionGroup=t.collisionGroup!==undefined?t.collisionGroup:-1;this.mode=t.mode!==undefined?t.mode:o.ANY;this.callback=t.callback||function(t){};this.direction=r.create();this.length=1;this.update()}o.prototype.constructor=o;o.CLOSEST=1;o.ANY=2;o.ALL=4;o.prototype.update=function(){var t=this.direction;r.sub(t,this.to,this.from);this.length=r.length(t);r.normalize(t,t)};o.prototype.intersectBodies=function(t,e){for(var i=0,r=e.length;!t.shouldStop(this)&&i<r;i++){var s=e[i];var n=s.getAABB();if(n.overlapsRay(this)>=0||n.containsPoint(this.from)){this.intersectBody(t,s)}}};var h=r.create();o.prototype.intersectBody=function(t,e){var i=this.checkCollisionResponse;if(i&&!e.collisionResponse){return}var s=h;for(var n=0,a=e.shapes.length;n<a;n++){var o=e.shapes[n];if(i&&!o.collisionResponse){continue}if((this.collisionGroup&o.collisionMask)===0||(o.collisionGroup&this.collisionMask)===0){continue}r.rotate(s,o.position,e.angle);r.add(s,s,e.position);var l=o.angle+e.angle;this.intersectShape(t,o,l,s,e);if(t.shouldStop(this)){break}}};o.prototype.intersectShape=function(t,e,i,r,s){var n=this.from;var a=f(n,this.direction,r);if(a>e.boundingRadius*e.boundingRadius){return}this._currentBody=s;this._currentShape=e;e.raycast(t,this,r,i);this._currentBody=this._currentShape=null};o.prototype.getAABB=function(t){var e=this.to;var i=this.from;r.set(t.lowerBound,Math.min(e[0],i[0]),Math.min(e[1],i[1]));r.set(t.upperBound,Math.max(e[0],i[0]),Math.max(e[1],i[1]))};var l=r.create();o.prototype.reportIntersection=function(t,e,i,s){var n=this.from;var a=this.to;var h=this._currentShape;var l=this._currentBody;if(this.skipBackfaces&&r.dot(i,this.direction)>0){return}switch(this.mode){case o.ALL:t.set(i,h,l,e,s);this.callback(t);break;case o.CLOSEST:if(e<t.fraction||!t.hasHit()){t.set(i,h,l,e,s)}break;case o.ANY:t.set(i,h,l,e,s);break}};var u=r.create(),c=r.create();function f(t,e,i){r.sub(u,i,t);var s=r.dot(u,e);r.scale(c,e,s);r.add(c,c,t);return r.squaredDistance(i,c)}},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(t,e,i){var r=t("../math/vec2");var s=t("../collision/Ray");e.exports=n;function n(){this.normal=r.create();this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false}n.prototype.reset=function(){r.set(this.normal,0,0);this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false};n.prototype.getHitDistance=function(t){return r.distance(t.from,t.to)*this.fraction};n.prototype.hasHit=function(){return this.fraction!==-1};n.prototype.getHitPoint=function(t,e){r.lerp(t,e.from,e.to,this.fraction)};n.prototype.stop=function(){this.isStopped=true};n.prototype.shouldStop=function(t){return this.isStopped||this.fraction!==-1&&t.mode===s.ANY};n.prototype.set=function(t,e,i,s,n){r.copy(this.normal,t);this.shape=e;this.body=i;this.fraction=s;this.faceIndex=n}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(t,e,i){var r=t("../utils/Utils"),s=t("../collision/Broadphase");e.exports=n;function n(){s.call(this,s.SAP);this.axisList=[];this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)};this._removeBodyHandler=function(e){var i=t.axisList.indexOf(e.body);if(i!==-1){t.axisList.splice(i,1)}}}n.prototype=new s;n.prototype.constructor=n;n.prototype.setWorld=function(t){this.axisList.length=0;r.appendArray(this.axisList,t.bodies);t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=t};n.sortAxisList=function(t,e){e=e|0;for(var i=1,r=t.length;i<r;i++){var s=t[i];for(var n=i-1;n>=0;n--){if(t[n].aabb.lowerBound[e]<=s.aabb.lowerBound[e]){break}t[n+1]=t[n]}t[n+1]=s}return t};n.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;n.sortAxisList(t,e)};n.prototype.getCollisionPairs=function(t){var e=this.axisList,i=this.result,r=this.axisIndex;i.length=0;var n=e.length;while(n--){var a=e[n];if(a.aabbNeedsUpdate){a.updateAABB()}}this.sortList();for(var o=0,h=e.length|0;o!==h;o++){var l=e[o];for(var u=o+1;u<h;u++){var c=e[u];var f=c.aabb.lowerBound[r]<=l.aabb.upperBound[r];if(!f){break}if(s.canCollide(l,c)&&this.boundingVolumeCheck(l,c)){i.push(l,c)}}}return i};n.prototype.aabbQuery=function(t,e,i){i=i||[];this.sortList();var r=this.axisIndex;var s="x";if(r===1){s="y"}if(r===2){s="z"}var n=this.axisList;var a=e.lowerBound[s];var o=e.upperBound[s];for(var h=0;h<n.length;h++){var l=n[h];if(l.aabbNeedsUpdate){l.updateAABB()}if(l.aabb.overlaps(e)){i.push(l)}}return i}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(t,e,i){e.exports=s;var r=t("../utils/Utils");function s(t,e,i,s){this.type=i;s=r.defaults(s,{collideConnected:true,wakeUpBodies:true});this.equations=[];this.bodyA=t;this.bodyB=e;this.collideConnected=s.collideConnected;if(s.wakeUpBodies){if(t){t.wakeUp()}if(e){e.wakeUp()}}}s.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")};s.DISTANCE=1;s.GEAR=2;s.LOCK=3;s.PRISMATIC=4;s.REVOLUTE=5;s.prototype.setStiffness=function(t){var e=this.equations;for(var i=0;i!==e.length;i++){var r=e[i];r.stiffness=t;r.needsUpdate=true}};s.prototype.setRelaxation=function(t){var e=this.equations;for(var i=0;i!==e.length;i++){var r=e[i];r.relaxation=t;r.needsUpdate=true}}},{"../utils/Utils":57}],15:[function(t,e,i){var r=t("./Constraint"),s=t("../equations/Equation"),n=t("../math/vec2"),a=t("../utils/Utils");e.exports=o;function o(t,e,i){i=a.defaults(i,{localAnchorA:[0,0],localAnchorB:[0,0]});r.call(this,t,e,r.DISTANCE,i);this.localAnchorA=n.fromValues(i.localAnchorA[0],i.localAnchorA[1]);this.localAnchorB=n.fromValues(i.localAnchorB[0],i.localAnchorB[1]);var o=this.localAnchorA;var h=this.localAnchorB;this.distance=0;if(typeof i.distance==="number"){this.distance=i.distance}else{var l=n.create(),u=n.create(),c=n.create();n.rotate(l,o,t.angle);n.rotate(u,h,e.angle);n.add(c,e.position,u);n.sub(c,c,l);n.sub(c,c,t.position);this.distance=n.length(c)}var f;if(typeof i.maxForce==="undefined"){f=Number.MAX_VALUE}else{f=i.maxForce}var d=new s(t,e,-f,f);this.equations=[d];this.maxForce=f;var c=n.create();var p=n.create();var g=n.create();var v=this;d.computeGq=function(){var t=this.bodyA,e=this.bodyB,i=t.position,r=e.position;n.rotate(p,o,t.angle);n.rotate(g,h,e.angle);n.add(c,r,g);n.sub(c,c,p);n.sub(c,c,i);return n.length(c)-v.distance};this.setMaxForce(f);this.upperLimitEnabled=false;this.upperLimit=1;this.lowerLimitEnabled=false;this.lowerLimit=0;this.position=0}o.prototype=new r;o.prototype.constructor=o;var h=n.create();var l=n.create();var u=n.create();o.prototype.update=function(){var t=this.equations[0],e=this.bodyA,i=this.bodyB,r=this.distance,s=e.position,a=i.position,o=this.equations[0],c=t.G;n.rotate(l,this.localAnchorA,e.angle);n.rotate(u,this.localAnchorB,i.angle);n.add(h,a,u);n.sub(h,h,l);n.sub(h,h,s);this.position=n.length(h);var f=false;if(this.upperLimitEnabled){if(this.position>this.upperLimit){o.maxForce=0;o.minForce=-this.maxForce;this.distance=this.upperLimit;f=true}}if(this.lowerLimitEnabled){if(this.position<this.lowerLimit){o.maxForce=this.maxForce;o.minForce=0;this.distance=this.lowerLimit;f=true}}if((this.lowerLimitEnabled||this.upperLimitEnabled)&&!f){o.enabled=false;return}o.enabled=true;n.normalize(h,h);var d=n.crossLength(l,h),p=n.crossLength(u,h);c[0]=-h[0];c[1]=-h[1];c[2]=-d;c[3]=h[0];c[4]=h[1];c[5]=p};o.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t;e.maxForce=t};o.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(t,e,i){var r=t("./Constraint"),s=t("../equations/Equation"),n=t("../equations/AngleLockEquation"),a=t("../math/vec2");e.exports=o;function o(t,e,i){i=i||{};r.call(this,t,e,r.GEAR,i);this.ratio=i.ratio!==undefined?i.ratio:1;this.angle=i.angle!==undefined?i.angle:e.angle-this.ratio*t.angle;i.angle=this.angle;i.ratio=this.ratio;this.equations=[new n(t,e,i)];if(i.maxTorque!==undefined){this.setMaxTorque(i.maxTorque)}}o.prototype=new r;o.prototype.constructor=o;o.prototype.update=function(){var t=this.equations[0];if(t.ratio!==this.ratio){t.setRatio(this.ratio)}t.angle=this.angle};o.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)};o.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(t,e,i){var r=t("./Constraint"),s=t("../math/vec2"),n=t("../equations/Equation");e.exports=a;function a(t,e,i){i=i||{};r.call(this,t,e,r.LOCK,i);var a=typeof i.maxForce==="undefined"?Number.MAX_VALUE:i.maxForce;var o=i.localAngleB||0;var h=new n(t,e,-a,a),l=new n(t,e,-a,a),u=new n(t,e,-a,a);var c=s.create(),f=s.create(),d=this;h.computeGq=function(){s.rotate(c,d.localOffsetB,t.angle);s.sub(f,e.position,t.position);s.sub(f,f,c);return f[0]};l.computeGq=function(){s.rotate(c,d.localOffsetB,t.angle);s.sub(f,e.position,t.position);s.sub(f,f,c);return f[1]};var p=s.create(),g=s.create();u.computeGq=function(){s.rotate(p,d.localOffsetB,e.angle-d.localAngleB);s.scale(p,p,-1);s.sub(f,t.position,e.position);s.add(f,f,p);s.rotate(g,p,-Math.PI/2);s.normalize(g,g);return s.dot(f,g)};this.localOffsetB=s.create();if(i.localOffsetB){s.copy(this.localOffsetB,i.localOffsetB)}else{s.sub(this.localOffsetB,e.position,t.position);s.rotate(this.localOffsetB,this.localOffsetB,-t.angle)}this.localAngleB=0;if(typeof i.localAngleB==="number"){this.localAngleB=i.localAngleB}else{this.localAngleB=e.angle-t.angle}this.equations.push(h,l,u);this.setMaxForce(a)}a.prototype=new r;a.prototype.constructor=a;a.prototype.setMaxForce=function(t){var e=this.equations;for(var i=0;i<this.equations.length;i++){e[i].maxForce=t;e[i].minForce=-t}};a.prototype.getMaxForce=function(){return this.equations[0].maxForce};var o=s.create();var h=s.create();var l=s.create();var u=s.fromValues(1,0);var c=s.fromValues(0,1);a.prototype.update=function(){var t=this.equations[0],e=this.equations[1],i=this.equations[2],r=this.bodyA,n=this.bodyB;s.rotate(o,this.localOffsetB,r.angle);s.rotate(h,this.localOffsetB,n.angle-this.localAngleB);s.scale(h,h,-1);s.rotate(l,h,Math.PI/2);s.normalize(l,l);t.G[0]=-1;t.G[1]=0;t.G[2]=-s.crossLength(o,u);t.G[3]=1;e.G[0]=0;e.G[1]=-1;e.G[2]=-s.crossLength(o,c);e.G[4]=1;i.G[0]=-l[0];i.G[1]=-l[1];i.G[3]=l[0];i.G[4]=l[1];i.G[5]=s.crossLength(h,l)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(t,e,i){var r=t("./Constraint"),s=t("../equations/ContactEquation"),n=t("../equations/Equation"),a=t("../math/vec2"),o=t("../equations/RotationalLockEquation");e.exports=h;function h(t,e,i){i=i||{};r.call(this,t,e,r.PRISMATIC,i);var h=a.fromValues(0,0),l=a.fromValues(1,0),u=a.fromValues(0,0);if(i.localAnchorA){a.copy(h,i.localAnchorA)}if(i.localAxisA){a.copy(l,i.localAxisA)}if(i.localAnchorB){a.copy(u,i.localAnchorB)}this.localAnchorA=h;this.localAnchorB=u;this.localAxisA=l;var c=this.maxForce=typeof i.maxForce!=="undefined"?i.maxForce:Number.MAX_VALUE;var f=new n(t,e,-c,c);var d=new a.create,p=new a.create,g=new a.create,v=new a.create;f.computeGq=function(){return a.dot(g,v)};f.updateJacobian=function(){var i=this.G,r=t.position,s=e.position;a.rotate(d,h,t.angle);a.rotate(p,u,e.angle);a.add(g,s,p);a.sub(g,g,r);a.sub(g,g,d);a.rotate(v,l,t.angle+Math.PI/2);i[0]=-v[0];i[1]=-v[1];i[2]=-a.crossLength(d,v)+a.crossLength(v,g);i[3]=v[0];i[4]=v[1];i[5]=a.crossLength(p,v)};this.equations.push(f);if(!i.disableRotationalLock){var m=new o(t,e,-c,c);this.equations.push(m)}this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof i.lowerLimit!=="undefined"?true:false;this.upperLimitEnabled=typeof i.upperLimit!=="undefined"?true:false;this.lowerLimit=typeof i.lowerLimit!=="undefined"?i.lowerLimit:0;this.upperLimit=typeof i.upperLimit!=="undefined"?i.upperLimit:1;this.upperLimitEquation=new s(t,e);this.lowerLimitEquation=new s(t,e);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=c;this.motorEquation=new n(t,e);this.motorEnabled=false;this.motorSpeed=0;var y=this;var x=this.motorEquation;var b=x.computeGW;x.computeGq=function(){return 0};x.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=e.velocity,s=i.velocity,n=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,r,n,s,a)+y.motorSpeed}}h.prototype=new r;h.prototype.constructor=h;var l=a.create(),u=a.create(),c=a.create(),f=a.create(),d=a.create(),p=a.create();h.prototype.update=function(){var t=this.equations,e=t[0],i=this.upperLimit,r=this.lowerLimit,s=this.upperLimitEquation,n=this.lowerLimitEquation,o=this.bodyA,h=this.bodyB,g=this.localAxisA,v=this.localAnchorA,m=this.localAnchorB;e.updateJacobian();a.rotate(l,g,o.angle);a.rotate(f,v,o.angle);a.add(u,f,o.position);a.rotate(d,m,h.angle);a.add(c,d,h.position);var y=this.position=a.dot(c,l)-a.dot(u,l);if(this.motorEnabled){var x=this.motorEquation.G;x[0]=l[0];x[1]=l[1];x[2]=a.crossLength(l,d);x[3]=-l[0];x[4]=-l[1];x[5]=-a.crossLength(l,f)}if(this.upperLimitEnabled&&y>i){a.scale(s.normalA,l,-1);a.sub(s.contactPointA,u,o.position);a.sub(s.contactPointB,c,h.position);a.scale(p,l,i);a.add(s.contactPointA,s.contactPointA,p);if(t.indexOf(s)===-1){t.push(s)}}else{var b=t.indexOf(s);if(b!==-1){t.splice(b,1)}}if(this.lowerLimitEnabled&&y<r){a.scale(n.normalA,l,1);a.sub(n.contactPointA,u,o.position);a.sub(n.contactPointB,c,h.position);a.scale(p,l,r);a.sub(n.contactPointB,n.contactPointB,p);if(t.indexOf(n)===-1){t.push(n)}}else{var b=t.indexOf(n);if(b!==-1){t.splice(b,1)}}};h.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};h.prototype.disableMotor=function(){if(!this.motorEnabled){return}var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1);this.motorEnabled=false};h.prototype.setLimits=function(t,e){if(typeof t==="number"){this.lowerLimit=t;this.lowerLimitEnabled=true}else{this.lowerLimit=t;this.lowerLimitEnabled=false}if(typeof e==="number"){this.upperLimit=e;this.upperLimitEnabled=true}else{this.upperLimit=e;this.upperLimitEnabled=false}}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(t,e,i){var r=t("./Constraint"),s=t("../equations/Equation"),n=t("../equations/RotationalVelocityEquation"),a=t("../equations/RotationalLockEquation"),o=t("../math/vec2");e.exports=d;var h=o.create(),l=o.create(),u=o.fromValues(1,0),c=o.fromValues(0,1),f=o.create();function d(t,e,i){i=i||{};r.call(this,t,e,r.REVOLUTE,i);var d=this.maxForce=typeof i.maxForce!=="undefined"?i.maxForce:Number.MAX_VALUE;this.pivotA=o.create();this.pivotB=o.create();if(i.worldPivot){o.sub(this.pivotA,i.worldPivot,t.position);o.sub(this.pivotB,i.worldPivot,e.position);o.rotate(this.pivotA,this.pivotA,-t.angle);o.rotate(this.pivotB,this.pivotB,-e.angle)}else{o.copy(this.pivotA,i.localPivotA);o.copy(this.pivotB,i.localPivotB)}var p=this.equations=[new s(t,e,-d,d),new s(t,e,-d,d)];var g=p[0];var v=p[1];var m=this;g.computeGq=function(){o.rotate(h,m.pivotA,t.angle);o.rotate(l,m.pivotB,e.angle);o.add(f,e.position,l);o.sub(f,f,t.position);o.sub(f,f,h);return o.dot(f,u)};v.computeGq=function(){o.rotate(h,m.pivotA,t.angle);o.rotate(l,m.pivotB,e.angle);o.add(f,e.position,l);o.sub(f,f,t.position);o.sub(f,f,h);return o.dot(f,c)};v.minForce=g.minForce=-d;v.maxForce=g.maxForce=d;this.motorEquation=new n(t,e);this.motorEnabled=false;this.angle=0;this.lowerLimitEnabled=false;this.upperLimitEnabled=false;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new a(t,e);this.lowerLimitEquation=new a(t,e);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}d.prototype=new r;d.prototype.constructor=d;d.prototype.setLimits=function(t,e){if(typeof t==="number"){this.lowerLimit=t;this.lowerLimitEnabled=true}else{this.lowerLimit=t;this.lowerLimitEnabled=false}if(typeof e==="number"){this.upperLimit=e;this.upperLimitEnabled=true}else{this.upperLimit=e;this.upperLimitEnabled=false}};d.prototype.update=function(){var t=this.bodyA,e=this.bodyB,i=this.pivotA,r=this.pivotB,s=this.equations,n=s[0],a=s[1],f=s[0],d=s[1],p=this.upperLimit,g=this.lowerLimit,v=this.upperLimitEquation,m=this.lowerLimitEquation;var y=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&y>p){v.angle=p;if(s.indexOf(v)===-1){s.push(v)}}else{var x=s.indexOf(v);if(x!==-1){s.splice(x,1)}}if(this.lowerLimitEnabled&&y<g){m.angle=g;if(s.indexOf(m)===-1){s.push(m)}}else{var x=s.indexOf(m);if(x!==-1){s.splice(x,1)}}o.rotate(h,i,t.angle);o.rotate(l,r,e.angle);f.G[0]=-1;f.G[1]=0;f.G[2]=-o.crossLength(h,u);f.G[3]=1;f.G[4]=0;f.G[5]=o.crossLength(l,u);d.G[0]=0;d.G[1]=-1;d.G[2]=-o.crossLength(h,c);d.G[3]=0;d.G[4]=1;d.G[5]=o.crossLength(l,c)};d.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};d.prototype.disableMotor=function(){if(!this.motorEnabled){return}var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1);this.motorEnabled=false};d.prototype.motorIsEnabled=function(){return!!this.motorEnabled};d.prototype.setMotorSpeed=function(t){if(!this.motorEnabled){return}var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t};d.prototype.getMotorSpeed=function(){if(!this.motorEnabled){return false}return this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(t,e,i){var r=t("./Equation"),s=t("../math/vec2");e.exports=n;function n(t,e,i){i=i||{};r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;this.ratio=typeof i.ratio==="number"?i.ratio:1;this.setRatio(this.ratio)}n.prototype=new r;n.prototype.constructor=n;n.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};n.prototype.setRatio=function(t){var e=this.G;e[2]=t;e[5]=-1;this.ratio=t};n.prototype.setMaxTorque=function(t){this.maxForce=t;this.minForce=-t}},{"../math/vec2":30,"./Equation":22}],21:[function(t,e,i){var r=t("./Equation"),s=t("../math/vec2");e.exports=n;function n(t,e){r.call(this,t,e,0,Number.MAX_VALUE);this.contactPointA=s.create();this.penetrationVec=s.create();this.contactPointB=s.create();this.normalA=s.create();this.restitution=0;this.firstImpact=false;this.shapeA=null;this.shapeB=null}n.prototype=new r;n.prototype.constructor=n;n.prototype.computeB=function(t,e,i){var r=this.bodyA,n=this.bodyB,a=this.contactPointA,o=this.contactPointB,h=r.position,l=n.position;var u=this.penetrationVec,c=this.normalA,f=this.G;var d=s.crossLength(a,c),p=s.crossLength(o,c);f[0]=-c[0];f[1]=-c[1];f[2]=-d;f[3]=c[0];f[4]=c[1];f[5]=p;s.add(u,l,o);s.sub(u,u,h);s.sub(u,u,a);var g,v;if(this.firstImpact&&this.restitution!==0){v=0;g=1/e*(1+this.restitution)*this.computeGW()}else{v=s.dot(c,u)+this.offset;g=this.computeGW()}var m=this.computeGiMf();var y=-v*t-g*e-i*m;return y}},{"../math/vec2":30,"./Equation":22}],22:[function(t,e,i){e.exports=a;var r=t("../math/vec2"),s=t("../utils/Utils"),n=t("../objects/Body");function a(t,e,i,r){this.minForce=typeof i==="undefined"?-Number.MAX_VALUE:i;this.maxForce=typeof r==="undefined"?Number.MAX_VALUE:r;this.bodyA=t;this.bodyB=e;this.stiffness=a.DEFAULT_STIFFNESS;this.relaxation=a.DEFAULT_RELAXATION;this.G=new s.ARRAY_TYPE(6);for(var n=0;n<6;n++){this.G[n]=0}this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=true;this.multiplier=0;this.relativeVelocity=0;this.enabled=true}a.prototype.constructor=a;a.DEFAULT_STIFFNESS=1e6;a.DEFAULT_RELAXATION=4;a.prototype.update=function(){var t=this.stiffness,e=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*e));this.b=4*e/(1+4*e);this.epsilon=4/(i*i*t*(1+4*e));this.needsUpdate=false};a.prototype.gmult=function(t,e,i,r,s){return t[0]*e[0]+t[1]*e[1]+t[2]*i+t[3]*r[0]+t[4]*r[1]+t[5]*s};a.prototype.computeB=function(t,e,i){var r=this.computeGW();var s=this.computeGq();var n=this.computeGiMf();return-s*t-r*e-n*i};var o=r.create(),h=r.create();a.prototype.computeGq=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=e.position,s=i.position,n=e.angle,a=i.angle;return this.gmult(t,o,n,h,a)+this.offset};a.prototype.computeGW=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=e.velocity,s=i.velocity,n=e.angularVelocity,a=i.angularVelocity;return this.gmult(t,r,n,s,a)+this.relativeVelocity};a.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,i=this.bodyB,r=e.vlambda,s=i.vlambda,n=e.wlambda,a=i.wlambda;return this.gmult(t,r,n,s,a)};var l=r.create(),u=r.create();a.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,i=t.force,s=t.angularForce,n=e.force,a=e.angularForce,o=t.invMassSolve,h=e.invMassSolve,c=t.invInertiaSolve,f=e.invInertiaSolve,d=this.G;r.scale(l,i,o);r.multiply(l,t.massMultiplier,l);r.scale(u,n,h);r.multiply(u,e.massMultiplier,u);return this.gmult(d,l,s*c,u,a*f)};a.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,i=t.invMassSolve,r=e.invMassSolve,s=t.invInertiaSolve,n=e.invInertiaSolve,a=this.G;return a[0]*a[0]*i*t.massMultiplier[0]+a[1]*a[1]*i*t.massMultiplier[1]+a[2]*a[2]*s+a[3]*a[3]*r*e.massMultiplier[0]+a[4]*a[4]*r*e.massMultiplier[1]+a[5]*a[5]*n};var c=r.create(),f=r.create(),d=r.create(),p=r.create(),g=r.create(),v=r.create();a.prototype.addToWlambda=function(t){var e=this.bodyA,i=this.bodyB,s=c,n=f,a=d,o=p,h=g,l=e.invMassSolve,u=i.invMassSolve,m=e.invInertiaSolve,y=i.invInertiaSolve,x=v,b=this.G;n[0]=b[0];n[1]=b[1];a[0]=b[3];a[1]=b[4];r.scale(s,n,l*t);r.multiply(s,s,e.massMultiplier);r.add(e.vlambda,e.vlambda,s);e.wlambda+=m*b[2]*t;r.scale(s,a,u*t);r.multiply(s,s,i.massMultiplier);r.add(i.vlambda,i.vlambda,s);i.wlambda+=y*b[5]*t};a.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(t,e,i){var r=t("../math/vec2"),s=t("./Equation"),n=t("../utils/Utils");e.exports=a;function a(t,e,i){s.call(this,t,e,-i,i);this.contactPointA=r.create();this.contactPointB=r.create();this.t=r.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=.3}a.prototype=new s;a.prototype.constructor=a;a.prototype.setSlipForce=function(t){this.maxForce=t;this.minForce=-t};a.prototype.getSlipForce=function(){return this.maxForce};a.prototype.computeB=function(t,e,i){var s=this.bodyA,n=this.bodyB,a=this.contactPointA,o=this.contactPointB,h=this.t,l=this.G;l[0]=-h[0];l[1]=-h[1];l[2]=-r.crossLength(a,h);l[3]=h[0];l[4]=h[1];l[5]=r.crossLength(o,h);var u=this.computeGW(),c=this.computeGiMf();var f=-u*e-i*c;return f}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(t,e,i){var r=t("./Equation"),s=t("../math/vec2");e.exports=n;function n(t,e,i){i=i||{};r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;var s=this.G;s[2]=1;s[5]=-1}n.prototype=new r;n.prototype.constructor=n;var a=s.create(),o=s.create(),h=s.fromValues(1,0),l=s.fromValues(0,1);n.prototype.computeGq=function(){s.rotate(a,h,this.bodyA.angle+this.angle);s.rotate(o,l,this.bodyB.angle);return s.dot(a,o)}},{"../math/vec2":30,"./Equation":22}],25:[function(t,e,i){var r=t("./Equation"),s=t("../math/vec2");e.exports=n;function n(t,e){r.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}n.prototype=new r;n.prototype.constructor=n;n.prototype.computeB=function(t,e,i){var r=this.G;r[2]=-1;r[5]=this.ratio;var s=this.computeGiMf();var n=this.computeGW();var a=-n*e-i*s;return a}},{"../math/vec2":30,"./Equation":22}],26:[function(t,e,i){var r=function(){};e.exports=r;r.prototype={constructor:r,on:function(t,e,i){e.context=i||this;if(this._listeners===undefined){this._listeners={}}var r=this._listeners;if(r[t]===undefined){r[t]=[]}if(r[t].indexOf(e)===-1){r[t].push(e)}return this},has:function(t,e){if(this._listeners===undefined){return false}var i=this._listeners;if(e){if(i[t]!==undefined&&i[t].indexOf(e)!==-1){return true}}else{if(i[t]!==undefined){return true}}return false},off:function(t,e){if(this._listeners===undefined){return this}var i=this._listeners;var r=i[t].indexOf(e);if(r!==-1){i[t].splice(r,1)}return this},emit:function(t){if(this._listeners===undefined){return this}var e=this._listeners;var i=e[t.type];if(i!==undefined){t.target=this;for(var r=0,s=i.length;r<s;r++){var n=i[r];n.call(n.context,t)}}return this}}},{}],27:[function(t,e,i){var r=t("./Material");var s=t("../equations/Equation");e.exports=n;function n(t,e,i){i=i||{};if(!(t instanceof r)||!(e instanceof r)){throw new Error("First two arguments must be Material instances.")}this.id=n.idCounter++;this.materialA=t;this.materialB=e;this.friction=typeof i.friction!=="undefined"?Number(i.friction):.3;this.restitution=typeof i.restitution!=="undefined"?Number(i.restitution):0;this.stiffness=typeof i.stiffness!=="undefined"?Number(i.stiffness):s.DEFAULT_STIFFNESS;this.relaxation=typeof i.relaxation!=="undefined"?Number(i.relaxation):s.DEFAULT_RELAXATION;this.frictionStiffness=typeof i.frictionStiffness!=="undefined"?Number(i.frictionStiffness):s.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof i.frictionRelaxation!=="undefined"?Number(i.frictionRelaxation):s.DEFAULT_RELAXATION;this.surfaceVelocity=typeof i.surfaceVelocity!=="undefined"?Number(i.surfaceVelocity):0;this.contactSkinSize=.005}n.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(t,e,i){e.exports=r;function r(t){this.id=t||r.idCounter++}r.idCounter=0},{}],29:[function(t,e,i){var r={};r.GetArea=function(t){if(t.length<6)return 0;var e=t.length-2;var i=0;for(var r=0;r<e;r+=2)i+=(t[r+2]-t[r])*(t[r+1]+t[r+3]);i+=(t[0]-t[e])*(t[e+1]+t[1]);return-i*.5};r.Triangulate=function(t){var e=t.length>>1;if(e<3)return[];var i=[];var s=[];for(var n=0;n<e;n++)s.push(n);var n=0;var a=e;while(a>3){var o=s[(n+0)%a];var h=s[(n+1)%a];var l=s[(n+2)%a];var u=t[2*o],c=t[2*o+1];var f=t[2*h],d=t[2*h+1];var p=t[2*l],g=t[2*l+1];var v=false;if(r._convex(u,c,f,d,p,g)){v=true;for(var m=0;m<a;m++){var y=s[m];if(y==o||y==h||y==l)continue;if(r._PointInTriangle(t[2*y],t[2*y+1],u,c,f,d,p,g)){v=false;break}}}if(v){i.push(o,h,l);s.splice((n+1)%a,1);a--;n=0}else if(n++>3*a)break}i.push(s[0],s[1],s[2]);return i};r._PointInTriangle=function(t,e,i,r,s,n,a,o){var h=a-i;var l=o-r;var u=s-i;var c=n-r;var f=t-i;var d=e-r;var p=h*h+l*l;var g=h*u+l*c;var v=h*f+l*d;var m=u*u+c*c;var y=u*f+c*d;var x=1/(p*m-g*g);var b=(m*v-g*y)*x;var w=(p*y-g*v)*x;return b>=0&&w>=0&&b+w<1};r._convex=function(t,e,i,r,s,n){return(e-r)*(s-i)+(i-t)*(n-r)>=0};e.exports=r},{}],30:[function(t,e,i){var r=e.exports={};var s=t("../utils/Utils");r.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]};r.crossVZ=function(t,e,i){r.rotate(t,e,-Math.PI/2);r.scale(t,t,i);return t};r.crossZV=function(t,e,i){r.rotate(t,i,Math.PI/2);r.scale(t,t,e);return t};r.rotate=function(t,e,i){if(i!==0){var r=Math.cos(i),s=Math.sin(i),n=e[0],a=e[1];t[0]=r*n-s*a;t[1]=s*n+r*a}else{t[0]=e[0];t[1]=e[1]}};r.rotate90cw=function(t,e){var i=e[0];var r=e[1];t[0]=r;t[1]=-i};r.toLocalFrame=function(t,e,i,s){r.copy(t,e);r.sub(t,t,i);r.rotate(t,t,-s)};r.toGlobalFrame=function(t,e,i,s){r.copy(t,e);r.rotate(t,t,s);r.add(t,t,i)};r.vectorToLocalFrame=function(t,e,i){r.rotate(t,e,-i)};r.vectorToGlobalFrame=function(t,e,i){r.rotate(t,e,i)};r.centroid=function(t,e,i,s){r.add(t,e,i);r.add(t,t,s);r.scale(t,t,1/3);return t};r.create=function(){var t=new s.ARRAY_TYPE(2);t[0]=0;t[1]=0;return t};r.clone=function(t){var e=new s.ARRAY_TYPE(2);e[0]=t[0];e[1]=t[1];return e};r.fromValues=function(t,e){var i=new s.ARRAY_TYPE(2);i[0]=t;i[1]=e;return i};r.copy=function(t,e){t[0]=e[0];t[1]=e[1];return t};r.set=function(t,e,i){t[0]=e;t[1]=i;return t};r.add=function(t,e,i){t[0]=e[0]+i[0];t[1]=e[1]+i[1];return t};r.subtract=function(t,e,i){t[0]=e[0]-i[0];t[1]=e[1]-i[1];return t};r.sub=r.subtract;r.multiply=function(t,e,i){t[0]=e[0]*i[0];t[1]=e[1]*i[1];return t};r.mul=r.multiply;r.divide=function(t,e,i){t[0]=e[0]/i[0];t[1]=e[1]/i[1];return t};r.div=r.divide;r.scale=function(t,e,i){t[0]=e[0]*i;t[1]=e[1]*i;return t};r.distance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)};r.dist=r.distance;r.squaredDistance=function(t,e){var i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r};r.sqrDist=r.squaredDistance;r.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)};r.len=r.length;r.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i};r.sqrLen=r.squaredLength;r.negate=function(t,e){t[0]=-e[0];t[1]=-e[1];return t};r.normalize=function(t,e){var i=e[0],r=e[1];var s=i*i+r*r;if(s>0){s=1/Math.sqrt(s);t[0]=e[0]*s;t[1]=e[1]*s}return t};r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]};r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"};r.lerp=function(t,e,i,r){var s=e[0],n=e[1];t[0]=s+r*(i[0]-s);t[1]=n+r*(i[1]-n);return t};r.reflect=function(t,e,i){var r=e[0]*i[0]+e[1]*i[1];t[0]=e[0]-2*i[0]*r;t[1]=e[1]-2*i[1]*r};r.getLineSegmentsIntersection=function(t,e,i,s,n){var a=r.getLineSegmentsIntersectionFraction(e,i,s,n);if(a<0){return false}else{t[0]=e[0]+a*(i[0]-e[0]);t[1]=e[1]+a*(i[1]-e[1]);return true}};r.getLineSegmentsIntersectionFraction=function(t,e,i,r){var s=e[0]-t[0];var n=e[1]-t[1];var a=r[0]-i[0];var o=r[1]-i[1];var h,l;h=(-n*(t[0]-i[0])+s*(t[1]-i[1]))/(-a*n+s*o);l=(a*(t[1]-i[1])-o*(t[0]-i[0]))/(-a*n+s*o);if(h>=0&&h<=1&&l>=0&&l<=1){return l}return-1}},{"../utils/Utils":57}],31:[function(t,e,i){var r=t("../math/vec2"),s=t("poly-decomp"),n=t("../shapes/Convex"),a=t("../collision/RaycastResult"),o=t("../collision/Ray"),h=t("../collision/AABB"),l=t("../events/EventEmitter");e.exports=u;function u(t){t=t||{};l.call(this);this.id=t.id||++u._idCounter;this.world=null;this.shapes=[];this.mass=t.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!t.fixedRotation;this.fixedX=!!t.fixedX;this.fixedY=!!t.fixedY;this.massMultiplier=r.create();this.position=r.fromValues(0,0);if(t.position){r.copy(this.position,t.position)}this.interpolatedPosition=r.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=r.fromValues(0,0);this.previousAngle=0;this.velocity=r.fromValues(0,0);if(t.velocity){r.copy(this.velocity,t.velocity)}this.vlambda=r.fromValues(0,0);this.wlambda=0;this.angle=t.angle||0;this.angularVelocity=t.angularVelocity||0;this.force=r.create();if(t.force){r.copy(this.force,t.force)}this.angularForce=t.angularForce||0;this.damping=typeof t.damping==="number"?t.damping:.1;this.angularDamping=typeof t.angularDamping==="number"?t.angularDamping:.1;this.type=u.STATIC;if(typeof t.type!=="undefined"){this.type=t.type}else if(!t.mass){this.type=u.STATIC}else{this.type=u.DYNAMIC}this.boundingRadius=0;this.aabb=new h;this.aabbNeedsUpdate=true;this.allowSleep=t.allowSleep!==undefined?t.allowSleep:true;this.wantsToSleep=false;this.sleepState=u.AWAKE;this.sleepSpeedLimit=t.sleepSpeedLimit!==undefined?t.sleepSpeedLimit:.2;this.sleepTimeLimit=t.sleepTimeLimit!==undefined?t.sleepTimeLimit:1;this.gravityScale=t.gravityScale!==undefined?t.gravityScale:1;this.collisionResponse=t.collisionResponse!==undefined?t.collisionResponse:true;this.idleTime=0;this.timeLastSleepy=0;this.ccdSpeedThreshold=t.ccdSpeedThreshold!==undefined?t.ccdSpeedThreshold:-1;this.ccdIterations=t.ccdIterations!==undefined?t.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=false;this.updateMassProperties()}u.prototype=new l;u.prototype.constructor=u;u._idCounter=0;u.prototype.updateSolveMassProperties=function(){if(this.sleepState===u.SLEEPING||this.type===u.KINEMATIC){this.invMassSolve=0;this.invInertiaSolve=0}else{this.invMassSolve=this.invMass;this.invInertiaSolve=this.invInertia}};u.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t;this.updateMassProperties()};u.prototype.getArea=function(){var t=0;for(var e=0;e<this.shapes.length;e++){t+=this.shapes[e].area}return t};u.prototype.getAABB=function(){if(this.aabbNeedsUpdate){this.updateAABB()}return this.aabb};var c=new h,f=r.create();u.prototype.updateAABB=function(){var t=this.shapes,e=t.length,i=f,s=this.angle;for(var n=0;n!==e;n++){var a=t[n],o=a.angle+s;r.rotate(i,a.position,s);r.add(i,i,this.position);a.computeAABB(c,i,o);if(n===0){this.aabb.copy(c)}else{this.aabb.extend(c)}}this.aabbNeedsUpdate=false};u.prototype.updateBoundingRadius=function(){var t=this.shapes,e=t.length,i=0;for(var s=0;s!==e;s++){var n=t[s],a=r.length(n.position),o=n.boundingRadius;if(a+o>i){i=a+o}}this.boundingRadius=i};u.prototype.addShape=function(t,e,i){if(t.body){throw new Error("A shape can only be added to one body.")}t.body=this;if(e){r.copy(t.position,e)}else{r.set(t.position,0,0)}t.angle=i||0;this.shapes.push(t);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=true};u.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);if(e!==-1){this.shapes.splice(e,1);this.aabbNeedsUpdate=true;t.body=null;return true}else{return false}};u.prototype.updateMassProperties=function(){if(this.type===u.STATIC||this.type===u.KINEMATIC){this.mass=Number.MAX_VALUE;this.invMass=0;this.inertia=Number.MAX_VALUE;this.invInertia=0}else{var t=this.shapes,e=t.length,i=this.mass/e,s=0;if(!this.fixedRotation){for(var n=0;n<e;n++){var a=t[n],o=r.squaredLength(a.position),h=a.computeMomentOfInertia(i);s+=h+i*o}this.inertia=s;this.invInertia=s>0?1/s:0}else{this.inertia=Number.MAX_VALUE;this.invInertia=0}this.invMass=1/this.mass;r.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};var d=r.create();u.prototype.applyForce=function(t,e){r.add(this.force,this.force,t);if(e){var i=r.crossLength(e,t);this.angularForce+=i}};var p=r.create();var g=r.create();var v=r.create();u.prototype.applyForceLocal=function(t,e){e=e||v;var i=p;var r=g;this.vectorToWorldFrame(i,t);this.vectorToWorldFrame(r,e);this.applyForce(i,r)};var m=r.create();u.prototype.applyImpulse=function(t,e){if(this.type!==u.DYNAMIC){return}var i=m;r.scale(i,t,this.invMass);r.multiply(i,this.massMultiplier,i);r.add(this.velocity,i,this.velocity);if(e){var s=r.crossLength(e,t);s*=this.invInertia;this.angularVelocity+=s}};var y=r.create();var x=r.create();var b=r.create();u.prototype.applyImpulseLocal=function(t,e){e=e||b;var i=y;var r=x;this.vectorToWorldFrame(i,t);this.vectorToWorldFrame(r,e);this.applyImpulse(i,r)};u.prototype.toLocalFrame=function(t,e){r.toLocalFrame(t,e,this.position,this.angle)};u.prototype.toWorldFrame=function(t,e){r.toGlobalFrame(t,e,this.position,this.angle)};u.prototype.vectorToLocalFrame=function(t,e){r.vectorToLocalFrame(t,e,this.angle)};u.prototype.vectorToWorldFrame=function(t,e){r.vectorToGlobalFrame(t,e,this.angle)};u.prototype.fromPolygon=function(t,e){e=e||{};for(var i=this.shapes.length;i>=0;--i){this.removeShape(this.shapes[i])}var a=new s.Polygon;a.vertices=t;a.makeCCW();if(typeof e.removeCollinearPoints==="number"){a.removeCollinearPoints(e.removeCollinearPoints)}if(typeof e.skipSimpleCheck==="undefined"){if(!a.isSimple()){return false}}this.concavePath=a.vertices.slice(0);for(var i=0;i<this.concavePath.length;i++){var o=[0,0];r.copy(o,this.concavePath[i]);this.concavePath[i]=o}var h;if(e.optimalDecomp){h=a.decomp()}else{h=a.quickDecomp()}var l=r.create();for(var i=0;i!==h.length;i++){var u=new n({vertices:h[i].vertices});for(var c=0;c!==u.vertices.length;c++){var o=u.vertices[c];r.sub(o,o,u.centerOfMass)}r.scale(l,u.centerOfMass,1);u.updateTriangles();u.updateCenterOfMass();u.updateBoundingRadius();this.addShape(u,l)}this.adjustCenterOfMass();this.aabbNeedsUpdate=true;return true};var w=r.fromValues(0,0),_=r.fromValues(0,0),P=r.fromValues(0,0),T=r.fromValues(0,0);u.prototype.adjustCenterOfMass=function(){var t=_,e=P,i=T,s=0;r.set(e,0,0);for(var n=0;n!==this.shapes.length;n++){var a=this.shapes[n];r.scale(t,a.position,a.area);r.add(e,e,t);s+=a.area}r.scale(i,e,1/s);for(var n=0;n!==this.shapes.length;n++){var a=this.shapes[n];r.sub(a.position,a.position,i)}r.add(this.position,this.position,i);for(var n=0;this.concavePath&&n<this.concavePath.length;n++){r.sub(this.concavePath[n],this.concavePath[n],i)}this.updateMassProperties();this.updateBoundingRadius()};u.prototype.setZeroForce=function(){r.set(this.force,0,0);this.angularForce=0};u.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;r.set(e,0,0);t.wlambda=0};u.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;r.add(e,e,t.vlambda);t.angularVelocity+=t.wlambda};u.prototype.applyDamping=function(t){if(this.type===u.DYNAMIC){var e=this.velocity;r.scale(e,e,Math.pow(1-this.damping,t));this.angularVelocity*=Math.pow(1-this.angularDamping,t)}};u.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=u.AWAKE;this.idleTime=0;if(t!==u.AWAKE){this.emit(u.wakeUpEvent)}};u.prototype.sleep=function(){this.sleepState=u.SLEEPING;this.angularVelocity=0;this.angularForce=0;r.set(this.velocity,0,0);r.set(this.force,0,0);this.emit(u.sleepEvent)};u.prototype.sleepTick=function(t,e,i){if(!this.allowSleep||this.type===u.SLEEPING){return}this.wantsToSleep=false;var s=this.sleepState,n=r.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),a=Math.pow(this.sleepSpeedLimit,2);if(n>=a){this.idleTime=0;this.sleepState=u.AWAKE}else{this.idleTime+=i;this.sleepState=u.SLEEPY}if(this.idleTime>this.sleepTimeLimit){if(!e){this.sleep()}else{this.wantsToSleep=true}}};u.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var C=r.create();var S=r.create();u.prototype.integrate=function(t){var e=this.invMass,i=this.force,s=this.position,n=this.velocity;r.copy(this.previousPosition,this.position);this.previousAngle=this.angle;if(!this.fixedRotation){this.angularVelocity+=this.angularForce*this.invInertia*t}r.scale(C,i,t*e);r.multiply(C,this.massMultiplier,C);r.add(n,C,n);if(!this.integrateToTimeOfImpact(t)){r.scale(S,n,t);r.add(s,s,S);if(!this.fixedRotation){this.angle+=this.angularVelocity*t}}this.aabbNeedsUpdate=true};var A=new a;var E=new o({mode:o.ALL});var I=r.create();var M=r.create();var R=r.create();var B=r.create();u.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||r.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2)){return false}r.normalize(I,this.velocity);r.scale(M,this.velocity,t);r.add(M,M,this.position);r.sub(R,M,this.position);var e=this.angularVelocity*t;var i=r.length(R);var s=1;var n;var a=this;A.reset();E.callback=function(t){if(t.body===a){return}n=t.body;t.getHitPoint(M,E);r.sub(R,M,a.position);s=r.length(R)/i;t.stop()};r.copy(E.from,this.position);r.copy(E.to,M);E.update();this.world.raycast(A,E);if(!n){return false}var o=this.angle;r.copy(B,this.position);var h=0;var l=0;var u=0;var c=s;while(c>=l&&h<this.ccdIterations){h++;u=(c-l)/2;r.scale(S,R,s);r.add(this.position,B,S);this.angle=o+e*s;this.updateAABB();var f=this.aabb.overlaps(n.aabb)&&this.world.narrowphase.bodiesOverlap(this,n);if(f){l=u}else{c=u}}s=u;r.copy(this.position,B);this.angle=o;r.scale(S,R,s);r.add(this.position,this.position,S);if(!this.fixedRotation){this.angle+=e*s}return true};u.prototype.getVelocityAtPoint=function(t,e){r.crossVZ(t,e,this.angularVelocity);r.subtract(t,this.velocity,t);return t};u.sleepyEvent={type:"sleepy"};u.sleepEvent={type:"sleep"};u.wakeUpEvent={type:"wakeup"};u.DYNAMIC=1;u.STATIC=2;u.KINEMATIC=4;u.AWAKE=0;u.SLEEPY=1;u.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(t,e,i){var r=t("../math/vec2");var s=t("./Spring");var n=t("../utils/Utils");e.exports=a;function a(t,e,i){i=i||{};s.call(this,t,e,i);this.localAnchorA=r.fromValues(0,0);this.localAnchorB=r.fromValues(0,0);if(i.localAnchorA){r.copy(this.localAnchorA,i.localAnchorA)}if(i.localAnchorB){r.copy(this.localAnchorB,i.localAnchorB)}if(i.worldAnchorA){this.setWorldAnchorA(i.worldAnchorA)}if(i.worldAnchorB){this.setWorldAnchorB(i.worldAnchorB)}var n=r.create();var a=r.create();this.getWorldAnchorA(n);this.getWorldAnchorB(a);var o=r.distance(n,a);this.restLength=typeof i.restLength==="number"?i.restLength:o}a.prototype=new s;a.prototype.constructor=a;a.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)};a.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)};a.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)};a.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var o=r.create(),h=r.create(),l=r.create(),u=r.create(),c=r.create(),f=r.create(),d=r.create(),p=r.create(),g=r.create();a.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restLength,s=this.bodyA,n=this.bodyB,a=o,v=h,m=l,y=u,x=g;var b=c,w=f,_=d,P=p;this.getWorldAnchorA(b);this.getWorldAnchorB(w);r.sub(_,b,s.position);r.sub(P,w,n.position);r.sub(a,w,b);var T=r.len(a);r.normalize(v,a);r.sub(m,n.velocity,s.velocity);r.crossZV(x,n.angularVelocity,P);r.add(m,m,x);r.crossZV(x,s.angularVelocity,_);r.sub(m,m,x);r.scale(y,v,-t*(T-i)-e*r.dot(m,v));r.sub(s.force,s.force,y);r.add(n.force,n.force,y);var C=r.crossLength(_,y);var S=r.crossLength(P,y);s.angularForce-=C;n.angularForce+=S}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(t,e,i){var r=t("../math/vec2");var s=t("./Spring");e.exports=n;function n(t,e,i){i=i||{};s.call(this,t,e,i);this.restAngle=typeof i.restAngle==="number"?i.restAngle:e.angle-t.angle}n.prototype=new s;n.prototype.constructor=n;n.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,i=this.restAngle,r=this.bodyA,s=this.bodyB,n=s.angle-r.angle,a=s.angularVelocity-r.angularVelocity;var o=-t*(n-i)-e*a*0;r.angularForce-=o;s.angularForce+=o}},{"../math/vec2":30,"./Spring":34}],34:[function(t,e,i){var r=t("../math/vec2");var s=t("../utils/Utils");e.exports=n;function n(t,e,i){i=s.defaults(i,{stiffness:100,damping:1});this.stiffness=i.stiffness;this.damping=i.damping;this.bodyA=t;this.bodyB=e}n.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(t,e,i){var r=t("../math/vec2");var s=t("../utils/Utils");var n=t("../constraints/Constraint");var a=t("../equations/FrictionEquation");var o=t("../objects/Body");e.exports=h;function h(t,e){e=e||{};this.chassisBody=t;this.wheels=[];this.groundBody=new o({mass:0});this.world=null;var i=this;this.preStepCallback=function(){i.update()}}h.prototype.addToWorld=function(t){this.world=t;t.addBody(this.groundBody);t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.addConstraint(i)}};h.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody);t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var i=this.wheels[e];t.removeConstraint(i)}this.world=null};h.prototype.addWheel=function(t){var e=new l(this,t);this.wheels.push(e);return e};h.prototype.update=function(){for(var t=0;t<this.wheels.length;t++){this.wheels[t].update()}};function l(t,e){e=e||{};this.vehicle=t;this.forwardEquation=new a(t.chassisBody,t.groundBody);this.sideEquation=new a(t.chassisBody,t.groundBody);this.steerValue=0;this.engineForce=0;this.setSideFriction(e.sideFriction!==undefined?e.sideFriction:5);this.localForwardVector=r.fromValues(0,1);if(e.localForwardVector){r.copy(this.localForwardVector,e.localForwardVector)}this.localPosition=r.fromValues(0,0);if(e.localPosition){r.copy(this.localPosition,e.localPosition)}n.apply(this,t.chassisBody,t.groundBody);this.equations.push(this.forwardEquation,this.sideEquation);this.setBrakeForce(0)}l.prototype=new n;l.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)};l.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var u=r.create();var c=r.create();l.prototype.getSpeed=function(){this.vehicle.chassisBody.vectorToWorldFrame(c,this.localForwardVector);this.vehicle.chassisBody.getVelocityAtPoint(u,c);return r.dot(u,c)};var f=r.create();l.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector);r.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2);this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t);r.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue);r.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue);this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition);r.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB);this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition);r.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA);r.normalize(f,this.forwardEquation.t);r.scale(f,f,this.engineForce);this.vehicle.chassisBody.applyForce(f,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(t,e,i){var r=e.exports={AABB:t("./collision/AABB"),AngleLockEquation:t("./equations/AngleLockEquation"),Body:t("./objects/Body"),Broadphase:t("./collision/Broadphase"),Capsule:t("./shapes/Capsule"),Circle:t("./shapes/Circle"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),ContactEquationPool:t("./utils/ContactEquationPool"),ContactMaterial:t("./material/ContactMaterial"),Convex:t("./shapes/Convex"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventEmitter:t("./events/EventEmitter"),FrictionEquation:t("./equations/FrictionEquation"),FrictionEquationPool:t("./utils/FrictionEquationPool"),GearConstraint:t("./constraints/GearConstraint"),GSSolver:t("./solver/GSSolver"),Heightfield:t("./shapes/Heightfield"),Line:t("./shapes/Line"),LockConstraint:t("./constraints/LockConstraint"),Material:t("./material/Material"),Narrowphase:t("./collision/Narrowphase"),NaiveBroadphase:t("./collision/NaiveBroadphase"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),Pool:t("./utils/Pool"),RevoluteConstraint:t("./constraints/RevoluteConstraint"),PrismaticConstraint:t("./constraints/PrismaticConstraint"),Ray:t("./collision/Ray"),RaycastResult:t("./collision/RaycastResult"),Box:t("./shapes/Box"),RotationalVelocityEquation:t("./equations/RotationalVelocityEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Spring:t("./objects/Spring"),TopDownVehicle:t("./objects/TopDownVehicle"),LinearSpring:t("./objects/LinearSpring"),RotationalSpring:t("./objects/RotationalSpring"),Utils:t("./utils/Utils"),World:t("./world/World"),vec2:t("./math/vec2"),version:t("../package.json").version};Object.defineProperty(r,"Rectangle",{get:function(){console.warn("The Rectangle class has been renamed to Box.");return this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(t,e,i){var r=t("../math/vec2"),s=t("./Shape"),n=t("./Convex");e.exports=a;function a(t){if(typeof arguments[0]==="number"&&typeof arguments[1]==="number"){t={width:arguments[0],height:arguments[1]};console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")}t=t||{};var e=this.width=t.width||1;var i=this.height=t.height||1;var a=[r.fromValues(-e/2,-i/2),r.fromValues(e/2,-i/2),r.fromValues(e/2,i/2),r.fromValues(-e/2,i/2)];var o=[r.fromValues(1,0),r.fromValues(0,1)];t.vertices=a;t.axes=o;t.type=s.BOX;n.call(this,t)}a.prototype=new n;a.prototype.constructor=a;a.prototype.computeMomentOfInertia=function(t){var e=this.width,i=this.height;return t*(i*i+e*e)/12};a.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};var o=r.create(),h=r.create(),l=r.create(),u=r.create();a.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};a.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(t,e,i){var r=t("./Shape"),s=t("../math/vec2");e.exports=n;function n(t){if(typeof arguments[0]==="number"&&typeof arguments[1]==="number"){t={length:arguments[0],radius:arguments[1]};console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")}t=t||{};this.length=t.length||1;this.radius=t.radius||1;t.type=r.CAPSULE;r.call(this,t)}n.prototype=new r;n.prototype.constructor=n;n.prototype.computeMomentOfInertia=function(t){var e=this.radius,i=this.length+e,r=e*2;return t*(r*r+i*i)/12};n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var a=s.create();n.prototype.computeAABB=function(t,e,i){var r=this.radius;s.set(a,this.length/2,0);if(i!==0){s.rotate(a,a,i)}s.set(t.upperBound,Math.max(a[0]+r,-a[0]+r),Math.max(a[1]+r,-a[1]+r));s.set(t.lowerBound,Math.min(a[0]-r,-a[0]-r),Math.min(a[1]-r,-a[1]-r));s.add(t.lowerBound,t.lowerBound,e);s.add(t.upperBound,t.upperBound,e)};var o=s.create();var h=s.create();var l=s.create();var u=s.create();var c=s.fromValues(0,1);n.prototype.raycast=function(t,e,i,r){var n=e.from;var a=e.to;var f=e.direction;var d=o;var p=h;var g=l;var v=u;var m=this.length/2;for(var y=0;y<2;y++){var x=this.radius*(y*2-1);s.set(g,-m,x);s.set(v,m,x);s.toGlobalFrame(g,g,i,r);s.toGlobalFrame(v,v,i,r);var b=s.getLineSegmentsIntersectionFraction(n,a,g,v);if(b>=0){s.rotate(p,c,r);s.scale(p,p,y*2-1);e.reportIntersection(t,b,p,-1);if(t.shouldStop(e)){return}}}var w=Math.pow(this.radius,2)+Math.pow(m,2);for(var y=0;y<2;y++){s.set(g,m*(y*2-1),0);s.toGlobalFrame(g,g,i,r);var _=Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2);var P=2*((a[0]-n[0])*(n[0]-g[0])+(a[1]-n[1])*(n[1]-g[1]));var T=Math.pow(n[0]-g[0],2)+Math.pow(n[1]-g[1],2)-Math.pow(this.radius,2);var b=Math.pow(P,2)-4*_*T;if(b<0){continue}else if(b===0){s.lerp(d,n,a,b);if(s.squaredDistance(d,i)>w){s.sub(p,d,g);s.normalize(p,p);e.reportIntersection(t,b,p,-1);if(t.shouldStop(e)){return}}}else{var C=Math.sqrt(b);var S=1/(2*_);var A=(-P-C)*S;var E=(-P+C)*S;if(A>=0&&A<=1){s.lerp(d,n,a,A);if(s.squaredDistance(d,i)>w){s.sub(p,d,g);s.normalize(p,p);e.reportIntersection(t,A,p,-1);if(t.shouldStop(e)){return}}}if(E>=0&&E<=1){s.lerp(d,n,a,E);if(s.squaredDistance(d,i)>w){s.sub(p,d,g);s.normalize(p,p);e.reportIntersection(t,E,p,-1);if(t.shouldStop(e)){return}}}}}}},{"../math/vec2":30,"./Shape":45}],39:[function(t,e,i){var r=t("./Shape"),s=t("../math/vec2");e.exports=n;function n(t){if(typeof arguments[0]==="number"){t={radius:arguments[0]};console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")}t=t||{};this.radius=t.radius||1;t.type=r.CIRCLE;r.call(this,t)}n.prototype=new r;n.prototype.constructor=n;n.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2};n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};n.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};n.prototype.computeAABB=function(t,e,i){var r=this.radius;s.set(t.upperBound,r,r);s.set(t.lowerBound,-r,-r);if(e){s.add(t.lowerBound,t.lowerBound,e);s.add(t.upperBound,t.upperBound,e)}};var a=s.create();var o=s.create();n.prototype.raycast=function(t,e,i,r){var n=e.from,h=e.to,l=this.radius;var u=Math.pow(h[0]-n[0],2)+Math.pow(h[1]-n[1],2);var c=2*((h[0]-n[0])*(n[0]-i[0])+(h[1]-n[1])*(n[1]-i[1]));var f=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2)-Math.pow(l,2);var d=Math.pow(c,2)-4*u*f;var p=a;var g=o;if(d<0){return}else if(d===0){s.lerp(p,n,h,d);s.sub(g,p,i);s.normalize(g,g);e.reportIntersection(t,d,g,-1)}else{var v=Math.sqrt(d);var m=1/(2*u);var y=(-c-v)*m;var x=(-c+v)*m;if(y>=0&&y<=1){s.lerp(p,n,h,y);s.sub(g,p,i);s.normalize(g,g);e.reportIntersection(t,y,g,-1);if(t.shouldStop(e)){return}}if(x>=0&&x<=1){s.lerp(p,n,h,x);s.sub(g,p,i);s.normalize(g,g);e.reportIntersection(t,x,g,-1)}}}},{"../math/vec2":30,"./Shape":45}],40:[function(t,e,i){var r=t("./Shape"),s=t("../math/vec2"),n=t("../math/polyk"),a=t("poly-decomp");e.exports=o;function o(t){if(Array.isArray(arguments[0])){t={vertices:arguments[0],axes:arguments[1]};console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")}t=t||{};this.vertices=[];var e=t.vertices!==undefined?t.vertices:[];for(var i=0;i<e.length;i++){var n=s.create();s.copy(n,e[i]);this.vertices.push(n)}this.axes=[];if(t.axes){for(var i=0;i<t.axes.length;i++){var a=s.create();s.copy(a,t.axes[i]);this.axes.push(a)}}else{for(var i=0;i<this.vertices.length;i++){var o=this.vertices[i];var h=this.vertices[(i+1)%this.vertices.length];var l=s.create();s.sub(l,h,o);s.rotate90cw(l,l);s.normalize(l,l);this.axes.push(l)}}this.centerOfMass=s.fromValues(0,0);this.triangles=[];if(this.vertices.length){this.updateTriangles();this.updateCenterOfMass()}this.boundingRadius=0;t.type=r.CONVEX;r.call(this,t);this.updateBoundingRadius();this.updateArea();if(this.area<0){throw new Error("Convex vertices must be given in conter-clockwise winding.")}}o.prototype=new r;o.prototype.constructor=o;var h=s.create();var l=s.create();o.prototype.projectOntoLocalAxis=function(t,e){var i=null,r=null,n,a,t=h;for(var o=0;o<this.vertices.length;o++){n=this.vertices[o];a=s.dot(n,t);if(i===null||a>i){i=a}if(r===null||a<r){r=a}}if(r>i){var l=r;r=i;i=l}s.set(e,r,i)};o.prototype.projectOntoWorldAxis=function(t,e,i,r){var n=l;this.projectOntoLocalAxis(t,r);if(i!==0){s.rotate(n,t,i)}else{n=t}var a=s.dot(e,n);s.set(r,r[0]+a,r[1]+a)};o.prototype.updateTriangles=function(){this.triangles.length=0;var t=[];for(var e=0;e<this.vertices.length;e++){var i=this.vertices[e];t.push(i[0],i[1])}var r=n.Triangulate(t);for(var e=0;e<r.length;e+=3){var s=r[e],a=r[e+1],o=r[e+2];this.triangles.push([s,a,o])}};var u=s.create(),c=s.create(),f=s.create(),d=s.create(),p=s.create(),g=s.create(),v=s.create(),m=s.create(),y=s.create();o.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,i=this.centerOfMass,r=u,n=y,a=f,h=d,l=p,x=g,b=v,w=m,_=c;s.set(i,0,0);var P=0;for(var T=0;T!==t.length;T++){var C=t[T],a=e[C[0]],h=e[C[1]],l=e[C[2]];s.centroid(r,a,h,l);var S=o.triangleArea(a,h,l);P+=S;s.scale(_,r,S);s.add(i,i,_)}s.scale(i,i,1/P)};o.prototype.computeMomentOfInertia=function(t){var e=0,i=0,r=this.vertices.length;for(var n=r-1,a=0;a<r;n=a,a++){var o=this.vertices[n];var h=this.vertices[a];var l=Math.abs(s.crossLength(o,h));var u=s.dot(h,h)+s.dot(h,o)+s.dot(o,o);e+=l*u;i+=l}return t/6*(e/i)};o.prototype.updateBoundingRadius=function(){var t=this.vertices,e=0;for(var i=0;i!==t.length;i++){var r=s.squaredLength(t[i]);if(r>e){e=r}}this.boundingRadius=Math.sqrt(e)};o.triangleArea=function(t,e,i){return((e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]))*.5};o.prototype.updateArea=function(){this.updateTriangles();this.area=0;var t=this.triangles,e=this.vertices;for(var i=0;i!==t.length;i++){var r=t[i],s=e[r[0]],n=e[r[1]],a=e[r[2]];var h=o.triangleArea(s,n,a);this.area+=h}};o.prototype.computeAABB=function(t,e,i){t.setFromPoints(this.vertices,e,i,0)};var x=s.create();var b=s.create();var w=s.create();o.prototype.raycast=function(t,e,i,r){var n=x;var a=b;var o=w;var h=this.vertices;s.toLocalFrame(n,e.from,i,r);s.toLocalFrame(a,e.to,i,r);var l=h.length;for(var u=0;u<l&&!t.shouldStop(e);u++){var c=h[u];var f=h[(u+1)%l];var d=s.getLineSegmentsIntersectionFraction(n,a,c,f);if(d>=0){s.sub(o,f,c);s.rotate(o,o,-Math.PI/2+r);s.normalize(o,o);e.reportIntersection(t,d,o,u)}}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(t,e,i){var r=t("./Shape"),s=t("../math/vec2"),n=t("../utils/Utils");e.exports=a;function a(t){if(Array.isArray(arguments[0])){t={heights:arguments[0]};if(typeof arguments[1]==="object"){for(var e in arguments[1]){t[e]=arguments[1][e]}}console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{};this.heights=t.heights?t.heights.slice(0):[];this.maxValue=t.maxValue||null;this.minValue=t.minValue||null;this.elementWidth=t.elementWidth||.1;if(t.maxValue===undefined||t.minValue===undefined){this.updateMaxMinValues()}t.type=r.HEIGHTFIELD;r.call(this,t)}a.prototype=new r;a.prototype.constructor=a;a.prototype.updateMaxMinValues=function(){var t=this.heights;var e=t[0];var i=t[0];for(var r=0;r!==t.length;r++){var s=t[r];if(s>e){e=s}if(s<i){i=s}}this.maxValue=e;this.minValue=i};a.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE};a.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};a.prototype.updateArea=function(){var t=this.heights,e=0;for(var i=0;i<t.length-1;i++){e+=(t[i]+t[i+1])/2*this.elementWidth}this.area=e};var o=[s.create(),s.create(),s.create(),s.create()];a.prototype.computeAABB=function(t,e,i){s.set(o[0],0,this.maxValue);s.set(o[1],this.elementWidth*this.heights.length,this.maxValue);s.set(o[2],this.elementWidth*this.heights.length,this.minValue);s.set(o[3],0,this.minValue);t.setFromPoints(o,e,i)};a.prototype.getLineSegment=function(t,e,i){var r=this.heights;var n=this.elementWidth;s.set(t,i*n,r[i]);s.set(e,(i+1)*n,r[i+1])};a.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)};a.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);e=Math.min(this.heights.length,Math.max(e,0));return e};var h=s.create();var l=s.create();var u=s.create();var c=s.create();var f=s.create();var d=s.create();var p=s.fromValues(0,1);function g(t,e,i,r,s){var n,a,o,h;n=i[0]-e[0];a=i[1]-e[1];o=s[0]-r[0];h=s[1]-r[1];var l,u;l=(-a*(e[0]-r[0])+n*(e[1]-r[1]))/(-o*a+n*h);u=(o*(e[1]-r[1])-h*(e[0]-r[0]))/(-o*a+n*h);if(l>=0&&l<=1&&u>=0&&u<=1){var c=e[0]+u*n;var f=e[1]+u*a;t[0]=c;t[1]=f;return u}return-1}a.prototype.raycast=function(t,e,i,r){var n=e.from;var a=e.to;var o=e.direction;var p=h;var g=l;var v=u;var m=c;var y=f;var x=d;s.toLocalFrame(y,n,i,r);s.toLocalFrame(x,a,i,r);var b=this.getClampedSegmentIndex(y);var w=this.getClampedSegmentIndex(x);if(b>w){var _=b;b=w;w=_}for(var P=0;P<this.heights.length-1;P++){this.getLineSegment(v,m,P);var T=s.getLineSegmentsIntersectionFraction(y,x,v,m);if(T>=0){s.sub(g,m,v);s.rotate(g,g,r+Math.PI/2);s.normalize(g,g);e.reportIntersection(t,T,g,-1);if(t.shouldStop(e)){return}}}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(t,e,i){var r=t("./Shape"),s=t("../math/vec2");e.exports=n;function n(t){if(typeof arguments[0]==="number"){t={length:arguments[0]};console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")}t=t||{};this.length=t.length||1;t.type=r.LINE;r.call(this,t)}n.prototype=new r;n.prototype.constructor=n;n.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12};n.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var a=[s.create(),s.create()];n.prototype.computeAABB=function(t,e,i){var r=this.length/2;s.set(a[0],-r,0);s.set(a[1],r,0);t.setFromPoints(a,e,i,0)};var o=s.create();var h=s.create();var l=s.create();var u=s.create();var c=s.fromValues(0,1);n.prototype.raycast=function(t,e,i,r){var n=e.from;var a=e.to;var o=l;var f=u;var d=this.length/2;s.set(o,-d,0);s.set(f,d,0);s.toGlobalFrame(o,o,i,r);s.toGlobalFrame(f,f,i,r);var p=s.getLineSegmentsIntersectionFraction(o,f,n,a);if(p>=0){var g=h;s.rotate(g,c,r);e.reportIntersection(t,p,g,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(t,e,i){var r=t("./Shape"),s=t("../math/vec2");e.exports=n;function n(t){t=t||{};t.type=r.PARTICLE;r.call(this,t)}n.prototype=new r;n.prototype.constructor=n;n.prototype.computeMomentOfInertia=function(t){return 0};n.prototype.updateBoundingRadius=function(){this.boundingRadius=0};n.prototype.computeAABB=function(t,e,i){s.copy(t.lowerBound,e);s.copy(t.upperBound,e)}},{"../math/vec2":30,"./Shape":45}],44:[function(t,e,i){var r=t("./Shape"),s=t("../math/vec2"),n=t("../utils/Utils");e.exports=a;function a(t){t=t||{};t.type=r.PLANE;r.call(this,t)}a.prototype=new r;a.prototype.constructor=a;a.prototype.computeMomentOfInertia=function(t){return 0};a.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};a.prototype.computeAABB=function(t,e,i){var r=i%(2*Math.PI);var n=s.set;var a=Number.MAX_VALUE;var o=t.lowerBound;var h=t.upperBound;if(r===0){n(o,-a,-a);n(h,a,0)}else if(r===Math.PI/2){n(o,0,-a);n(h,a,a)}else if(r===Math.PI){n(o,-a,0);n(h,a,a)}else if(r===3*Math.PI/2){n(o,-a,-a);n(h,0,a)}else{n(o,-a,-a);n(h,a,a)}s.add(o,o,e);s.add(h,h,e)};a.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var o=s.create();var h=s.create();var l=s.create();var u=s.create();var c=s.create();a.prototype.raycast=function(t,e,i,r){var n=e.from;var a=e.to;var f=e.direction;var d=o;var p=h;var g=l;var v=u;var m=c;s.set(v,0,1);s.rotate(v,v,r);s.sub(m,n,i);var y=s.dot(m,v);s.sub(m,a,i);var x=s.dot(m,v);if(y*x>0){return}if(s.squaredDistance(n,a)<y*y){return}var b=s.dot(v,f);s.sub(d,n,i);var w=-s.dot(v,d)/b/e.length;e.reportIntersection(t,w,v,-1)}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(t,e,i){e.exports=s;var r=t("../math/vec2");function s(t){t=t||{};this.body=null;this.position=r.fromValues(0,0);if(t.position){r.copy(this.position,t.position)}this.angle=t.angle||0;this.type=t.type||0;this.id=s.idCounter++;this.boundingRadius=0;this.collisionGroup=t.collisionGroup!==undefined?t.collisionGroup:1;this.collisionResponse=t.collisionResponse!==undefined?t.collisionResponse:true;this.collisionMask=t.collisionMask!==undefined?t.collisionMask:1;this.material=t.material||null;this.area=0;this.sensor=t.sensor!==undefined?t.sensor:false;if(this.type){this.updateBoundingRadius()}this.updateArea()}s.idCounter=0;s.CIRCLE=1;s.PARTICLE=2;s.PLANE=4;s.CONVEX=8;s.LINE=16;s.BOX=32;Object.defineProperty(s,"RECTANGLE",{get:function(){console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead.");return s.BOX}});s.CAPSULE=64;s.HEIGHTFIELD=128;s.prototype.computeMomentOfInertia=function(t){};s.prototype.updateBoundingRadius=function(){};s.prototype.updateArea=function(){};s.prototype.computeAABB=function(t,e,i){};s.prototype.raycast=function(t,e,i,r){}},{"../math/vec2":30}],46:[function(t,e,i){var r=t("../math/vec2"),s=t("./Solver"),n=t("../utils/Utils"),a=t("../equations/FrictionEquation");e.exports=o;function o(t){s.call(this,t,s.GS);t=t||{};this.iterations=t.iterations||10;this.tolerance=t.tolerance||1e-7;this.arrayStep=30;this.lambda=new n.ARRAY_TYPE(this.arrayStep);this.Bs=new n.ARRAY_TYPE(this.arrayStep);this.invCs=new n.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=false;this.frictionIterations=0;this.usedIterations=0}o.prototype=new s;o.prototype.constructor=o;function h(t){var e=t.length;while(e--){t[e]=+0}}o.prototype.solve=function(t,e){this.sortEquations();var i=0,s=this.iterations,l=this.frictionIterations,u=this.equations,c=u.length,f=Math.pow(this.tolerance*c,2),d=e.bodies,p=e.bodies.length,g=r.add,v=r.set,m=this.useZeroRHS,y=this.lambda;this.usedIterations=0;if(c){for(var x=0;x!==p;x++){var b=d[x];b.updateSolveMassProperties()}}if(y.length<c){y=this.lambda=new n.ARRAY_TYPE(c+this.arrayStep);this.Bs=new n.ARRAY_TYPE(c+this.arrayStep);this.invCs=new n.ARRAY_TYPE(c+this.arrayStep)}h(y);var w=this.invCs,_=this.Bs,y=this.lambda;for(var x=0;x!==u.length;x++){var P=u[x];if(P.timeStep!==t||P.needsUpdate){P.timeStep=t;P.update()}_[x]=P.computeB(P.a,P.b,t);w[x]=P.computeInvC(P.epsilon)}var T,C,P,S,x,A;if(c!==0){for(x=0;x!==p;x++){var b=d[x];b.resetConstraintVelocity()}if(l){for(i=0;i!==l;i++){S=0;for(A=0;A!==c;A++){P=u[A];var E=o.iterateEquation(A,P,P.epsilon,_,w,y,m,t,i);S+=Math.abs(E)}this.usedIterations++;if(S*S<=f){break}}o.updateMultipliers(u,y,1/t);for(A=0;A!==c;A++){var I=u[A];if(I instanceof a){var M=0;for(var R=0;R!==I.contactEquations.length;R++){M+=I.contactEquations[R].multiplier}M*=I.frictionCoefficient/I.contactEquations.length;I.maxForce=M;I.minForce=-M}}}for(i=0;i!==s;i++){S=0;for(A=0;A!==c;A++){P=u[A];var E=o.iterateEquation(A,P,P.epsilon,_,w,y,m,t,i);S+=Math.abs(E)}this.usedIterations++;if(S*S<=f){break}}for(x=0;x!==p;x++){d[x].addConstraintVelocity()}o.updateMultipliers(u,y,1/t)}};o.updateMultipliers=function(t,e,i){var r=t.length;while(r--){t[r].multiplier=e[r]*i}};o.iterateEquation=function(t,e,i,r,s,n,a,o,h){var l=r[t],u=s[t],c=n[t],f=e.computeGWlambda();var d=e.maxForce,p=e.minForce;if(a){l=0}var g=u*(l-f-i*c);var v=c+g;if(v<p*o){g=p*o-c}else if(v>d*o){g=d*o-c}n[t]+=g;e.addToWlambda(g);return g}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(t,e,i){var r=t("../utils/Utils"),s=t("../events/EventEmitter");e.exports=n;function n(t,e){t=t||{};s.call(this);this.type=e;this.equations=[];this.equationSortFunction=t.equationSortFunction||false}n.prototype=new s;n.prototype.constructor=n;n.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var a={bodies:[]};n.prototype.solveIsland=function(t,e){this.removeAllEquations();if(e.equations.length){this.addEquations(e.equations);a.bodies.length=0;e.getBodies(a.bodies);if(a.bodies.length){this.solve(t,a)}}};n.prototype.sortEquations=function(){if(this.equationSortFunction){this.equations.sort(this.equationSortFunction)}};n.prototype.addEquation=function(t){if(t.enabled){this.equations.push(t)}};n.prototype.addEquations=function(t){for(var e=0,i=t.length;e!==i;e++){var r=t[e];if(r.enabled){this.equations.push(r)}}};n.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);if(e!==-1){this.equations.splice(e,1)}};n.prototype.removeAllEquations=function(){this.equations.length=0};n.GS=1;n.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(t,e,i){var r=t("../equations/ContactEquation");var s=t("./Pool");e.exports=n;function n(){s.apply(this,arguments)}n.prototype=new s;n.prototype.constructor=n;n.prototype.create=function(){return new r};n.prototype.destroy=function(t){t.bodyA=t.bodyB=null;return this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(t,e,i){var r=t("../equations/FrictionEquation");var s=t("./Pool");e.exports=n;function n(){s.apply(this,arguments)}n.prototype=new s;n.prototype.constructor=n;n.prototype.create=function(){return new r};n.prototype.destroy=function(t){t.bodyA=t.bodyB=null;return this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(t,e,i){var r=t("../world/IslandNode");var s=t("./Pool");e.exports=n;function n(){s.apply(this,arguments)}n.prototype=new s;n.prototype.constructor=n;n.prototype.create=function(){return new r};n.prototype.destroy=function(t){t.reset();return this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(t,e,i){var r=t("../world/Island");var s=t("./Pool");e.exports=n;function n(){s.apply(this,arguments)}n.prototype=new s;n.prototype.constructor=n;n.prototype.create=function(){return new r};n.prototype.destroy=function(t){t.reset();return this}},{"../world/Island":58,"./Pool":55}],52:[function(t,e,i){var r=t("./TupleDictionary");var s=t("./OverlapKeeperRecord");var n=t("./OverlapKeeperRecordPool");var a=t("./Utils");e.exports=o;function o(){this.overlappingShapesLastState=new r;this.overlappingShapesCurrentState=new r;this.recordPool=new n({size:16});this.tmpDict=new r;this.tmpArray1=[]}o.prototype.tick=function(){var t=this.overlappingShapesLastState;var e=this.overlappingShapesCurrentState;var i=t.keys.length;while(i--){var r=t.keys[i];var s=t.getByKey(r);var n=e.getByKey(r);if(s){this.recordPool.release(s)}}t.reset();t.copy(e);e.reset()};o.prototype.setOverlapping=function(t,e,i,r){var s=this.overlappingShapesLastState;var n=this.overlappingShapesCurrentState;if(!n.get(e.id,r.id)){var a=this.recordPool.get();a.set(t,e,i,r);n.set(e.id,r.id,a)}};o.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)};o.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)};o.prototype.bodiesAreOverlapping=function(t,e){var i=this.overlappingShapesCurrentState;var r=i.keys.length;while(r--){var s=i.keys[r];var n=i.data[s];if(n.bodyA===t&&n.bodyB===e||n.bodyA===e&&n.bodyB===t){return true}}return false};o.prototype.getDiff=function(t,e,i){var i=i||[];var r=t;var s=e;i.length=0;var n=s.keys.length;while(n--){var a=s.keys[n];var o=s.data[a];if(!o){throw new Error("Key "+a+" had no data!")}var h=r.data[a];if(!h){i.push(o)}}return i};o.prototype.isNewOverlap=function(t,e){var i=t.id|0,r=e.id|0;var s=this.overlappingShapesLastState;var n=this.overlappingShapesCurrentState;return!!!s.get(i,r)&&!!n.get(i,r)};o.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)};o.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)};o.prototype.getBodyDiff=function(t,e){e=e||[];var i=this.tmpDict;var r=t.length;while(r--){var s=t[r];i.set(s.bodyA.id|0,s.bodyB.id|0,s)}r=i.keys.length;while(r--){var s=i.getByKey(i.keys[r]);if(s){e.push(s.bodyA,s.bodyB)}}i.reset();return e}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(t,e,i){e.exports=r;function r(t,e,i,r){this.shapeA=e;this.shapeB=r;this.bodyA=t;this.bodyB=i}r.prototype.set=function(t,e,i,s){r.call(this,t,e,i,s)}},{}],54:[function(t,e,i){var r=t("./OverlapKeeperRecord");var s=t("./Pool");e.exports=n;function n(){s.apply(this,arguments)}n.prototype=new s;n.prototype.constructor=n;n.prototype.create=function(){return new r};n.prototype.destroy=function(t){t.bodyA=t.bodyB=t.shapeA=t.shapeB=null;return this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(t,e,i){e.exports=r;function r(t){t=t||{};this.objects=[];if(t.size!==undefined){this.resize(t.size)}}r.prototype.resize=function(t){var e=this.objects;while(e.length>t){e.pop()}while(e.length<t){e.push(this.create())}return this};r.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()};r.prototype.release=function(t){this.destroy(t);this.objects.push(t);return this}},{}],56:[function(t,e,i){var r=t("./Utils");e.exports=s;function s(){this.data={};this.keys=[]}s.prototype.getKey=function(t,e){t=t|0;e=e|0;if((t|0)===(e|0)){return-1}return((t|0)>(e|0)?t<<16|e&65535:e<<16|t&65535)|0};s.prototype.getByKey=function(t){t=t|0;return this.data[t]};s.prototype.get=function(t,e){return this.data[this.getKey(t,e)]};s.prototype.set=function(t,e,i){if(!i){throw new Error("No data!")}var r=this.getKey(t,e);if(!this.data[r]){this.keys.push(r)}this.data[r]=i;return r};s.prototype.reset=function(){var t=this.data,e=this.keys;var i=e.length;while(i--){delete t[e[i]]}e.length=0};s.prototype.copy=function(t){this.reset();r.appendArray(this.keys,t.keys);var e=t.keys.length;while(e--){var i=t.keys[e];this.data[i]=t.data[i]}}},{"./Utils":57}],57:[function(t,e,i){e.exports=r;function r(){}r.appendArray=function(t,e){if(e.length<15e4){t.push.apply(t,e)}else{for(var i=0,r=e.length;i!==r;++i){t.push(e[i])}}};r.splice=function(t,e,i){i=i||1;for(var r=e,s=t.length-i;r<s;r++){t[r]=t[r+i]}t.length=s};if(typeof P2_ARRAY_TYPE!=="undefined"){r.ARRAY_TYPE=P2_ARRAY_TYPE}else if(typeof Float32Array!=="undefined"){r.ARRAY_TYPE=Float32Array}else{r.ARRAY_TYPE=Array}r.extend=function(t,e){for(var i in e){t[i]=e[i]}};r.defaults=function(t,e){t=t||{};for(var i in e){if(!(i in t)){t[i]=e[i]}}return t}},{}],58:[function(t,e,i){var r=t("../objects/Body");e.exports=s;function s(){this.equations=[];this.bodies=[]}s.prototype.reset=function(){this.equations.length=this.bodies.length=0};var n=[];s.prototype.getBodies=function(t){var e=t||[],i=this.equations;n.length=0;for(var r=0;r!==i.length;r++){var s=i[r];if(n.indexOf(s.bodyA.id)===-1){e.push(s.bodyA);n.push(s.bodyA.id)}if(n.indexOf(s.bodyB.id)===-1){e.push(s.bodyB);n.push(s.bodyB.id)}}return e};s.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===r.DYNAMIC&&!e.wantsToSleep){return false}}return true};s.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return true}},{"../objects/Body":31}],59:[function(t,e,i){var r=t("../math/vec2"),s=t("./Island"),n=t("./IslandNode"),a=t("./../utils/IslandNodePool"),o=t("./../utils/IslandPool"),h=t("../objects/Body");e.exports=l;function l(t){this.nodePool=new a({size:16});this.islandPool=new o({size:8});this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}l.getUnvisitedNode=function(t){var e=t.length;for(var i=0;i!==e;i++){var r=t[i];if(!r.visited&&r.body.type===h.DYNAMIC){return r}}return false};l.prototype.visit=function(t,e,i){e.push(t.body);var r=t.equations.length;for(var s=0;s!==r;s++){var n=t.equations[s];if(i.indexOf(n)===-1){i.push(n)}}};l.prototype.bfs=function(t,e,i){var r=this.queue;r.length=0;r.push(t);t.visited=true;this.visit(t,e,i);while(r.length){var s=r.pop();var n;while(n=l.getUnvisitedNode(s.neighbors)){n.visited=true;this.visit(n,e,i);if(n.body.type===h.DYNAMIC){r.push(n)}}}};l.prototype.split=function(t){var e=t.bodies,i=this.nodes,r=this.equations;while(i.length){this.nodePool.release(i.pop())}for(var s=0;s!==e.length;s++){var n=this.nodePool.get();n.body=e[s];i.push(n)}for(var a=0;a!==r.length;a++){var o=r[a],s=e.indexOf(o.bodyA),h=e.indexOf(o.bodyB),u=i[s],c=i[h];u.neighbors.push(c);c.neighbors.push(u);u.equations.push(o);c.equations.push(o)}var f=this.islands;for(var s=0;s<f.length;s++){this.islandPool.release(f[s])}f.length=0;var d;while(d=l.getUnvisitedNode(i)){var p=this.islandPool.get();this.bfs(d,p.bodies,p.equations);f.push(p)}return f}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(t,e,i){e.exports=r;function r(t){this.body=t;this.neighbors=[];this.equations=[];this.visited=false}r.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=false;this.body=null}},{}],61:[function(t,e,i){var r=t("../solver/GSSolver"),s=t("../solver/Solver"),n=t("../collision/Ray"),a=t("../math/vec2"),o=t("../shapes/Circle"),h=t("../shapes/Convex"),l=t("../shapes/Line"),u=t("../shapes/Plane"),c=t("../shapes/Capsule"),f=t("../shapes/Particle"),d=t("../events/EventEmitter"),p=t("../objects/Body"),g=t("../shapes/Shape"),v=t("../objects/LinearSpring"),m=t("../material/Material"),y=t("../material/ContactMaterial"),x=t("../constraints/DistanceConstraint"),b=t("../constraints/Constraint"),w=t("../constraints/LockConstraint"),_=t("../constraints/RevoluteConstraint"),P=t("../constraints/PrismaticConstraint"),T=t("../constraints/GearConstraint"),C=t("../../package.json"),S=t("../collision/Broadphase"),A=t("../collision/AABB"),E=t("../collision/SAPBroadphase"),I=t("../collision/Narrowphase"),M=t("../utils/Utils"),R=t("../utils/OverlapKeeper"),B=t("./IslandManager"),L=t("../objects/RotationalSpring");e.exports=k;function k(t){d.apply(this);t=t||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=t.solver||new r;this.narrowphase=new I(this);this.islandManager=new B;this.gravity=a.fromValues(0,-9.78);if(t.gravity){a.copy(this.gravity,t.gravity)}this.frictionGravity=a.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=true;this.useFrictionGravityOnZeroGravity=true;this.broadphase=t.broadphase||new E;this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new m;this.defaultContactMaterial=new y(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=true;this.applyDamping=true;this.applyGravity=true;this.solveConstraints=true;this.contactMaterials=[];this.time=0;this.accumulator=0;this.stepping=false;this.bodiesToBeRemoved=[];this.islandSplit=typeof t.islandSplit!=="undefined"?!!t.islandSplit:true;this.emitImpactEvent=true;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=k.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new R}k.prototype=new Object(d.prototype);k.prototype.constructor=k;k.NO_SLEEPING=1;k.BODY_SLEEPING=2;k.ISLAND_SLEEPING=4;k.prototype.addConstraint=function(t){this.constraints.push(t)};k.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)};k.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);if(e!==-1){M.splice(this.contactMaterials,e,1)}};k.prototype.getContactMaterial=function(t,e){var i=this.contactMaterials;for(var r=0,s=i.length;r!==s;r++){var n=i[r];if(n.materialA.id===t.id&&n.materialB.id===e.id||n.materialA.id===e.id&&n.materialB.id===t.id){return n}}return false};k.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);if(e!==-1){M.splice(this.constraints,e,1)}};var O=a.create(),F=a.create(),D=a.create(),U=a.create(),G=a.create(),N=a.create(),X=a.create(),j=a.fromValues(0,0),W=a.fromValues(0,0),z=a.fromValues(0,0),V=a.fromValues(0,0);k.prototype.step=function(t,e,i){i=i||10;e=e||0;if(e===0){this.internalStep(t);this.time+=t}else{this.accumulator+=e;var r=0;while(this.accumulator>=t&&r<i){this.internalStep(t);this.time+=t;this.accumulator-=t;r++}var s=this.accumulator%t/t;for(var n=0;n!==this.bodies.length;n++){var o=this.bodies[n];a.lerp(o.interpolatedPosition,o.previousPosition,o.position,s);o.interpolatedAngle=o.previousAngle+s*(o.angle-o.previousAngle)}}};var q=[];k.prototype.internalStep=function(t){this.stepping=true;var e=this,i=this.springs.length,r=this.springs,s=this.bodies,n=this.gravity,o=this.solver,h=this.bodies.length,l=this.broadphase,u=this.narrowphase,c=this.constraints,f,d,g=G,v=N,m=X,y=a.scale,x=a.add,b=a.rotate,w=this.islandManager;this.overlapKeeper.tick();this.lastTimeStep=t;if(this.useWorldGravityAsFrictionGravity){var _=a.length(this.gravity);if(!(_===0&&this.useFrictionGravityOnZeroGravity)){this.frictionGravity=_}}if(this.applyGravity){for(var P=0;P!==h;P++){var T=s[P],C=T.force;if(T.type!==p.DYNAMIC||T.sleepState===p.SLEEPING){continue}a.scale(m,n,T.mass*T.gravityScale);x(C,C,m)}}if(this.applySpringForces){for(var P=0;P!==i;P++){var S=r[P];S.applyForce()}}if(this.applyDamping){for(var P=0;P!==h;P++){var T=s[P];if(T.type===p.DYNAMIC){T.applyDamping(t)}}}var A=l.getCollisionPairs(this);var E=this.disabledBodyCollisionPairs;for(var P=E.length-2;P>=0;P-=2){for(var I=A.length-2;I>=0;I-=2){if(E[P]===A[I]&&E[P+1]===A[I+1]||E[P+1]===A[I]&&E[P]===A[I+1]){A.splice(I,2)}}}var R=c.length;for(P=0;P!==R;P++){var B=c[P];if(!B.collideConnected){for(var I=A.length-2;I>=0;I-=2){if(B.bodyA===A[I]&&B.bodyB===A[I+1]||B.bodyB===A[I]&&B.bodyA===A[I+1]){A.splice(I,2)}}}}this.postBroadphaseEvent.pairs=A;this.emit(this.postBroadphaseEvent);this.postBroadphaseEvent.pairs=null;u.reset(this);for(var P=0,L=A.length;P!==L;P+=2){var O=A[P],F=A[P+1];for(var D=0,U=O.shapes.length;D!==U;D++){var j=O.shapes[D],W=j.position,z=j.angle;for(var V=0,H=F.shapes.length;V!==H;V++){var Y=F.shapes[V],K=Y.position,$=Y.angle;var J=this.defaultContactMaterial;if(j.material&&Y.material){var Z=this.getContactMaterial(j.material,Y.material);if(Z){J=Z}}this.runNarrowphase(u,O,j,W,z,F,Y,K,$,J,this.frictionGravity)}}}for(var P=0;P!==h;P++){var Q=s[P];if(Q._wakeUpAfterNarrowphase){Q.wakeUp();Q._wakeUpAfterNarrowphase=false}}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(q);var tt=this.endContactEvent;var V=q.length;while(V--){var et=q[V];tt.shapeA=et.shapeA;tt.shapeB=et.shapeB;tt.bodyA=et.bodyA;tt.bodyB=et.bodyB;this.emit(tt)}q.length=0}var it=this.preSolveEvent;it.contactEquations=u.contactEquations;it.frictionEquations=u.frictionEquations;this.emit(it);it.contactEquations=it.frictionEquations=null;var R=c.length;for(P=0;P!==R;P++){c[P].update()}if(u.contactEquations.length||u.frictionEquations.length||R){if(this.islandSplit){w.equations.length=0;M.appendArray(w.equations,u.contactEquations);M.appendArray(w.equations,u.frictionEquations);for(P=0;P!==R;P++){M.appendArray(w.equations,c[P].equations)}w.split(this);for(var P=0;P!==w.islands.length;P++){var rt=w.islands[P];if(rt.equations.length){o.solveIsland(t,rt)}}}else{o.addEquations(u.contactEquations);o.addEquations(u.frictionEquations);for(P=0;P!==R;P++){o.addEquations(c[P].equations)}if(this.solveConstraints){o.solve(t,this)}o.removeAllEquations()}}for(var P=0;P!==h;P++){var Q=s[P];Q.integrate(t)}for(var P=0;P!==h;P++){s[P].setZeroForce()}if(this.emitImpactEvent&&this.has("impact")){var st=this.impactEvent;for(var P=0;P!==u.contactEquations.length;P++){var nt=u.contactEquations[P];if(nt.firstImpact){st.bodyA=nt.bodyA;st.bodyB=nt.bodyB;st.shapeA=nt.shapeA;st.shapeB=nt.shapeB;st.contactEquation=nt;this.emit(st)}}}if(this.sleepMode===k.BODY_SLEEPING){for(P=0;P!==h;P++){s[P].sleepTick(this.time,false,t)}}else if(this.sleepMode===k.ISLAND_SLEEPING&&this.islandSplit){for(P=0;P!==h;P++){s[P].sleepTick(this.time,true,t)}for(var P=0;P<this.islandManager.islands.length;P++){var rt=this.islandManager.islands[P];if(rt.wantsToSleep()){rt.sleep()}}}this.stepping=false;var at=this.bodiesToBeRemoved;for(var P=0;P!==at.length;P++){this.removeBody(at[P])}at.length=0;this.emit(this.postStepEvent)};k.prototype.runNarrowphase=function(t,e,i,r,s,n,o,h,l,u,c){if(!((i.collisionGroup&o.collisionMask)!==0&&(o.collisionGroup&i.collisionMask)!==0)){return}a.rotate(j,r,e.angle);a.rotate(W,h,n.angle);a.add(j,j,e.position);a.add(W,W,n.position);var f=s+e.angle;var d=l+n.angle;t.enableFriction=u.friction>0;t.frictionCoefficient=u.friction;var g;if(e.type===p.STATIC||e.type===p.KINEMATIC){g=n.mass}else if(n.type===p.STATIC||n.type===p.KINEMATIC){g=e.mass}else{g=e.mass*n.mass/(e.mass+n.mass)}t.slipForce=u.friction*c*g;t.restitution=u.restitution;t.surfaceVelocity=u.surfaceVelocity;t.frictionStiffness=u.frictionStiffness;t.frictionRelaxation=u.frictionRelaxation;t.stiffness=u.stiffness;t.relaxation=u.relaxation;t.contactSkinSize=u.contactSkinSize;t.enabledEquations=e.collisionResponse&&n.collisionResponse&&i.collisionResponse&&o.collisionResponse;var v=t[i.type|o.type],m=0;if(v){var y=i.sensor||o.sensor;var x=t.frictionEquations.length;if(i.type<o.type){m=v.call(t,e,i,j,f,n,o,W,d,y)}else{m=v.call(t,n,o,W,d,e,i,j,f,y)}var b=t.frictionEquations.length-x;if(m){if(e.allowSleep&&e.type===p.DYNAMIC&&e.sleepState===p.SLEEPING&&n.sleepState===p.AWAKE&&n.type!==p.STATIC){var w=a.squaredLength(n.velocity)+Math.pow(n.angularVelocity,2);var _=Math.pow(n.sleepSpeedLimit,2);if(w>=_*2){e._wakeUpAfterNarrowphase=true}}if(n.allowSleep&&n.type===p.DYNAMIC&&n.sleepState===p.SLEEPING&&e.sleepState===p.AWAKE&&e.type!==p.STATIC){var P=a.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2);var T=Math.pow(e.sleepSpeedLimit,2);if(P>=T*2){n._wakeUpAfterNarrowphase=true}}this.overlapKeeper.setOverlapping(e,i,n,o);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(i,o)){var C=this.beginContactEvent;C.shapeA=i;C.shapeB=o;C.bodyA=e;C.bodyB=n;C.contactEquations.length=0;if(typeof m==="number"){for(var S=t.contactEquations.length-m;S<t.contactEquations.length;S++){C.contactEquations.push(t.contactEquations[S])}}this.emit(C)}if(typeof m==="number"&&b>1){for(var S=t.frictionEquations.length-b;S<t.frictionEquations.length;S++){var A=t.frictionEquations[S];A.setSlipForce(A.getSlipForce()/b)}}}}};k.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t;this.emit(e);e.spring=null};k.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);if(e!==-1){M.splice(this.springs,e,1)}};k.prototype.addBody=function(t){if(this.bodies.indexOf(t)===-1){this.bodies.push(t);t.world=this;var e=this.addBodyEvent;e.body=t;this.emit(e);e.body=null}};k.prototype.removeBody=function(t){if(this.stepping){this.bodiesToBeRemoved.push(t)}else{t.world=null;var e=this.bodies.indexOf(t);if(e!==-1){M.splice(this.bodies,e,1);this.removeBodyEvent.body=t;t.resetConstraintVelocity();this.emit(this.removeBodyEvent);this.removeBodyEvent.body=null}}};k.prototype.getBodyById=function(t){var e=this.bodies;for(var i=0;i<e.length;i++){var r=e[i];if(r.id===t){return r}}return false};k.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)};k.prototype.enableBodyCollision=function(t,e){var i=this.disabledBodyCollisionPairs;for(var r=0;r<i.length;r+=2){if(i[r]===t&&i[r+1]===e||i[r+1]===t&&i[r]===e){i.splice(r,2);return}}};k.prototype.clear=function(){this.time=0;if(this.solver&&this.solver.equations.length){this.solver.removeAllEquations()}var t=this.constraints;for(var e=t.length-1;e>=0;e--){this.removeConstraint(t[e])}var i=this.bodies;for(var e=i.length-1;e>=0;e--){this.removeBody(i[e])}var r=this.springs;for(var e=r.length-1;e>=0;e--){this.removeSpring(r[e])}var s=this.contactMaterials;for(var e=s.length-1;e>=0;e--){this.removeContactMaterial(s[e])}k.apply(this)};var H=a.create(),Y=a.fromValues(0,0),K=a.fromValues(0,0);k.prototype.hitTest=function(t,e,i){i=i||0;var r=new p({position:t}),s=new f,n=t,l=0,d=H,g=Y,v=K;r.addShape(s);var m=this.narrowphase,y=[];for(var x=0,b=e.length;x!==b;x++){var w=e[x];for(var _=0,P=w.shapes.length;_!==P;_++){var T=w.shapes[_];a.rotate(d,T.position,w.angle);a.add(d,d,w.position);var C=T.angle+w.angle;if(T instanceof o&&m.circleParticle(w,T,d,C,r,s,n,l,true)||T instanceof h&&m.particleConvex(r,s,n,l,w,T,d,C,true)||T instanceof u&&m.particlePlane(r,s,n,l,w,T,d,C,true)||T instanceof c&&m.particleCapsule(r,s,n,l,w,T,d,C,true)||T instanceof f&&a.squaredLength(a.sub(v,d,t))<i*i){y.push(w)}}}return y};k.prototype.setGlobalStiffness=function(t){var e=this.constraints;for(var i=0;i!==e.length;i++){var r=e[i];for(var s=0;s!==r.equations.length;s++){var n=r.equations[s];n.stiffness=t;n.needsUpdate=true}}var a=this.contactMaterials;for(var i=0;i!==a.length;i++){var r=a[i];r.stiffness=r.frictionStiffness=t}var r=this.defaultContactMaterial;r.stiffness=r.frictionStiffness=t};k.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++){var i=this.constraints[e];for(var r=0;r!==i.equations.length;r++){var s=i.equations[r];s.relaxation=t;s.needsUpdate=true}}for(var e=0;e!==this.contactMaterials.length;e++){var i=this.contactMaterials[e];i.relaxation=i.frictionRelaxation=t}var i=this.defaultContactMaterial;i.relaxation=i.frictionRelaxation=t};var $=new A;var J=[];k.prototype.raycast=function(t,e){e.getAABB($);this.broadphase.aabbQuery(this,$,J);e.intersectBodies(t,J);J.length=0;return t.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});(function(){var i=this;var r=r||{};r.game=null;r.WEBGL_RENDERER=0;r.CANVAS_RENDERER=1;r.VERSION="v2.2.9";r._UID=0;if(typeof Float32Array!="undefined"){r.Float32Array=Float32Array;r.Uint16Array=Uint16Array;r.Uint32Array=Uint32Array;r.ArrayBuffer=ArrayBuffer}else{r.Float32Array=Array;r.Uint16Array=Array}r.PI_2=Math.PI*2;r.RAD_TO_DEG=180/Math.PI;r.DEG_TO_RAD=Math.PI/180;r.RETINA_PREFIX="@2x";/**
* @author       Mat Groves http://matgroves.com @Doormat23
* @author       Richard Davey <rich@photonstorm.com>
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
r.DisplayObject=function(){this.position=new r.Point(0,0);this.scale=new r.Point(1,1);this.pivot=new r.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.renderable=false;this.parent=null;this.worldAlpha=1;this.worldTransform=new r.Matrix;this.worldPosition=new r.Point(0,0);this.worldScale=new r.Point(1,1);this.worldRotation=0;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new r.Rectangle(0,0,0,0);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};r.DisplayObject.prototype.constructor=r.DisplayObject;r.DisplayObject.prototype={destroy:function(){if(this.children){var t=this.children.length;while(t--){this.children[t].destroy()}this.children=[]}this.hitArea=null;this.parent=null;this.worldTransform=null;this.filterArea=null;this.renderable=false;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite()},updateTransform:function(t){if(!t&&!this.parent&&!this.game){return this}var e=this.parent;if(t){e=t}else if(!this.parent){e=this.game.world}var i=e.worldTransform;var s=this.worldTransform;var n,a,o,h,l,u;if(this.rotation%r.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}n=this._cr*this.scale.x;a=this._sr*this.scale.x;o=-this._sr*this.scale.y;h=this._cr*this.scale.y;l=this.position.x;u=this.position.y;if(this.pivot.x||this.pivot.y){l-=this.pivot.x*n+this.pivot.y*o;u-=this.pivot.x*a+this.pivot.y*h}s.a=n*i.a+a*i.c;s.b=n*i.b+a*i.d;s.c=o*i.a+h*i.c;s.d=o*i.b+h*i.d;s.tx=l*i.a+u*i.c+i.tx;s.ty=l*i.b+u*i.d+i.ty}else{n=this.scale.x;h=this.scale.y;l=this.position.x-this.pivot.x*n;u=this.position.y-this.pivot.y*h;s.a=n*i.a;s.b=n*i.b;s.c=h*i.c;s.d=h*i.d;s.tx=l*i.a+u*i.c+i.tx;s.ty=l*i.b+u*i.d+i.ty}this.worldAlpha=this.alpha*e.worldAlpha;this.worldPosition.set(s.tx,s.ty);this.worldScale.set(this.scale.x*Math.sqrt(s.a*s.a+s.c*s.c),this.scale.y*Math.sqrt(s.b*s.b+s.d*s.d));this.worldRotation=Math.atan2(-s.c,s.d);this._currentBounds=null;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,s,i)}return this},preUpdate:function(){},generateTexture:function(t,e,i){var s=this.getLocalBounds();var n=new r.RenderTexture(s.width|0,s.height|0,i,e,t);r.DisplayObject._tempMatrix.tx=-s.x;r.DisplayObject._tempMatrix.ty=-s.y;n.render(this,r.DisplayObject._tempMatrix);return n},updateCache:function(){this._generateCachedSprite();return this},toGlobal:function(t){this.updateTransform();return this.worldTransform.apply(t)},toLocal:function(t,e){if(e){t=e.toGlobal(t)}this.updateTransform();return this.worldTransform.applyInverse(t)},_renderCachedSprite:function(t){this._cachedSprite.worldAlpha=this.worldAlpha;if(t.gl){r.Sprite.prototype._renderWebGL.call(this._cachedSprite,t)}else{r.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)}},_generateCachedSprite:function(){this._cacheAsBitmap=false;var t=this.getLocalBounds();t.width=Math.max(1,Math.ceil(t.width));t.height=Math.max(1,Math.ceil(t.height));this.updateTransform();if(!this._cachedSprite){var e=new r.RenderTexture(t.width,t.height);this._cachedSprite=new r.Sprite(e);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(t.width,t.height)}var i=this._filters;this._filters=null;this._cachedSprite.filters=i;r.DisplayObject._tempMatrix.tx=-t.x;r.DisplayObject._tempMatrix.ty=-t.y;this._cachedSprite.texture.render(this,r.DisplayObject._tempMatrix,true);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._filters=i;this._cacheAsBitmap=true},_destroyCachedSprite:function(){if(!this._cachedSprite){return}this._cachedSprite.texture.destroy(true);this._cachedSprite=null}};r.DisplayObject.prototype.displayObjectUpdateTransform=r.DisplayObject.prototype.updateTransform;Object.defineProperties(r.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},worldVisible:{get:function(){if(!this.visible){return false}else{var t=this.parent;if(!t){return this.visible}else{do{if(!t.visible){return false}t=t.parent}while(t)}return true}}},mask:{get:function(){return this._mask},set:function(t){if(this._mask){this._mask.isMask=false}this._mask=t;if(t){this._mask.isMask=true}}},filters:{get:function(){return this._filters},set:function(t){if(Array.isArray(t)){var e=[];for(var i=0;i<t.length;i++){var s=t[i].passes;for(var n=0;n<s.length;n++){e.push(s[n])}}this._filterBlock={target:this,filterPasses:e}}this._filters=t;if(this.blendMode&&this.blendMode===r.blendModes.MULTIPLY){this.blendMode=r.blendModes.NORMAL}}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){if(this._cacheAsBitmap===t){return}if(t){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=t}}});r.DisplayObjectContainer=function(){r.DisplayObject.call(this);this.children=[];this.ignoreChildInput=false};r.DisplayObjectContainer.prototype=Object.create(r.DisplayObject.prototype);r.DisplayObjectContainer.prototype.constructor=r.DisplayObjectContainer;r.DisplayObjectContainer.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)};r.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(e>=0&&e<=this.children.length){if(t.parent){t.parent.removeChild(t)}t.parent=this;this.children.splice(e,0,t);return t}else{throw new Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length)}};r.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t===e){return}var i=this.getChildIndex(t);var r=this.getChildIndex(e);if(i<0||r<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[i]=e;this.children[r]=t};r.DisplayObjectContainer.prototype.getChildIndex=function(t){var e=this.children.indexOf(t);if(e===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return e};r.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(e<0||e>=this.children.length){throw new Error("The supplied index is out of bounds")}var i=this.getChildIndex(t);this.children.splice(i,1);this.children.splice(e,0,t)};r.DisplayObjectContainer.prototype.getChildAt=function(t){if(t<0||t>=this.children.length){throw new Error("getChildAt: Supplied index "+t+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller")}return this.children[t]};r.DisplayObjectContainer.prototype.removeChild=function(t){var e=this.children.indexOf(t);if(e===-1){return}return this.removeChildAt(e)};r.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);if(e){e.parent=undefined;this.children.splice(t,1)}return e};r.DisplayObjectContainer.prototype.removeChildren=function(t,e){if(t===undefined){t=0}if(e===undefined){e=this.children.length}var i=e-t;if(i>0&&i<=e){var r=this.children.splice(begin,i);for(var s=0;s<r.length;s++){var n=r[s];n.parent=undefined}return r}else if(i===0&&this.children.length===0){return[]}else{throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")}};r.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible){return}this.displayObjectUpdateTransform();if(this._cacheAsBitmap){return}for(var t=0;t<this.children.length;t++){this.children[t].updateTransform()}};r.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=r.DisplayObjectContainer.prototype.updateTransform;r.DisplayObjectContainer.prototype.getBounds=function(t){var e=t&&t instanceof r.DisplayObject;var i=true;if(!e){t=this}else if(t instanceof r.DisplayObjectContainer){i=t.contains(this)}else{i=false}var s;if(e){var n=t.worldTransform;t.worldTransform=r.identityMatrix;for(s=0;s<t.children.length;s++){t.children[s].updateTransform()}}var a=Infinity;var o=Infinity;var h=-Infinity;var l=-Infinity;var u;var c;var f;var d=false;for(s=0;s<this.children.length;s++){var p=this.children[s];if(!p.visible){continue}d=true;u=this.children[s].getBounds();a=a<u.x?a:u.x;o=o<u.y?o:u.y;c=u.width+u.x;f=u.height+u.y;h=h>c?h:c;l=l>f?l:f}var g=this._bounds;if(!d){g=new r.Rectangle;var v=g.x;var m=g.width+g.x;var y=g.y;var x=g.height+g.y;var b=this.worldTransform;var w=b.a;var _=b.b;var P=b.c;var T=b.d;var C=b.tx;var S=b.ty;var A=w*m+P*x+C;var E=T*x+_*m+S;var I=w*v+P*x+C;var M=T*x+_*v+S;var R=w*v+P*y+C;var B=T*y+_*v+S;var L=w*m+P*y+C;var k=T*y+_*m+S;h=A;l=E;a=A;o=E;a=I<a?I:a;a=R<a?R:a;a=L<a?L:a;o=M<o?M:o;o=B<o?B:o;o=k<o?k:o;h=I>h?I:h;h=R>h?R:h;h=L>h?L:h;l=M>l?M:l;l=B>l?B:l;l=k>l?k:l}g.x=a;g.y=o;g.width=h-a;g.height=l-o;if(e){t.worldTransform=n;for(s=0;s<t.children.length;s++){t.children[s].updateTransform()}}if(!i){var O=t.getBounds();g.x-=O.x;g.y-=O.y}return g};r.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)};r.DisplayObjectContainer.prototype.contains=function(t){if(!t){return false}else if(t===this){return true}else{return this.contains(t.parent)}};r.DisplayObjectContainer.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0){return}if(this._cacheAsBitmap){this._renderCachedSprite(t);return}var e;if(this._mask||this._filters){if(this._filters){t.spriteBatch.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){t.spriteBatch.stop();t.maskManager.pushMask(this.mask,t);t.spriteBatch.start()}for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}t.spriteBatch.stop();if(this._mask)t.maskManager.popMask(this._mask,t);if(this._filters)t.filterManager.popFilter();t.spriteBatch.start()}else{for(e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}}};r.DisplayObjectContainer.prototype._renderCanvas=function(t){if(this.visible===false||this.alpha===0){return}if(this._cacheAsBitmap){this._renderCachedSprite(t);return}if(this._mask){t.maskManager.pushMask(this._mask,t)}for(var e=0;e<this.children.length;e++){this.children[e]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}};Object.defineProperty(r.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(t){var e=this.getLocalBounds().width;if(e!==0){this.scale.x=t/e}else{this.scale.x=1}this._width=t}});Object.defineProperty(r.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(t){var e=this.getLocalBounds().height;if(e!==0){this.scale.y=t/e}else{this.scale.y=1}this._height=t}});r.Sprite=function(t){r.DisplayObjectContainer.call(this);this.anchor=new r.Point;this.texture=t||r.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.cachedTint=-1;this.tintedTexture=null;this.blendMode=r.blendModes.NORMAL;this.shader=null;this.exists=true;if(this.texture.baseTexture.hasLoaded){this.onTextureUpdate()}this.renderable=true};r.Sprite.prototype=Object.create(r.DisplayObjectContainer.prototype);r.Sprite.prototype.constructor=r.Sprite;Object.defineProperty(r.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width;this._width=t}});Object.defineProperty(r.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height;this._height=t}});r.Sprite.prototype.setTexture=function(t,e){if(e!==undefined){this.texture.baseTexture.destroy()}this.texture.baseTexture.skipRender=false;this.texture=t;this.texture.valid=true;this.cachedTint=-1};r.Sprite.prototype.onTextureUpdate=function(){if(this._width)this.scale.x=this._width/this.texture.frame.width;if(this._height)this.scale.y=this._height/this.texture.frame.height};r.Sprite.prototype.getBounds=function(t){var e=this.texture.frame.width;var i=this.texture.frame.height;var r=e*(1-this.anchor.x);var s=e*-this.anchor.x;var n=i*(1-this.anchor.y);var a=i*-this.anchor.y;var o=t||this.worldTransform;var h=o.a;var l=o.b;var u=o.c;var c=o.d;var f=o.tx;var d=o.ty;var p=-Infinity;var g=-Infinity;var v=Infinity;var m=Infinity;if(l===0&&u===0){if(h<0){h*=-1;var y=r;r=-s;s=-y}if(c<0){c*=-1;var y=n;n=-a;a=-y}v=h*s+f;p=h*r+f;m=c*a+d;g=c*n+d}else{var x=h*s+u*a+f;var b=c*a+l*s+d;var w=h*r+u*a+f;var _=c*a+l*r+d;var P=h*r+u*n+f;var T=c*n+l*r+d;var C=h*s+u*n+f;var S=c*n+l*s+d;v=x<v?x:v;v=w<v?w:v;v=P<v?P:v;v=C<v?C:v;m=b<m?b:m;m=_<m?_:m;m=T<m?T:m;m=S<m?S:m;p=x>p?x:p;p=w>p?w:p;p=P>p?P:p;p=C>p?C:p;g=b>g?b:g;g=_>g?_:g;g=T>g?T:g;g=S>g?S:g}var A=this._bounds;A.x=v;A.width=p-v;A.y=m;A.height=g-m;this._currentBounds=A;return A};r.Sprite.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=r.identityMatrix;for(var e=0;e<this.children.length;e++){this.children[e].updateTransform()}var i=this.getBounds();this.worldTransform=t;for(e=0;e<this.children.length;e++){this.children[e].updateTransform()}return i};r.Sprite.prototype._renderWebGL=function(t,e){if(!this.visible||this.alpha<=0||!this.renderable)return;var i=this.worldTransform;if(e){i=e}if(this._mask||this._filters){var r=t.spriteBatch;if(this._filters){r.flush();t.filterManager.pushFilter(this._filterBlock)}if(this._mask){r.stop();t.maskManager.pushMask(this.mask,t);r.start()}r.render(this);for(var s=0;s<this.children.length;s++){this.children[s]._renderWebGL(t)}r.stop();if(this._mask)t.maskManager.popMask(this._mask,t);if(this._filters)t.filterManager.popFilter();r.start()}else{t.spriteBatch.render(this);for(var s=0;s<this.children.length;s++){this.children[s]._renderWebGL(t,i)}}};r.Sprite.prototype._renderCanvas=function(t,e){if(!this.visible||this.alpha===0||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0){return}var i=this.worldTransform;if(e){i=e}if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;t.context.globalCompositeOperation=r.blendModesCanvas[t.currentBlendMode]}if(this._mask){t.maskManager.pushMask(this._mask,t)}if(this.texture.valid){var s=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha;if(t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode){t.scaleMode=this.texture.baseTexture.scaleMode;t.context[t.smoothProperty]=t.scaleMode===r.scaleModes.LINEAR}var n=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var a=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;var o=i.tx*t.resolution+t.shakeX;var h=i.ty*t.resolution+t.shakeY;if(t.roundPixels){t.context.setTransform(i.a,i.b,i.c,i.d,o|0,h|0);n|=0;a|=0}else{t.context.setTransform(i.a,i.b,i.c,i.d,o,h)}var l=this.texture.crop.width;var u=this.texture.crop.height;n/=s;a/=s;if(this.tint!==16777215){if(this.texture.requiresReTint||this.cachedTint!==this.tint){this.tintedTexture=r.CanvasTinter.getTintedTexture(this,this.tint);this.cachedTint=this.tint;this.texture.requiresReTint=false}t.context.drawImage(this.tintedTexture,0,0,l,u,n,a,l/s,u/s)}else{var c=this.texture.crop.x;var f=this.texture.crop.y;t.context.drawImage(this.texture.baseTexture.source,c,f,l,u,n,a,l/s,u/s)}}for(var d=0;d<this.children.length;d++){this.children[d]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}};r.SpriteBatch=function(t){r.DisplayObjectContainer.call(this);this.textureThing=t;this.ready=false};r.SpriteBatch.prototype=Object.create(r.DisplayObjectContainer.prototype);r.SpriteBatch.prototype.constructor=r.SpriteBatch;r.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new r.WebGLFastSpriteBatch(t);this.ready=true};r.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};r.SpriteBatch.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0||!this.children.length)return;if(!this.ready){this.initWebGL(t.gl)}if(this.fastSpriteBatch.gl!==t.gl){this.fastSpriteBatch.setContext(t.gl)}t.spriteBatch.stop();t.shaderManager.setShader(t.shaderManager.fastShader);this.fastSpriteBatch.begin(this,t);this.fastSpriteBatch.render(this);t.spriteBatch.start()};r.SpriteBatch.prototype._renderCanvas=function(t){if(!this.visible||this.alpha<=0||!this.children.length)return;var e=t.context;e.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();var i=this.worldTransform;var r=true;for(var s=0;s<this.children.length;s++){var n=this.children[s];if(!n.visible)continue;var a=n.texture;var o=a.frame;e.globalAlpha=this.worldAlpha*n.alpha;if(n.rotation%(Math.PI*2)===0){if(r){e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty);r=false}e.drawImage(a.baseTexture.source,o.x,o.y,o.width,o.height,n.anchor.x*(-o.width*n.scale.x)+n.position.x+.5+t.shakeX|0,n.anchor.y*(-o.height*n.scale.y)+n.position.y+.5+t.shakeY|0,o.width*n.scale.x,o.height*n.scale.y)}else{if(!r)r=true;n.displayObjectUpdateTransform();var h=n.worldTransform;var l=h.tx*t.resolution+t.shakeX;var u=h.ty*t.resolution+t.shakeY;if(t.roundPixels){e.setTransform(h.a,h.b,h.c,h.d,l|0,u|0)}else{e.setTransform(h.a,h.b,h.c,h.d,l,u)}e.drawImage(a.baseTexture.source,o.x,o.y,o.width,o.height,n.anchor.x*-o.width+.5|0,n.anchor.y*-o.height+.5|0,o.width,o.height)}}};r.hex2rgb=function(t){return[(t>>16&255)/255,(t>>8&255)/255,(t&255)/255]};r.rgb2hex=function(t){return(t[0]*255<<16)+(t[1]*255<<8)+t[2]*255};r.canUseNewCanvasBlendModes=function(){if(document===undefined)return false;var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/";var e="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var i=new Image;i.src=t+"AP804Oa6"+e;var s=new Image;s.src=t+"/wCKxvRF"+e;var n=r.CanvasPool.create(this,6,1);var a=n.getContext("2d");a.globalCompositeOperation="multiply";a.drawImage(i,0,0);a.drawImage(s,2,0);if(!a.getImageData(2,0,1,1)){return false}var o=a.getImageData(2,0,1,1).data;r.CanvasPool.remove(this);return o[0]===255&&o[1]===0&&o[2]===0};r.getNextPowerOfTwo=function(t){if(t>0&&(t&t-1)===0)return t;else{var e=1;while(e<t)e<<=1;return e}};r.isPowerOfTwo=function(t,e){return t>0&&(t&t-1)===0&&e>0&&(e&e-1)===0};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
r.CanvasPool={create:function(t,e,i){var s=r.CanvasPool.getFirst();var n;if(s===-1){var a={parent:t,canvas:document.createElement("canvas")};r.CanvasPool.pool.push(a);n=a.canvas}else{r.CanvasPool.pool[s].parent=t;n=r.CanvasPool.pool[s].canvas}if(e!==undefined){n.width=e;n.height=i}return n},getFirst:function(){var t=r.CanvasPool.pool;for(var e=0;e<t.length;e++){if(!t[e].parent){return e}}return-1},remove:function(t){var e=r.CanvasPool.pool;for(var i=0;i<e.length;i++){if(e[i].parent===t){e[i].parent=null;e[i].canvas.width=1;e[i].canvas.height=1}}},removeByCanvas:function(t){var e=r.CanvasPool.pool;for(var i=0;i<e.length;i++){if(e[i].canvas===t){e[i].parent=null;e[i].canvas.width=1;e[i].canvas.height=1}}},getTotal:function(){var t=r.CanvasPool.pool;var e=0;for(var i=0;i<t.length;i++){if(t[i].parent){e++}}return e},getFree:function(){var t=r.CanvasPool.pool;var e=0;for(var i=0;i<t.length;i++){if(!t[i].parent){e++}}return e}};r.CanvasPool.pool=[];r.initDefaultShaders=function(){};r.CompileVertexShader=function(t,e){return r._CompileShader(t,e,t.VERTEX_SHADER)};r.CompileFragmentShader=function(t,e){return r._CompileShader(t,e,t.FRAGMENT_SHADER)};r._CompileShader=function(t,e,i){var r=e;if(Array.isArray(e)){r=e.join("\n")}var s=t.createShader(i);t.shaderSource(s,r);t.compileShader(s);if(!t.getShaderParameter(s,t.COMPILE_STATUS)){window.console.log(t.getShaderInfoLog(s));return null}return s};r.compileProgram=function(t,e,i){var s=r.CompileFragmentShader(t,i);var n=r.CompileVertexShader(t,e);var a=t.createProgram();t.attachShader(a,n);t.attachShader(a,s);t.linkProgram(a);if(!t.getProgramParameter(a,t.LINK_STATUS)){window.console.log(t.getProgramInfoLog(a));window.console.log("Could not initialise shaders")}return a};r.PixiShader=function(t){this._UID=r._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.firstRun=true;this.dirty=true;this.attributes=[];this.init()};r.PixiShader.prototype.constructor=r.PixiShader;r.PixiShader.prototype.init=function(){var t=this.gl;var e=r.compileProgram(t,this.vertexSrc||r.PixiShader.defaultVertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.dimensions=t.getUniformLocation(e,"dimensions");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.colorAttribute=t.getAttribLocation(e,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var i in this.uniforms){this.uniforms[i].uniformLocation=t.getUniformLocation(e,i)}this.initUniforms();this.program=e};r.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var t=this.gl;var e;for(var i in this.uniforms){e=this.uniforms[i];var r=e.type;if(r==="sampler2D"){e._init=false;if(e.value!==null){this.initSampler2D(e)}}else if(r==="mat2"||r==="mat3"||r==="mat4"){e.glMatrix=true;e.glValueLength=1;if(r==="mat2"){e.glFunc=t.uniformMatrix2fv}else if(r==="mat3"){e.glFunc=t.uniformMatrix3fv}else if(r==="mat4"){e.glFunc=t.uniformMatrix4fv}}else{e.glFunc=t["uniform"+r];if(r==="2f"||r==="2i"){e.glValueLength=2}else if(r==="3f"||r==="3i"){e.glValueLength=3}else if(r==="4f"||r==="4i"){e.glValueLength=4}else{e.glValueLength=1}}}};r.PixiShader.prototype.initSampler2D=function(t){if(!t.value||!t.value.baseTexture||!t.value.baseTexture.hasLoaded){return}var e=this.gl;e.activeTexture(e["TEXTURE"+this.textureCount]);e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id]);if(t.textureData){var i=t.textureData;var r=i.magFilter?i.magFilter:e.LINEAR;var s=i.minFilter?i.minFilter:e.LINEAR;var n=i.wrapS?i.wrapS:e.CLAMP_TO_EDGE;var a=i.wrapT?i.wrapT:e.CLAMP_TO_EDGE;var o=i.luminance?e.LUMINANCE:e.RGBA;if(i.repeat){n=e.REPEAT;a=e.REPEAT}e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY);if(i.width){var h=i.width?i.width:512;var l=i.height?i.height:2;var u=i.border?i.border:0;e.texImage2D(e.TEXTURE_2D,0,o,h,l,u,o,e.UNSIGNED_BYTE,null)}else{e.texImage2D(e.TEXTURE_2D,0,o,e.RGBA,e.UNSIGNED_BYTE,t.value.baseTexture.source)}e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a)}e.uniform1i(t.uniformLocation,this.textureCount);t._init=true;this.textureCount++};r.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var t;var e=this.gl;for(var i in this.uniforms){t=this.uniforms[i];if(t.glValueLength===1){if(t.glMatrix===true){t.glFunc.call(e,t.uniformLocation,t.transpose,t.value)}else{t.glFunc.call(e,t.uniformLocation,t.value)}}else if(t.glValueLength===2){t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y)}else if(t.glValueLength===3){t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z)}else if(t.glValueLength===4){t.glFunc.call(e,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w)}else if(t.type==="sampler2D"){if(t._init){e.activeTexture(e["TEXTURE"+this.textureCount]);if(t.value.baseTexture._dirty[e.id]){r.instances[e.id].updateTexture(t.value.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,t.value.baseTexture._glTextures[e.id])}e.uniform1i(t.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(t)}}}};r.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};r.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];r.PixiFastShader=function(t){this._UID=r._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};r.PixiFastShader.prototype.constructor=r.PixiFastShader;r.PixiFastShader.prototype.init=function(){var t=this.gl;var e=r.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.dimensions=t.getUniformLocation(e,"dimensions");this.uMatrix=t.getUniformLocation(e,"uMatrix");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aPositionCoord=t.getAttribLocation(e,"aPositionCoord");this.aScale=t.getAttribLocation(e,"aScale");this.aRotation=t.getAttribLocation(e,"aRotation");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.colorAttribute=t.getAttribLocation(e,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=e};r.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};r.StripShader=function(t){this._UID=r._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};r.StripShader.prototype.constructor=r.StripShader;r.StripShader.prototype.init=function(){var t=this.gl;var e=r.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.uSampler=t.getUniformLocation(e,"uSampler");this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.colorAttribute=t.getAttribLocation(e,"aColor");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=t.getUniformLocation(e,"translationMatrix");this.alpha=t.getUniformLocation(e,"alpha");this.program=e};r.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};r.PrimitiveShader=function(t){this._UID=r._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};r.PrimitiveShader.prototype.constructor=r.PrimitiveShader;r.PrimitiveShader.prototype.init=function(){var t=this.gl;var e=r.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.tintColor=t.getUniformLocation(e,"tint");this.flipY=t.getUniformLocation(e,"flipY");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.colorAttribute=t.getAttribLocation(e,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(e,"translationMatrix");this.alpha=t.getUniformLocation(e,"alpha");this.program=e};r.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};r.ComplexPrimitiveShader=function(t){this._UID=r._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};r.ComplexPrimitiveShader.prototype.constructor=r.ComplexPrimitiveShader;r.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl;var e=r.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(e);this.projectionVector=t.getUniformLocation(e,"projectionVector");this.offsetVector=t.getUniformLocation(e,"offsetVector");this.tintColor=t.getUniformLocation(e,"tint");this.color=t.getUniformLocation(e,"color");this.flipY=t.getUniformLocation(e,"flipY");this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(e,"translationMatrix");this.alpha=t.getUniformLocation(e,"alpha");this.program=e};r.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};r.glContexts=[];r.instances=[];r.WebGLRenderer=function(t){this.game=t;if(!r.defaultRenderer){r.defaultRenderer=this}this.type=r.WEBGL_RENDERER;this.resolution=t.resolution;this.transparent=t.transparent;this.autoResize=false;this.preserveDrawingBuffer=t.preserveDrawingBuffer;this.clearBeforeRender=t.clearBeforeRender;this.width=t.width;this.height=t.height;this.view=t.canvas;this._contextOptions={alpha:this.transparent,antialias:t.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:this.preserveDrawingBuffer};this.projection=new r.Point;this.offset=new r.Point;this.shaderManager=new r.WebGLShaderManager;this.spriteBatch=new r.WebGLSpriteBatch;this.maskManager=new r.WebGLMaskManager;this.filterManager=new r.WebGLFilterManager;this.stencilManager=new r.WebGLStencilManager;this.blendModeManager=new r.WebGLBlendModeManager;this.renderSession={};this.renderSession.game=this.game;this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};r.WebGLRenderer.prototype.constructor=r.WebGLRenderer;r.WebGLRenderer.prototype.initContext=function(){var t=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=t;if(!t){throw new Error("This browser does not support webGL. Try using the canvas renderer")}this.glContextId=t.id=r.WebGLRenderer.glContextId++;r.glContexts[this.glContextId]=t;r.instances[this.glContextId]=this;t.disable(t.DEPTH_TEST);t.disable(t.CULL_FACE);t.enable(t.BLEND);this.shaderManager.setContext(t);this.spriteBatch.setContext(t);this.maskManager.setContext(t);this.filterManager.setContext(t);this.blendModeManager.setContext(t);this.stencilManager.setContext(t);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};r.WebGLRenderer.prototype.render=function(t){if(this.contextLost){return}var e=this.gl;e.viewport(0,0,this.width,this.height);e.bindFramebuffer(e.FRAMEBUFFER,null);if(this.game.clearBeforeRender){e.clearColor(t._bgColor.r,t._bgColor.g,t._bgColor.b,t._bgColor.a);e.clear(e.COLOR_BUFFER_BIT)}this.offset.x=this.game.camera._shake.x;this.offset.y=this.game.camera._shake.y;this.renderDisplayObject(t,this.projection)};r.WebGLRenderer.prototype.renderDisplayObject=function(t,e,i,s){this.renderSession.blendModeManager.setBlendMode(r.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=i?-1:1;this.renderSession.projection=e;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,i);t._renderWebGL(this.renderSession,s);this.spriteBatch.end()};r.WebGLRenderer.prototype.resize=function(t,e){this.width=t*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};r.WebGLRenderer.prototype.updateTexture=function(t){if(!t.hasLoaded){return false}var e=this.gl;if(!t._glTextures[e.id]){t._glTextures[e.id]=e.createTexture()}e.bindTexture(e.TEXTURE_2D,t._glTextures[e.id]);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.source);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t.scaleMode===r.scaleModes.LINEAR?e.LINEAR:e.NEAREST);if(t.mipmap&&r.isPowerOfTwo(t.width,t.height)){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===r.scaleModes.LINEAR?e.LINEAR_MIPMAP_LINEAR:e.NEAREST_MIPMAP_NEAREST);e.generateMipmap(e.TEXTURE_2D)}else{e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t.scaleMode===r.scaleModes.LINEAR?e.LINEAR:e.NEAREST)}if(!t._powerOf2){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}else{e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)}t._dirty[e.id]=false;return true};r.WebGLRenderer.prototype.destroy=function(){r.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;r.CanvasPool.remove(this);r.instances[this.glContextId]=null;r.WebGLRenderer.glContextId--};r.WebGLRenderer.prototype.mapBlendModes=function(){var t=this.gl;if(!r.blendModesWebGL){var e=[];var i=r.blendModes;e[i.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.ADD]=[t.SRC_ALPHA,t.DST_ALPHA];e[i.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA];e[i.SCREEN]=[t.SRC_ALPHA,t.ONE];e[i.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];e[i.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA];r.blendModesWebGL=e}};r.WebGLRenderer.glContextId=0;r.WebGLBlendModeManager=function(){this.currentBlendMode=99999};r.WebGLBlendModeManager.prototype.constructor=r.WebGLBlendModeManager;r.WebGLBlendModeManager.prototype.setContext=function(t){this.gl=t};r.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return false;this.currentBlendMode=t;var e=r.blendModesWebGL[this.currentBlendMode];if(e){this.gl.blendFunc(e[0],e[1])}return true};r.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};r.WebGLMaskManager=function(){};r.WebGLMaskManager.prototype.constructor=r.WebGLMaskManager;r.WebGLMaskManager.prototype.setContext=function(t){this.gl=t};r.WebGLMaskManager.prototype.pushMask=function(t,e){var i=e.gl;if(t.dirty){r.WebGLGraphics.updateGraphics(t,i)}if(t._webGL[i.id]===undefined||t._webGL[i.id].data===undefined||t._webGL[i.id].data.length===0){return}e.stencilManager.pushStencil(t,t._webGL[i.id].data[0],e)};r.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;if(t._webGL[i.id]===undefined||t._webGL[i.id].data===undefined||t._webGL[i.id].data.length===0){return}e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)};r.WebGLMaskManager.prototype.destroy=function(){this.gl=null};r.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=true;this.count=0};r.WebGLStencilManager.prototype.setContext=function(t){this.gl=t};r.WebGLStencilManager.prototype.pushStencil=function(t,e,i){var r=this.gl;this.bindGraphics(t,e,i);if(this.stencilStack.length===0){r.enable(r.STENCIL_TEST);r.clear(r.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(e);var s=this.count;r.colorMask(false,false,false,false);r.stencilFunc(r.ALWAYS,0,255);r.stencilOp(r.KEEP,r.KEEP,r.INVERT);if(e.mode===1){r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0);if(this.reverse){r.stencilFunc(r.EQUAL,255-s,255);r.stencilOp(r.KEEP,r.KEEP,r.DECR)}else{r.stencilFunc(r.EQUAL,s,255);r.stencilOp(r.KEEP,r.KEEP,r.INCR)}r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(e.indices.length-4)*2);if(this.reverse){r.stencilFunc(r.EQUAL,255-(s+1),255)}else{r.stencilFunc(r.EQUAL,s+1,255)}this.reverse=!this.reverse}else{if(!this.reverse){r.stencilFunc(r.EQUAL,255-s,255);r.stencilOp(r.KEEP,r.KEEP,r.DECR)}else{r.stencilFunc(r.EQUAL,s,255);r.stencilOp(r.KEEP,r.KEEP,r.INCR)}r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0);if(!this.reverse){r.stencilFunc(r.EQUAL,255-(s+1),255)}else{r.stencilFunc(r.EQUAL,s+1,255)}}r.colorMask(true,true,true,true);r.stencilOp(r.KEEP,r.KEEP,r.KEEP);this.count++};r.WebGLStencilManager.prototype.bindGraphics=function(t,e,i){this._currentGraphics=t;var s=this.gl;var n=i.projection,a=i.offset,o;if(e.mode===1){o=i.shaderManager.complexPrimitiveShader;i.shaderManager.setShader(o);s.uniform1f(o.flipY,i.flipY);s.uniformMatrix3fv(o.translationMatrix,false,t.worldTransform.toArray(true));s.uniform2f(o.projectionVector,n.x,-n.y);s.uniform2f(o.offsetVector,-a.x,-a.y);s.uniform3fv(o.tintColor,r.hex2rgb(t.tint));s.uniform3fv(o.color,e.color);s.uniform1f(o.alpha,t.worldAlpha*e.alpha);s.bindBuffer(s.ARRAY_BUFFER,e.buffer);s.vertexAttribPointer(o.aVertexPosition,2,s.FLOAT,false,4*2,0);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.indexBuffer)}else{o=i.shaderManager.primitiveShader;i.shaderManager.setShader(o);s.uniformMatrix3fv(o.translationMatrix,false,t.worldTransform.toArray(true));s.uniform1f(o.flipY,i.flipY);s.uniform2f(o.projectionVector,n.x,-n.y);s.uniform2f(o.offsetVector,-a.x,-a.y);s.uniform3fv(o.tintColor,r.hex2rgb(t.tint));s.uniform1f(o.alpha,t.worldAlpha);s.bindBuffer(s.ARRAY_BUFFER,e.buffer);s.vertexAttribPointer(o.aVertexPosition,2,s.FLOAT,false,4*6,0);s.vertexAttribPointer(o.colorAttribute,4,s.FLOAT,false,4*6,2*4);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.indexBuffer)}};r.WebGLStencilManager.prototype.popStencil=function(t,e,i){var r=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){r.disable(r.STENCIL_TEST)}else{var s=this.count;this.bindGraphics(t,e,i);r.colorMask(false,false,false,false);if(e.mode===1){this.reverse=!this.reverse;if(this.reverse){r.stencilFunc(r.EQUAL,255-(s+1),255);r.stencilOp(r.KEEP,r.KEEP,r.INCR)}else{r.stencilFunc(r.EQUAL,s+1,255);r.stencilOp(r.KEEP,r.KEEP,r.DECR)}r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(e.indices.length-4)*2);r.stencilFunc(r.ALWAYS,0,255);r.stencilOp(r.KEEP,r.KEEP,r.INVERT);r.drawElements(r.TRIANGLE_FAN,e.indices.length-4,r.UNSIGNED_SHORT,0);if(!this.reverse){r.stencilFunc(r.EQUAL,255-s,255)}else{r.stencilFunc(r.EQUAL,s,255)}}else{if(!this.reverse){r.stencilFunc(r.EQUAL,255-(s+1),255);r.stencilOp(r.KEEP,r.KEEP,r.INCR)}else{r.stencilFunc(r.EQUAL,s+1,255);r.stencilOp(r.KEEP,r.KEEP,r.DECR)}r.drawElements(r.TRIANGLE_STRIP,e.indices.length,r.UNSIGNED_SHORT,0);if(!this.reverse){r.stencilFunc(r.EQUAL,255-s,255)}else{r.stencilFunc(r.EQUAL,s,255)}}r.colorMask(true,true,true,true);r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}};r.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};r.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++){this.attribState[t]=false}this.stack=[]};r.WebGLShaderManager.prototype.constructor=r.WebGLShaderManager;r.WebGLShaderManager.prototype.setContext=function(t){this.gl=t;this.primitiveShader=new r.PrimitiveShader(t);this.complexPrimitiveShader=new r.ComplexPrimitiveShader(t);this.defaultShader=new r.PixiShader(t);this.fastShader=new r.PixiFastShader(t);this.stripShader=new r.StripShader(t);this.setShader(this.defaultShader)};r.WebGLShaderManager.prototype.setAttribs=function(t){var e;for(e=0;e<this.tempAttribState.length;e++){this.tempAttribState[e]=false}for(e=0;e<t.length;e++){var i=t[e];this.tempAttribState[i]=true}var r=this.gl;for(e=0;e<this.attribState.length;e++){if(this.attribState[e]!==this.tempAttribState[e]){this.attribState[e]=this.tempAttribState[e];if(this.tempAttribState[e]){r.enableVertexAttribArray(e)}else{r.disableVertexAttribArray(e)}}}};r.WebGLShaderManager.prototype.setShader=function(t){if(this._currentId===t._UID)return false;this._currentId=t._UID;this.currentShader=t;this.gl.useProgram(t.program);this.setAttribs(t.attributes);return true};r.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};r.WebGLSpriteBatch=function(){this.vertSize=5;this.size=2e3;var t=this.size*4*4*this.vertSize;var e=this.size*6;this.vertices=new r.ArrayBuffer(t);this.positions=new r.Float32Array(this.vertices);this.colors=new r.Uint32Array(this.vertices);this.indices=new r.Uint16Array(e);this.lastIndexCount=0;for(var i=0,s=0;i<e;i+=6,s+=4){this.indices[i+0]=s+0;this.indices[i+1]=s+1;this.indices[i+2]=s+2;this.indices[i+3]=s+0;this.indices[i+4]=s+2;this.indices[i+5]=s+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=true;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new r.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};r.WebGLSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW);this.currentBlendMode=99999;var e=new r.PixiShader(t);e.fragmentSrc=this.defaultShader.fragmentSrc;e.uniforms={};e.init();this.defaultShader.shaders[t.id]=e};r.WebGLSpriteBatch.prototype.begin=function(t){this.renderSession=t;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};r.WebGLSpriteBatch.prototype.end=function(){this.flush()};r.WebGLSpriteBatch.prototype.render=function(t,e){var i=t.texture;var r=t.worldTransform;if(e){r=e}if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=i.baseTexture}var s=i._uvs;if(!s){return}var n=t.anchor.x;var a=t.anchor.y;var o,h,l,u;if(i.trim){var c=i.trim;h=c.x-n*c.width;o=h+i.crop.width;u=c.y-a*c.height;l=u+i.crop.height}else{o=i.frame.width*(1-n);h=i.frame.width*-n;l=i.frame.height*(1-a);u=i.frame.height*-a}var f=this.currentBatchSize*4*this.vertSize;var d=i.baseTexture.resolution;var p=r.a/d;var g=r.b/d;var v=r.c/d;var m=r.d/d;var y=r.tx;var x=r.ty;var b=this.colors;var w=this.positions;if(this.renderSession.roundPixels){w[f]=p*h+v*u+y|0;w[f+1]=m*u+g*h+x|0;w[f+5]=p*o+v*u+y|0;w[f+6]=m*u+g*o+x|0;w[f+10]=p*o+v*l+y|0;w[f+11]=m*l+g*o+x|0;w[f+15]=p*h+v*l+y|0;w[f+16]=m*l+g*h+x|0}else{w[f]=p*h+v*u+y;w[f+1]=m*u+g*h+x;w[f+5]=p*o+v*u+y;w[f+6]=m*u+g*o+x;w[f+10]=p*o+v*l+y;w[f+11]=m*l+g*o+x;w[f+15]=p*h+v*l+y;w[f+16]=m*l+g*h+x}w[f+2]=s.x0;w[f+3]=s.y0;w[f+7]=s.x1;w[f+8]=s.y1;w[f+12]=s.x2;w[f+13]=s.y2;w[f+17]=s.x3;w[f+18]=s.y3;var _=t.tint;b[f+4]=b[f+9]=b[f+14]=b[f+19]=(_>>16)+(_&65280)+((_&255)<<16)+(t.worldAlpha*255<<24);this.sprites[this.currentBatchSize++]=t};r.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var e=t.tilingTexture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=e.baseTexture}if(!t._uvs){t._uvs=new r.TextureUvs}var i=t._uvs;var s=e.baseTexture.width;var n=e.baseTexture.height;t.tilePosition.x%=s*t.tileScaleOffset.x;t.tilePosition.y%=n*t.tileScaleOffset.y;var a=t.tilePosition.x/(s*t.tileScaleOffset.x);var o=t.tilePosition.y/(n*t.tileScaleOffset.y);var h=t.width/s/(t.tileScale.x*t.tileScaleOffset.x);var l=t.height/n/(t.tileScale.y*t.tileScaleOffset.y);i.x0=0-a;i.y0=0-o;i.x1=1*h-a;i.y1=0-o;i.x2=1*h-a;i.y2=1*l-o;i.x3=0-a;i.y3=1*l-o;var u=t.tint;var c=(u>>16)+(u&65280)+((u&255)<<16)+(t.worldAlpha*255<<24);var f=this.positions;var d=this.colors;var p=t.width;var g=t.height;var v=t.anchor.x;var m=t.anchor.y;var y=p*(1-v);var x=p*-v;var b=g*(1-m);var w=g*-m;var _=this.currentBatchSize*4*this.vertSize;var P=e.baseTexture.resolution;var T=t.worldTransform;var C=T.a/P;var S=T.b/P;var A=T.c/P;var E=T.d/P;var I=T.tx;var M=T.ty;f[_++]=C*x+A*w+I;f[_++]=E*w+S*x+M;f[_++]=i.x0;f[_++]=i.y0;d[_++]=c;f[_++]=C*y+A*w+I;f[_++]=E*w+S*y+M;f[_++]=i.x1;f[_++]=i.y1;d[_++]=c;f[_++]=C*y+A*b+I;f[_++]=E*b+S*y+M;f[_++]=i.x2;f[_++]=i.y2;d[_++]=c;f[_++]=C*x+A*b+I;f[_++]=E*b+S*x+M;f[_++]=i.x3;f[_++]=i.y3;d[_++]=c;this.sprites[this.currentBatchSize++]=t};r.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var t=this.gl;var e;if(this.dirty){this.dirty=false;t.activeTexture(t.TEXTURE0);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);e=this.defaultShader.shaders[t.id];var i=this.vertSize*4;t.vertexAttribPointer(e.aVertexPosition,2,t.FLOAT,false,i,0);t.vertexAttribPointer(e.aTextureCoord,2,t.FLOAT,false,i,2*4);t.vertexAttribPointer(e.colorAttribute,4,t.UNSIGNED_BYTE,true,i,4*4)}if(this.currentBatchSize>this.size*.5){t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices)}else{var s=this.positions.subarray(0,this.currentBatchSize*4*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,s)}var n,a,o;var h=0;var l=0;var u=null;var c=this.renderSession.blendModeManager.currentBlendMode;var f=null;var d=false;var p=false;var g;for(var v=0,m=this.currentBatchSize;v<m;v++){g=this.sprites[v];if(g.tilingTexture){n=g.tilingTexture.baseTexture}else{n=g.texture.baseTexture}a=g.blendMode;o=g.shader||this.defaultShader;d=c!==a;p=f!==o;var y=n.skipRender;if(y&&g.children.length>0){y=false}if(u!==n&&!y||d||p){this.renderBatch(u,h,l);l=v;h=0;u=n;if(d){c=a;this.renderSession.blendModeManager.setBlendMode(c)}if(p){f=o;e=f.shaders[t.id];if(!e){e=new r.PixiShader(t);e.fragmentSrc=f.fragmentSrc;e.uniforms=f.uniforms;e.init();f.shaders[t.id]=e}this.renderSession.shaderManager.setShader(e);if(e.dirty){e.syncUniforms()}var x=this.renderSession.projection;t.uniform2f(e.projectionVector,x.x,x.y);var b=this.renderSession.offset;t.uniform2f(e.offsetVector,b.x,b.y)}}h++}this.renderBatch(u,h,l);this.currentBatchSize=0};r.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(e===0){return}var r=this.gl;if(t._dirty[r.id]){if(!this.renderSession.renderer.updateTexture(t)){return}}else{r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id])}r.drawElements(r.TRIANGLES,e*6,r.UNSIGNED_SHORT,i*6*2);this.renderSession.drawCount++};r.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=true};r.WebGLSpriteBatch.prototype.start=function(){this.dirty=true};r.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};r.WebGLFastSpriteBatch=function(t){this.vertSize=10;this.maxSize=6e3;this.size=this.maxSize;var e=this.size*4*this.vertSize;var i=this.maxSize*6;this.vertices=new r.Float32Array(e);this.indices=new r.Uint16Array(i);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var s=0,n=0;s<i;s+=6,n+=4){this.indices[s+0]=n+0;this.indices[s+1]=n+1;this.indices[s+2]=n+2;this.indices[s+3]=n+0;this.indices[s+4]=n+2;this.indices[s+5]=n+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(t)};r.WebGLFastSpriteBatch.prototype.constructor=r.WebGLFastSpriteBatch;r.WebGLFastSpriteBatch.prototype.setContext=function(t){this.gl=t;this.vertexBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertices,t.DYNAMIC_DRAW)};r.WebGLFastSpriteBatch.prototype.begin=function(t,e){this.renderSession=e;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=t.worldTransform.toArray(true);this.start()};r.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};r.WebGLFastSpriteBatch.prototype.render=function(t){var e=t.children;var i=e[0];if(!i.texture._uvs)return;this.currentBaseTexture=i.texture.baseTexture;if(i.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(i.blendMode)}for(var r=0,s=e.length;r<s;r++){this.renderSprite(e[r])}this.flush()};r.WebGLFastSpriteBatch.prototype.renderSprite=function(t){if(!t.visible)return;if(t.texture.baseTexture!==this.currentBaseTexture&&!t.texture.baseTexture.skipRender){this.flush();this.currentBaseTexture=t.texture.baseTexture;if(!t.texture._uvs)return}var e,i=this.vertices,r,s,n,a,o,h,l;e=t.texture._uvs;r=t.texture.frame.width;s=t.texture.frame.height;if(t.texture.trim){var u=t.texture.trim;a=u.x-t.anchor.x*u.width;n=a+t.texture.crop.width;h=u.y-t.anchor.y*u.height;o=h+t.texture.crop.height}else{n=t.texture.frame.width*(1-t.anchor.x);a=t.texture.frame.width*-t.anchor.x;o=t.texture.frame.height*(1-t.anchor.y);h=t.texture.frame.height*-t.anchor.y}l=this.currentBatchSize*4*this.vertSize;i[l++]=a;i[l++]=h;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x0;i[l++]=e.y1;i[l++]=t.alpha;i[l++]=n;i[l++]=h;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x1;i[l++]=e.y1;i[l++]=t.alpha;i[l++]=n;i[l++]=o;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x2;i[l++]=e.y2;i[l++]=t.alpha;i[l++]=a;i[l++]=o;i[l++]=t.position.x;i[l++]=t.position.y;i[l++]=t.scale.x;i[l++]=t.scale.y;i[l++]=t.rotation;i[l++]=e.x3;i[l++]=e.y3;i[l++]=t.alpha;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};r.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0)return;var t=this.gl;if(!this.currentBaseTexture._glTextures[t.id])this.renderSession.renderer.updateTexture(this.currentBaseTexture,t);t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]);if(this.currentBatchSize>this.size*.5){t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices)}else{var e=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,this.currentBatchSize*6,t.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};r.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};r.WebGLFastSpriteBatch.prototype.start=function(){var t=this.gl;t.activeTexture(t.TEXTURE0);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var e=this.renderSession.projection;t.uniform2f(this.shader.projectionVector,e.x,e.y);t.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var i=this.vertSize*4;t.vertexAttribPointer(this.shader.aVertexPosition,2,t.FLOAT,false,i,0);t.vertexAttribPointer(this.shader.aPositionCoord,2,t.FLOAT,false,i,2*4);t.vertexAttribPointer(this.shader.aScale,2,t.FLOAT,false,i,4*4);t.vertexAttribPointer(this.shader.aRotation,1,t.FLOAT,false,i,6*4);t.vertexAttribPointer(this.shader.aTextureCoord,2,t.FLOAT,false,i,7*4);t.vertexAttribPointer(this.shader.colorAttribute,1,t.FLOAT,false,i,9*4)};r.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};r.WebGLFilterManager.prototype.constructor=r.WebGLFilterManager;r.WebGLFilterManager.prototype.setContext=function(t){this.gl=t;this.texturePool=[];this.initShaderBuffers()};r.WebGLFilterManager.prototype.begin=function(t,e){this.renderSession=t;this.defaultShader=t.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=i.x*2;this.height=-i.y*2;this.buffer=e};r.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl;var i=this.renderSession.projection;var s=this.renderSession.offset;t._filterArea=t.target.filterArea||t.target.getBounds();t._previous_stencil_mgr=this.renderSession.stencilManager;this.renderSession.stencilManager=new r.WebGLStencilManager;this.renderSession.stencilManager.setContext(e);e.disable(e.STENCIL_TEST);this.filterStack.push(t);var n=t.filterPasses[0];this.offsetX+=t._filterArea.x;this.offsetY+=t._filterArea.y;var a=this.texturePool.pop();if(!a){a=new r.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}else{a.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}e.bindTexture(e.TEXTURE_2D,a.texture);var o=t._filterArea;var h=n.padding;o.x-=h;o.y-=h;o.width+=h*2;o.height+=h*2;if(o.x<0)o.x=0;if(o.width>this.width)o.width=this.width;if(o.y<0)o.y=0;if(o.height>this.height)o.height=this.height;e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer);e.viewport(0,0,o.width*this.renderSession.resolution,o.height*this.renderSession.resolution);i.x=o.width/2;i.y=-o.height/2;s.x=-o.x;s.y=-o.y;e.colorMask(true,true,true,true);e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT);t._glFilterTexture=a};r.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl;var e=this.filterStack.pop();var i=e._filterArea;var s=e._glFilterTexture;var n=this.renderSession.projection;var a=this.renderSession.offset;if(e.filterPasses.length>1){t.viewport(0,0,i.width*this.renderSession.resolution,i.height*this.renderSession.resolution);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=i.height;this.vertexArray[2]=i.width;this.vertexArray[3]=i.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=i.width;this.vertexArray[7]=0;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var o=s;var h=this.texturePool.pop();if(!h)h=new r.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);h.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer);t.clear(t.COLOR_BUFFER_BIT);t.disable(t.BLEND);for(var l=0;l<e.filterPasses.length-1;l++){var u=e.filterPasses[l];t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,o.texture);this.applyFilterPass(u,i,i.width,i.height);var c=o;o=h;h=c}t.enable(t.BLEND);s=o;this.texturePool.push(h)}var f=e.filterPasses[e.filterPasses.length-1];this.offsetX-=i.x;this.offsetY-=i.y;var d=this.width;var p=this.height;var g=0;var v=0;var m=this.buffer;if(this.filterStack.length===0){t.colorMask(true,true,true,true)}else{var y=this.filterStack[this.filterStack.length-1];i=y._filterArea;d=i.width;p=i.height;g=i.x;v=i.y;m=y._glFilterTexture.frameBuffer}n.x=d/2;n.y=-p/2;a.x=g;a.y=v;i=e._filterArea;var x=i.x-g;var b=i.y-v;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=x;this.vertexArray[1]=b+i.height;this.vertexArray[2]=x+i.width;this.vertexArray[3]=b+i.height;this.vertexArray[4]=x;this.vertexArray[5]=b;this.vertexArray[6]=x+i.width;this.vertexArray[7]=b;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);t.viewport(0,0,d*this.renderSession.resolution,p*this.renderSession.resolution);t.bindFramebuffer(t.FRAMEBUFFER,m);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,s.texture);if(this.renderSession.stencilManager){this.renderSession.stencilManager.destroy()}this.renderSession.stencilManager=e._previous_stencil_mgr;e._previous_stencil_mgr=null;if(this.renderSession.stencilManager.count>0){t.enable(t.STENCIL_TEST)}else{t.disable(t.STENCIL_TEST)}this.applyFilterPass(f,i,d,p);this.texturePool.push(s);e._glFilterTexture=null};r.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,s){var n=this.gl;var a=t.shaders[n.id];if(!a){a=new r.PixiShader(n);a.fragmentSrc=t.fragmentSrc;a.uniforms=t.uniforms;a.init();t.shaders[n.id]=a}this.renderSession.shaderManager.setShader(a);n.uniform2f(a.projectionVector,i/2,-s/2);n.uniform2f(a.offsetVector,0,0);if(t.uniforms.dimensions){t.uniforms.dimensions.value[0]=this.width;t.uniforms.dimensions.value[1]=this.height;t.uniforms.dimensions.value[2]=this.vertexArray[0];t.uniforms.dimensions.value[3]=this.vertexArray[5]}a.syncUniforms();n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.vertexAttribPointer(a.aVertexPosition,2,n.FLOAT,false,0,0);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer);n.vertexAttribPointer(a.aTextureCoord,2,n.FLOAT,false,0,0);n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer);n.vertexAttribPointer(a.colorAttribute,2,n.FLOAT,false,0,0);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);this.renderSession.drawCount++};r.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer();this.uvBuffer=t.createBuffer();this.colorBuffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.vertexArray=new r.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW);this.uvArray=new r.Float32Array([0,0,1,0,0,1,1,1]);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW);this.colorArray=new r.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)};r.WebGLFilterManager.prototype.destroy=function(){var t=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var e=0;e<this.texturePool.length;e++){this.texturePool[e].destroy()}this.texturePool=null;t.deleteBuffer(this.vertexBuffer);t.deleteBuffer(this.uvBuffer);t.deleteBuffer(this.colorBuffer);t.deleteBuffer(this.indexBuffer)};r.FilterTexture=function(t,e,i,s){this.gl=t;this.frameBuffer=t.createFramebuffer();this.texture=t.createTexture();s=s||r.scaleModes.DEFAULT;t.bindTexture(t.TEXTURE_2D,this.texture);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,s===r.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,s===r.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);this.renderBuffer=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer);this.resize(e,i)};r.FilterTexture.prototype.constructor=r.FilterTexture;r.FilterTexture.prototype.clear=function(){var t=this.gl;t.clearColor(0,0,0,0);t.clear(t.COLOR_BUFFER_BIT)};r.FilterTexture.prototype.resize=function(t,e){if(this.width===t&&this.height===e)return;this.width=t;this.height=e;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t,e)};r.FilterTexture.prototype.destroy=function(){var t=this.gl;t.deleteFramebuffer(this.frameBuffer);t.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};r.CanvasBuffer=function(t,e){this.width=t;this.height=e;this.canvas=r.CanvasPool.create(this,this.width,this.height);this.context=this.canvas.getContext("2d");this.canvas.width=t;this.canvas.height=e};r.CanvasBuffer.prototype.constructor=r.CanvasBuffer;r.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};r.CanvasBuffer.prototype.resize=function(t,e){this.width=this.canvas.width=t;this.height=this.canvas.height=e};r.CanvasBuffer.prototype.destroy=function(){r.CanvasPool.remove(this)};r.CanvasMaskManager=function(){};r.CanvasMaskManager.prototype.constructor=r.CanvasMaskManager;r.CanvasMaskManager.prototype.pushMask=function(t,e){var i=e.context;i.save();var s=t.alpha;var n=t.worldTransform;var a=e.resolution;i.setTransform(n.a*a,n.b*a,n.c*a,n.d*a,n.tx*a,n.ty*a);r.CanvasGraphics.renderGraphicsMask(t,i);i.clip();t.worldAlpha=s};r.CanvasMaskManager.prototype.popMask=function(t){t.context.restore()};r.CanvasTinter=function(){};r.CanvasTinter.getTintedTexture=function(t,e){var i=t.tintedTexture||r.CanvasPool.create(this);r.CanvasTinter.tintMethod(t.texture,e,i);return i};r.CanvasTinter.tintWithMultiply=function(t,e,i){var r=i.getContext("2d");var s=t.crop;if(i.width!==s.width||i.height!==s.height){i.width=s.width;i.height=s.height}r.clearRect(0,0,s.width,s.height);r.fillStyle="#"+("00000"+(e|0).toString(16)).substr(-6);r.fillRect(0,0,s.width,s.height);r.globalCompositeOperation="multiply";r.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);r.globalCompositeOperation="destination-atop";r.drawImage(t.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height)};r.CanvasTinter.tintWithPerPixel=function(t,e,i){var s=i.getContext("2d");var n=t.crop;i.width=n.width;i.height=n.height;s.globalCompositeOperation="copy";s.drawImage(t.baseTexture.source,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var a=r.hex2rgb(e);var o=a[0],h=a[1],l=a[2];var u=s.getImageData(0,0,n.width,n.height);var c=u.data;for(var f=0;f<c.length;f+=4){c[f+0]*=o;c[f+1]*=h;c[f+2]*=l;if(!r.CanvasTinter.canHandleAlpha){var d=c[f+3];c[f+0]/=255/d;c[f+1]/=255/d;c[f+2]/=255/d}}s.putImageData(u,0,0)};r.CanvasTinter.checkInverseAlpha=function(){var t=new r.CanvasBuffer(2,1);t.context.fillStyle="rgba(10, 20, 30, 0.5)";t.context.fillRect(0,0,1,1);var e=t.context.getImageData(0,0,1,1);if(e===null){return false}t.context.putImageData(e,1,0);var i=t.context.getImageData(1,0,1,1);return i.data[0]===e.data[0]&&i.data[1]===e.data[1]&&i.data[2]===e.data[2]&&i.data[3]===e.data[3]};r.CanvasTinter.canHandleAlpha=r.CanvasTinter.checkInverseAlpha();r.CanvasTinter.canUseMultiply=r.canUseNewCanvasBlendModes();r.CanvasTinter.tintMethod=r.CanvasTinter.canUseMultiply?r.CanvasTinter.tintWithMultiply:r.CanvasTinter.tintWithPerPixel;r.CanvasRenderer=function(t){this.game=t;if(!r.defaultRenderer){r.defaultRenderer=this}this.type=r.CANVAS_RENDERER;this.resolution=t.resolution;this.clearBeforeRender=t.clearBeforeRender;this.transparent=t.transparent;this.autoResize=false;this.width=t.width*this.resolution;this.height=t.height*this.resolution;this.view=t.canvas;this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.count=0;this.maskManager=new r.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:false};this.mapBlendModes();this.resize(this.width,this.height)};r.CanvasRenderer.prototype.constructor=r.CanvasRenderer;r.CanvasRenderer.prototype.render=function(t){this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=0;this.renderSession.shakeX=this.game.camera._shake.x;this.renderSession.shakeY=this.game.camera._shake.y;this.context.globalCompositeOperation="source-over";if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else if(t._bgColor){this.context.fillStyle=t._bgColor.rgba;this.context.fillRect(0,0,this.width,this.height)}}this.renderDisplayObject(t)};r.CanvasRenderer.prototype.destroy=function(t){if(t===undefined){t=true}if(t&&this.view.parent){this.view.parent.removeChild(this.view)}this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};r.CanvasRenderer.prototype.resize=function(t,e){this.width=t*this.resolution;this.height=e*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}if(this.renderSession.smoothProperty){this.context[this.renderSession.smoothProperty]=this.renderSession.scaleMode===r.scaleModes.LINEAR}};r.CanvasRenderer.prototype.renderDisplayObject=function(t,e,i){this.renderSession.context=e||this.context;this.renderSession.resolution=this.resolution;t._renderCanvas(this.renderSession,i)};r.CanvasRenderer.prototype.mapBlendModes=function(){if(!r.blendModesCanvas){var t=[];var e=r.blendModes;var i=r.canUseNewCanvasBlendModes();t[e.NORMAL]="source-over";t[e.ADD]="lighter";t[e.MULTIPLY]=i?"multiply":"source-over";t[e.SCREEN]=i?"screen":"source-over";t[e.OVERLAY]=i?"overlay":"source-over";t[e.DARKEN]=i?"darken":"source-over";t[e.LIGHTEN]=i?"lighten":"source-over";t[e.COLOR_DODGE]=i?"color-dodge":"source-over";t[e.COLOR_BURN]=i?"color-burn":"source-over";t[e.HARD_LIGHT]=i?"hard-light":"source-over";t[e.SOFT_LIGHT]=i?"soft-light":"source-over";t[e.DIFFERENCE]=i?"difference":"source-over";t[e.EXCLUSION]=i?"exclusion":"source-over";t[e.HUE]=i?"hue":"source-over";t[e.SATURATION]=i?"saturation":"source-over";t[e.COLOR]=i?"color":"source-over";t[e.LUMINOSITY]=i?"luminosity":"source-over";r.blendModesCanvas=t}};r.BaseTexture=function(t,e){this.resolution=1;this.width=100;this.height=100;this.scaleMode=e||r.scaleModes.DEFAULT;this.hasLoaded=false;this.source=t;this.premultipliedAlpha=true;this._glTextures=[];this.mipmap=false;this._dirty=[true,true,true,true];if(!t){return}if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.naturalWidth||this.source.width;this.height=this.source.naturalHeight||this.source.height;this.dirty()}this.skipRender=false;this._powerOf2=false};r.BaseTexture.prototype.constructor=r.BaseTexture;r.BaseTexture.prototype.forceLoaded=function(t,e){this.hasLoaded=true;this.width=t;this.height=e;this.dirty()};r.BaseTexture.prototype.destroy=function(){if(this.source){r.CanvasPool.removeByCanvas(this.source)}this.source=null;this.unloadFromGPU()};r.BaseTexture.prototype.updateSourceImage=function(t){console.warn("PIXI.BaseTexture.updateSourceImage is deprecated. Use Phaser.Sprite.loadTexture instead.")};r.BaseTexture.prototype.dirty=function(){for(var t=0;t<this._glTextures.length;t++){this._dirty[t]=true}};r.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var t=this._glTextures.length-1;t>=0;t--){var e=this._glTextures[t];var i=r.glContexts[t];if(i&&e){i.deleteTexture(e)}}this._glTextures.length=0;this.dirty()};r.BaseTexture.fromCanvas=function(t,e){if(t.width===0){t.width=1}if(t.height===0){t.height=1}return new r.BaseTexture(t,e)};r.TextureSilentFail=false;r.Texture=function(t,e,i,s){this.noFrame=false;if(!e){this.noFrame=true;e=new r.Rectangle(0,0,1,1)}if(t instanceof r.Texture){t=t.baseTexture}this.baseTexture=t;this.frame=e;this.trim=s;this.valid=false;this.isTiling=false;this.requiresUpdate=false;this.requiresReTint=false;this._uvs=null;this.width=0;this.height=0;this.crop=i||new r.Rectangle(0,0,1,1);if(t.hasLoaded){if(this.noFrame)e=new r.Rectangle(0,0,t.width,t.height);this.setFrame(e)}};r.Texture.prototype.constructor=r.Texture;r.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;if(this.noFrame){this.frame=new r.Rectangle(0,0,t.width,t.height)}this.setFrame(this.frame)};r.Texture.prototype.destroy=function(t){if(t)this.baseTexture.destroy();this.valid=false};r.Texture.prototype.setFrame=function(t){this.noFrame=false;this.frame=t;this.width=t.width;this.height=t.height;this.crop.x=t.x;this.crop.y=t.y;this.crop.width=t.width;this.crop.height=t.height;if(!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height)){if(!r.TextureSilentFail){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=false;return}this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}if(this.valid)this._updateUvs()};r.Texture.prototype._updateUvs=function(){if(!this._uvs)this._uvs=new r.TextureUvs;var t=this.crop;var e=this.baseTexture.width;var i=this.baseTexture.height;this._uvs.x0=t.x/e;this._uvs.y0=t.y/i;this._uvs.x1=(t.x+t.width)/e;this._uvs.y1=t.y/i;this._uvs.x2=(t.x+t.width)/e;this._uvs.y2=(t.y+t.height)/i;this._uvs.x3=t.x/e;this._uvs.y3=(t.y+t.height)/i};r.Texture.fromCanvas=function(t,e){var i=r.BaseTexture.fromCanvas(t,e);return new r.Texture(i)};r.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};r.RenderTexture=function(t,e,i,s,n){this.width=t||100;this.height=e||100;this.resolution=n||1;this.frame=new r.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=new r.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.baseTexture=new r.BaseTexture;this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;this.baseTexture.scaleMode=s||r.scaleModes.DEFAULT;this.baseTexture.hasLoaded=true;r.Texture.call(this,this.baseTexture,new r.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution));this.renderer=i||r.defaultRenderer;if(this.renderer.type===r.WEBGL_RENDERER){var a=this.renderer.gl;this.baseTexture._dirty[a.id]=false;this.textureBuffer=new r.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[a.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new r.Point(this.width*.5,-this.height*.5)}else{this.render=this.renderCanvas;this.textureBuffer=new r.CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas}this.valid=true;this.tempMatrix=new Phaser.Matrix;this._updateUvs()};r.RenderTexture.prototype=Object.create(r.Texture.prototype);r.RenderTexture.prototype.constructor=r.RenderTexture;r.RenderTexture.prototype.resize=function(t,e,i){if(t===this.width&&e===this.height)return;this.valid=t>0&&e>0;this.width=t;this.height=e;this.frame.width=this.crop.width=t*this.resolution;this.frame.height=this.crop.height=e*this.resolution;if(i){this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution}if(this.renderer.type===r.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}if(!this.valid)return;this.textureBuffer.resize(this.width,this.height)};r.RenderTexture.prototype.clear=function(){if(!this.valid){return}if(this.renderer.type===r.WEBGL_RENDERER){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};r.RenderTexture.prototype.renderWebGL=function(t,e,i){if(!this.valid||t.alpha===0){return}var r=t.worldTransform;r.identity();r.translate(0,this.projection.y*2);if(e){r.append(e)}r.scale(1,-1);for(var s=0;s<t.children.length;s++){t.children[s].updateTransform()}var n=this.renderer.gl;n.viewport(0,0,this.width*this.resolution,this.height*this.resolution);n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(i){this.textureBuffer.clear()}this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer,e);this.renderer.spriteBatch.dirty=true};r.RenderTexture.prototype.renderCanvas=function(t,e,i){if(!this.valid||t.alpha===0){return}var r=t.worldTransform;r.identity();if(e){r.append(e)}for(var s=0;s<t.children.length;s++){t.children[s].updateTransform()}if(i){this.textureBuffer.clear()}var n=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(t,this.textureBuffer.context,e);this.renderer.resolution=n};r.RenderTexture.prototype.getImage=function(){var t=new Image;t.src=this.getBase64();return t};r.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};r.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===r.WEBGL_RENDERER){var t=this.renderer.gl;var e=this.textureBuffer.width;var i=this.textureBuffer.height;var s=new Uint8Array(4*e*i);t.bindFramebuffer(t.FRAMEBUFFER,this.textureBuffer.frameBuffer);t.readPixels(0,0,e,i,t.RGBA,t.UNSIGNED_BYTE,s);t.bindFramebuffer(t.FRAMEBUFFER,null);var n=new r.CanvasBuffer(e,i);var a=n.context.getImageData(0,0,e,i);a.data.set(s);n.context.putImageData(a,0,0);return n.canvas}else{return this.textureBuffer.canvas}};r.AbstractFilter=function(t,e){this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms=e||{};this.fragmentSrc=t||[]};r.AbstractFilter.prototype.constructor=r.AbstractFilter;r.AbstractFilter.prototype.syncUniforms=function(){for(var t=0,e=this.shaders.length;t<e;t++){this.shaders[t].dirty=true}};r.Strip=function(t){r.DisplayObjectContainer.call(this);this.texture=t;this.uvs=new r.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new r.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new r.Float32Array([1,1,1,1]);this.indices=new r.Uint16Array([0,1,2,3]);this.dirty=true;this.blendMode=r.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=r.Strip.DrawModes.TRIANGLE_STRIP};r.Strip.prototype=Object.create(r.DisplayObjectContainer.prototype);r.Strip.prototype.constructor=r.Strip;r.Strip.prototype._renderWebGL=function(t){if(!this.visible||this.alpha<=0)return;t.spriteBatch.stop();if(!this._vertexBuffer)this._initWebGL(t);t.shaderManager.setShader(t.shaderManager.stripShader);this._renderStrip(t);t.spriteBatch.start()};r.Strip.prototype._initWebGL=function(t){var e=t.gl;this._vertexBuffer=e.createBuffer();this._indexBuffer=e.createBuffer();this._uvBuffer=e.createBuffer();this._colorBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer);e.bufferData(e.ARRAY_BUFFER,this.colors,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)};r.Strip.prototype._renderStrip=function(t){var e=t.gl;var i=t.projection,s=t.offset,n=t.shaderManager.stripShader;var a=this.drawMode===r.Strip.DrawModes.TRIANGLE_STRIP?e.TRIANGLE_STRIP:e.TRIANGLES;t.blendModeManager.setBlendMode(this.blendMode);e.uniformMatrix3fv(n.translationMatrix,false,this.worldTransform.toArray(true));e.uniform2f(n.projectionVector,i.x,-i.y);e.uniform2f(n.offsetVector,-s.x,-s.y);e.uniform1f(n.alpha,this.worldAlpha);if(!this.dirty){e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);e.vertexAttribPointer(n.aVertexPosition,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.vertexAttribPointer(n.aTextureCoord,2,e.FLOAT,false,0,0);e.activeTexture(e.TEXTURE0);if(this.texture.baseTexture._dirty[e.id]){t.renderer.updateTexture(this.texture.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id])}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}else{this.dirty=false;e.bindBuffer(e.ARRAY_BUFFER,this._vertexBuffer);e.bufferData(e.ARRAY_BUFFER,this.vertices,e.STATIC_DRAW);e.vertexAttribPointer(n.aVertexPosition,2,e.FLOAT,false,0,0);e.bindBuffer(e.ARRAY_BUFFER,this._uvBuffer);e.bufferData(e.ARRAY_BUFFER,this.uvs,e.STATIC_DRAW);e.vertexAttribPointer(n.aTextureCoord,2,e.FLOAT,false,0,0);e.activeTexture(e.TEXTURE0);if(this.texture.baseTexture._dirty[e.id]){t.renderer.updateTexture(this.texture.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,this.texture.baseTexture._glTextures[e.id])}e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW)}e.drawElements(a,this.indices.length,e.UNSIGNED_SHORT,0)};r.Strip.prototype._renderCanvas=function(t){var e=t.context;var i=this.worldTransform;var s=i.tx*t.resolution+t.shakeX;var n=i.ty*t.resolution+t.shakeY;if(t.roundPixels){e.setTransform(i.a,i.b,i.c,i.d,s|0,n|0)}else{e.setTransform(i.a,i.b,i.c,i.d,s,n)}if(this.drawMode===r.Strip.DrawModes.TRIANGLE_STRIP){this._renderCanvasTriangleStrip(e)}else{this._renderCanvasTriangles(e)}};r.Strip.prototype._renderCanvasTriangleStrip=function(t){var e=this.vertices;var i=this.uvs;var r=e.length/2;this.count++;for(var s=0;s<r-2;s++){var n=s*2;this._renderCanvasDrawTriangle(t,e,i,n,n+2,n+4)}};r.Strip.prototype._renderCanvasTriangles=function(t){var e=this.vertices;var i=this.uvs;var r=this.indices;var s=r.length;this.count++;for(var n=0;n<s;n+=3){var a=r[n]*2,o=r[n+1]*2,h=r[n+2]*2;this._renderCanvasDrawTriangle(t,e,i,a,o,h)}};r.Strip.prototype._renderCanvasDrawTriangle=function(t,e,i,r,s,n){var a=this.texture.baseTexture.source;var o=this.texture.width;var h=this.texture.height;var l=e[r],u=e[s],c=e[n];var f=e[r+1],d=e[s+1],p=e[n+1];var g=i[r]*o,v=i[s]*o,m=i[n]*o;var y=i[r+1]*h,x=i[s+1]*h,b=i[n+1]*h;if(this.canvasPadding>0){var w=this.canvasPadding/this.worldTransform.a;var _=this.canvasPadding/this.worldTransform.d;var P=(l+u+c)/3;var T=(f+d+p)/3;var C=l-P;var S=f-T;var A=Math.sqrt(C*C+S*S);l=P+C/A*(A+w);f=T+S/A*(A+_);C=u-P;S=d-T;A=Math.sqrt(C*C+S*S);u=P+C/A*(A+w);d=T+S/A*(A+_);C=c-P;S=p-T;A=Math.sqrt(C*C+S*S);c=P+C/A*(A+w);p=T+S/A*(A+_)}t.save();t.beginPath();t.moveTo(l,f);t.lineTo(u,d);t.lineTo(c,p);t.closePath();t.clip();var E=g*x+y*m+v*b-x*m-y*v-g*b;var I=l*x+y*c+u*b-x*c-y*u-l*b;var M=g*u+l*m+v*c-u*m-l*v-g*c;var R=g*x*c+y*u*m+l*v*b-l*x*m-y*v*c-g*u*b;var B=f*x+y*p+d*b-x*p-y*d-f*b;var L=g*d+f*m+v*p-d*m-f*v-g*p;var k=g*x*p+y*d*m+f*v*b-f*x*m-y*v*p-g*d*b;t.transform(I/E,B/E,M/E,L/E,R/E,k/E);t.drawImage(a,0,0);t.restore()};r.Strip.prototype.renderStripFlat=function(t){var e=this.context;var i=t.vertices;var r=i.length/2;this.count++;e.beginPath();for(var s=1;s<r-2;s++){var n=s*2;var a=i[n],o=i[n+2],h=i[n+4];var l=i[n+1],u=i[n+3],c=i[n+5];e.moveTo(a,l);e.lineTo(o,u);e.lineTo(h,c)}e.fillStyle="#FF0000";e.fill();e.closePath()};r.Strip.prototype.onTextureUpdate=function(){this.updateFrame=true};r.Strip.prototype.getBounds=function(t){var e=t||this.worldTransform;var i=e.a;var s=e.b;var n=e.c;var a=e.d;var o=e.tx;var h=e.ty;var l=-Infinity;var u=-Infinity;var c=Infinity;var f=Infinity;var d=this.vertices;for(var p=0,g=d.length;p<g;p+=2){var v=d[p],m=d[p+1];var y=i*v+n*m+o;var x=a*m+s*v+h;c=y<c?y:c;f=x<f?x:f;l=y>l?y:l;u=x>u?x:u}if(c===-Infinity||u===Infinity){return r.EmptyRectangle}var b=this._bounds;b.x=c;b.width=l-c;b.y=f;b.height=u-f;this._currentBounds=b;return b};r.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};r.Rope=function(t,e){r.Strip.call(this,t);this.points=e;this.vertices=new r.Float32Array(e.length*4);this.uvs=new r.Float32Array(e.length*4);this.colors=new r.Float32Array(e.length*2);this.indices=new r.Uint16Array(e.length*2);this.refresh()};r.Rope.prototype=Object.create(r.Strip.prototype);r.Rope.prototype.constructor=r.Rope;r.Rope.prototype.refresh=function(){var t=this.points;if(t.length<1)return;var e=this.uvs;var i=t[0];var r=this.indices;var s=this.colors;this.count-=.2;e[0]=0;e[1]=0;e[2]=0;e[3]=1;s[0]=1;s[1]=1;r[0]=0;r[1]=1;var n=t.length,a,o,h;for(var l=1;l<n;l++){a=t[l];o=l*4;h=l/(n-1);if(l%2){e[o]=h;e[o+1]=0;e[o+2]=h;e[o+3]=1}else{e[o]=h;e[o+1]=0;e[o+2]=h;e[o+3]=1}o=l*2;s[o]=1;s[o+1]=1;o=l*2;r[o]=o;r[o+1]=o+1;i=a}};r.Rope.prototype.updateTransform=function(){var t=this.points;if(t.length<1)return;var e=t[0];var i;var s={x:0,y:0};this.count-=.2;var n=this.vertices;var a=t.length,o,h,l,u,c;for(var f=0;f<a;f++){o=t[f];h=f*4;if(f<t.length-1){i=t[f+1]}else{i=o}s.y=-(i.x-e.x);s.x=i.y-e.y;l=(1-f/(a-1))*10;if(l>1)l=1;u=Math.sqrt(s.x*s.x+s.y*s.y);c=this.texture.height/2;s.x/=u;s.y/=u;s.x*=c;s.y*=c;n[h]=o.x+s.x;n[h+1]=o.y+s.y;n[h+2]=o.x-s.x;n[h+3]=o.y-s.y;e=o}r.DisplayObjectContainer.prototype.updateTransform.call(this)};r.Rope.prototype.setTexture=function(t){this.texture=t};r.TilingSprite=function(t,e,i){r.Sprite.call(this,t);this._width=e||128;this._height=i||128;this.tileScale=new r.Point(1,1);this.tileScaleOffset=new r.Point(1,1);this.tilePosition=new r.Point;this.renderable=true;this.tint=16777215;this.textureDebug=false;this.blendMode=r.blendModes.NORMAL;this.canvasBuffer=null;this.tilingTexture=null;this.tilePattern=null;this.refreshTexture=true;this.frameWidth=0;this.frameHeight=0};r.TilingSprite.prototype=Object.create(r.Sprite.prototype);r.TilingSprite.prototype.constructor=r.TilingSprite;r.TilingSprite.prototype.setTexture=function(t){if(this.texture!==t){this.texture=t;this.refreshTexture=true;this.cachedTint=16777215}};r.TilingSprite.prototype._renderWebGL=function(t){if(!this.visible||!this.renderable||this.alpha===0){return}if(this._mask){t.spriteBatch.stop();t.maskManager.pushMask(this.mask,t);t.spriteBatch.start()}if(this._filters){t.spriteBatch.flush();t.filterManager.pushFilter(this._filterBlock)}if(this.refreshTexture){this.generateTilingTexture(true,t);if(this.tilingTexture){if(this.tilingTexture.needsUpdate){t.renderer.updateTexture(this.tilingTexture.baseTexture);this.tilingTexture.needsUpdate=false}}else{return}}t.spriteBatch.renderTilingSprite(this);for(var e=0;e<this.children.length;e++){this.children[e]._renderWebGL(t)}t.spriteBatch.stop();if(this._filters){t.filterManager.popFilter()}if(this._mask){t.maskManager.popMask(this._mask,t)}t.spriteBatch.start()};r.TilingSprite.prototype._renderCanvas=function(t){if(!this.visible||!this.renderable||this.alpha===0){return}var e=t.context;if(this._mask){t.maskManager.pushMask(this._mask,t)}e.globalAlpha=this.worldAlpha;var i=this.worldTransform;var s=t.resolution;var n=i.tx*s+t.shakeX;var a=i.ty*s+t.shakeY;e.setTransform(i.a*s,i.b*s,i.c*s,i.d*s,n,a);if(this.refreshTexture){this.generateTilingTexture(false,t);if(this.tilingTexture){this.tilePattern=e.createPattern(this.tilingTexture.baseTexture.source,"repeat")}else{return}}var o=t.currentBlendMode;if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;e.globalCompositeOperation=r.blendModesCanvas[t.currentBlendMode]}var h=this.tilePosition;var l=this.tileScale;h.x%=this.tilingTexture.baseTexture.width;h.y%=this.tilingTexture.baseTexture.height;e.scale(l.x,l.y);e.translate(h.x+this.anchor.x*-this._width,h.y+this.anchor.y*-this._height);e.fillStyle=this.tilePattern;var n=-h.x;var a=-h.y;var u=this._width/l.x;var c=this._height/l.y;if(t.roundPixels){n|=0;a|=0;u|=0;c|=0}e.fillRect(n,a,u,c);e.scale(1/l.x,1/l.y);e.translate(-h.x+this.anchor.x*this._width,-h.y+this.anchor.y*this._height);if(this._mask){t.maskManager.popMask(t)}for(var f=0;f<this.children.length;f++){this.children[f]._renderCanvas(t)}if(o!==this.blendMode){t.currentBlendMode=o;e.globalCompositeOperation=r.blendModesCanvas[o]}};r.TilingSprite.prototype.onTextureUpdate=function(){};r.TilingSprite.prototype.generateTilingTexture=function(t,e){if(!this.texture.baseTexture.hasLoaded){return}var i=this.texture;var s=i.frame;var n=this._frame.sourceSizeW||this._frame.width;var a=this._frame.sourceSizeH||this._frame.height;var o=0;var h=0;if(this._frame.trimmed){o=this._frame.spriteSourceSizeX;h=this._frame.spriteSourceSizeY}if(t){n=r.getNextPowerOfTwo(n);a=r.getNextPowerOfTwo(a)}if(this.canvasBuffer){this.canvasBuffer.resize(n,a);this.tilingTexture.baseTexture.width=n;this.tilingTexture.baseTexture.height=a;this.tilingTexture.needsUpdate=true}else{this.canvasBuffer=new r.CanvasBuffer(n,a);this.tilingTexture=r.Texture.fromCanvas(this.canvasBuffer.canvas);this.tilingTexture.isTiling=true;this.tilingTexture.needsUpdate=true}if(this.textureDebug){this.canvasBuffer.context.strokeStyle="#00ff00";this.canvasBuffer.context.strokeRect(0,0,n,a)}var l=i.crop.width;var u=i.crop.height;if(l!==n||u!==a){l=n;u=a}this.canvasBuffer.context.drawImage(i.baseTexture.source,i.crop.x,i.crop.y,i.crop.width,i.crop.height,o,h,l,u);this.tileScaleOffset.x=s.width/n;this.tileScaleOffset.y=s.height/a;this.refreshTexture=false;this.tilingTexture.baseTexture._powerOf2=true};r.TilingSprite.prototype.getBounds=function(){var t=this._width;var e=this._height;var i=t*(1-this.anchor.x);var r=t*-this.anchor.x;var s=e*(1-this.anchor.y);var n=e*-this.anchor.y;var a=this.worldTransform;var o=a.a;var h=a.b;var l=a.c;var u=a.d;var c=a.tx;var f=a.ty;var d=o*r+l*n+c;var p=u*n+h*r+f;var g=o*i+l*n+c;var v=u*n+h*i+f;var m=o*i+l*s+c;var y=u*s+h*i+f;var x=o*r+l*s+c;var b=u*s+h*r+f;var w=-Infinity;var _=-Infinity;var P=Infinity;var T=Infinity;P=d<P?d:P;P=g<P?g:P;P=m<P?m:P;P=x<P?x:P;T=p<T?p:T;T=v<T?v:T;T=y<T?y:T;T=b<T?b:T;w=d>w?d:w;w=g>w?g:w;w=m>w?m:w;w=x>w?x:w;_=p>_?p:_;_=v>_?v:_;_=y>_?y:_;_=b>_?b:_;var C=this._bounds;C.x=P;C.width=w-P;C.y=T;C.height=_-T;this._currentBounds=C;return C};r.TilingSprite.prototype.destroy=function(){r.Sprite.prototype.destroy.call(this);if(this.canvasBuffer){this.canvasBuffer.destroy();this.canvasBuffer=null}this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;if(this.tilingTexture){this.tilingTexture.destroy(true);this.tilingTexture=null}};Object.defineProperty(r.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t}});Object.defineProperty(r.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t}});if(true){if(typeof t!=="undefined"&&t.exports){e=t.exports=r}e.PIXI=r}else if(typeof define!=="undefined"&&define.amd){define("PIXI",function(){return i.PIXI=r}())}else{i.PIXI=r}return r}).call(this);/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
(function(){var r=this;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
var s=s||{VERSION:"2.6.2",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{}};/**
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
if(!Math.trunc){Math.trunc=function t(e){return e<0?Math.ceil(e):Math.floor(e)}}if(!Function.prototype.bind){Function.prototype.bind=function(){var t=Array.prototype.slice;return function(e){var i=this,r=t.call(arguments,1);if(typeof i!=="function"){throw new TypeError}function s(){var n=r.concat(t.call(arguments));i.apply(this instanceof s?this:e,n)}s.prototype=function t(e){if(e){t.prototype=e}if(!(this instanceof t)){return new t}}(i.prototype);return s}}()}if(!Array.isArray){Array.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(t){"use strict";if(this===void 0||this===null){throw new TypeError}var e=Object(this);var i=e.length>>>0;if(typeof t!=="function"){throw new TypeError}var r=arguments.length>=2?arguments[1]:void 0;for(var s=0;s<i;s++){if(s in e){t.call(r,e[s],s,e)}}}}if(typeof window.Uint32Array!=="function"&&typeof window.Uint32Array!=="object"){var n=function(t){var e=new Array;window[t]=function(t){if(typeof t==="number"){Array.call(this,t);this.length=t;for(var e=0;e<this.length;e++){this[e]=0}}else{Array.call(this,t.length);this.length=t.length;for(var e=0;e<this.length;e++){this[e]=t[e]}}};window[t].prototype=e;window[t].constructor=window[t]};n("Uint32Array");n("Int16Array")}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Utils={reverseString:function(t){return t.split("").reverse().join("")},getProperty:function(t,e){var i=e.split("."),r=i.pop(),s=i.length,n=1,a=i[0];while(n<s&&(t=t[a])){a=i[n];n++}if(t){return t[r]}else{return null}},setProperty:function(t,e,i){var r=e.split("."),s=r.pop(),n=r.length,a=1,o=r[0];while(a<n&&(t=t[o])){o=r[a];a++}if(t){t[s]=i}return t},chanceRoll:function(t){if(t===undefined){t=50}return t>0&&Math.random()*100<=t},randomChoice:function(t,e){return Math.random()<.5?t:e},parseDimension:function(t,e){var i=0;var r=0;if(typeof t==="string"){if(t.substr(-1)==="%"){i=parseInt(t,10)/100;if(e===0){r=window.innerWidth*i}else{r=window.innerHeight*i}}else{r=parseInt(t,10)}}else{r=t}return r},pad:function(t,e,i,r){if(e===undefined){var e=0}if(i===undefined){var i=" "}if(r===undefined){var r=3}t=t.toString();var s=0;if(e+1>=t.length){switch(r){case 1:t=new Array(e+1-t.length).join(i)+t;break;case 3:var n=Math.ceil((s=e-t.length)/2);var a=s-n;t=new Array(a+1).join(i)+t+new Array(n+1).join(i);break;default:t=t+new Array(e+1-t.length).join(i);break}}return t},isPlainObject:function(t){if(typeof t!=="object"||t.nodeType||t===t.window){return false}try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf")){return false}}catch(t){return false}return true},extend:function(){var t,e,i,r,n,a,o=arguments[0]||{},h=1,l=arguments.length,u=false;if(typeof o==="boolean"){u=o;o=arguments[1]||{};h=2}if(l===h){o=this;--h}for(;h<l;h++){if((t=arguments[h])!=null){for(e in t){i=o[e];r=t[e];if(o===r){continue}if(u&&r&&(s.Utils.isPlainObject(r)||(n=Array.isArray(r)))){if(n){n=false;a=i&&Array.isArray(i)?i:[]}else{a=i&&s.Utils.isPlainObject(i)?i:{}}o[e]=s.Utils.extend(u,a,r)}else if(r!==undefined){o[e]=r}}}}return o},mixinPrototype:function(t,e,i){if(i===undefined){i=false}var r=Object.keys(e);for(var s=0;s<r.length;s++){var n=r[s];var a=e[n];if(!i&&n in t){continue}else{if(a&&(typeof a.get==="function"||typeof a.set==="function")){if(typeof a.clone==="function"){t[n]=a.clone()}else{Object.defineProperty(t,n,a)}}else{t[n]=a}}}},mixin:function(t,e){if(!t||typeof t!=="object"){return e}for(var i in t){var r=t[i];if(r.childNodes||r.cloneNode){continue}var n=typeof t[i];if(!t[i]||n!=="object"){e[i]=t[i]}else{if(typeof e[i]===n){e[i]=s.Utils.mixin(t[i],e[i])}else{e[i]=s.Utils.mixin(t[i],new r.constructor)}}}return e}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Circle=function(t,e,i){t=t||0;e=e||0;i=i||0;this.x=t;this.y=e;this._diameter=i;this._radius=0;if(i>0){this._radius=i*.5}this.type=s.CIRCLE};s.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},random:function(t){if(t===undefined){t=new s.Point}var e=2*Math.PI*Math.random();var i=Math.random()+Math.random();var r=i>1?2-i:i;var n=r*Math.cos(e);var a=r*Math.sin(e);t.x=this.x+n*this.radius;t.y=this.y+a*this.radius;return t},getBounds:function(){return new s.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(t,e,i){this.x=t;this.y=e;this._diameter=i;this._radius=i*.5;return this},copyFrom:function(t){return this.setTo(t.x,t.y,t.diameter)},copyTo:function(t){t.x=this.x;t.y=this.y;t.diameter=this._diameter;return t},distance:function(t,e){var i=s.Math.distance(this.x,this.y,t.x,t.y);return e?Math.round(i):i},clone:function(t){if(t===undefined||t===null){t=new s.Circle(this.x,this.y,this.diameter)}else{t.setTo(this.x,this.y,this.diameter)}return t},contains:function(t,e){return s.Circle.contains(this,t,e)},circumferencePoint:function(t,e,i){return s.Circle.circumferencePoint(this,t,e,i)},offset:function(t,e){this.x+=t;this.y+=e;return this},offsetPoint:function(t){return this.offset(t.x,t.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};s.Circle.prototype.constructor=s.Circle;Object.defineProperty(s.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(t){if(t>0){this._diameter=t;this._radius=t*.5}}});Object.defineProperty(s.Circle.prototype,"radius",{get:function(){return this._radius},set:function(t){if(t>0){this._radius=t;this._diameter=t*2}}});Object.defineProperty(s.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(t){if(t>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-t}}});Object.defineProperty(s.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(t){if(t<this.x){this._radius=0;this._diameter=0}else{this.radius=t-this.x}}});Object.defineProperty(s.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(t){if(t>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-t}}});Object.defineProperty(s.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(t){if(t<this.y){this._radius=0;this._diameter=0}else{this.radius=t-this.y}}});Object.defineProperty(s.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(s.Circle.prototype,"empty",{get:function(){return this._diameter===0},set:function(t){if(t===true){this.setTo(0,0,0)}}});s.Circle.contains=function(t,e,i){if(t.radius>0&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom){var r=(t.x-e)*(t.x-e);var s=(t.y-i)*(t.y-i);return r+s<=t.radius*t.radius}else{return false}};s.Circle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.diameter===e.diameter};s.Circle.intersects=function(t,e){return s.Math.distance(t.x,t.y,e.x,e.y)<=t.radius+e.radius};s.Circle.circumferencePoint=function(t,e,i,r){if(i===undefined){i=false}if(r===undefined){r=new s.Point}if(i===true){e=s.Math.degToRad(e)}r.x=t.x+t.radius*Math.cos(e);r.y=t.y+t.radius*Math.sin(e);return r};s.Circle.intersectsRectangle=function(t,e){var i=Math.abs(t.x-e.x-e.halfWidth);var r=e.halfWidth+t.radius;if(i>r){return false}var s=Math.abs(t.y-e.y-e.halfHeight);var n=e.halfHeight+t.radius;if(s>n){return false}if(i<=e.halfWidth||s<=e.halfHeight){return true}var a=i-e.halfWidth;var o=s-e.halfHeight;var h=a*a;var l=o*o;var u=t.radius*t.radius;return h+l<=u};PIXI.Circle=s.Circle;/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Chad Engler <chad@pantherdev.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Ellipse=function(t,e,i,r){t=t||0;e=e||0;i=i||0;r=r||0;this.x=t;this.y=e;this.width=i;this.height=r;this.type=s.ELLIPSE};s.Ellipse.prototype={setTo:function(t,e,i,r){this.x=t;this.y=e;this.width=i;this.height=r;return this},getBounds:function(){return new s.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){t.x=this.x;t.y=this.y;t.width=this.width;t.height=this.height;return t},clone:function(t){if(t===undefined||t===null){t=new s.Ellipse(this.x,this.y,this.width,this.height)}else{t.setTo(this.x,this.y,this.width,this.height)}return t},contains:function(t,e){return s.Ellipse.contains(this,t,e)},random:function(t){if(t===undefined){t=new s.Point}var e=Math.random()*Math.PI*2;var i=Math.random();t.x=Math.sqrt(i)*Math.cos(e);t.y=Math.sqrt(i)*Math.sin(e);t.x=this.x+t.x*this.width/2;t.y=this.y+t.y*this.height/2;return t},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};s.Ellipse.prototype.constructor=s.Ellipse;Object.defineProperty(s.Ellipse.prototype,"left",{get:function(){return this.x},set:function(t){this.x=t}});Object.defineProperty(s.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(t){if(t<this.x){this.width=0}else{this.width=t-this.x}}});Object.defineProperty(s.Ellipse.prototype,"top",{get:function(){return this.y},set:function(t){this.y=t}});Object.defineProperty(s.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){if(t<this.y){this.height=0}else{this.height=t-this.y}}});Object.defineProperty(s.Ellipse.prototype,"empty",{get:function(){return this.width===0||this.height===0},set:function(t){if(t===true){this.setTo(0,0,0,0)}}});s.Ellipse.contains=function(t,e,i){if(t.width<=0||t.height<=0){return false}var r=(e-t.x)/t.width-.5;var s=(i-t.y)/t.height-.5;r*=r;s*=s;return r+s<.25};PIXI.Ellipse=s.Ellipse;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Line=function(t,e,i,r){t=t||0;e=e||0;i=i||0;r=r||0;this.start=new s.Point(t,e);this.end=new s.Point(i,r);this.type=s.LINE};s.Line.prototype={setTo:function(t,e,i,r){this.start.setTo(t,e);this.end.setTo(i,r);return this},fromSprite:function(t,e,i){if(i===undefined){i=false}if(i){return this.setTo(t.center.x,t.center.y,e.center.x,e.center.y)}return this.setTo(t.x,t.y,e.x,e.y)},fromAngle:function(t,e,i,r){this.start.setTo(t,e);this.end.setTo(t+Math.cos(i)*r,e+Math.sin(i)*r);return this},rotate:function(t,e){var i=(this.start.x+this.end.x)/2;var r=(this.start.y+this.end.y)/2;this.start.rotate(i,r,t,e);this.end.rotate(i,r,t,e);return this},rotateAround:function(t,e,i,r){this.start.rotate(t,e,i,r);this.end.rotate(t,e,i,r);return this},intersects:function(t,e,i){return s.Line.intersectsPoints(this.start,this.end,t.start,t.end,e,i)},reflect:function(t){return s.Line.reflect(this,t)},midPoint:function(t){if(t===undefined){t=new s.Point}t.x=(this.start.x+this.end.x)/2;t.y=(this.start.y+this.end.y)/2;return t},centerOn:function(t,e){var i=(this.start.x+this.end.x)/2;var r=(this.start.y+this.end.y)/2;var s=t-i;var n=e-r;this.start.add(s,n);this.end.add(s,n)},pointOnLine:function(t,e){return(t-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(e-this.start.y)},pointOnSegment:function(t,e){var i=Math.min(this.start.x,this.end.x);var r=Math.max(this.start.x,this.end.x);var s=Math.min(this.start.y,this.end.y);var n=Math.max(this.start.y,this.end.y);return this.pointOnLine(t,e)&&(t>=i&&t<=r)&&(e>=s&&e<=n)},random:function(t){if(t===undefined){t=new s.Point}var e=Math.random();t.x=this.start.x+e*(this.end.x-this.start.x);t.y=this.start.y+e*(this.end.y-this.start.y);return t},coordinatesOnLine:function(t,e){if(t===undefined){t=1}if(e===undefined){e=[]}var i=Math.round(this.start.x);var r=Math.round(this.start.y);var s=Math.round(this.end.x);var n=Math.round(this.end.y);var a=Math.abs(s-i);var o=Math.abs(n-r);var h=i<s?1:-1;var l=r<n?1:-1;var u=a-o;e.push([i,r]);var c=1;while(!(i===s&&r===n)){var f=u<<1;if(f>-o){u-=o;i+=h}if(f<a){u+=a;r+=l}if(c%t===0){e.push([i,r])}c++}return e},clone:function(t){if(t===undefined||t===null){t=new s.Line(this.start.x,this.start.y,this.end.x,this.end.y)}else{t.setTo(this.start.x,this.start.y,this.end.x,this.end.y)}return t}};Object.defineProperty(s.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(s.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(s.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(s.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(s.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(s.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(s.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(s.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(s.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(s.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(s.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(s.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(s.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(s.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(s.Line.prototype,"normalAngle",{get:function(){return s.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});s.Line.intersectsPoints=function(t,e,i,r,n,a){if(n===undefined){n=true}if(a===undefined){a=new s.Point}var o=e.y-t.y;var h=r.y-i.y;var l=t.x-e.x;var u=i.x-r.x;var c=e.x*t.y-t.x*e.y;var f=r.x*i.y-i.x*r.y;var d=o*u-h*l;if(d===0){return null}a.x=(l*f-u*c)/d;a.y=(h*c-o*f)/d;if(n){var p=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y);var g=((r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x))/p;var v=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/p;if(g>=0&&g<=1&&v>=0&&v<=1){return a}else{return null}}return a};s.Line.intersects=function(t,e,i,r){return s.Line.intersectsPoints(t.start,t.end,e.start,e.end,i,r)};s.Line.intersectsRectangle=function(t,e){if(!s.Rectangle.intersects(t,e)){return false}var i=t.start.x;var r=t.start.y;var n=t.end.x;var a=t.end.y;var o=e.x;var h=e.y;var l=e.right;var u=e.bottom;var c=0;if(i>=o&&i<=l&&r>=h&&r<=u||n>=o&&n<=l&&a>=h&&a<=u){return true}if(i<o&&n>=o){c=r+(a-r)*(o-i)/(n-i);if(c>h&&c<=u){return true}}else if(i>l&&n<=l){c=r+(a-r)*(l-i)/(n-i);if(c>=h&&c<=u){return true}}if(r<h&&a>=h){c=i+(n-i)*(h-r)/(a-r);if(c>=o&&c<=l){return true}}else if(r>u&&a<=u){c=i+(n-i)*(u-r)/(a-r);if(c>=o&&c<=l){return true}}return false};s.Line.reflect=function(t,e){return 2*e.normalAngle-3.141592653589793-t.angle};/**
* @author       Mat Groves http://matgroves.com/ @Doormat23
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Matrix=function(t,e,i,r,n,a){if(t===undefined||t===null){t=1}if(e===undefined||e===null){e=0}if(i===undefined||i===null){i=0}if(r===undefined||r===null){r=1}if(n===undefined||n===null){n=0}if(a===undefined||a===null){a=0}this.a=t;this.b=e;this.c=i;this.d=r;this.tx=n;this.ty=a;this.type=s.MATRIX};s.Matrix.prototype={fromArray:function(t){return this.setTo(t[0],t[1],t[3],t[4],t[2],t[5])},setTo:function(t,e,i,r,s,n){this.a=t;this.b=e;this.c=i;this.d=r;this.tx=s;this.ty=n;return this},clone:function(t){if(t===undefined||t===null){t=new s.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)}else{t.a=this.a;t.b=this.b;t.c=this.c;t.d=this.d;t.tx=this.tx;t.ty=this.ty}return t},copyTo:function(t){t.copyFrom(this);return t},copyFrom:function(t){this.a=t.a;this.b=t.b;this.c=t.c;this.d=t.d;this.tx=t.tx;this.ty=t.ty;return this},toArray:function(t,e){if(e===undefined){e=new PIXI.Float32Array(9)}if(t){e[0]=this.a;e[1]=this.b;e[2]=0;e[3]=this.c;e[4]=this.d;e[5]=0;e[6]=this.tx;e[7]=this.ty;e[8]=1}else{e[0]=this.a;e[1]=this.c;e[2]=this.tx;e[3]=this.b;e[4]=this.d;e[5]=this.ty;e[6]=0;e[7]=0;e[8]=1}return e},apply:function(t,e){if(e===undefined){e=new s.Point}e.x=this.a*t.x+this.c*t.y+this.tx;e.y=this.b*t.x+this.d*t.y+this.ty;return e},applyInverse:function(t,e){if(e===undefined){e=new s.Point}var i=1/(this.a*this.d+this.c*-this.b);var r=t.x;var n=t.y;e.x=this.d*i*r+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i;e.y=this.a*i*n+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i;return e},translate:function(t,e){this.tx+=t;this.ty+=e;return this},scale:function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;return this},rotate:function(t){var e=Math.cos(t);var i=Math.sin(t);var r=this.a;var s=this.c;var n=this.tx;this.a=r*e-this.b*i;this.b=r*i+this.b*e;this.c=s*e-this.d*i;this.d=s*i+this.d*e;this.tx=n*e-this.ty*i;this.ty=n*i+this.ty*e;return this},append:function(t){var e=this.a;var i=this.b;var r=this.c;var s=this.d;this.a=t.a*e+t.b*r;this.b=t.a*i+t.b*s;this.c=t.c*e+t.d*r;this.d=t.c*i+t.d*s;this.tx=t.tx*e+t.ty*r+this.tx;this.ty=t.tx*i+t.ty*s+this.ty;return this},identity:function(){return this.setTo(1,0,0,1,0,0)}};s.identityMatrix=new s.Matrix;PIXI.Matrix=s.Matrix;PIXI.identityMatrix=s.identityMatrix;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Point=function(t,e){t=t||0;e=e||0;this.x=t;this.y=e;this.type=s.POINT};s.Point.prototype={copyFrom:function(t){return this.setTo(t.x,t.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(t,e){this.x=t||0;this.y=e||(e!==0?this.x:0);return this},set:function(t,e){this.x=t||0;this.y=e||(e!==0?this.x:0);return this},add:function(t,e){this.x+=t;this.y+=e;return this},subtract:function(t,e){this.x-=t;this.y-=e;return this},multiply:function(t,e){this.x*=t;this.y*=e;return this},divide:function(t,e){this.x/=t;this.y/=e;return this},clampX:function(t,e){this.x=s.Math.clamp(this.x,t,e);return this},clampY:function(t,e){this.y=s.Math.clamp(this.y,t,e);return this},clamp:function(t,e){this.x=s.Math.clamp(this.x,t,e);this.y=s.Math.clamp(this.y,t,e);return this},clone:function(t){if(t===undefined||t===null){t=new s.Point(this.x,this.y)}else{t.setTo(this.x,this.y)}return t},copyTo:function(t){t.x=this.x;t.y=this.y;return t},distance:function(t,e){return s.Point.distance(this,t,e)},equals:function(t){return t.x===this.x&&t.y===this.y},angle:function(t,e){if(e===undefined){e=false}if(e){return s.Math.radToDeg(Math.atan2(t.y-this.y,t.x-this.x))}else{return Math.atan2(t.y-this.y,t.x-this.x)}},rotate:function(t,e,i,r,n){return s.Point.rotate(this,t,e,i,r,n)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(t){return this.normalize().multiply(t,t)},normalize:function(){if(!this.isZero()){var t=this.getMagnitude();this.x/=t;this.y/=t}return this},isZero:function(){return this.x===0&&this.y===0},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};s.Point.prototype.constructor=s.Point;s.Point.add=function(t,e,i){if(i===undefined){i=new s.Point}i.x=t.x+e.x;i.y=t.y+e.y;return i};s.Point.subtract=function(t,e,i){if(i===undefined){i=new s.Point}i.x=t.x-e.x;i.y=t.y-e.y;return i};s.Point.multiply=function(t,e,i){if(i===undefined){i=new s.Point}i.x=t.x*e.x;i.y=t.y*e.y;return i};s.Point.divide=function(t,e,i){if(i===undefined){i=new s.Point}i.x=t.x/e.x;i.y=t.y/e.y;return i};s.Point.equals=function(t,e){return t.x===e.x&&t.y===e.y};s.Point.angle=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)};s.Point.negative=function(t,e){if(e===undefined){e=new s.Point}return e.setTo(-t.x,-t.y)};s.Point.multiplyAdd=function(t,e,i,r){if(r===undefined){r=new s.Point}return r.setTo(t.x+e.x*i,t.y+e.y*i)};s.Point.interpolate=function(t,e,i,r){if(r===undefined){r=new s.Point}return r.setTo(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)};s.Point.perp=function(t,e){if(e===undefined){e=new s.Point}return e.setTo(-t.y,t.x)};s.Point.rperp=function(t,e){if(e===undefined){e=new s.Point}return e.setTo(t.y,-t.x)};s.Point.distance=function(t,e,i){var r=s.Math.distance(t.x,t.y,e.x,e.y);return i?Math.round(r):r};s.Point.project=function(t,e,i){if(i===undefined){i=new s.Point}var r=t.dot(e)/e.getMagnitudeSq();if(r!==0){i.setTo(r*e.x,r*e.y)}return i};s.Point.projectUnit=function(t,e,i){if(i===undefined){i=new s.Point}var r=t.dot(e);if(r!==0){i.setTo(r*e.x,r*e.y)}return i};s.Point.normalRightHand=function(t,e){if(e===undefined){e=new s.Point}return e.setTo(t.y*-1,t.x)};s.Point.normalize=function(t,e){if(e===undefined){e=new s.Point}var i=t.getMagnitude();if(i!==0){e.setTo(t.x/i,t.y/i)}return e};s.Point.rotate=function(t,e,i,r,n,a){if(n){r=s.Math.degToRad(r)}if(a===undefined){t.subtract(e,i);var o=Math.sin(r);var h=Math.cos(r);var l=h*t.x-o*t.y;var u=o*t.x+h*t.y;t.x=l+e;t.y=u+i}else{var c=r+Math.atan2(t.y-i,t.x-e);t.x=e+a*Math.cos(c);t.y=i+a*Math.sin(c)}return t};s.Point.centroid=function(t,e){if(e===undefined){e=new s.Point}if(Object.prototype.toString.call(t)!=="[object Array]"){throw new Error("Phaser.Point. Parameter 'points' must be an array")}var i=t.length;if(i<1){throw new Error("Phaser.Point. Parameter 'points' array must not be empty")}if(i===1){e.copyFrom(t[0]);return e}for(var r=0;r<i;r++){s.Point.add(e,t[r],e)}e.divide(i,i);return e};s.Point.parse=function(t,e,i){e=e||"x";i=i||"y";var r=new s.Point;if(t[e]){r.x=parseInt(t[e],10)}if(t[i]){r.y=parseInt(t[i],10)}return r};PIXI.Point=s.Point;/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Adrien Brault <adrien.brault@gmail.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Polygon=function(){this.area=0;this._points=[];if(arguments.length>0){this.setTo.apply(this,arguments)}this.closed=true;this.flattened=false;this.type=s.POLYGON};s.Polygon.prototype={toNumberArray:function(t){if(t===undefined){t=[]}for(var e=0;e<this._points.length;e++){if(typeof this._points[e]==="number"){t.push(this._points[e]);t.push(this._points[e+1]);e++}else{t.push(this._points[e].x);t.push(this._points[e].y)}}return t},flatten:function(){this._points=this.toNumberArray();this.flattened=true;return this},clone:function(t){var e=this._points.slice();if(t===undefined||t===null){t=new s.Polygon(e)}else{t.setTo(e)}return t},contains:function(t,e){var i=false;if(this.flattened){for(var r=-2,s=this._points.length-2;(r+=2)<this._points.length;s=r){var n=this._points[r];var a=this._points[r+1];var o=this._points[s];var h=this._points[s+1];if((a<=e&&e<h||h<=e&&e<a)&&t<(o-n)*(e-a)/(h-a)+n){i=!i}}}else{for(var r=-1,s=this._points.length-1;++r<this._points.length;s=r){var n=this._points[r].x;var a=this._points[r].y;var o=this._points[s].x;var h=this._points[s].y;if((a<=e&&e<h||h<=e&&e<a)&&t<(o-n)*(e-a)/(h-a)+n){i=!i}}}return i},setTo:function(t){this.area=0;this._points=[];if(arguments.length>0){if(!Array.isArray(t)){t=Array.prototype.slice.call(arguments)}var e=Number.MAX_VALUE;for(var i=0,r=t.length;i<r;i++){if(typeof t[i]==="number"){var s=new PIXI.Point(t[i],t[i+1]);i++}else if(Array.isArray(t[i])){var s=new PIXI.Point(t[i][0],t[i][1])}else{var s=new PIXI.Point(t[i].x,t[i].y)}this._points.push(s);if(s.y<e){e=s.y}}this.calculateArea(e)}return this},calculateArea:function(t){var e;var i;var r;var s;for(var n=0,a=this._points.length;n<a;n++){e=this._points[n];if(n===a-1){i=this._points[0]}else{i=this._points[n+1]}r=(e.y-t+(i.y-t))/2;s=e.x-i.x;this.area+=r*s}return this.area}};s.Polygon.prototype.constructor=s.Polygon;Object.defineProperty(s.Polygon.prototype,"points",{get:function(){return this._points},set:function(t){if(t!=null){this.setTo(t)}else{this.setTo()}}});PIXI.Polygon=s.Polygon;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Rectangle=function(t,e,i,r){t=t||0;e=e||0;i=i||0;r=r||0;this.x=t;this.y=e;this.width=i;this.height=r;this.type=s.RECTANGLE};s.Rectangle.prototype={offset:function(t,e){this.x+=t;this.y+=e;return this},offsetPoint:function(t){return this.offset(t.x,t.y)},setTo:function(t,e,i,r){this.x=t;this.y=e;this.width=i;this.height=r;return this},scale:function(t,e){if(e===undefined){e=t}this.width*=t;this.height*=e;return this},centerOn:function(t,e){this.centerX=t;this.centerY=e;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height)},copyFrom:function(t){return this.setTo(t.x,t.y,t.width,t.height)},copyTo:function(t){t.x=this.x;t.y=this.y;t.width=this.width;t.height=this.height;return t},inflate:function(t,e){return s.Rectangle.inflate(this,t,e)},size:function(t){return s.Rectangle.size(this,t)},resize:function(t,e){this.width=t;this.height=e;return this},clone:function(t){return s.Rectangle.clone(this,t)},contains:function(t,e){return s.Rectangle.contains(this,t,e)},containsRect:function(t){return s.Rectangle.containsRect(t,this)},equals:function(t){return s.Rectangle.equals(this,t)},intersection:function(t,e){return s.Rectangle.intersection(this,t,e)},intersects:function(t){return s.Rectangle.intersects(this,t)},intersectsRaw:function(t,e,i,r,n){return s.Rectangle.intersectsRaw(this,t,e,i,r,n)},union:function(t,e){return s.Rectangle.union(this,t,e)},random:function(t){if(t===undefined){t=new s.Point}t.x=this.randomX;t.y=this.randomY;return t},getPoint:function(t,e){if(e===undefined){e=new s.Point}switch(t){default:case s.TOP_LEFT:return e.set(this.x,this.y);case s.TOP_CENTER:return e.set(this.centerX,this.y);case s.TOP_RIGHT:return e.set(this.right,this.y);case s.LEFT_CENTER:return e.set(this.x,this.centerY);case s.CENTER:return e.set(this.centerX,this.centerY);case s.RIGHT_CENTER:return e.set(this.right,this.centerY);case s.BOTTOM_LEFT:return e.set(this.x,this.bottom);case s.BOTTOM_CENTER:return e.set(this.centerX,this.bottom);case s.BOTTOM_RIGHT:return e.set(this.right,this.bottom)}},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(s.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(s.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(s.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(t){if(t<=this.y){this.height=0}else{this.height=t-this.y}}});Object.defineProperty(s.Rectangle.prototype,"bottomLeft",{get:function(){return new s.Point(this.x,this.bottom)},set:function(t){this.x=t.x;this.bottom=t.y}});Object.defineProperty(s.Rectangle.prototype,"bottomRight",{get:function(){return new s.Point(this.right,this.bottom)},set:function(t){this.right=t.x;this.bottom=t.y}});Object.defineProperty(s.Rectangle.prototype,"left",{get:function(){return this.x},set:function(t){if(t>=this.right){this.width=0}else{this.width=this.right-t}this.x=t}});Object.defineProperty(s.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(t){if(t<=this.x){this.width=0}else{this.width=t-this.x}}});Object.defineProperty(s.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(s.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}});Object.defineProperty(s.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(t){this.x=t-this.halfWidth}});Object.defineProperty(s.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(t){this.y=t-this.halfHeight}});Object.defineProperty(s.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}});Object.defineProperty(s.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}});Object.defineProperty(s.Rectangle.prototype,"top",{get:function(){return this.y},set:function(t){if(t>=this.bottom){this.height=0;this.y=t}else{this.height=this.bottom-t}}});Object.defineProperty(s.Rectangle.prototype,"topLeft",{get:function(){return new s.Point(this.x,this.y)},set:function(t){this.x=t.x;this.y=t.y}});Object.defineProperty(s.Rectangle.prototype,"topRight",{get:function(){return new s.Point(this.x+this.width,this.y)},set:function(t){this.right=t.x;this.y=t.y}});Object.defineProperty(s.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(t){if(t===true){this.setTo(0,0,0,0)}}});s.Rectangle.prototype.constructor=s.Rectangle;s.Rectangle.inflate=function(t,e,i){t.x-=e;t.width+=2*e;t.y-=i;t.height+=2*i;return t};s.Rectangle.inflatePoint=function(t,e){return s.Rectangle.inflate(t,e.x,e.y)};s.Rectangle.size=function(t,e){if(e===undefined||e===null){e=new s.Point(t.width,t.height)}else{e.setTo(t.width,t.height)}return e};s.Rectangle.clone=function(t,e){if(e===undefined||e===null){e=new s.Rectangle(t.x,t.y,t.width,t.height)}else{e.setTo(t.x,t.y,t.width,t.height)}return e};s.Rectangle.contains=function(t,e,i){if(t.width<=0||t.height<=0){return false}return e>=t.x&&e<t.right&&i>=t.y&&i<t.bottom};s.Rectangle.containsRaw=function(t,e,i,r,s,n){return s>=t&&s<t+i&&n>=e&&n<e+r};s.Rectangle.containsPoint=function(t,e){return s.Rectangle.contains(t,e.x,e.y)};s.Rectangle.containsRect=function(t,e){if(t.volume>e.volume){return false}return t.x>=e.x&&t.y>=e.y&&t.right<e.right&&t.bottom<e.bottom};s.Rectangle.equals=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height};s.Rectangle.sameDimensions=function(t,e){return t.width===e.width&&t.height===e.height};s.Rectangle.intersection=function(t,e,i){if(i===undefined){i=new s.Rectangle}if(s.Rectangle.intersects(t,e)){i.x=Math.max(t.x,e.x);i.y=Math.max(t.y,e.y);i.width=Math.min(t.right,e.right)-i.x;i.height=Math.min(t.bottom,e.bottom)-i.y}return i};s.Rectangle.intersects=function(t,e){if(t.width<=0||t.height<=0||e.width<=0||e.height<=0){return false}return!(t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)};s.Rectangle.intersectsRaw=function(t,e,i,r,s,n){if(n===undefined){n=0}return!(e>t.right+n||i<t.left-n||r>t.bottom+n||s<t.top-n)};s.Rectangle.union=function(t,e,i){if(i===undefined){i=new s.Rectangle}return i.setTo(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.max(t.right,e.right)-Math.min(t.left,e.left),Math.max(t.bottom,e.bottom)-Math.min(t.top,e.top))};s.Rectangle.aabb=function(t,e){if(e===undefined){e=new s.Rectangle}var i=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;t.forEach(function(t){if(t.x>i){i=t.x}if(t.x<r){r=t.x}if(t.y>n){n=t.y}if(t.y<a){a=t.y}});e.setTo(r,a,i-r,n-a);return e};PIXI.Rectangle=s.Rectangle;PIXI.EmptyRectangle=new s.Rectangle(0,0,0,0);/**
* @author       Mat Groves http://matgroves.com/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.RoundedRectangle=function(t,e,i,r,n){if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i=0}if(r===undefined){r=0}if(n===undefined){n=20}this.x=t;this.y=e;this.width=i;this.height=r;this.radius=n||20;this.type=s.ROUNDEDRECTANGLE};s.RoundedRectangle.prototype={clone:function(){return new s.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(t,e){if(this.width<=0||this.height<=0){return false}var i=this.x;if(t>=i&&t<=i+this.width){var r=this.y;if(e>=r&&e<=r+this.height){return true}}return false}};s.RoundedRectangle.prototype.constructor=s.RoundedRectangle;PIXI.RoundedRectangle=s.RoundedRectangle;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Camera=function(t,e,i,r,n,a){this.game=t;this.world=t.world;this.id=0;this.view=new s.Rectangle(i,r,n,a);this.bounds=new s.Rectangle(i,r,n,a);this.deadzone=null;this.visible=true;this.roundPx=true;this.atLimit={x:false,y:false};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this.lerp=new s.Point(1,1);this.onShakeComplete=new s.Signal;this.onFlashComplete=new s.Signal;this.onFadeComplete=new s.Signal;this.fx=null;this._targetPosition=new s.Point;this._edge=0;this._position=new s.Point;this._shake={intensity:0,duration:0,horizontal:false,vertical:false,shakeBounds:true,x:0,y:0};this._fxDuration=0;this._fxType=0};s.Camera.FOLLOW_LOCKON=0;s.Camera.FOLLOW_PLATFORMER=1;s.Camera.FOLLOW_TOPDOWN=2;s.Camera.FOLLOW_TOPDOWN_TIGHT=3;s.Camera.SHAKE_BOTH=4;s.Camera.SHAKE_HORIZONTAL=5;s.Camera.SHAKE_VERTICAL=6;s.Camera.ENABLE_FX=true;s.Camera.prototype={boot:function(){this.displayObject=this.game.world;this.scale=this.game.world.scale;this.game.camera=this;if(s.Graphics&&s.Camera.ENABLE_FX){this.fx=new s.Graphics(this.game);this.game.stage.addChild(this.fx)}},preUpdate:function(){this.totalInView=0},follow:function(t,e,i,r){if(e===undefined){e=s.Camera.FOLLOW_LOCKON}if(i===undefined){i=1}if(r===undefined){r=1}this.target=t;this.lerp.set(i,r);var n;switch(e){case s.Camera.FOLLOW_PLATFORMER:var a=this.width/8;var o=this.height/3;this.deadzone=new s.Rectangle((this.width-a)/2,(this.height-o)/2-o*.25,a,o);break;case s.Camera.FOLLOW_TOPDOWN:n=Math.max(this.width,this.height)/4;this.deadzone=new s.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case s.Camera.FOLLOW_TOPDOWN_TIGHT:n=Math.max(this.width,this.height)/8;this.deadzone=new s.Rectangle((this.width-n)/2,(this.height-n)/2,n,n);break;case s.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(t){this.setPosition(Math.round(t.x-this.view.halfWidth),Math.round(t.y-this.view.halfHeight))},focusOnXY:function(t,e){this.setPosition(Math.round(t-this.view.halfWidth),Math.round(e-this.view.halfHeight))},shake:function(t,e,i,r,n){if(t===undefined){t=.05}if(e===undefined){e=500}if(i===undefined){i=true}if(r===undefined){r=s.Camera.SHAKE_BOTH}if(n===undefined){n=true}if(!i&&this._shake.duration>0){return false}this._shake.intensity=t;this._shake.duration=e;this._shake.shakeBounds=n;this._shake.x=0;this._shake.y=0;this._shake.horizontal=r===s.Camera.SHAKE_BOTH||r===s.Camera.SHAKE_HORIZONTAL;this._shake.vertical=r===s.Camera.SHAKE_BOTH||r===s.Camera.SHAKE_VERTICAL;return true},flash:function(t,e,i){if(t===undefined){t=16777215}if(e===undefined){e=500}if(i===undefined){i=false}if(!this.fx||!i&&this._fxDuration>0){return false}this.fx.clear();this.fx.beginFill(t);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=1;this._fxDuration=e;this._fxType=0;return true},fade:function(t,e,i){if(t===undefined){t=0}if(e===undefined){e=500}if(i===undefined){i=false}if(!this.fx||!i&&this._fxDuration>0){return false}this.fx.clear();this.fx.beginFill(t);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=0;this._fxDuration=e;this._fxType=1;return true},update:function(){if(this._fxDuration>0){this.updateFX()}if(this._shake.duration>0){this.updateShake()}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor();this._shake.x=Math.floor(this._shake.x);this._shake.y=Math.floor(this._shake.y)}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateFX:function(){if(this._fxType===0){this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration;if(this.fx.alpha<=0){this._fxDuration=0;this.fx.alpha=0;this.onFlashComplete.dispatch()}}else{this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration;if(this.fx.alpha>=1){this._fxDuration=0;this.fx.alpha=1;this.onFadeComplete.dispatch()}}},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS;if(this._shake.duration<=0){this.onShakeComplete.dispatch();this._shake.x=0;this._shake.y=0}else{if(this._shake.horizontal){this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width}if(this._shake.vertical){this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height}}},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x;this._targetPosition.y=this.view.y+this.target.worldPosition.y;if(this.deadzone){this._edge=this._targetPosition.x-this.view.x;if(this._edge<this.deadzone.left){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x)}else if(this._edge>this.deadzone.right){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)}this._edge=this._targetPosition.y-this.view.y;if(this._edge<this.deadzone.top){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y)}else if(this._edge>this.deadzone.bottom){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y)}}else{this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x);this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){if(this.bounds){this.bounds.copyFrom(this.game.world.bounds)}},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;var t=this.view.x+this._shake.x;var e=this.view.right+this._shake.x;var i=this.view.y+this._shake.y;var r=this.view.bottom+this._shake.y;if(t<=this.bounds.x*this.scale.x){this.atLimit.x=true;this.view.x=this.bounds.x*this.scale.x;if(!this._shake.shakeBounds){this._shake.x=0}}if(e>=this.bounds.right*this.scale.x){this.atLimit.x=true;this.view.x=this.bounds.right*this.scale.x-this.width;if(!this._shake.shakeBounds){this._shake.x=0}}if(i<=this.bounds.top*this.scale.y){this.atLimit.y=true;this.view.y=this.bounds.top*this.scale.y;if(!this._shake.shakeBounds){this._shake.y=0}}if(r>=this.bounds.bottom*this.scale.y){this.atLimit.y=true;this.view.y=this.bounds.bottom*this.scale.y-this.height;if(!this._shake.shakeBounds){this._shake.y=0}}},setPosition:function(t,e){this.view.x=t;this.view.y=e;if(this.bounds){this.checkBounds()}},setSize:function(t,e){this.view.width=t;this.view.height=e},reset:function(){this.target=null;this.view.x=0;this.view.y=0;this._shake.duration=0;this.resetFX()},resetFX:function(){this.fx.clear();this.fx.alpha=0;this._fxDuration=0}};s.Camera.prototype.constructor=s.Camera;Object.defineProperty(s.Camera.prototype,"x",{get:function(){return this.view.x},set:function(t){this.view.x=t;if(this.bounds){this.checkBounds()}}});Object.defineProperty(s.Camera.prototype,"y",{get:function(){return this.view.y},set:function(t){this.view.y=t;if(this.bounds){this.checkBounds()}}});Object.defineProperty(s.Camera.prototype,"position",{get:function(){this._position.set(this.view.x,this.view.y);return this._position},set:function(t){if(typeof t.x!=="undefined"){this.view.x=t.x}if(typeof t.y!=="undefined"){this.view.y=t.y}if(this.bounds){this.checkBounds()}}});Object.defineProperty(s.Camera.prototype,"width",{get:function(){return this.view.width},set:function(t){this.view.width=t}});Object.defineProperty(s.Camera.prototype,"height",{get:function(){return this.view.height},set:function(t){this.view.height=t}});Object.defineProperty(s.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(t){this._shake.intensity=t}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.State=function(){this.game=null;this.key="";this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.state=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};s.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}};s.State.prototype.constructor=s.State;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.StateManager=function(t,e){this.game=t;this.states={};this._pendingState=null;if(typeof e!=="undefined"&&e!==null){this._pendingState=e}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current="";this.onStateChange=new s.Signal;this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};s.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);if(this._pendingState!==null&&typeof this._pendingState!=="string"){this.add("default",this._pendingState,true)}},add:function(t,e,i){if(i===undefined){i=false}var r;if(e instanceof s.State){r=e}else if(typeof e==="object"){r=e;r.game=this.game}else if(typeof e==="function"){r=new e(this.game)}this.states[t]=r;if(i){if(this.game.isBooted){this.start(t)}else{this._pendingState=t}}return r},remove:function(t){if(this.current===t){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPreRenderCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[t]},start:function(t,e,i){if(e===undefined){e=true}if(i===undefined){i=false}if(this.checkState(t)){this._pendingState=t;this._clearWorld=e;this._clearCache=i;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(t,e){if(t===undefined){t=true}if(e===undefined){e=false}this._pendingState=this.current;this._clearWorld=t;this._clearCache=e;if(arguments.length>2){this._args=Array.prototype.slice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var t=this.current;this.clearCurrentState();this.setCurrentState(this._pendingState);this.onStateChange.dispatch(this.current,t);if(this.current!==this._pendingState){return}else{this._pendingState=null}if(this.onPreloadCallback){this.game.load.reset(true);this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}}},clearCurrentState:function(){if(this.current){if(this.onShutDownCallback){this.onShutDownCallback.call(this.callbackContext,this.game)}this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();this.game.scale.reset(this._clearWorld);if(this.game.debug){this.game.debug.reset()}if(this._clearWorld){this.game.world.shutdown();if(this._clearCache){this.game.cache.destroy()}}}},checkState:function(t){if(this.states[t]){if(this.states[t]["preload"]||this.states[t]["create"]||this.states[t]["update"]||this.states[t]["render"]){return true}else{console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return false}}else{console.warn("Phaser.StateManager - No state found with the key: "+t);return false}},link:function(t){this.states[t].game=this.game;this.states[t].add=this.game.add;this.states[t].make=this.game.make;this.states[t].camera=this.game.camera;this.states[t].cache=this.game.cache;this.states[t].input=this.game.input;this.states[t].load=this.game.load;this.states[t].math=this.game.math;this.states[t].sound=this.game.sound;this.states[t].scale=this.game.scale;this.states[t].state=this;this.states[t].stage=this.game.stage;this.states[t].time=this.game.time;this.states[t].tweens=this.game.tweens;this.states[t].world=this.game.world;this.states[t].particles=this.game.particles;this.states[t].rnd=this.game.rnd;this.states[t].physics=this.game.physics;this.states[t].key=t},unlink:function(t){if(this.states[t]){this.states[t].game=null;this.states[t].add=null;this.states[t].make=null;this.states[t].camera=null;this.states[t].cache=null;this.states[t].input=null;this.states[t].load=null;this.states[t].math=null;this.states[t].sound=null;this.states[t].scale=null;this.states[t].state=null;this.states[t].stage=null;this.states[t].time=null;this.states[t].tweens=null;this.states[t].world=null;this.states[t].particles=null;this.states[t].rnd=null;this.states[t].physics=null}},setCurrentState:function(t){this.callbackContext=this.states[t];this.link(t);this.onInitCallback=this.states[t]["init"]||this.dummy;this.onPreloadCallback=this.states[t]["preload"]||null;this.onLoadRenderCallback=this.states[t]["loadRender"]||null;this.onLoadUpdateCallback=this.states[t]["loadUpdate"]||null;this.onCreateCallback=this.states[t]["create"]||null;this.onUpdateCallback=this.states[t]["update"]||null;this.onPreRenderCallback=this.states[t]["preRender"]||null;this.onRenderCallback=this.states[t]["render"]||null;this.onResizeCallback=this.states[t]["resize"]||null;this.onPausedCallback=this.states[t]["paused"]||null;this.onResumedCallback=this.states[t]["resumed"]||null;this.onPauseUpdateCallback=this.states[t]["pauseUpdate"]||null;this.onShutDownCallback=this.states[t]["shutdown"]||this.dummy;if(this.current!==""){this.game.physics.reset()}this.current=t;this._created=false;this.onInitCallback.apply(this.callbackContext,this._args);if(t===this._pendingState){this._args=[]}this.game._kickstart=true},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created){if(this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},pauseUpdate:function(){if(this._created){if(this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(t){if(this._created&&this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game,t)}},resize:function(t,e){if(this.onResizeCallback){this.onResizeCallback.call(this.callbackContext,t,e)}},render:function(){if(this._created){if(this.onRenderCallback){if(this.game.renderType===s.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0);this.onRenderCallback.call(this.callbackContext,this.game);this.game.context.restore()}else{this.onRenderCallback.call(this.callbackContext,this.game)}}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this._clearWorld=true;this._clearCache=true;this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=""}};s.StateManager.prototype.constructor=s.StateManager;Object.defineProperty(s.StateManager.prototype,"created",{get:function(){return this._created}});/**
* @author       Miller Medeiros http://millermedeiros.github.com/js-signals/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Signal=function(){};s.Signal.prototype={_bindings:null,_prevParams:null,memorize:false,_shouldPropagate:true,active:true,_boundDispatch:false,validateListener:function(t,e){if(typeof t!=="function"){throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",e))}},_registerListener:function(t,e,i,r,n){var a=this._indexOfListener(t,i);var o;if(a!==-1){o=this._bindings[a];if(o.isOnce()!==e){throw new Error("You cannot add"+(e?"":"Once")+"() then add"+(!e?"":"Once")+"() the same listener without removing the relationship first.")}}else{o=new s.SignalBinding(this,t,e,i,r,n);this._addBinding(o)}if(this.memorize&&this._prevParams){o.execute(this._prevParams)}return o},_addBinding:function(t){if(!this._bindings){this._bindings=[]}var e=this._bindings.length;do{e--}while(this._bindings[e]&&t._priority<=this._bindings[e]._priority);this._bindings.splice(e+1,0,t)},_indexOfListener:function(t,e){if(!this._bindings){return-1}if(e===undefined){e=null}var i=this._bindings.length;var r;while(i--){r=this._bindings[i];if(r._listener===t&&r.context===e){return i}}return-1},has:function(t,e){return this._indexOfListener(t,e)!==-1},add:function(t,e,i){this.validateListener(t,"add");var r=[];if(arguments.length>3){for(var s=3;s<arguments.length;s++){r.push(arguments[s])}}return this._registerListener(t,false,e,i,r)},addOnce:function(t,e,i){this.validateListener(t,"addOnce");var r=[];if(arguments.length>3){for(var s=3;s<arguments.length;s++){r.push(arguments[s])}}return this._registerListener(t,true,e,i,r)},remove:function(t,e){this.validateListener(t,"remove");var i=this._indexOfListener(t,e);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return t},removeAll:function(t){if(t===undefined){t=null}if(!this._bindings){return}var e=this._bindings.length;while(e--){if(t){if(this._bindings[e].context===t){this._bindings[e]._destroy();this._bindings.splice(e,1)}}else{this._bindings[e]._destroy()}}if(!t){this._bindings.length=0}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active||!this._bindings){return}var t=Array.prototype.slice.call(arguments);var e=this._bindings.length;var i;if(this.memorize){this._prevParams=t}if(!e){return}i=this._bindings.slice();this._shouldPropagate=true;do{e--}while(i[e]&&this._shouldPropagate&&i[e].execute(t)!==false)},forget:function(){if(this._prevParams){this._prevParams=null}},dispose:function(){this.removeAll();this._bindings=null;if(this._prevParams){this._prevParams=null}},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(s.Signal.prototype,"boundDispatch",{get:function(){var t=this;return this._boundDispatch||(this._boundDispatch=function(){return t.dispatch.apply(t,arguments)})}});s.Signal.prototype.constructor=s.Signal;/**
* @author       Miller Medeiros http://millermedeiros.github.com/js-signals/
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.SignalBinding=function(t,e,i,r,s,n){this._listener=e;if(i){this._isOnce=true}if(r!=null){this.context=r}this._signal=t;if(s){this._priority=s}if(n&&n.length){this._args=n}};s.SignalBinding.prototype={context:null,_isOnce:false,_priority:0,_args:null,callCount:0,active:true,params:null,execute:function(t){var e,i;if(this.active&&!!this._listener){i=this.params?this.params.concat(t):t;if(this._args){i=i.concat(this._args)}e=this._listener.apply(this.context,i);this.callCount++;if(this._isOnce){this.detach()}}return e},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};s.SignalBinding.prototype.constructor=s.SignalBinding;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Filter=function(t,e,i){this.game=t;this.type=s.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.prevPoint=new s.Point;var r=new Date;this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[r.getFullYear(),r.getMonth(),r.getDate(),r.getHours()*60*60+r.getMinutes()*60+r.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:true}}};if(e){for(var n in e){this.uniforms[n]=e[n]}}this.fragmentSrc=i||""};s.Filter.prototype={init:function(){},setResolution:function(t,e){this.uniforms.resolution.value.x=t;this.uniforms.resolution.value.y=e},update:function(t){if(typeof t!=="undefined"){var e=t.x/this.game.width;var i=1-t.y/this.game.height;if(e!==this.prevPoint.x||i!==this.prevPoint.y){this.uniforms.mouse.value.x=e.toFixed(2);this.uniforms.mouse.value.y=i.toFixed(2);this.prevPoint.set(e,i)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(t,e,i,r,s,n){if(s===undefined){s=0}if(n===undefined){n=0}if(i!==undefined&&i!==null){this.width=i}else{i=this.width}if(r!==undefined&&r!==null){this.height=r}else{r=this.height}var a=this.game.add.image(t,e,"__default");a.width=i;a.height=r;a.anchor.set(s,n);a.filters=[this];return a},destroy:function(){this.game=null}};s.Filter.prototype.constructor=s.Filter;Object.defineProperty(s.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(t){this.uniforms.resolution.value.x=t}});Object.defineProperty(s.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(t){this.uniforms.resolution.value.y=t}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Plugin=function(t,e){if(e===undefined){e=null}this.game=t;this.parent=e;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};s.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};s.Plugin.prototype.constructor=s.Plugin;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.PluginManager=function(t){this.game=t;this.plugins=[];this._len=0;this._i=0};s.PluginManager.prototype={add:function(t){var e=Array.prototype.slice.call(arguments,1);var i=false;if(typeof t==="function"){t=new t(this.game,this)}else{t.game=this.game;t.parent=this}if(typeof t["preUpdate"]==="function"){t.hasPreUpdate=true;i=true}if(typeof t["update"]==="function"){t.hasUpdate=true;i=true}if(typeof t["postUpdate"]==="function"){t.hasPostUpdate=true;i=true}if(typeof t["render"]==="function"){t.hasRender=true;i=true}if(typeof t["postRender"]==="function"){t.hasPostRender=true;i=true}if(i){if(t.hasPreUpdate||t.hasUpdate||t.hasPostUpdate){t.active=true}if(t.hasRender||t.hasPostRender){t.visible=true}this._len=this.plugins.push(t);if(typeof t["init"]==="function"){t.init.apply(t,e)}return t}else{return null}},remove:function(t,e){if(e===undefined){e=true}this._i=this._len;while(this._i--){if(this.plugins[this._i]===t){if(e){t.destroy()}this.plugins.splice(this._i,1);this._len--;return}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy()}this.plugins.length=0;this._len=0},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate()}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update()}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate()}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render()}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender()}}},destroy:function(){this.removeAll();this.game=null}};s.PluginManager.prototype.constructor=s.PluginManager;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Stage=function(t){this.game=t;PIXI.DisplayObjectContainer.call(this);this.name="_stage_root";this.disableVisibilityChange=false;this.exists=true;this.worldTransform=new PIXI.Matrix;this.stage=this;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"};if(!this.game.transparent){this._bgColor.a=1}if(t.config){this.parseConfig(t.config)}};s.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);s.Stage.prototype.constructor=s.Stage;s.Stage.prototype.parseConfig=function(t){if(t["disableVisibilityChange"]){this.disableVisibilityChange=t["disableVisibilityChange"]}if(t["backgroundColor"]){this.setBackgroundColor(t["backgroundColor"])}};s.Stage.prototype.boot=function(){s.DOM.getOffset(this.game.canvas,this.offset);s.Canvas.setUserSelect(this.game.canvas,"none");s.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};s.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var t=0;t<this.children.length;t++){this.children[t].preUpdate()}};s.Stage.prototype.update=function(){var t=this.children.length;while(t--){this.children[t].update()}};s.Stage.prototype.postUpdate=function(){this.game.camera.update();if(this.game.camera.target){this.game.camera.target.postUpdate();this.updateTransform();this.game.camera.updateTarget()}for(var t=0;t<this.children.length;t++){this.children[t].postUpdate()}this.updateTransform()};s.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var t=0;t<this.children.length;t++){this.children[t].updateTransform()}};s.Stage.prototype.checkVisibility=function(){if(document.hidden!==undefined){this._hiddenVar="visibilitychange"}else if(document.webkitHidden!==undefined){this._hiddenVar="webkitvisibilitychange"}else if(document.mozHidden!==undefined){this._hiddenVar="mozvisibilitychange"}else if(document.msHidden!==undefined){this._hiddenVar="msvisibilitychange"}else{this._hiddenVar=null}var t=this;this._onChange=function(e){return t.visibilityChange(e)};if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false)}window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;if(this.game.device.cocoonJSApp){CocoonJS.App.onSuspended.addEventListener(function(){s.Stage.prototype.visibilityChange.call(t,{type:"pause"})});CocoonJS.App.onActivated.addEventListener(function(){s.Stage.prototype.visibilityChange.call(t,{type:"resume"})})}};s.Stage.prototype.visibilityChange=function(t){if(t.type==="pagehide"||t.type==="blur"||t.type==="pageshow"||t.type==="focus"){if(t.type==="pagehide"||t.type==="blur"){this.game.focusLoss(t)}else if(t.type==="pageshow"||t.type==="focus"){this.game.focusGain(t)}return}if(this.disableVisibilityChange){return}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||t.type==="pause"){this.game.gamePaused(t)}else{this.game.gameResumed(t)}};s.Stage.prototype.setBackgroundColor=function(t){if(this.game.transparent){return}s.Color.valueToColor(t,this._bgColor);s.Color.updateColor(this._bgColor);this._bgColor.r/=255;this._bgColor.g/=255;this._bgColor.b/=255;this._bgColor.a=1};s.Stage.prototype.destroy=function(){if(this._hiddenVar){document.removeEventListener(this._hiddenVar,this._onChange,false)}window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(s.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(t){this.setBackgroundColor(t)}});Object.defineProperty(s.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(t){if(t){PIXI.scaleModes.DEFAULT=PIXI.scaleModes.LINEAR}else{PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST}}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Group=function(t,e,i,r,n,a){if(r===undefined){r=false}if(n===undefined){n=false}if(a===undefined){a=s.Physics.ARCADE}this.game=t;if(e===undefined){e=t.world}this.name=i||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);if(r){this.game.stage.addChild(this);this.z=this.game.stage.children.length}else{if(e){e.addChild(this);this.z=e.children.length}}this.type=s.GROUP;this.physicsType=s.GROUP;this.alive=true;this.exists=true;this.ignoreDestroy=false;this.pendingDestroy=false;this.classType=s.Sprite;this.cursor=null;this.inputEnableChildren=false;this.onChildInputDown=new s.Signal;this.onChildInputUp=new s.Signal;this.onChildInputOver=new s.Signal;this.onChildInputOut=new s.Signal;this.enableBody=n;this.enableBodyDebug=false;this.physicsBodyType=a;this.physicsSortDirection=null;this.onDestroy=new s.Signal;this.cursorIndex=0;this.fixedToCamera=false;this.cameraOffset=new s.Point;this.hash=[];this._sortProperty="z"};s.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);s.Group.prototype.constructor=s.Group;s.Group.RETURN_NONE=0;s.Group.RETURN_TOTAL=1;s.Group.RETURN_CHILD=2;s.Group.RETURN_ALL=3;s.Group.SORT_ASCENDING=-1;s.Group.SORT_DESCENDING=1;s.Group.prototype.add=function(t,e,i){if(e===undefined){e=false}if(t.parent===this){return t}if(t.body&&t.parent&&t.parent.hash){t.parent.removeFromHash(t)}if(i===undefined){t.z=this.children.length;this.addChild(t)}else{this.addChildAt(t,i);this.updateZ()}if(this.enableBody&&t.hasOwnProperty("body")&&t.body===null){this.game.physics.enable(t,this.physicsBodyType)}else if(t.body){this.addToHash(t)}if(this.inputEnableChildren&&(!t.input||t.inputEnabled)){t.inputEnabled=true}if(!e&&t.events){t.events.onAddedToGroup$dispatch(t,this)}if(this.cursor===null){this.cursor=t}return t};s.Group.prototype.addAt=function(t,e,i){this.add(t,i,e)};s.Group.prototype.addToHash=function(t){if(t.parent===this){var e=this.hash.indexOf(t);if(e===-1){this.hash.push(t);return true}}return false};s.Group.prototype.removeFromHash=function(t){if(t){var e=this.hash.indexOf(t);if(e!==-1){this.hash.splice(e,1);return true}}return false};s.Group.prototype.addMultiple=function(t,e){if(t instanceof s.Group){t.moveAll(this,e)}else if(Array.isArray(t)){for(var i=0;i<t.length;i++){this.add(t[i],e)}}return t};s.Group.prototype.getAt=function(t){if(t<0||t>=this.children.length){return-1}else{return this.getChildAt(t)}};s.Group.prototype.create=function(t,e,i,r,s,n){if(s===undefined){s=true}var a=new this.classType(this.game,t,e,i,r);a.exists=s;a.visible=s;a.alive=s;return this.add(a,false,n)};s.Group.prototype.createMultiple=function(t,e,i,r){if(i===undefined){i=0}if(r===undefined){r=false}if(!Array.isArray(e)){e=[e]}if(!Array.isArray(i)){i=[i]}var s=this;var n=[];e.forEach(function(e){i.forEach(function(i){for(var a=0;a<t;a++){n.push(s.create(0,0,e,i,r))}})});return n};s.Group.prototype.updateZ=function(){var t=this.children.length;while(t--){this.children[t].z=t}};s.Group.prototype.align=function(t,e,i,r,n,a){if(n===undefined){n=s.TOP_LEFT}if(a===undefined){a=0}if(this.children.length===0||a>this.children.length||t===-1&&e===-1){return false}var o=new s.Rectangle(0,0,i,r);var h=t*i;var l=e*r;for(var u=a;u<this.children.length;u++){var c=this.children[u];if(c["alignIn"]){c.alignIn(o,n)}else{continue}if(t===-1){o.y+=r;if(o.y===l){o.x+=i;o.y=0}}else if(e===-1){o.x+=i;if(o.x===h){o.x=0;o.y+=r}}else{o.x+=i;if(o.x===h){o.x=0;o.y+=r;if(o.y===l){return true}}}}return true};s.Group.prototype.resetCursor=function(t){if(t===undefined){t=0}if(t>this.children.length-1){t=0}if(this.cursor){this.cursorIndex=t;this.cursor=this.children[this.cursorIndex];return this.cursor}};s.Group.prototype.next=function(){if(this.cursor){if(this.cursorIndex>=this.children.length-1){this.cursorIndex=0}else{this.cursorIndex++}this.cursor=this.children[this.cursorIndex];return this.cursor}};s.Group.prototype.previous=function(){if(this.cursor){if(this.cursorIndex===0){this.cursorIndex=this.children.length-1}else{this.cursorIndex--}this.cursor=this.children[this.cursorIndex];return this.cursor}};s.Group.prototype.swap=function(t,e){this.swapChildren(t,e);this.updateZ()};s.Group.prototype.bringToTop=function(t){if(t.parent===this&&this.getIndex(t)<this.children.length){this.remove(t,false,true);this.add(t,true)}return t};s.Group.prototype.sendToBack=function(t){if(t.parent===this&&this.getIndex(t)>0){this.remove(t,false,true);this.addAt(t,0,true)}return t};s.Group.prototype.moveUp=function(t){if(t.parent===this&&this.getIndex(t)<this.children.length-1){var e=this.getIndex(t);var i=this.getAt(e+1);if(i){this.swap(t,i)}}return t};s.Group.prototype.moveDown=function(t){if(t.parent===this&&this.getIndex(t)>0){var e=this.getIndex(t);var i=this.getAt(e-1);if(i){this.swap(t,i)}}return t};s.Group.prototype.xy=function(t,e,i){if(t<0||t>this.children.length){return-1}else{this.getChildAt(t).x=e;this.getChildAt(t).y=i}};s.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};s.Group.prototype.getIndex=function(t){return this.children.indexOf(t)};s.Group.prototype.getByName=function(t){for(var e=0;e<this.children.length;e++){if(this.children[e].name===t){return this.children[e]}}return null};s.Group.prototype.replace=function(t,e){var i=this.getIndex(t);if(i!==-1){if(e.parent){if(e.parent instanceof s.Group){e.parent.remove(e)}else{e.parent.removeChild(e)}}this.remove(t);this.addAt(e,i);return t}};s.Group.prototype.hasProperty=function(t,e){var i=e.length;if(i===1&&e[0]in t){return true}else if(i===2&&e[0]in t&&e[1]in t[e[0]]){return true}else if(i===3&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]){return true}else if(i===4&&e[0]in t&&e[1]in t[e[0]]&&e[2]in t[e[0]][e[1]]&&e[3]in t[e[0]][e[1]][e[2]]){return true}return false};s.Group.prototype.setProperty=function(t,e,i,r,s){if(s===undefined){s=false}r=r||0;if(!this.hasProperty(t,e)&&(!s||r>0)){return false}var n=e.length;if(n===1){if(r===0){t[e[0]]=i}else if(r===1){t[e[0]]+=i}else if(r===2){t[e[0]]-=i}else if(r===3){t[e[0]]*=i}else if(r===4){t[e[0]]/=i}}else if(n===2){if(r===0){t[e[0]][e[1]]=i}else if(r===1){t[e[0]][e[1]]+=i}else if(r===2){t[e[0]][e[1]]-=i}else if(r===3){t[e[0]][e[1]]*=i}else if(r===4){t[e[0]][e[1]]/=i}}else if(n===3){if(r===0){t[e[0]][e[1]][e[2]]=i}else if(r===1){t[e[0]][e[1]][e[2]]+=i}else if(r===2){t[e[0]][e[1]][e[2]]-=i}else if(r===3){t[e[0]][e[1]][e[2]]*=i}else if(r===4){t[e[0]][e[1]][e[2]]/=i}}else if(n===4){if(r===0){t[e[0]][e[1]][e[2]][e[3]]=i}else if(r===1){t[e[0]][e[1]][e[2]][e[3]]+=i}else if(r===2){t[e[0]][e[1]][e[2]][e[3]]-=i}else if(r===3){t[e[0]][e[1]][e[2]][e[3]]*=i}else if(r===4){t[e[0]][e[1]][e[2]][e[3]]/=i}}return true};s.Group.prototype.checkProperty=function(t,e,i,r){if(r===undefined){r=false}if(!s.Utils.getProperty(t,e)&&r){return false}if(s.Utils.getProperty(t,e)!==i){return false}return true};s.Group.prototype.set=function(t,e,i,r,s,n,a){if(a===undefined){a=false}e=e.split(".");if(r===undefined){r=false}if(s===undefined){s=false}if((r===false||r&&t.alive)&&(s===false||s&&t.visible)){return this.setProperty(t,e,i,n,a)}};s.Group.prototype.setAll=function(t,e,i,r,s,n){if(i===undefined){i=false}if(r===undefined){r=false}if(n===undefined){n=false}t=t.split(".");s=s||0;for(var a=0;a<this.children.length;a++){if((!i||i&&this.children[a].alive)&&(!r||r&&this.children[a].visible)){this.setProperty(this.children[a],t,e,s,n)}}};s.Group.prototype.setAllChildren=function(t,e,i,r,n,a){if(i===undefined){i=false}if(r===undefined){r=false}if(a===undefined){a=false}n=n||0;for(var o=0;o<this.children.length;o++){if((!i||i&&this.children[o].alive)&&(!r||r&&this.children[o].visible)){if(this.children[o]instanceof s.Group){this.children[o].setAllChildren(t,e,i,r,n,a)}else{this.setProperty(this.children[o],t.split("."),e,n,a)}}}};s.Group.prototype.checkAll=function(t,e,i,r,s){if(i===undefined){i=false}if(r===undefined){r=false}if(s===undefined){s=false}for(var n=0;n<this.children.length;n++){if((!i||i&&this.children[n].alive)&&(!r||r&&this.children[n].visible)){if(!this.checkProperty(this.children[n],t,e,s)){return false}}}return true};s.Group.prototype.addAll=function(t,e,i,r){this.setAll(t,e,i,r,1)};s.Group.prototype.subAll=function(t,e,i,r){this.setAll(t,e,i,r,2)};s.Group.prototype.multiplyAll=function(t,e,i,r){this.setAll(t,e,i,r,3)};s.Group.prototype.divideAll=function(t,e,i,r){this.setAll(t,e,i,r,4)};s.Group.prototype.callAllExists=function(t,e){var i;if(arguments.length>2){i=[];for(var r=2;r<arguments.length;r++){i.push(arguments[r])}}for(var r=0;r<this.children.length;r++){if(this.children[r].exists===e&&this.children[r][t]){this.children[r][t].apply(this.children[r],i)}}};s.Group.prototype.callbackFromArray=function(t,e,i){if(i===1){if(t[e[0]]){return t[e[0]]}}else if(i===2){if(t[e[0]][e[1]]){return t[e[0]][e[1]]}}else if(i===3){if(t[e[0]][e[1]][e[2]]){return t[e[0]][e[1]][e[2]]}}else if(i===4){if(t[e[0]][e[1]][e[2]][e[3]]){return t[e[0]][e[1]][e[2]][e[3]]}}else if(t[e]){return t[e]}return false};s.Group.prototype.callAll=function(t,e){if(t===undefined){return}t=t.split(".");var i=t.length;if(e===undefined||e===null||e===""){e=null}else{if(typeof e==="string"){e=e.split(".");var r=e.length}}var s;if(arguments.length>2){s=[];for(var n=2;n<arguments.length;n++){s.push(arguments[n])}}var a=null;var o=null;for(var n=0;n<this.children.length;n++){a=this.callbackFromArray(this.children[n],t,i);if(e&&a){o=this.callbackFromArray(this.children[n],e,r);if(a){a.apply(o,s)}}else if(a){a.apply(this.children[n],s)}}};s.Group.prototype.preUpdate=function(){if(this.pendingDestroy){this.destroy();return false}if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}for(var t=0;t<this.children.length;t++){this.children[t].preUpdate()}return true};s.Group.prototype.update=function(){var t=this.children.length;while(t--){this.children[t].update()}};s.Group.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}for(var t=0;t<this.children.length;t++){this.children[t].postUpdate()}};s.Group.prototype.filter=function(t,e){var i=-1;var r=this.children.length;var n=[];while(++i<r){var a=this.children[i];if(!e||e&&a.exists){if(t(a,i,this.children)){n.push(a)}}}return new s.ArraySet(n)};s.Group.prototype.forEach=function(t,e,i){if(i===undefined){i=false}if(arguments.length<=3){for(var r=0;r<this.children.length;r++){if(!i||i&&this.children[r].exists){t.call(e,this.children[r])}}}else{var s=[null];for(var r=3;r<arguments.length;r++){s.push(arguments[r])}for(var r=0;r<this.children.length;r++){if(!i||i&&this.children[r].exists){s[0]=this.children[r];t.apply(e,s)}}}};s.Group.prototype.forEachExists=function(t,e){var i;if(arguments.length>2){i=[null];for(var r=2;r<arguments.length;r++){i.push(arguments[r])}}this.iterate("exists",true,s.Group.RETURN_TOTAL,t,e,i)};s.Group.prototype.forEachAlive=function(t,e){var i;if(arguments.length>2){i=[null];for(var r=2;r<arguments.length;r++){i.push(arguments[r])}}this.iterate("alive",true,s.Group.RETURN_TOTAL,t,e,i)};s.Group.prototype.forEachDead=function(t,e){var i;if(arguments.length>2){i=[null];for(var r=2;r<arguments.length;r++){i.push(arguments[r])}}this.iterate("alive",false,s.Group.RETURN_TOTAL,t,e,i)};s.Group.prototype.sort=function(t,e){if(this.children.length<2){return}if(t===undefined){t="z"}if(e===undefined){e=s.Group.SORT_ASCENDING}this._sortProperty=t;if(e===s.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this))}else{this.children.sort(this.descendingSortHandler.bind(this))}this.updateZ()};s.Group.prototype.customSort=function(t,e){if(this.children.length<2){return}this.children.sort(t.bind(e));this.updateZ()};s.Group.prototype.ascendingSortHandler=function(t,e){if(t[this._sortProperty]<e[this._sortProperty]){return-1}else if(t[this._sortProperty]>e[this._sortProperty]){return 1}else{if(t.z<e.z){return-1}else{return 1}}};s.Group.prototype.descendingSortHandler=function(t,e){if(t[this._sortProperty]<e[this._sortProperty]){return 1}else if(t[this._sortProperty]>e[this._sortProperty]){return-1}else{return 0}};s.Group.prototype.iterate=function(t,e,i,r,n,a){if(this.children.length===0){if(i===s.Group.RETURN_TOTAL){return 0}else if(i===s.Group.RETURN_ALL){return[]}}var o=0;if(i===s.Group.RETURN_ALL){var h=[]}for(var l=0;l<this.children.length;l++){if(this.children[l][t]===e){o++;if(r){if(a){a[0]=this.children[l];r.apply(n,a)}else{r.call(n,this.children[l])}}if(i===s.Group.RETURN_CHILD){return this.children[l]}else if(i===s.Group.RETURN_ALL){h.push(this.children[l])}}}if(i===s.Group.RETURN_TOTAL){return o}else if(i===s.Group.RETURN_ALL){return h}else{return null}};s.Group.prototype.getFirstExists=function(t,e,i,r,n,a){if(e===undefined){e=false}if(typeof t!=="boolean"){t=true}var o=this.iterate("exists",t,s.Group.RETURN_CHILD);return o===null&&e?this.create(i,r,n,a):this.resetChild(o,i,r,n,a)};s.Group.prototype.getFirstAlive=function(t,e,i,r,n){if(t===undefined){t=false}var a=this.iterate("alive",true,s.Group.RETURN_CHILD);return a===null&&t?this.create(e,i,r,n):this.resetChild(a,e,i,r,n)};s.Group.prototype.getFirstDead=function(t,e,i,r,n){if(t===undefined){t=false}var a=this.iterate("alive",false,s.Group.RETURN_CHILD);return a===null&&t?this.create(e,i,r,n):this.resetChild(a,e,i,r,n)};s.Group.prototype.resetChild=function(t,e,i,r,s){if(t===null){return null}if(e===undefined){e=null}if(i===undefined){i=null}if(e!==null&&i!==null){t.reset(e,i)}if(r!==undefined){t.loadTexture(r,s)}return t};s.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1]}};s.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0]}};s.Group.prototype.getClosestTo=function(t,e,i){var r=Number.MAX_VALUE;var n=0;var a=null;for(var o=0;o<this.children.length;o++){var h=this.children[o];if(h.exists){n=Math.abs(s.Point.distance(t,h));if(n<r&&(!e||e.call(i,h,n))){r=n;a=h}}}return a};s.Group.prototype.getFurthestFrom=function(t,e,i){var r=0;var n=0;var a=null;for(var o=0;o<this.children.length;o++){var h=this.children[o];if(h.exists){n=Math.abs(s.Point.distance(t,h));if(n>r&&(!e||e.call(i,h,n))){r=n;a=h}}}return a};s.Group.prototype.countLiving=function(){return this.iterate("alive",true,s.Group.RETURN_TOTAL)};s.Group.prototype.countDead=function(){return this.iterate("alive",false,s.Group.RETURN_TOTAL)};s.Group.prototype.getRandom=function(t,e){if(t===undefined){t=0}if(e===undefined){e=this.children.length}if(e===0){return null}return s.ArrayUtils.getRandomItem(this.children,t,e)};s.Group.prototype.getRandomExists=function(t,e){var i=this.getAll("exists",true,t,e);return this.game.rnd.pick(i)};s.Group.prototype.getAll=function(t,e,i,r){if(i===undefined){i=0}if(r===undefined){r=this.children.length}var s=[];for(var n=i;n<r;n++){var a=this.children[n];if(t&&a[t]===e){s.push(a)}}return s};s.Group.prototype.remove=function(t,e,i){if(e===undefined){e=false}if(i===undefined){i=false}if(this.children.length===0||this.children.indexOf(t)===-1){return false}if(!i&&t.events&&!t.destroyPhase){t.events.onRemovedFromGroup$dispatch(t,this)}var r=this.removeChild(t);this.removeFromHash(t);this.updateZ();if(this.cursor===t){this.next()}if(e&&r){r.destroy(true)}return true};s.Group.prototype.moveAll=function(t,e){if(e===undefined){e=false}if(this.children.length>0&&t instanceof s.Group){do{t.add(this.children[0],e)}while(this.children.length>0);this.hash=[];this.cursor=null}return t};s.Group.prototype.removeAll=function(t,e,i){if(t===undefined){t=false}if(e===undefined){e=false}if(i===undefined){i=false}if(this.children.length===0){return}do{if(!e&&this.children[0].events){this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this)}var r=this.removeChild(this.children[0]);this.removeFromHash(r);if(t&&r){r.destroy(true,i)}}while(this.children.length>0);this.hash=[];this.cursor=null};s.Group.prototype.removeBetween=function(t,e,i,r){if(e===undefined){e=this.children.length-1}if(i===undefined){i=false}if(r===undefined){r=false}if(this.children.length===0){return}if(t>e||t<0||e>this.children.length){return false}var s=e;while(s>=t){if(!r&&this.children[s].events){this.children[s].events.onRemovedFromGroup$dispatch(this.children[s],this)}var n=this.removeChild(this.children[s]);this.removeFromHash(n);if(i&&n){n.destroy(true)}if(this.cursor===this.children[s]){this.cursor=null}s--}this.updateZ()};s.Group.prototype.destroy=function(t,e){if(this.game===null||this.ignoreDestroy){return}if(t===undefined){t=true}if(e===undefined){e=false}this.onDestroy.dispatch(this,t,e);this.removeAll(t);this.cursor=null;this.filters=null;this.pendingDestroy=false;if(!e){if(this.parent){this.parent.removeChild(this)}this.game=null;this.exists=false}};Object.defineProperty(s.Group.prototype,"total",{get:function(){return this.iterate("exists",true,s.Group.RETURN_TOTAL)}});Object.defineProperty(s.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(s.Group.prototype,"angle",{get:function(){return s.Math.radToDeg(this.rotation)},set:function(t){this.rotation=s.Math.degToRad(t)}});Object.defineProperty(s.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(t){var e=this.getBounds(this.parent);var i=this.x-e.x;this.x=t+i-e.halfWidth}});Object.defineProperty(s.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(t){var e=this.getBounds(this.parent);var i=this.y-e.y;this.y=t+i-e.halfHeight}});Object.defineProperty(s.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(t){var e=this.getBounds(this.parent);var i=this.x-e.x;this.x=t+i}});Object.defineProperty(s.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(t){var e=this.getBounds(this.parent);var i=this.x-e.x;this.x=t+i-e.width}});Object.defineProperty(s.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(t){var e=this.getBounds(this.parent);var i=this.y-e.y;this.y=t+i}});Object.defineProperty(s.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(t){var e=this.getBounds(this.parent);var i=this.y-e.y;this.y=t+i-e.height}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.World=function(t){s.Group.call(this,t,null,"__world",false);this.bounds=new s.Rectangle(0,0,t.width,t.height);this.camera=null;this._definedSize=false;this._width=t.width;this._height=t.height;this.game.state.onStateChange.add(this.stateChange,this)};s.World.prototype=Object.create(s.Group.prototype);s.World.prototype.constructor=s.World;s.World.prototype.boot=function(){this.camera=new s.Camera(this.game,0,0,0,this.game.width,this.game.height);this.game.stage.addChild(this);this.camera.boot()};s.World.prototype.stateChange=function(){this.x=0;this.y=0;this.camera.reset()};s.World.prototype.setBounds=function(t,e,i,r){this._definedSize=true;this._width=i;this._height=r;this.bounds.setTo(t,e,i,r);this.x=t;this.y=e;if(this.camera.bounds){this.camera.bounds.setTo(t,e,Math.max(i,this.game.width),Math.max(r,this.game.height))}this.game.physics.setBoundsToWorld()};s.World.prototype.resize=function(t,e){if(this._definedSize){if(t<this._width){t=this._width}if(e<this._height){e=this._height}}this.bounds.width=t;this.bounds.height=e;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};s.World.prototype.shutdown=function(){this.destroy(true,true)};s.World.prototype.wrap=function(t,e,i,r,s){if(e===undefined){e=0}if(i===undefined){i=false}if(r===undefined){r=true}if(s===undefined){s=true}if(!i){if(r&&t.x+e<this.bounds.x){t.x=this.bounds.right+e}else if(r&&t.x-e>this.bounds.right){t.x=this.bounds.left-e}if(s&&t.y+e<this.bounds.top){t.y=this.bounds.bottom+e}else if(s&&t.y-e>this.bounds.bottom){t.y=this.bounds.top-e}}else{t.getBounds();if(r){if(t.x+t._currentBounds.width<this.bounds.x){t.x=this.bounds.right}else if(t.x>this.bounds.right){t.x=this.bounds.left}}if(s){if(t.y+t._currentBounds.height<this.bounds.top){t.y=this.bounds.bottom}else if(t.y>this.bounds.bottom){t.y=this.bounds.top}}}};Object.defineProperty(s.World.prototype,"width",{get:function(){return this.bounds.width},set:function(t){if(t<this.game.width){t=this.game.width}this.bounds.width=t;this._width=t;this._definedSize=true}});Object.defineProperty(s.World.prototype,"height",{get:function(){return this.bounds.height},set:function(t){if(t<this.game.height){t=this.game.height}this.bounds.height=t;this._height=t;this._definedSize=true}});Object.defineProperty(s.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}});Object.defineProperty(s.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}});Object.defineProperty(s.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.between(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x))}else{return this.game.rnd.between(this.bounds.x,this.bounds.width)}}});Object.defineProperty(s.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.between(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y))}else{return this.game.rnd.between(this.bounds.y,this.bounds.height)}}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Game=function(t,e,i,r,n,a,o,h){this.id=s.GAMES.push(this)-1;this.config=null;this.physicsConfig=h;this.parent="";this.width=800;this.height=600;this.resolution=1;this._width=800;this._height=600;this.transparent=false;this.antialias=true;this.preserveDrawingBuffer=false;this.clearBeforeRender=true;this.renderer=null;this.renderType=s.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.plugins=null;this.rnd=null;this.device=s.Device;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.create=null;this.lockRender=false;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=false;this._codePaused=false;this.currentUpdateID=0;this.updatesThisFrame=1;this._deltaTime=0;this._lastCount=0;this._spiraling=0;this._kickstart=true;this.fpsProblemNotifier=new s.Signal;this.forceSingleUpdate=true;this._nextFpsNotification=0;if(arguments.length===1&&typeof arguments[0]==="object"){this.parseConfig(arguments[0])}else{this.config={enableDebug:true};if(typeof t!=="undefined"){this._width=t}if(typeof e!=="undefined"){this._height=e}if(typeof i!=="undefined"){this.renderType=i}if(typeof r!=="undefined"){this.parent=r}if(typeof a!=="undefined"){this.transparent=a}if(typeof o!=="undefined"){this.antialias=o}this.rnd=new s.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new s.StateManager(this,n)}this.device.whenReady(this.boot,this);return this};s.Game.prototype={parseConfig:function(t){this.config=t;if(t["enableDebug"]===undefined){this.config.enableDebug=true}if(t["width"]){this._width=t["width"]}if(t["height"]){this._height=t["height"]}if(t["renderer"]){this.renderType=t["renderer"]}if(t["parent"]){this.parent=t["parent"]}if(t["transparent"]!==undefined){this.transparent=t["transparent"]}if(t["antialias"]!==undefined){this.antialias=t["antialias"]}if(t["resolution"]){this.resolution=t["resolution"]}if(t["preserveDrawingBuffer"]!==undefined){this.preserveDrawingBuffer=t["preserveDrawingBuffer"]}if(t["physicsConfig"]){this.physicsConfig=t["physicsConfig"]}var e=[(Date.now()*Math.random()).toString()];if(t["seed"]){e=t["seed"]}this.rnd=new s.RandomDataGenerator(e);var i=null;if(t["state"]){i=t["state"]}this.state=new s.StateManager(this,i)},boot:function(){if(this.isBooted){return}this.onPause=new s.Signal;this.onResume=new s.Signal;this.onBlur=new s.Signal;this.onFocus=new s.Signal;this.isBooted=true;PIXI.game=this;this.math=s.Math;this.scale=new s.ScaleManager(this,this._width,this._height);this.stage=new s.Stage(this);this.setUpRenderer();this.world=new s.World(this);this.add=new s.GameObjectFactory(this);this.make=new s.GameObjectCreator(this);this.cache=new s.Cache(this);this.load=new s.Loader(this);this.time=new s.Time(this);this.tweens=new s.TweenManager(this);this.input=new s.Input(this);this.sound=new s.SoundManager(this);this.physics=new s.Physics(this,this.physicsConfig);this.particles=new s.Particles(this);this.create=new s.Create(this);this.plugins=new s.PluginManager(this);this.net=new s.Net(this);this.time.boot();this.stage.boot();this.world.boot();this.scale.boot();this.input.boot();this.sound.boot();this.state.boot();if(this.config["enableDebug"]){this.debug=new s.Utils.Debug(this);this.debug.boot()}else{this.debug={preUpdate:function(){},update:function(){},reset:function(){}}}this.showDebugHeader();this.isRunning=true;if(this.config&&this.config["forceSetTimeOut"]){this.raf=new s.RequestAnimationFrame(this,this.config["forceSetTimeOut"])}else{this.raf=new s.RequestAnimationFrame(this,false)}this._kickstart=true;if(window["focus"]){if(!window["PhaserGlobal"]||window["PhaserGlobal"]&&!window["PhaserGlobal"].stopFocus){window.focus()}}this.raf.start()},showDebugHeader:function(){if(window["PhaserGlobal"]&&window["PhaserGlobal"].hideBanner){return}var t=s.VERSION;var e="Canvas";var i="HTML Audio";var r=1;if(this.renderType===s.WEBGL){e="WebGL";r++}else if(this.renderType===s.HEADLESS){e="Headless"}if(this.device.webAudio){i="WebAudio";r++}if(this.device.chrome){var n=["%c %c %c Phaser v"+t+" | Pixi.js | "+e+" | "+i+"  %c %c "+"%c http://phaser.io %c♥%c♥%c♥","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"];for(var a=0;a<3;a++){if(a<r){n.push("color: #ff2424; background: #fff")}else{n.push("color: #959595; background: #fff")}}console.log.apply(console,n)}else if(window["console"]){console.log("Phaser v"+t+" | Pixi.js "+PIXI.VERSION+" | "+e+" | "+i+" | http://phaser.io")}},setUpRenderer:function(){if(this.config["canvas"]){this.canvas=this.config["canvas"]}else{this.canvas=s.Canvas.create(this,this.width,this.height,this.config["canvasID"],true)}if(this.config["canvasStyle"]){this.canvas.style=this.config["canvasStyle"]}else{this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}if(this.renderType===s.HEADLESS||this.renderType===s.CANVAS||this.renderType===s.AUTO&&!this.device.webGL){if(this.device.canvas){this.renderType=s.CANVAS;this.renderer=new PIXI.CanvasRenderer(this);this.context=this.renderer.context}else{throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.")}}else{this.renderType=s.WEBGL;this.renderer=new PIXI.WebGLRenderer(this);this.context=null;this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),false);this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),false)}if(this.device.cocoonJS){this.canvas.screencanvas=this.renderType===s.CANVAS?true:false}if(this.renderType!==s.HEADLESS){this.stage.smoothed=this.antialias;s.Canvas.addToDOM(this.canvas,this.parent,false);s.Canvas.setTouchAction(this.canvas)}},contextLost:function(t){t.preventDefault();this.renderer.contextLost=true},contextRestored:function(){this.renderer.initContext();this.cache.clearGLTextures();this.renderer.contextLost=false},update:function(t){this.time.update(t);if(this._kickstart){this.updateLogic(this.time.desiredFpsMult);this.updateRender(this.time.slowMotion*this.time.desiredFps);this._kickstart=false;return}if(this._spiraling>1&&!this.forceSingleUpdate){if(this.time.time>this._nextFpsNotification){this._nextFpsNotification=this.time.time+1e4;this.fpsProblemNotifier.dispatch()}this._deltaTime=0;this._spiraling=0;this.updateRender(this.time.slowMotion*this.time.desiredFps)}else{var e=this.time.slowMotion*1e3/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(e*3,this.time.elapsed),0);var i=0;this.updatesThisFrame=Math.floor(this._deltaTime/e);if(this.forceSingleUpdate){this.updatesThisFrame=Math.min(1,this.updatesThisFrame)}while(this._deltaTime>=e){this._deltaTime-=e;this.currentUpdateID=i;this.updateLogic(this.time.desiredFpsMult);i++;if(this.forceSingleUpdate&&i===1){break}else{this.time.refresh()}}if(i>this._lastCount){this._spiraling++}else if(i<this._lastCount){this._spiraling=0}this._lastCount=i;this.updateRender(this._deltaTime/e)}},updateLogic:function(t){if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true}this.scale.preUpdate();this.debug.preUpdate();this.camera.preUpdate();this.physics.preUpdate();this.state.preUpdate(t);this.plugins.preUpdate(t);this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update();this.sound.update();this.input.update();this.physics.update();this.particles.update();this.plugins.update();this.stage.postUpdate();this.plugins.postUpdate()}else{this.scale.pauseUpdate();this.state.pauseUpdate();this.debug.preUpdate()}this.stage.updateTransform()},updateRender:function(t){if(this.lockRender){return}this.state.preRender(t);if(this.renderType!==s.HEADLESS){this.renderer.render(this.stage);this.plugins.render(t);this.state.render(t)}this.plugins.postRender(t)},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0},disableStep:function(){this.stepping=false;this.pendingStep=false},step:function(){this.pendingStep=false;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.plugins.destroy();this.state=null;this.sound=null;this.scale=null;this.stage=null;this.input=null;this.physics=null;this.plugins=null;this.cache=null;this.load=null;this.time=null;this.world=null;this.isBooted=false;this.renderer.destroy(false);s.Canvas.removeFromDOM(this.canvas);PIXI.defaultRenderer=null;s.GAMES[this.id]=null},gamePaused:function(t){if(!this._paused){this._paused=true;this.time.gamePaused();if(this.sound.muteOnPause){this.sound.setMute()}this.onPause.dispatch(t);if(this.device.cordova&&this.device.iOS){this.lockRender=true}}},gameResumed:function(t){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();if(this.sound.muteOnPause){this.sound.unsetMute()}this.onResume.dispatch(t);if(this.device.cordova&&this.device.iOS){this.lockRender=false}}},focusLoss:function(t){this.onBlur.dispatch(t);if(!this.stage.disableVisibilityChange){this.gamePaused(t)}},focusGain:function(t){this.onFocus.dispatch(t);if(!this.stage.disableVisibilityChange){this.gameResumed(t)}}};s.Game.prototype.constructor=s.Game;Object.defineProperty(s.Game.prototype,"paused",{get:function(){return this._paused},set:function(t){if(t===true){if(this._paused===false){this._paused=true;this.sound.setMute();this.time.gamePaused();this.onPause.dispatch(this)}this._codePaused=true}else{if(this._paused){this._paused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this)}this._codePaused=false}}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Input=function(t){this.game=t;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.customCandidateHandler=null;this.customCandidateHandlerContext=null;this.pollRate=0;this.enabled=true;this.multiInputOverride=s.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2e3;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new s.ArraySet;this._localPoint=new s.Point;this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};s.Input.MOUSE_OVERRIDES_TOUCH=0;s.Input.TOUCH_OVERRIDES_MOUSE=1;s.Input.MOUSE_TOUCH_COMBINE=2;s.Input.MAX_POINTERS=10;s.Input.prototype={boot:function(){this.mousePointer=new s.Pointer(this.game,0,s.PointerMode.CURSOR);this.addPointer();this.addPointer();this.mouse=new s.Mouse(this.game);this.touch=new s.Touch(this.game);this.mspointer=new s.MSPointer(this.game);if(s.Keyboard){this.keyboard=new s.Keyboard(this.game)}if(s.Gamepad){this.gamepad=new s.Gamepad(this.game)}this.onDown=new s.Signal;this.onUp=new s.Signal;this.onTap=new s.Signal;this.onHold=new s.Signal;this.scale=new s.Point(1,1);this.speed=new s.Point;this.position=new s.Point;this._oldPosition=new s.Point;this.circle=new s.Circle(0,0,44);this.activePointer=this.mousePointer;this.hitCanvas=PIXI.CanvasPool.create(this,1,1);this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=true;if(this.keyboard){this.keyboard.start()}var t=this;this._onClickTrampoline=function(e){t.onClickTrampoline(e)};this.game.canvas.addEventListener("click",this._onClickTrampoline,false)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();if(this.keyboard){this.keyboard.stop()}if(this.gamepad){this.gamepad.stop()}this.moveCallbacks=[];PIXI.CanvasPool.remove(this);this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(t,e){this.customCandidateHandler=t;this.customCandidateHandlerContext=e},addMoveCallback:function(t,e){this.moveCallbacks.push({callback:t,context:e})},deleteMoveCallback:function(t,e){var i=this.moveCallbacks.length;while(i--){if(this.moveCallbacks[i].callback===t&&this.moveCallbacks[i].context===e){this.moveCallbacks.splice(i,1);return}}},addPointer:function(){if(this.pointers.length>=s.Input.MAX_POINTERS){console.warn("Phaser.Input.addPointer: Maximum limit of "+s.Input.MAX_POINTERS+" pointers reached.");return null}var t=this.pointers.length+1;var e=new s.Pointer(this.game,t,s.PointerMode.TOUCH);this.pointers.push(e);this["pointer"+t]=e;return e},update:function(){if(this.keyboard){this.keyboard.update()}if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad&&this.gamepad.active){this.gamepad.update()}for(var t=0;t<this.pointers.length;t++){this.pointers[t].update()}this._pollCounter=0},reset:function(t){if(!this.game.isBooted||this.resetLocked){return}if(t===undefined){t=false}this.mousePointer.reset();if(this.keyboard){this.keyboard.reset(t)}if(this.gamepad){this.gamepad.reset()}for(var e=0;e<this.pointers.length;e++){this.pointers[e].reset()}if(this.game.canvas.style.cursor!=="none"){this.game.canvas.style.cursor="inherit"}if(t){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new s.Signal;this.onUp=new s.Signal;this.onTap=new s.Signal;this.onHold=new s.Signal;this.moveCallbacks=[]}this._pollCounter=0},resetSpeed:function(t,e){this._oldPosition.setTo(t,e);this.speed.setTo(0,0)},startPointer:function(t){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers){return null}if(!this.pointer1.active){return this.pointer1.start(t)}if(!this.pointer2.active){return this.pointer2.start(t)}for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(!i.active){return i.start(t)}}return null},updatePointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier){return this.pointer1.move(t)}if(this.pointer2.active&&this.pointer2.identifier===t.identifier){return this.pointer2.move(t)}for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier){return i.move(t)}}return null},stopPointer:function(t){if(this.pointer1.active&&this.pointer1.identifier===t.identifier){return this.pointer1.stop(t)}if(this.pointer2.active&&this.pointer2.identifier===t.identifier){return this.pointer2.stop(t)}for(var e=2;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active&&i.identifier===t.identifier){return i.stop(t)}}return null},countActivePointers:function(t){if(t===undefined){t=this.pointers.length}var e=t;for(var i=0;i<this.pointers.length&&e>0;i++){var r=this.pointers[i];if(r.active){e--}}return t-e},getPointer:function(t){if(t===undefined){t=false}for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.active===t){return i}}return null},getPointerFromIdentifier:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.identifier===t){return i}}return null},getPointerFromId:function(t){for(var e=0;e<this.pointers.length;e++){var i=this.pointers[e];if(i.pointerId===t){return i}}return null},getLocalPosition:function(t,e,i){if(i===undefined){i=new s.Point}var r=t.worldTransform;var n=1/(r.a*r.d+r.c*-r.b);return i.setTo(r.d*n*e.x+-r.c*n*e.y+(r.ty*r.c-r.tx*r.d)*n,r.a*n*e.y+-r.b*n*e.x+(-r.ty*r.a+r.tx*r.b)*n)},hitTest:function(t,e,i){if(!t.worldVisible){return false}this.getLocalPosition(t,e,this._localPoint);i.copyFrom(this._localPoint);if(t.hitArea&&t.hitArea.contains){return t.hitArea.contains(this._localPoint.x,this._localPoint.y)}else if(t instanceof s.TileSprite){var r=t.width;var n=t.height;var a=-r*t.anchor.x;if(this._localPoint.x>=a&&this._localPoint.x<a+r){var o=-n*t.anchor.y;if(this._localPoint.y>=o&&this._localPoint.y<o+n){return true}}}else if(t instanceof PIXI.Sprite){var r=t.texture.frame.width;var n=t.texture.frame.height;var a=-r*t.anchor.x;if(this._localPoint.x>=a&&this._localPoint.x<a+r){var o=-n*t.anchor.y;if(this._localPoint.y>=o&&this._localPoint.y<o+n){return true}}}else if(t instanceof s.Graphics){for(var h=0;h<t.graphicsData.length;h++){var l=t.graphicsData[h];if(!l.fill){continue}if(l.shape&&l.shape.contains(this._localPoint.x,this._localPoint.y)){return true}}}for(var h=0;h<t.children.length;h++){if(this.hitTest(t.children[h],e,i)){return true}}return false},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};s.Input.prototype.constructor=s.Input;Object.defineProperty(s.Input.prototype,"x",{get:function(){return this._x},set:function(t){this._x=Math.floor(t)}});Object.defineProperty(s.Input.prototype,"y",{get:function(){return this._y},set:function(t){this._y=Math.floor(t)}});Object.defineProperty(s.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}});Object.defineProperty(s.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});Object.defineProperty(s.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(s.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(s.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Mouse=function(t){this.game=t;this.input=t.input;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=false;this.button=-1;this.wheelDelta=0;this.enabled=true;this.locked=false;this.stopOnGameOut=false;this.pointerLock=new s.Signal;this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null;this._wheelEvent=null};s.Mouse.NO_BUTTON=-1;s.Mouse.LEFT_BUTTON=0;s.Mouse.MIDDLE_BUTTON=1;s.Mouse.RIGHT_BUTTON=2;s.Mouse.BACK_BUTTON=3;s.Mouse.FORWARD_BUTTON=4;s.Mouse.WHEEL_UP=1;s.Mouse.WHEEL_DOWN=-1;s.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===false){return}if(this._onMouseDown!==null){return}var t=this;this._onMouseDown=function(e){return t.onMouseDown(e)};this._onMouseMove=function(e){return t.onMouseMove(e)};this._onMouseUp=function(e){return t.onMouseUp(e)};this._onMouseUpGlobal=function(e){return t.onMouseUpGlobal(e)};this._onMouseOutGlobal=function(e){return t.onMouseOutGlobal(e)};this._onMouseOut=function(e){return t.onMouseOut(e)};this._onMouseOver=function(e){return t.onMouseOver(e)};this._onMouseWheel=function(e){return t.onMouseWheel(e)};var e=this.game.canvas;e.addEventListener("mousedown",this._onMouseDown,true);e.addEventListener("mousemove",this._onMouseMove,true);e.addEventListener("mouseup",this._onMouseUp,true);if(!this.game.device.cocoonJS){window.addEventListener("mouseup",this._onMouseUpGlobal,true);window.addEventListener("mouseout",this._onMouseOutGlobal,true);e.addEventListener("mouseover",this._onMouseOver,true);e.addEventListener("mouseout",this._onMouseOut,true)}var i=this.game.device.wheelEvent;if(i){e.addEventListener(i,this._onMouseWheel,true);if(i==="mousewheel"){this._wheelEvent=new a(-1/40,1)}else if(i==="DOMMouseScroll"){this._wheelEvent=new a(1,1)}}},onMouseDown:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t["identifier"]=0;this.input.mousePointer.start(t)},onMouseMove:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t["identifier"]=0;this.input.mousePointer.move(t)},onMouseUp:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t["identifier"]=0;this.input.mousePointer.stop(t)},onMouseUpGlobal:function(t){if(!this.input.mousePointer.withinGame){if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,t)}t["identifier"]=0;this.input.mousePointer.stop(t)}},onMouseOutGlobal:function(t){this.event=t;if(this.capture){t.preventDefault()}this.input.mousePointer.withinGame=false;if(!this.input.enabled||!this.enabled){return}this.input.mousePointer.stop(t);this.input.mousePointer.leftButton.stop(t);this.input.mousePointer.rightButton.stop(t)},onMouseOut:function(t){this.event=t;if(this.capture){t.preventDefault()}this.input.mousePointer.withinGame=false;if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}if(this.stopOnGameOut){t["identifier"]=0;this.input.mousePointer.stop(t)}},onMouseOver:function(t){this.event=t;if(this.capture){t.preventDefault()}this.input.mousePointer.withinGame=true;if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,t)}},onMouseWheel:function(t){if(this._wheelEvent){t=this._wheelEvent.bindEvent(t)}this.event=t;if(this.capture){t.preventDefault()}this.wheelDelta=s.Math.clamp(-t.deltaY,-1,1);if(this.mouseWheelCallback){this.mouseWheelCallback.call(this.callbackContext,t)}},requestPointerLock:function(){if(this.game.device.pointerLock){var t=this.game.canvas;t.requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock;t.requestPointerLock();var e=this;this._pointerLockChange=function(t){return e.pointerLockChange(t)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(t){var e=this.game.canvas;if(document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e){this.locked=true;this.pointerLock.dispatch(true,t)}else{this.locked=false;this.pointerLock.dispatch(false,t)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){var t=this.game.canvas;t.removeEventListener("mousedown",this._onMouseDown,true);t.removeEventListener("mousemove",this._onMouseMove,true);t.removeEventListener("mouseup",this._onMouseUp,true);t.removeEventListener("mouseover",this._onMouseOver,true);t.removeEventListener("mouseout",this._onMouseOut,true);var e=this.game.device.wheelEvent;if(e){t.removeEventListener(e,this._onMouseWheel,true)}window.removeEventListener("mouseup",this._onMouseUpGlobal,true);window.removeEventListener("mouseout",this._onMouseOutGlobal,true);document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)}};s.Mouse.prototype.constructor=s.Mouse;function a(t,e){this._scaleFactor=t;this._deltaMode=e;this.originalEvent=null}a.prototype={};a.prototype.constructor=a;a.prototype.bindEvent=function(t){if(!a._stubsGenerated&&t){var e=function(t){return function(){var e=this.originalEvent[t];return typeof e!=="function"?e:e.bind(this.originalEvent)}};for(var i in t){if(!(i in a.prototype)){Object.defineProperty(a.prototype,i,{get:e(i)})}}a._stubsGenerated=true}this.originalEvent=t;return this};Object.defineProperties(a.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.MSPointer=function(t){this.game=t;this.input=t.input;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.capture=true;this.button=-1;this.event=null;this.enabled=true;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null;this._onMSPointerUpGlobal=null;this._onMSPointerOut=null;this._onMSPointerOver=null};s.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null){return}var t=this;if(this.game.device.mspointer){this._onMSPointerDown=function(e){return t.onPointerDown(e)};this._onMSPointerMove=function(e){return t.onPointerMove(e)};this._onMSPointerUp=function(e){return t.onPointerUp(e)};this._onMSPointerUpGlobal=function(e){return t.onPointerUpGlobal(e)};this._onMSPointerOut=function(e){return t.onPointerOut(e)};this._onMSPointerOver=function(e){return t.onPointerOver(e)};var e=this.game.canvas;e.addEventListener("MSPointerDown",this._onMSPointerDown,false);e.addEventListener("MSPointerMove",this._onMSPointerMove,false);e.addEventListener("MSPointerUp",this._onMSPointerUp,false);e.addEventListener("pointerdown",this._onMSPointerDown,false);e.addEventListener("pointermove",this._onMSPointerMove,false);e.addEventListener("pointerup",this._onMSPointerUp,false);e.style["-ms-content-zooming"]="none";e.style["-ms-touch-action"]="none";if(!this.game.device.cocoonJS){window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,true);e.addEventListener("MSPointerOver",this._onMSPointerOver,true);e.addEventListener("MSPointerOut",this._onMSPointerOut,true);window.addEventListener("pointerup",this._onMSPointerUpGlobal,true);e.addEventListener("pointerover",this._onMSPointerOver,true);e.addEventListener("pointerout",this._onMSPointerOut,true)}}},onPointerDown:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.pointerDownCallback){this.pointerDownCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t.identifier=t.pointerId;if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.start(t)}else{this.input.startPointer(t)}},onPointerMove:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.pointerMoveCallback){this.pointerMoveCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t.identifier=t.pointerId;if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.move(t)}else{this.input.updatePointer(t)}},onPointerUp:function(t){this.event=t;if(this.capture){t.preventDefault()}if(this.pointerUpCallback){this.pointerUpCallback.call(this.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}t.identifier=t.pointerId;if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.stop(t)}else{this.input.stopPointer(t)}},onPointerUpGlobal:function(t){if((t.pointerType==="mouse"||t.pointerType===4)&&!this.input.mousePointer.withinGame){this.onPointerUp(t)}else{var e=this.input.getPointerFromIdentifier(t.identifier);if(e&&e.withinGame){this.onPointerUp(t)}}},onPointerOut:function(t){this.event=t;if(this.capture){t.preventDefault()}if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.withinGame=false}else{var e=this.input.getPointerFromIdentifier(t.identifier);if(e){e.withinGame=false}}if(this.input.mouse.mouseOutCallback){this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,t)}if(!this.input.enabled||!this.enabled){return}if(this.input.mouse.stopOnGameOut){t["identifier"]=0;if(e){e.stop(t)}else{this.input.mousePointer.stop(t)}}},onPointerOver:function(t){this.event=t;if(this.capture){t.preventDefault()}if(t.pointerType==="mouse"||t.pointerType===4){this.input.mousePointer.withinGame=true}else{var e=this.input.getPointerFromIdentifier(t.identifier);if(e){e.withinGame=true}}if(this.input.mouse.mouseOverCallback){this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,t)}},stop:function(){var t=this.game.canvas;t.removeEventListener("MSPointerDown",this._onMSPointerDown,false);t.removeEventListener("MSPointerMove",this._onMSPointerMove,false);t.removeEventListener("MSPointerUp",this._onMSPointerUp,false);t.removeEventListener("pointerdown",this._onMSPointerDown,false);t.removeEventListener("pointermove",this._onMSPointerMove,false);t.removeEventListener("pointerup",this._onMSPointerUp,false);window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,true);t.removeEventListener("MSPointerOver",this._onMSPointerOver,true);t.removeEventListener("MSPointerOut",this._onMSPointerOut,true);window.removeEventListener("pointerup",this._onMSPointerUpGlobal,true);t.removeEventListener("pointerover",this._onMSPointerOver,true);t.removeEventListener("pointerout",this._onMSPointerOut,true)}};s.MSPointer.prototype.constructor=s.MSPointer;/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.DeviceButton=function(t,e){this.parent=t;this.game=t.game;this.event=null;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false;this.value=0;this.buttonCode=e;this.onDown=new s.Signal;this.onUp=new s.Signal;this.onFloat=new s.Signal};s.DeviceButton.prototype={start:function(t,e){if(this.isDown){return}this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.repeats=0;this.event=t;this.value=e;if(t){this.altKey=t.altKey;this.shiftKey=t.shiftKey;this.ctrlKey=t.ctrlKey}this.onDown.dispatch(this,e)},stop:function(t,e){if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.event=t;this.value=e;if(t){this.altKey=t.altKey;this.shiftKey=t.shiftKey;this.ctrlKey=t.ctrlKey}this.onUp.dispatch(this,e)},padFloat:function(t){this.value=t;this.onFloat.dispatch(this,t)},justPressed:function(t){t=t||250;return this.isDown&&this.timeDown+t>this.game.time.time},justReleased:function(t){t=t||250;return this.isUp&&this.timeUp+t>this.game.time.time},reset:function(){this.isDown=false;this.isUp=true;this.timeDown=this.game.time.time;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.parent=null;this.game=null}};s.DeviceButton.prototype.constructor=s.DeviceButton;Object.defineProperty(s.DeviceButton.prototype,"duration",{get:function(){if(this.isUp){return-1}return this.game.time.time-this.timeDown}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Pointer=function(t,e,i){this.game=t;this.id=e;this.type=s.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.pointerMode=i||s.PointerMode.CURSOR|s.PointerMode.CONTACT;this.target=null;this.button=null;this.leftButton=new s.DeviceButton(this,s.Pointer.LEFT_BUTTON);this.middleButton=new s.DeviceButton(this,s.Pointer.MIDDLE_BUTTON);this.rightButton=new s.DeviceButton(this,s.Pointer.RIGHT_BUTTON);this.backButton=new s.DeviceButton(this,s.Pointer.BACK_BUTTON);this.forwardButton=new s.DeviceButton(this,s.Pointer.FORWARD_BUTTON);this.eraserButton=new s.DeviceButton(this,s.Pointer.ERASER_BUTTON);this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=e===0;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.interactiveCandidates=[];this.active=false;this.dirty=false;this.position=new s.Point;this.positionDown=new s.Point;this.positionUp=new s.Point;this.circle=new s.Circle(0,0,44);this._clickTrampolines=null;this._trampolineTargetObject=null};s.Pointer.NO_BUTTON=0;s.Pointer.LEFT_BUTTON=1;s.Pointer.RIGHT_BUTTON=2;s.Pointer.MIDDLE_BUTTON=4;s.Pointer.BACK_BUTTON=8;s.Pointer.FORWARD_BUTTON=16;s.Pointer.ERASER_BUTTON=32;s.Pointer.prototype={resetButtons:function(){this.isDown=false;this.isUp=true;if(this.isMouse){this.leftButton.reset();this.middleButton.reset();this.rightButton.reset();this.backButton.reset();this.forwardButton.reset();this.eraserButton.reset()}},processButtonsDown:function(t,e){if(s.Pointer.LEFT_BUTTON&t){this.leftButton.start(e)}if(s.Pointer.RIGHT_BUTTON&t){this.rightButton.start(e)}if(s.Pointer.MIDDLE_BUTTON&t){this.middleButton.start(e)}if(s.Pointer.BACK_BUTTON&t){this.backButton.start(e)}if(s.Pointer.FORWARD_BUTTON&t){this.forwardButton.start(e)}if(s.Pointer.ERASER_BUTTON&t){this.eraserButton.start(e)}},processButtonsUp:function(t,e){if(t===s.Mouse.LEFT_BUTTON){this.leftButton.stop(e)}if(t===s.Mouse.RIGHT_BUTTON){this.rightButton.stop(e)}if(t===s.Mouse.MIDDLE_BUTTON){this.middleButton.stop(e)}if(t===s.Mouse.BACK_BUTTON){this.backButton.stop(e)}if(t===s.Mouse.FORWARD_BUTTON){this.forwardButton.stop(e)}if(t===5){this.eraserButton.stop(e)}},updateButtons:function(t){this.button=t.button;var e=t.type.toLowerCase().substr(-4)==="down";if(t.buttons!==undefined){if(e){this.processButtonsDown(t.buttons,t)}else{this.processButtonsUp(t.button,t)}}else{if(e){this.leftButton.start(t)}else{this.leftButton.stop(t);this.rightButton.stop(t)}}if(t.buttons===1&&t.ctrlKey&&this.leftButton.isDown){this.leftButton.stop(t);this.rightButton.start(t)}this.isUp=true;this.isDown=false;if(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown){this.isUp=false;this.isDown=true}},start:function(t){var e=this.game.input;if(t["pointerId"]){this.pointerId=t.pointerId}this.identifier=t.identifier;this.target=t.target;if(this.isMouse){this.updateButtons(t)}else{this.isDown=true;this.isUp=false}this.active=true;this.withinGame=true;this.dirty=false;this._history=[];this._clickTrampolines=null;this._trampolineTargetObject=null;this.msSinceLastClick=this.game.time.time-this.timeDown;this.timeDown=this.game.time.time;this._holdSent=false;this.move(t,true);this.positionDown.setTo(this.x,this.y);if(e.multiInputOverride===s.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===s.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===s.Input.TOUCH_OVERRIDES_MOUSE&&e.totalActivePointers===0){e.x=this.x;e.y=this.y;e.position.setTo(this.x,this.y);e.onDown.dispatch(this,t);e.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){var t=this.game.input;if(this.active){if(this.dirty){if(t.interactiveItems.total>0){this.processInteractiveObjects(false)}this.dirty=false}if(this._holdSent===false&&this.duration>=t.holdRate){if(t.multiInputOverride===s.Input.MOUSE_OVERRIDES_TOUCH||t.multiInputOverride===s.Input.MOUSE_TOUCH_COMBINE||t.multiInputOverride===s.Input.TOUCH_OVERRIDES_MOUSE&&t.totalActivePointers===0){t.onHold.dispatch(this)}this._holdSent=true}if(t.recordPointerHistory&&this.game.time.time>=this._nextDrop){this._nextDrop=this.game.time.time+t.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>t.recordLimit){this._history.shift()}}}},move:function(t,e){var i=this.game.input;if(i.pollLocked){return}if(e===undefined){e=false}if(t.button!==undefined){this.button=t.button}if(e&&this.isMouse){this.updateButtons(t)}this.clientX=t.clientX;this.clientY=t.clientY;this.pageX=t.pageX;this.pageY=t.pageY;this.screenX=t.screenX;this.screenY=t.screenY;if(this.isMouse&&i.mouse.locked&&!e){this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0;this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY}this.x=(this.pageX-this.game.scale.offset.x)*i.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*i.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(i.multiInputOverride===s.Input.MOUSE_OVERRIDES_TOUCH||i.multiInputOverride===s.Input.MOUSE_TOUCH_COMBINE||i.multiInputOverride===s.Input.TOUCH_OVERRIDES_MOUSE&&i.totalActivePointers===0){i.activePointer=this;i.x=this.x;i.y=this.y;i.position.setTo(i.x,i.y);i.circle.x=i.x;i.circle.y=i.y}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused){return this}var r=i.moveCallbacks.length;while(r--){i.moveCallbacks[r].callback.call(i.moveCallbacks[r].context,this,this.x,this.y,e)}if(this.targetObject!==null&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}}else if(i.interactiveItems.total>0){this.processInteractiveObjects(e)}return this},processInteractiveObjects:function(t){var e=0;var i=-1;var r=null;var s=this.game.input.interactiveItems.first;this.interactiveCandidates=[];while(s){s.checked=false;if(s.validForInput(i,e,false)){s.checked=true;if(t&&s.checkPointerDown(this,true)||!t&&s.checkPointerOver(this,true)){e=s.sprite.renderOrderID;i=s.priorityID;r=s;this.interactiveCandidates.push(s)}}s=this.game.input.interactiveItems.next}s=this.game.input.interactiveItems.first;while(s){if(!s.checked&&s.validForInput(i,e,true)){if(t&&s.checkPointerDown(this,false)||!t&&s.checkPointerOver(this,false)){e=s.sprite.renderOrderID;i=s.priorityID;r=s;this.interactiveCandidates.push(s)}}s=this.game.input.interactiveItems.next}if(this.game.input.customCandidateHandler){r=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,r)}this.swapTarget(r,false);return this.targetObject!==null},swapTarget:function(t,e){if(e===undefined){e=false}if(t===null){if(this.targetObject){this.targetObject._pointerOutHandler(this,e);this.targetObject=null}}else{if(this.targetObject===null){this.targetObject=t;t._pointerOverHandler(this,e)}else{if(this.targetObject===t){if(t.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this,e);this.targetObject=t;this.targetObject._pointerOverHandler(this,e)}}}},leave:function(t){this.withinGame=false;this.move(t,false)},stop:function(t){var e=this.game.input;if(this._stateReset&&this.withinGame){t.preventDefault();return}this.timeUp=this.game.time.time;if(e.multiInputOverride===s.Input.MOUSE_OVERRIDES_TOUCH||e.multiInputOverride===s.Input.MOUSE_TOUCH_COMBINE||e.multiInputOverride===s.Input.TOUCH_OVERRIDES_MOUSE&&e.totalActivePointers===0){e.onUp.dispatch(this,t);if(this.duration>=0&&this.duration<=e.tapRate){if(this.timeUp-this.previousTapTime<e.doubleTapRate){e.onTap.dispatch(this,true)}else{e.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.isMouse){this.updateButtons(t)}else{this.isDown=false;this.isUp=true}if(this.id>0){this.active=false}this.withinGame=this.game.scale.bounds.contains(t.pageX,t.pageY);this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){e.currentPointers--}e.interactiveItems.callAll("_releasedHandler",this);if(this._clickTrampolines){this._trampolineTargetObject=this.targetObject}this.targetObject=null;return this},justPressed:function(t){t=t||this.game.input.justPressedRate;return this.isDown===true&&this.timeDown+t>this.game.time.time},justReleased:function(t){t=t||this.game.input.justReleasedRate;return this.isUp&&this.timeUp+t>this.game.time.time},addClickTrampoline:function(t,e,i,r){if(!this.isDown){return}var s=this._clickTrampolines=this._clickTrampolines||[];for(var n=0;n<s.length;n++){if(s[n].name===t){s.splice(n,1);break}}s.push({name:t,targetObject:this.targetObject,callback:e,callbackContext:i,callbackArgs:r})},processClickTrampolines:function(){var t=this._clickTrampolines;if(!t){return}for(var e=0;e<t.length;e++){var i=t[e];if(i.targetObject===this._trampolineTargetObject){i.callback.apply(i.callbackContext,i.callbackArgs)}}this._clickTrampolines=null;this._trampolineTargetObject=null},reset:function(){if(this.isMouse===false){this.active=false}this.pointerId=null;this.identifier=null;this.dirty=false;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;this.resetButtons();if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};s.Pointer.prototype.constructor=s.Pointer;Object.defineProperty(s.Pointer.prototype,"duration",{get:function(){if(this.isUp){return-1}return this.game.time.time-this.timeDown}});Object.defineProperty(s.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(s.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});s.PointerMode={CURSOR:1<<0,CONTACT:1<<1};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Touch=function(t){this.game=t;this.enabled=true;this.touchLockCallbacks=[];this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};s.Touch.prototype={start:function(){if(this._onTouchStart!==null){return}var t=this;if(this.game.device.touch){this._onTouchStart=function(e){return t.onTouchStart(e)};this._onTouchMove=function(e){return t.onTouchMove(e)};this._onTouchEnd=function(e){return t.onTouchEnd(e)};this._onTouchEnter=function(e){return t.onTouchEnter(e)};this._onTouchLeave=function(e){return t.onTouchLeave(e)};this._onTouchCancel=function(e){return t.onTouchCancel(e)};this.game.canvas.addEventListener("touchstart",this._onTouchStart,false);this.game.canvas.addEventListener("touchmove",this._onTouchMove,false);this.game.canvas.addEventListener("touchend",this._onTouchEnd,false);this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,false);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener("touchenter",this._onTouchEnter,false);this.game.canvas.addEventListener("touchleave",this._onTouchLeave,false)}}},consumeDocumentTouches:function(){this._documentTouchMove=function(t){t.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},addTouchLockCallback:function(t,e,i){if(i===undefined){i=false}this.touchLockCallbacks.push({callback:t,context:e,onEnd:i})},removeTouchLockCallback:function(t,e){var i=this.touchLockCallbacks.length;while(i--){if(this.touchLockCallbacks[i].callback===t&&this.touchLockCallbacks[i].context===e){this.touchLockCallbacks.splice(i,1);return true}}return false},onTouchStart:function(t){var e=this.touchLockCallbacks.length;while(e--){var i=this.touchLockCallbacks[e];if(!i.onEnd&&i.callback.call(i.context,this,t)){this.touchLockCallbacks.splice(e,1)}}this.event=t;if(!this.game.input.enabled||!this.enabled){return}if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.startPointer(t.changedTouches[e])}},onTouchCancel:function(t){this.event=t;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.stopPointer(t.changedTouches[e])}},onTouchEnter:function(t){this.event=t;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,t)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){t.preventDefault()}},onTouchLeave:function(t){this.event=t;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}},onTouchMove:function(t){this.event=t;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.updatePointer(t.changedTouches[e])}},onTouchEnd:function(t){var e=this.touchLockCallbacks.length;while(e--){var i=this.touchLockCallbacks[e];if(i.onEnd&&i.callback.call(i.context,this,t)){this.touchLockCallbacks.splice(e,1)}}this.event=t;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,t)}if(this.preventDefault){t.preventDefault()}for(var e=0;e<t.changedTouches.length;e++){this.game.input.stopPointer(t.changedTouches[e])}},stop:function(){if(this.game.device.touch){this.game.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};s.Touch.prototype.constructor=s.Touch;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.InputHandler=function(t){this.sprite=t;this.game=t.game;this.enabled=false;this.checked=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.scaleLayer=false;this.dragOffset=new s.Point;this.dragFromCenter=false;this.dragStopBlocksInputUp=false;this.dragStartPoint=new s.Point;this.dragDistanceThreshold=0;this.dragTimeThreshold=0;this.downPoint=new s.Point;this.snapPoint=new s.Point;this._dragPoint=new s.Point;this._dragPhase=false;this._pendingDrag=false;this._dragTimePass=false;this._dragDistancePass=false;this._wasEnabled=false;this._tempPoint=new s.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};s.InputHandler.prototype={start:function(t,e){t=t||0;if(e===undefined){e=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=e;this.priorityID=t;for(var i=0;i<10;i++){this._pointerData[i]={id:i,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new s.Point;this.enabled=true;this._wasEnabled=true}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);return this.sprite},addedToGroup:function(){if(this._dragPhase){return}if(this._wasEnabled&&!this.enabled){this.start()}},removedFromGroup:function(){if(this._dragPhase){return}if(this.enabled){this._wasEnabled=true;this.stop()}else{this._wasEnabled=false}},reset:function(){this.enabled=false;for(var t=0;t<10;t++){this._pointerData[t]={id:t,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null}},validForInput:function(t,e,i){if(i===undefined){i=true}if(!this.enabled||this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID||this.sprite.parent&&this.sprite.parent.ignoreChildInput){return false}if(!i&&(this.pixelPerfectClick||this.pixelPerfectOver)){return false}if(this.priorityID>t||this.priorityID===t&&this.sprite.renderOrderID>e){return true}return false},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(t){t=t||0;return this._pointerData[t].x},pointerY:function(t){t=t||0;return this._pointerData[t].y},pointerDown:function(t){t=t||0;return this._pointerData[t].isDown},pointerUp:function(t){t=t||0;return this._pointerData[t].isUp},pointerTimeDown:function(t){t=t||0;return this._pointerData[t].timeDown},pointerTimeUp:function(t){t=t||0;return this._pointerData[t].timeUp},pointerOver:function(t){if(!this.enabled){return false}if(t===undefined){for(var e=0;e<10;e++){if(this._pointerData[e].isOver){return true}}return false}else{return this._pointerData[t].isOver}},pointerOut:function(t){if(!this.enabled){return false}if(t===undefined){for(var e=0;e<10;e++){if(this._pointerData[e].isOut){return true}}}else{return this._pointerData[t].isOut}},pointerTimeOver:function(t){t=t||0;return this._pointerData[t].timeOver},pointerTimeOut:function(t){t=t||0;return this._pointerData[t].timeOut},pointerDragged:function(t){t=t||0;return this._pointerData[t].isDragged},checkPointerDown:function(t,e){if(!t.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false}if(this.game.input.hitTest(this.sprite,t,this._tempPoint)){if(e===undefined){e=false}if(!e&&this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPointerOver:function(t,e){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false}if(this.game.input.hitTest(this.sprite,t,this._tempPoint)){if(e===undefined){e=false}if(!e&&this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPixel:function(t,e,i){if(this.sprite.texture.baseTexture.source){if(t===null&&e===null){this.game.input.getLocalPosition(this.sprite,i,this._tempPoint);var t=this._tempPoint.x;var e=this._tempPoint.y}if(this.sprite.anchor.x!==0){t-=-this.sprite.texture.frame.width*this.sprite.anchor.x}if(this.sprite.anchor.y!==0){e-=-this.sprite.texture.frame.height*this.sprite.anchor.y}t+=this.sprite.texture.frame.x;e+=this.sprite.texture.frame.y;if(this.sprite.texture.trim){t-=this.sprite.texture.trim.x;e-=this.sprite.texture.trim.y;if(t<this.sprite.texture.crop.x||t>this.sprite.texture.crop.right||e<this.sprite.texture.crop.y||e>this.sprite.texture.crop.bottom){this._dx=t;this._dy=e;return false}}this._dx=t;this._dy=e;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,t,e,1,1,0,0,1,1);var r=this.game.input.hitContext.getImageData(0,0,1,1);if(r.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(t){if(this.sprite===null||this.sprite.parent===undefined){return}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(t);return false}if(this._pendingDrag){if(!this._dragDistancePass){this._dragDistancePass=s.Math.distance(t.x,t.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold}if(this._dragDistancePass&&this._dragTimePass){this.startDrag(t)}return true}else if(this.draggable&&this._draggedPointerID===t.id){return this.updateDrag(t,false)}else if(this._pointerData[t.id].isOver){if(this.checkPointerOver(t)){this._pointerData[t.id].x=t.x-this.sprite.x;this._pointerData[t.id].y=t.y-this.sprite.y;return true}else{this._pointerOutHandler(t);return false}}},_pointerOverHandler:function(t,e){if(this.sprite===null){return}var i=this._pointerData[t.id];if(i.isOver===false||t.dirty){var r=i.isOver===false;i.isOver=true;i.isOut=false;i.timeOver=this.game.time.time;i.x=t.x-this.sprite.x;i.y=t.y-this.sprite.y;if(this.useHandCursor&&i.isDragged===false){this.game.canvas.style.cursor="pointer";this._setHandCursor=true}if(!e&&r&&this.sprite&&this.sprite.events){this.sprite.events.onInputOver$dispatch(this.sprite,t)}if(this.sprite.parent&&this.sprite.parent.type===s.GROUP){this.sprite.parent.onChildInputOver.dispatch(this.sprite,t)}}},_pointerOutHandler:function(t,e){if(this.sprite===null){return}var i=this._pointerData[t.id];i.isOver=false;i.isOut=true;i.timeOut=this.game.time.time;if(this.useHandCursor&&i.isDragged===false){this.game.canvas.style.cursor="default";this._setHandCursor=false}if(!e&&this.sprite&&this.sprite.events){this.sprite.events.onInputOut$dispatch(this.sprite,t);if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===s.GROUP){this.sprite.parent.onChildInputOut.dispatch(this.sprite,t)}}},_touchedHandler:function(t){if(this.sprite===null){return}var e=this._pointerData[t.id];if(!e.isDown&&e.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,t)){return}e.isDown=true;e.isUp=false;e.timeDown=this.game.time.time;this.downPoint.set(t.x,t.y);t.dirty=true;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown$dispatch(this.sprite,t);if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===s.GROUP){this.sprite.parent.onChildInputDown.dispatch(this.sprite,t)}if(this.sprite===null){return}}if(this.draggable&&this.isDragged===false){if(this.dragTimeThreshold===0&&this.dragDistanceThreshold===0){this.startDrag(t)}else{this._pendingDrag=true;this._dragDistancePass=this.dragDistanceThreshold===0;if(this.dragTimeThreshold>0){this._dragTimePass=false;this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,t)}else{this._dragTimePass=true}}}if(this.bringToTop){this.sprite.bringToTop()}}},dragTimeElapsed:function(t){this._dragTimePass=true;if(this._pendingDrag&&this.sprite){if(this._dragDistancePass){this.startDrag(t)}}},_releasedHandler:function(t){if(this.sprite===null){return}var e=this._pointerData[t.id];if(e.isDown&&t.isUp){e.isDown=false;e.isUp=true;e.timeUp=this.game.time.time;e.downDuration=e.timeUp-e.timeDown;var i=this.checkPointerOver(t);if(this.sprite&&this.sprite.events){if(!this.dragStopBlocksInputUp||this.dragStopBlocksInputUp&&!(this.draggable&&this.isDragged&&this._draggedPointerID===t.id)){this.sprite.events.onInputUp$dispatch(this.sprite,t,i)}if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===s.GROUP){this.sprite.parent.onChildInputUp.dispatch(this.sprite,t,i)}if(i){i=this.checkPointerOver(t)}}e.isOver=i;if(!i&&this.useHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}t.dirty=true;this._pendingDrag=false;if(this.draggable&&this.isDragged&&this._draggedPointerID===t.id){this.stopDrag(t)}}},updateDrag:function(t,e){if(e===undefined){e=false}if(t.isUp){this.stopDrag(t);return false}var i=this.globalToLocalX(t.x)+this._dragPoint.x+this.dragOffset.x;var r=this.globalToLocalY(t.y)+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera){if(this.allowHorizontalDrag){this.sprite.cameraOffset.x=i}if(this.allowVerticalDrag){this.sprite.cameraOffset.y=r}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY;this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y)}}else{var s=this.game.camera.x-this._pointerData[t.id].camX;var n=this.game.camera.y-this._pointerData[t.id].camY;if(this.allowHorizontalDrag){this.sprite.x=i+s}if(this.allowVerticalDrag){this.sprite.y=r+n}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY;this.snapPoint.set(this.sprite.x,this.sprite.y)}}this.sprite.events.onDragUpdate.dispatch(this.sprite,t,i,r,this.snapPoint,e);return true},justOver:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isOver&&this.overDuration(t)<e},justOut:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isOut&&this.game.time.time-this._pointerData[t].timeOut<e},justPressed:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isDown&&this.downDuration(t)<e},justReleased:function(t,e){t=t||0;e=e||500;return this._pointerData[t].isUp&&this.game.time.time-this._pointerData[t].timeUp<e},overDuration:function(t){t=t||0;if(this._pointerData[t].isOver){return this.game.time.time-this._pointerData[t].timeOver}return-1},downDuration:function(t){t=t||0;if(this._pointerData[t].isDown){return this.game.time.time-this._pointerData[t].timeDown}return-1},enableDrag:function(t,e,i,r,n,a){if(t===undefined){t=false}if(e===undefined){e=false}if(i===undefined){i=false}if(r===undefined){r=255}if(n===undefined){n=null}if(a===undefined){a=null}this._dragPoint=new s.Point;this.draggable=true;this.bringToTop=e;this.dragOffset=new s.Point;this.dragFromCenter=t;this.pixelPerfectClick=i;this.pixelPerfectAlpha=r;if(n){this.boundsRect=n}if(a){this.boundsSprite=a}},disableDrag:function(){if(this._pointerData){for(var t=0;t<10;t++){this._pointerData[t].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1;this._pendingDrag=false},startDrag:function(t){var e=this.sprite.x;var i=this.sprite.y;this.isDragged=true;this._draggedPointerID=t.id;this._pointerData[t.id].camX=this.game.camera.x;this._pointerData[t.id].camY=this.game.camera.y;this._pointerData[t.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){var r=this.sprite.getBounds();this.sprite.cameraOffset.x=this.globalToLocalX(t.x)+(this.sprite.cameraOffset.x-r.centerX);this.sprite.cameraOffset.y=this.globalToLocalY(t.y)+(this.sprite.cameraOffset.y-r.centerY)}this._dragPoint.setTo(this.sprite.cameraOffset.x-t.x,this.sprite.cameraOffset.y-t.y)}else{if(this.dragFromCenter){var r=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(t.x)+(this.sprite.x-r.centerX);this.sprite.y=this.globalToLocalY(t.y)+(this.sprite.y-r.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(t.x),this.sprite.y-this.globalToLocalY(t.y))}this.updateDrag(t,true);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop()}this.dragStartPoint.set(e,i);this.sprite.events.onDragStart$dispatch(this.sprite,t,e,i);this._pendingDrag=false},globalToLocalX:function(t){if(this.scaleLayer){t-=this.game.scale.grid.boundsFluid.x;t*=this.game.scale.grid.scaleFluidInversed.x}return t},globalToLocalY:function(t){if(this.scaleLayer){t-=this.game.scale.grid.boundsFluid.y;t*=this.game.scale.grid.scaleFluidInversed.y}return t},stopDrag:function(t){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[t.id].isDragged=false;this._dragPhase=false;this._pendingDrag=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY}else{this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX;this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY}}this.sprite.events.onDragStop$dispatch(this.sprite,t);if(this.checkPointerOver(t)===false){this._pointerOutHandler(t)}},setDragLock:function(t,e){if(t===undefined){t=true}if(e===undefined){e=true}this.allowHorizontalDrag=t;this.allowVerticalDrag=e},enableSnap:function(t,e,i,r,s,n){if(i===undefined){i=true}if(r===undefined){r=false}if(s===undefined){s=0}if(n===undefined){n=0}this.snapX=t;this.snapY=e;this.snapOffsetX=s;this.snapOffsetY=n;this.snapOnDrag=i;this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.left}else if(this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top}else if(this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height}}else{if(this.sprite.left<this.boundsRect.left){this.sprite.x=this.boundsRect.x+this.sprite.offsetX}else if(this.sprite.right>this.boundsRect.right){this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)}if(this.sprite.top<this.boundsRect.top){this.sprite.y=this.boundsRect.top+this.sprite.offsetY}else if(this.sprite.bottom>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x}else if(this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.cameraOffset.x+this.boundsSprite.width){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x+this.boundsSprite.width-this.sprite.width}if(this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y}else if(this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.cameraOffset.y+this.boundsSprite.height){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y+this.boundsSprite.height-this.sprite.height}}else{if(this.sprite.left<this.boundsSprite.left){this.sprite.x=this.boundsSprite.left+this.sprite.offsetX}else if(this.sprite.right>this.boundsSprite.right){this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)}if(this.sprite.top<this.boundsSprite.top){this.sprite.y=this.boundsSprite.top+this.sprite.offsetY}else if(this.sprite.bottom>this.boundsSprite.bottom){this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)}}}};s.InputHandler.prototype.constructor=s.InputHandler;/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Gamepad=function(t){this.game=t;this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.enabled=true;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||navigator.userAgent.indexOf("Firefox/")!==-1||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new s.SinglePad(t,this),new s.SinglePad(t,this),new s.SinglePad(t,this),new s.SinglePad(t,this)]};s.Gamepad.prototype={addCallbacks:function(t,e){if(typeof e!=="undefined"){this.onConnectCallback=typeof e.onConnect==="function"?e.onConnect:this.onConnectCallback;this.onDisconnectCallback=typeof e.onDisconnect==="function"?e.onDisconnect:this.onDisconnectCallback;this.onDownCallback=typeof e.onDown==="function"?e.onDown:this.onDownCallback;this.onUpCallback=typeof e.onUp==="function"?e.onUp:this.onUpCallback;this.onAxisCallback=typeof e.onAxis==="function"?e.onAxis:this.onAxisCallback;this.onFloatCallback=typeof e.onFloat==="function"?e.onFloat:this.onFloatCallback;this.callbackContext=t}},start:function(){if(this._active){return}this._active=true;var t=this;this._onGamepadConnected=function(e){return t.onGamepadConnected(e)};this._onGamepadDisconnected=function(e){return t.onGamepadDisconnected(e)};window.addEventListener("gamepadconnected",this._onGamepadConnected,false);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,false)},onGamepadConnected:function(t){var e=t.gamepad;this._rawPads.push(e);this._gamepads[e.index].connect(e)},onGamepadDisconnected:function(t){var e=t.gamepad;for(var i in this._rawPads){if(this._rawPads[i].index===e.index){this._rawPads.splice(i,1)}}this._gamepads[e.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(!this._active){return}if(navigator["getGamepads"]){var t=navigator.getGamepads()}else if(navigator["webkitGetGamepads"]){var t=navigator.webkitGetGamepads()}else if(navigator["webkitGamepads"]){var t=navigator.webkitGamepads()}if(t){this._rawPads=[];var e=false;for(var i=0;i<t.length;i++){if(typeof t[i]!==this._prevRawGamepadTypes[i]){e=true;this._prevRawGamepadTypes[i]=typeof t[i]}if(t[i]){this._rawPads.push(t[i])}if(i===3){break}}for(var r=0;r<this._gamepads.length;r++){this._gamepads[r]._rawPad=this._rawPads[r]}if(e){var s={rawIndices:{},padIndices:{}};var n;for(var a=0;a<this._gamepads.length;a++){n=this._gamepads[a];if(n.connected){for(var o=0;o<this._rawPads.length;o++){if(this._rawPads[o].index===n.index){s.rawIndices[n.index]=true;s.padIndices[a]=true}}}}for(var h=0;h<this._gamepads.length;h++){n=this._gamepads[h];if(s.padIndices[h]){continue}if(this._rawPads.length<1){n.disconnect()}for(var l=0;l<this._rawPads.length;l++){if(s.padIndices[h]){break}var u=this._rawPads[l];if(u){if(s.rawIndices[u.index]){n.disconnect();continue}else{n.connect(u);s.rawIndices[u.index]=true;s.padIndices[h]=true}}else{n.disconnect()}}}}}},setDeadZones:function(t){for(var e=0;e<this._gamepads.length;e++){this._gamepads[e].deadZone=t}},stop:function(){this._active=false;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var t=0;t<this._gamepads.length;t++){this._gamepads[t].reset()}},justPressed:function(t,e){for(var i=0;i<this._gamepads.length;i++){if(this._gamepads[i].justPressed(t,e)===true){return true}}return false},justReleased:function(t,e){for(var i=0;i<this._gamepads.length;i++){if(this._gamepads[i].justReleased(t,e)===true){return true}}return false},isDown:function(t){for(var e=0;e<this._gamepads.length;e++){if(this._gamepads[e].isDown(t)===true){return true}}return false},destroy:function(){this.stop();for(var t=0;t<this._gamepads.length;t++){this._gamepads[t].destroy()}}};s.Gamepad.prototype.constructor=s.Gamepad;Object.defineProperty(s.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(s.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(s.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(s.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(s.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(s.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(s.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});s.Gamepad.BUTTON_0=0;s.Gamepad.BUTTON_1=1;s.Gamepad.BUTTON_2=2;s.Gamepad.BUTTON_3=3;s.Gamepad.BUTTON_4=4;s.Gamepad.BUTTON_5=5;s.Gamepad.BUTTON_6=6;s.Gamepad.BUTTON_7=7;s.Gamepad.BUTTON_8=8;s.Gamepad.BUTTON_9=9;s.Gamepad.BUTTON_10=10;s.Gamepad.BUTTON_11=11;s.Gamepad.BUTTON_12=12;s.Gamepad.BUTTON_13=13;s.Gamepad.BUTTON_14=14;s.Gamepad.BUTTON_15=15;s.Gamepad.AXIS_0=0;s.Gamepad.AXIS_1=1;s.Gamepad.AXIS_2=2;s.Gamepad.AXIS_3=3;s.Gamepad.AXIS_4=4;s.Gamepad.AXIS_5=5;s.Gamepad.AXIS_6=6;s.Gamepad.AXIS_7=7;s.Gamepad.AXIS_8=8;s.Gamepad.AXIS_9=9;s.Gamepad.XBOX360_A=0;s.Gamepad.XBOX360_B=1;s.Gamepad.XBOX360_X=2;s.Gamepad.XBOX360_Y=3;s.Gamepad.XBOX360_LEFT_BUMPER=4;s.Gamepad.XBOX360_RIGHT_BUMPER=5;s.Gamepad.XBOX360_LEFT_TRIGGER=6;s.Gamepad.XBOX360_RIGHT_TRIGGER=7;s.Gamepad.XBOX360_BACK=8;s.Gamepad.XBOX360_START=9;s.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;s.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;s.Gamepad.XBOX360_DPAD_LEFT=14;s.Gamepad.XBOX360_DPAD_RIGHT=15;s.Gamepad.XBOX360_DPAD_UP=12;s.Gamepad.XBOX360_DPAD_DOWN=13;s.Gamepad.XBOX360_STICK_LEFT_X=0;s.Gamepad.XBOX360_STICK_LEFT_Y=1;s.Gamepad.XBOX360_STICK_RIGHT_X=2;s.Gamepad.XBOX360_STICK_RIGHT_Y=3;s.Gamepad.PS3XC_X=0;s.Gamepad.PS3XC_CIRCLE=1;s.Gamepad.PS3XC_SQUARE=2;s.Gamepad.PS3XC_TRIANGLE=3;s.Gamepad.PS3XC_L1=4;s.Gamepad.PS3XC_R1=5;s.Gamepad.PS3XC_L2=6;s.Gamepad.PS3XC_R2=7;s.Gamepad.PS3XC_SELECT=8;s.Gamepad.PS3XC_START=9;s.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;s.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;s.Gamepad.PS3XC_DPAD_UP=12;s.Gamepad.PS3XC_DPAD_DOWN=13;s.Gamepad.PS3XC_DPAD_LEFT=14;s.Gamepad.PS3XC_DPAD_RIGHT=15;s.Gamepad.PS3XC_STICK_LEFT_X=0;s.Gamepad.PS3XC_STICK_LEFT_Y=1;s.Gamepad.PS3XC_STICK_RIGHT_X=2;s.Gamepad.PS3XC_STICK_RIGHT_Y=3;/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.SinglePad=function(t,e){this.game=t;this.index=null;this.connected=false;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=.26;this._padParent=e;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};s.SinglePad.prototype={addCallbacks:function(t,e){if(typeof e!=="undefined"){this.onConnectCallback=typeof e.onConnect==="function"?e.onConnect:this.onConnectCallback;this.onDisconnectCallback=typeof e.onDisconnect==="function"?e.onDisconnect:this.onDisconnectCallback;this.onDownCallback=typeof e.onDown==="function"?e.onDown:this.onDownCallback;this.onUpCallback=typeof e.onUp==="function"?e.onUp:this.onUpCallback;this.onAxisCallback=typeof e.onAxis==="function"?e.onAxis:this.onAxisCallback;this.onFloatCallback=typeof e.onFloat==="function"?e.onFloat:this.onFloatCallback;this.callbackContext=t}},getButton:function(t){if(this._buttons[t]){return this._buttons[t]}else{return null}},pollStatus:function(){if(!this.connected||!this.game.input.enabled||!this.game.input.gamepad.enabled||this._rawPad.timestamp&&this._rawPad.timestamp===this._prevTimestamp){return}for(var t=0;t<this._buttonsLen;t++){var e=isNaN(this._rawPad.buttons[t])?this._rawPad.buttons[t].value:this._rawPad.buttons[t];if(e!==this._buttons[t].value){if(e===1){this.processButtonDown(t,e)}else if(e===0){this.processButtonUp(t,e)}else{this.processButtonFloat(t,e)}}}for(var i=0;i<this._axesLen;i++){var r=this._rawPad.axes[i];if(r>0&&r>this.deadZone||r<0&&r<-this.deadZone){this.processAxisChange(i,r)}else{this.processAxisChange(i,0)}}this._prevTimestamp=this._rawPad.timestamp},connect:function(t){var e=!this.connected;this.connected=true;this.index=t.index;this._rawPad=t;this._buttons=[];this._buttonsLen=t.buttons.length;this._axes=[];this._axesLen=t.axes.length;for(var i=0;i<this._axesLen;i++){this._axes[i]=t.axes[i]}for(var r in t.buttons){r=parseInt(r,10);this._buttons[r]=new s.DeviceButton(this,r)}if(e&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index)}if(e&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext)}},disconnect:function(){var t=this.connected;var e=this.index;this.connected=false;this.index=null;this._rawPad=undefined;for(var i=0;i<this._buttonsLen;i++){this._buttons[i].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;if(t&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,e)}if(t&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext)}},destroy:function(){this._rawPad=undefined;for(var t=0;t<this._buttonsLen;t++){this._buttons[t].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(t,e){if(this._axes[t]===e){return}this._axes[t]=e;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,t,e)}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,this,t,e)}},processButtonDown:function(t,e){if(this._buttons[t]){this._buttons[t].start(null,e)}if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,t,e,this.index)}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,t,e)}},processButtonUp:function(t,e){if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,t,e,this.index)}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,t,e)}if(this._buttons[t]){this._buttons[t].stop(null,e)}},processButtonFloat:function(t,e){if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,t,e,this.index)}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,t,e)}if(this._buttons[t]){this._buttons[t].padFloat(e)}},axis:function(t){if(this._axes[t]){return this._axes[t]}return false},isDown:function(t){if(this._buttons[t]){return this._buttons[t].isDown}return false},isUp:function(t){if(this._buttons[t]){return this._buttons[t].isUp}return false},justReleased:function(t,e){if(this._buttons[t]){return this._buttons[t].justReleased(e)}},justPressed:function(t,e){if(this._buttons[t]){return this._buttons[t].justPressed(e)}},buttonValue:function(t){if(this._buttons[t]){return this._buttons[t].value}return null},reset:function(){for(var t=0;t<this._axes.length;t++){this._axes[t]=0}}};s.SinglePad.prototype.constructor=s.SinglePad;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Key=function(t,e){this.game=t;this._enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=e;this.onDown=new s.Signal;this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new s.Signal;this._justDown=false;this._justUp=false};s.Key.prototype={update:function(){if(!this._enabled){return}if(this.isDown){this.duration=this.game.time.time-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this)}}},processKeyDown:function(t){if(!this._enabled){return}this.event=t;if(this.isDown){return}this.altKey=t.altKey;this.ctrlKey=t.ctrlKey;this.shiftKey=t.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this._justDown=true;this.onDown.dispatch(this)},processKeyUp:function(t){if(!this._enabled){return}this.event=t;if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=this.game.time.time-this.timeDown;this._justUp=true;this.onUp.dispatch(this)},reset:function(t){if(t===undefined){t=true}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=0;this._enabled=true;this._justDown=false;this._justUp=false;if(t){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null}},downDuration:function(t){if(t===undefined){t=50}return this.isDown&&this.duration<t},upDuration:function(t){if(t===undefined){t=50}return!this.isDown&&this.game.time.time-this.timeUp<t}};Object.defineProperty(s.Key.prototype,"justDown",{get:function(){var t=this._justDown;this._justDown=false;return t}});Object.defineProperty(s.Key.prototype,"justUp",{get:function(){var t=this._justUp;this._justUp=false;return t}});Object.defineProperty(s.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(t){t=!!t;if(t!==this._enabled){if(!t){this.reset(false)}this._enabled=t}}});s.Key.prototype.constructor=s.Key;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Keyboard=function(t){this.game=t;this.enabled=true;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};s.Keyboard.prototype={addCallbacks:function(t,e,i,r){this.callbackContext=t;if(e!==undefined&&e!==null){this.onDownCallback=e}if(i!==undefined&&i!==null){this.onUpCallback=i}if(r!==undefined&&r!==null){this.onPressCallback=r}},addKey:function(t){if(!this._keys[t]){this._keys[t]=new s.Key(this.game,t);this.addKeyCapture(t)}return this._keys[t]},addKeys:function(t){var e={};for(var i in t){e[i]=this.addKey(t[i])}return e},removeKey:function(t){if(this._keys[t]){this._keys[t]=null;this.removeKeyCapture(t)}},createCursorKeys:function(){return this.addKeys({up:s.KeyCode.UP,down:s.KeyCode.DOWN,left:s.KeyCode.LEFT,right:s.KeyCode.RIGHT})},start:function(){if(this.game.device.cocoonJS){return}if(this._onKeyDown!==null){return}var t=this;this._onKeyDown=function(e){return t.processKeyDown(e)};this._onKeyUp=function(e){return t.processKeyUp(e)};this._onKeyPress=function(e){return t.processKeyPress(e)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false);window.addEventListener("keypress",this._onKeyPress,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(t){if(typeof t==="object"){for(var e in t){this._capture[t[e]]=true}}else{this._capture[t]=true}},removeKeyCapture:function(t){delete this._capture[t]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update()}}},processKeyDown:function(t){this.event=t;if(!this.game.input.enabled||!this.enabled){return}var e=t.keyCode;if(this._capture[e]){t.preventDefault()}if(!this._keys[e]){this._keys[e]=new s.Key(this.game,e)}this._keys[e].processKeyDown(t);this._k=e;if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,t)}},processKeyPress:function(t){this.pressEvent=t;if(!this.game.input.enabled||!this.enabled){return}if(this.onPressCallback){this.onPressCallback.call(this.callbackContext,String.fromCharCode(t.charCode),t)}},processKeyUp:function(t){this.event=t;if(!this.game.input.enabled||!this.enabled){return}var e=t.keyCode;if(this._capture[e]){t.preventDefault()}if(!this._keys[e]){this._keys[e]=new s.Key(this.game,e)}this._keys[e].processKeyUp(t);if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,t)}},reset:function(t){if(t===undefined){t=true}this.event=null;var e=this._keys.length;while(e--){if(this._keys[e]){this._keys[e].reset(t)}}},downDuration:function(t,e){if(this._keys[t]){return this._keys[t].downDuration(e)}else{return null}},upDuration:function(t,e){if(this._keys[t]){return this._keys[t].upDuration(e)}else{return null}},isDown:function(t){if(this._keys[t]){return this._keys[t].isDown}else{return null}}};Object.defineProperty(s.Keyboard.prototype,"lastChar",{get:function(){if(this.event.charCode===32){return""}else{return String.fromCharCode(this.pressEvent.charCode)}}});Object.defineProperty(s.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});s.Keyboard.prototype.constructor=s.Keyboard;s.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};for(var o in s.KeyCode){if(s.KeyCode.hasOwnProperty(o)&&!o.match(/[a-z]/)){s.Keyboard[o]=s.KeyCode[o]}}/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component=function(){};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Angle=function(){};s.Component.Angle.prototype={angle:{get:function(){return s.Math.wrapAngle(s.Math.radToDeg(this.rotation))},set:function(t){this.rotation=s.Math.degToRad(s.Math.wrapAngle(t))}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Animation=function(){};s.Component.Animation.prototype={play:function(t,e,i,r){if(this.animations){return this.animations.play(t,e,i,r)}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.AutoCull=function(){};s.Component.AutoCull.prototype={autoCull:false,inCamera:{get:function(){if(!this.autoCull&&!this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y}return this.game.world.camera.view.intersects(this._bounds)}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Bounds=function(){};s.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return this.x-this.offsetX+this.width*.5},set:function(t){this.x=t+this.offsetX-this.width*.5}},centerY:{get:function(){return this.y-this.offsetY+this.height*.5},set:function(t){this.y=t+this.offsetY-this.height*.5}},left:{get:function(){return this.x-this.offsetX},set:function(t){this.x=t+this.offsetX}},right:{get:function(){return this.x+this.width-this.offsetX},set:function(t){this.x=t-this.width+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(t){this.y=t+this.offsetY}},bottom:{get:function(){return this.y+this.height-this.offsetY},set:function(t){this.y=t-this.height+this.offsetY}},alignIn:function(t,e,i,r){if(i===undefined){i=0}if(r===undefined){r=0}switch(e){default:case s.TOP_LEFT:this.left=t.left-i;this.top=t.top-r;break;case s.TOP_CENTER:this.centerX=t.centerX+i;this.top=t.top-r;break;case s.TOP_RIGHT:this.right=t.right+i;this.top=t.top-r;break;case s.LEFT_CENTER:this.left=t.left-i;this.centerY=t.centerY+r;break;case s.CENTER:this.centerX=t.centerX+i;this.centerY=t.centerY+r;break;case s.RIGHT_CENTER:this.right=t.right+i;this.centerY=t.centerY+r;break;case s.BOTTOM_LEFT:this.left=t.left-i;this.bottom=t.bottom+r;break;case s.BOTTOM_CENTER:this.centerX=t.centerX+i;this.bottom=t.bottom+r;break;case s.BOTTOM_RIGHT:this.right=t.right+i;this.bottom=t.bottom+r;break}return this},alignTo:function(t,e,i,r){if(i===undefined){i=0}if(r===undefined){r=0}switch(e){default:case s.TOP_LEFT:this.left=t.left-i;this.bottom=t.top-r;break;case s.TOP_CENTER:this.centerX=t.centerX+i;this.bottom=t.top-r;break;case s.TOP_RIGHT:this.right=t.right+i;this.bottom=t.top-r;break;case s.LEFT_TOP:this.right=t.left-i;this.top=t.top-r;break;case s.LEFT_CENTER:this.right=t.left-i;this.centerY=t.centerY+r;break;case s.LEFT_BOTTOM:this.right=t.left-i;this.bottom=t.bottom+r;break;case s.RIGHT_TOP:this.left=t.right+i;this.top=t.top-r;break;case s.RIGHT_CENTER:this.left=t.right+i;this.centerY=t.centerY+r;break;case s.RIGHT_BOTTOM:this.left=t.right+i;this.bottom=t.bottom+r;break;case s.BOTTOM_LEFT:this.left=t.left-i;this.top=t.bottom+r;break;case s.BOTTOM_CENTER:this.centerX=t.centerX+i;this.top=t.bottom+r;break;case s.BOTTOM_RIGHT:this.right=t.right+i;this.top=t.bottom+r;break}return this}};s.Group.prototype.alignIn=s.Component.Bounds.prototype.alignIn;s.Group.prototype.alignTo=s.Component.Bounds.prototype.alignTo;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.BringToTop=function(){};s.Component.BringToTop.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};s.Component.BringToTop.prototype.sendToBack=function(){if(this.parent){this.parent.sendToBack(this)}return this};s.Component.BringToTop.prototype.moveUp=function(){if(this.parent){this.parent.moveUp(this)}return this};s.Component.BringToTop.prototype.moveDown=function(){if(this.parent){this.parent.moveDown(this)}return this};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Core=function(){};s.Component.Core.install=function(t){s.Utils.mixinPrototype(this,s.Component.Core.prototype);this.components={};for(var e=0;e<t.length;e++){var i=t[e];var r=false;if(i==="Destroy"){r=true}s.Utils.mixinPrototype(this,s.Component[i].prototype,r);this.components[i]=true}};s.Component.Core.init=function(t,e,i,r,n){this.game=t;this.key=r;this.data={};this.position.set(e,i);this.world=new s.Point(e,i);this.previousPosition=new s.Point(e,i);this.events=new s.Events(this);this._bounds=new s.Rectangle;if(this.components.PhysicsBody){this.body=this.body}if(this.components.Animation){this.animations=new s.AnimationManager(this)}if(this.components.LoadTexture&&r!==null){this.loadTexture(r,n)}if(this.components.FixedToCamera){this.cameraOffset=new s.Point(e,i)}};s.Component.Core.preUpdate=function(){if(this.pendingDestroy){this.destroy();return}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this.renderOrderID=this.game.stage.currentRenderOrderID++}if(this.animations){this.animations.update()}if(this.body){this.body.preUpdate()}for(var t=0;t<this.children.length;t++){this.children[t].preUpdate()}return true};s.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:false,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:true,pendingDestroy:false,_bounds:null,_exists:true,exists:{get:function(){return this._exists},set:function(t){if(t){this._exists=true;if(this.body&&this.body.type===s.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._exists=false;if(this.body&&this.body.type===s.Physics.P2JS){this.body.removeFromWorld()}this.visible=false}}},update:function(){},postUpdate:function(){if(this.customRender){this.key.render()}if(this.components.PhysicsBody){s.Component.PhysicsBody.postUpdate.call(this)}if(this.components.FixedToCamera){s.Component.FixedToCamera.postUpdate.call(this)}for(var t=0;t<this.children.length;t++){this.children[t].postUpdate()}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Crop=function(){};s.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(t,e){if(e===undefined){e=false}if(t){if(e&&this.cropRect!==null){this.cropRect.setTo(t.x,t.y,t.width,t.height)}else if(e&&this.cropRect===null){this.cropRect=new s.Rectangle(t.x,t.y,t.width,t.height)}else{this.cropRect=t}this.updateCrop()}else{this._crop=null;this.cropRect=null;this.resetFrame()}},updateCrop:function(){if(!this.cropRect){return}var t=this.texture.crop.x;var e=this.texture.crop.y;var i=this.texture.crop.width;var r=this.texture.crop.height;this._crop=s.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var n=Math.max(this._frame.x,this._crop.x);var a=Math.max(this._frame.y,this._crop.y);var o=Math.min(this._frame.right,this._crop.right)-n;var h=Math.min(this._frame.bottom,this._crop.bottom)-a;this.texture.crop.x=n;this.texture.crop.y=a;this.texture.crop.width=o;this.texture.crop.height=h;this.texture.frame.width=Math.min(o,this.cropRect.width);this.texture.frame.height=Math.min(h,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs();if(this.tint!==16777215&&(t!==n||e!==a||i!==o||r!==h)){this.texture.requiresReTint=true}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Delta=function(){};s.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Destroy=function(){};s.Component.Destroy.prototype={destroyPhase:false,destroy:function(t,e){if(this.game===null||this.destroyPhase){return}if(t===undefined){t=true}if(e===undefined){e=false}this.destroyPhase=true;if(this.events){this.events.onDestroy$dispatch(this)}if(this.parent){if(this.parent instanceof s.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.input){this.input.destroy()}if(this.animations){this.animations.destroy()}if(this.body){this.body.destroy()}if(this.events){this.events.destroy()}this.game.tweens.removeFrom(this);var i=this.children.length;if(t){while(i--){this.children[i].destroy(t)}}else{while(i--){this.removeChild(this.children[i])}}if(this._crop){this._crop=null;this.cropRect=null}if(this._frame){this._frame=null}if(s.Video&&this.key instanceof s.Video){this.key.onChangeSource.remove(this.resizeFrame,this)}if(s.BitmapText&&this._glyphs){this._glyphs=[]}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this.data={};this.renderable=false;if(this.transformCallback){this.transformCallback=null;this.transformCallbackContext=null}this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();if(e){this.texture.destroy(true)}this.destroyPhase=false;this.pendingDestroy=false}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Events=function(t){this.parent=t};s.Events.prototype={destroy:function(){this._parent=null;if(this._onDestroy){this._onDestroy.dispose()}if(this._onAddedToGroup){this._onAddedToGroup.dispose()}if(this._onRemovedFromGroup){this._onRemovedFromGroup.dispose()}if(this._onRemovedFromWorld){this._onRemovedFromWorld.dispose()}if(this._onKilled){this._onKilled.dispose()}if(this._onRevived){this._onRevived.dispose()}if(this._onEnterBounds){this._onEnterBounds.dispose()}if(this._onOutOfBounds){this._onOutOfBounds.dispose()}if(this._onInputOver){this._onInputOver.dispose()}if(this._onInputOut){this._onInputOut.dispose()}if(this._onInputDown){this._onInputDown.dispose()}if(this._onInputUp){this._onInputUp.dispose()}if(this._onDragStart){this._onDragStart.dispose()}if(this._onDragUpdate){this._onDragUpdate.dispose()}if(this._onDragStop){this._onDragStop.dispose()}if(this._onAnimationStart){this._onAnimationStart.dispose()}if(this._onAnimationComplete){this._onAnimationComplete.dispose()}if(this._onAnimationLoop){this._onAnimationLoop.dispose()}},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};s.Events.prototype.constructor=s.Events;for(var h in s.Events.prototype){if(!s.Events.prototype.hasOwnProperty(h)||h.indexOf("on")!==0||s.Events.prototype[h]!==null){continue}(function(t,e){"use strict";Object.defineProperty(s.Events.prototype,t,{get:function(){return this[e]||(this[e]=new s.Signal)}});s.Events.prototype[t+"$dispatch"]=function(){return this[e]?this[e].dispatch.apply(this[e],arguments):null}})(h,"_"+h)}/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.FixedToCamera=function(){};s.Component.FixedToCamera.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};s.Component.FixedToCamera.prototype={_fixedToCamera:false,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(t){if(t){this._fixedToCamera=true;this.cameraOffset.set(this.x,this.y)}else{this._fixedToCamera=false}}},cameraOffset:new s.Point};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Health=function(){};s.Component.Health.prototype={health:1,maxHealth:100,damage:function(t){if(this.alive){this.health-=t;if(this.health<=0){this.kill()}}return this},setHealth:function(t){this.health=t;if(this.health>this.maxHealth){this.health=this.maxHealth}return this},heal:function(t){if(this.alive){this.health+=t;if(this.health>this.maxHealth){this.health=this.maxHealth}}return this}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.InCamera=function(){};s.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.InputEnabled=function(){};s.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return this.input&&this.input.enabled},set:function(t){if(t){if(this.input===null){this.input=new s.InputHandler(this);this.input.start()}else if(this.input&&!this.input.enabled){this.input.start()}}else{if(this.input&&this.input.enabled){this.input.stop()}}}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.InWorld=function(){};s.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y;if(this.autoCull){if(this.game.world.camera.view.intersects(this._bounds)){this.renderable=true;this.game.world.camera.totalInView++}else{this.renderable=false;if(this.outOfCameraBoundsKill){this.kill();return false}}}if(this.checkWorldBounds){if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=false;this.events.onEnterBounds$dispatch(this)}else if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=true;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill){this.kill();return false}}}}return true};s.Component.InWorld.prototype={checkWorldBounds:false,outOfBoundsKill:false,outOfCameraBoundsKill:false,_outOfBoundsFired:false,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.LifeSpan=function(){};s.Component.LifeSpan.preUpdate=function(){if(this.lifespan>0){this.lifespan-=this.game.time.physicsElapsedMS;if(this.lifespan<=0){this.kill();return false}}return true};s.Component.LifeSpan.prototype={alive:true,lifespan:0,revive:function(t){if(t===undefined){t=100}this.alive=true;this.exists=true;this.visible=true;if(typeof this.setHealth==="function"){this.setHealth(t)}if(this.events){this.events.onRevived$dispatch(this)}return this},kill:function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled$dispatch(this)}return this}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.LoadTexture=function(){};s.Component.LoadTexture.prototype={customRender:false,_frame:null,loadTexture:function(t,e,i){if(t===s.PENDING_ATLAS){t=e;e=0}else{e=e||0}if((i||i===undefined)&&this.animations){this.animations.stop()}this.key=t;this.customRender=false;var r=this.game.cache;var n=true;var a=!this.texture.baseTexture.scaleMode;if(s.RenderTexture&&t instanceof s.RenderTexture){this.key=t.key;this.setTexture(t)}else if(s.BitmapData&&t instanceof s.BitmapData){this.customRender=true;this.setTexture(t.texture);if(r.hasFrameData(t.key,s.Cache.BITMAPDATA)){n=!this.animations.loadFrameData(r.getFrameData(t.key,s.Cache.BITMAPDATA),e)}else{n=!this.animations.loadFrameData(t.frameData,0)}}else if(s.Video&&t instanceof s.Video){this.customRender=true;var o=t.texture.valid;this.setTexture(t.texture);this.setFrame(t.texture.frame.clone());t.onChangeSource.add(this.resizeFrame,this);this.texture.valid=o}else if(s.Tilemap&&t instanceof s.TilemapLayer){this.setTexture(PIXI.Texture.fromCanvas(t.canvas))}else if(t instanceof PIXI.Texture){this.setTexture(t)}else{var h=r.getImage(t,true);this.key=h.key;this.setTexture(new PIXI.Texture(h.base));if(t==="__default"){this.texture.baseTexture.skipRender=true}else{this.texture.baseTexture.skipRender=false}n=!this.animations.loadFrameData(h.frameData,e)}if(n){this._frame=s.Rectangle.clone(this.texture.frame)}if(!a){this.texture.baseTexture.scaleMode=1}},setFrame:function(t){this._frame=t;this.texture.frame.x=t.x;this.texture.frame.y=t.y;this.texture.frame.width=t.width;this.texture.frame.height=t.height;this.texture.crop.x=t.x;this.texture.crop.y=t.y;this.texture.crop.width=t.width;this.texture.crop.height=t.height;if(t.trimmed){if(this.texture.trim){this.texture.trim.x=t.spriteSourceSizeX;this.texture.trim.y=t.spriteSourceSizeY;this.texture.trim.width=t.sourceSizeW;this.texture.trim.height=t.sourceSizeH}else{this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH}}this.texture.width=t.sourceSizeW;this.texture.height=t.sourceSizeH;this.texture.frame.width=t.sourceSizeW;this.texture.frame.height=t.sourceSizeH}else if(!t.trimmed&&this.texture.trim){this.texture.trim=null}if(this.cropRect){this.updateCrop()}this.texture.requiresReTint=true;this.texture._updateUvs();if(this.tilingTexture){this.refreshTexture=true}},resizeFrame:function(t,e,i){this.texture.frame.resize(e,i);this.texture.setFrame(this.texture.frame)},resetFrame:function(){if(this._frame){this.setFrame(this._frame)}},frame:{get:function(){return this.animations.frame},set:function(t){this.animations.frame=t}},frameName:{get:function(){return this.animations.frameName},set:function(t){this.animations.frameName=t}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Overlap=function(){};s.Component.Overlap.prototype={overlap:function(t){return s.Rectangle.intersects(this.getBounds(),t.getBounds())}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.PhysicsBody=function(){};s.Component.PhysicsBody.preUpdate=function(){if(this.fresh&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(this.body){this.body.preUpdate()}this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this._exists||!this.parent.exists){this.renderOrderID=-1;return false}return true};s.Component.PhysicsBody.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate()}};s.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(t){this.position.x=t;if(this.body&&!this.body.dirty){this.body._reset=true}}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t;if(this.body&&!this.body.dirty){this.body._reset=true}}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Reset=function(){};s.Component.Reset.prototype.reset=function(t,e,i){if(i===undefined){i=1}this.world.set(t,e);this.position.set(t,e);this.fresh=true;this.exists=true;this.visible=true;this.renderable=true;if(this.components.InWorld){this._outOfBoundsFired=false}if(this.components.LifeSpan){this.alive=true;this.health=i}if(this.components.PhysicsBody){if(this.body){this.body.reset(t,e,false,false)}}return this};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.ScaleMinMax=function(){};s.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(t){if(this.scaleMin){if(t.a<this.scaleMin.x){t.a=this.scaleMin.x}if(t.d<this.scaleMin.y){t.d=this.scaleMin.y}}if(this.scaleMax){if(t.a>this.scaleMax.x){t.a=this.scaleMax.x}if(t.d>this.scaleMax.y){t.d=this.scaleMax.y}}},setScaleMinMax:function(t,e,i,r){if(e===undefined){e=i=r=t}else if(i===undefined){i=r=e;e=t}if(t===null){this.scaleMin=null}else{if(this.scaleMin){this.scaleMin.set(t,e)}else{this.scaleMin=new s.Point(t,e)}}if(i===null){this.scaleMax=null}else{if(this.scaleMax){this.scaleMax.set(i,r)}else{this.scaleMax=new s.Point(i,r)}}if(this.scaleMin===null){this.transformCallback=null}else{this.transformCallback=this.checkTransform;this.transformCallbackContext=this}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Component.Smoothed=function(){};s.Component.Smoothed.prototype={smoothed:{get:function(){return!this.texture.baseTexture.scaleMode},set:function(t){if(t){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.GameObjectFactory=function(t){this.game=t;this.world=this.game.world};s.GameObjectFactory.prototype={existing:function(t){return this.world.add(t)},weapon:function(t,e,i,r){var n=this.game.plugins.add(s.Weapon);n.createBullets(t,e,i,r);return n},image:function(t,e,i,r,n){if(n===undefined){n=this.world}return n.add(new s.Image(this.game,t,e,i,r))},sprite:function(t,e,i,r,s){if(s===undefined){s=this.world}return s.create(t,e,i,r)},creature:function(t,e,i,r,n){if(n===undefined){n=this.world}var a=new s.Creature(this.game,t,e,i,r);n.add(a);return a},tween:function(t){return this.game.tweens.create(t)},group:function(t,e,i,r,n){return new s.Group(this.game,t,e,i,r,n)},physicsGroup:function(t,e,i,r){return new s.Group(this.game,e,i,r,true,t)},spriteBatch:function(t,e,i){if(t===undefined){t=null}if(e===undefined){e="group"}if(i===undefined){i=false}return new s.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,r){return this.game.sound.add(t,e,i,r)},sound:function(t,e,i,r){return this.game.sound.add(t,e,i,r)},audioSprite:function(t){return this.game.sound.addSprite(t)},tileSprite:function(t,e,i,r,n,a,o){if(o===undefined){o=this.world}return o.add(new s.TileSprite(this.game,t,e,i,r,n,a))},rope:function(t,e,i,r,n,a){if(a===undefined){a=this.world}return a.add(new s.Rope(this.game,t,e,i,r,n))},text:function(t,e,i,r,n){if(n===undefined){n=this.world}return n.add(new s.Text(this.game,t,e,i,r))},button:function(t,e,i,r,n,a,o,h,l,u){if(u===undefined){u=this.world}return u.add(new s.Button(this.game,t,e,i,r,n,a,o,h,l))},graphics:function(t,e,i){if(i===undefined){i=this.world}return i.add(new s.Graphics(this.game,t,e))},emitter:function(t,e,i){return this.game.particles.add(new s.Particles.Arcade.Emitter(this.game,t,e,i))},retroFont:function(t,e,i,r,n,a,o,h,l){return new s.RetroFont(this.game,t,e,i,r,n,a,o,h,l)},bitmapText:function(t,e,i,r,n,a){if(a===undefined){a=this.world}return a.add(new s.BitmapText(this.game,t,e,i,r,n))},tilemap:function(t,e,i,r,n){return new s.Tilemap(this.game,t,e,i,r,n)},renderTexture:function(t,e,i,r){if(i===undefined||i===""){i=this.game.rnd.uuid()}if(r===undefined){r=false}var n=new s.RenderTexture(this.game,t,e,i);if(r){this.game.cache.addRenderTexture(i,n)}return n},video:function(t,e){return new s.Video(this.game,t,e)},bitmapData:function(t,e,i,r){if(r===undefined){r=false}if(i===undefined||i===""){i=this.game.rnd.uuid()}var n=new s.BitmapData(this.game,i,t,e);if(r){this.game.cache.addBitmapData(i,n)}return n},filter:function(t){var e=Array.prototype.slice.call(arguments,1);var t=new s.Filter[t](this.game);t.init.apply(t,e);return t},plugin:function(t){return this.game.plugins.add(t)}};s.GameObjectFactory.prototype.constructor=s.GameObjectFactory;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.GameObjectCreator=function(t){this.game=t;this.world=this.game.world};s.GameObjectCreator.prototype={image:function(t,e,i,r){return new s.Image(this.game,t,e,i,r)},sprite:function(t,e,i,r){return new s.Sprite(this.game,t,e,i,r)},tween:function(t){return new s.Tween(t,this.game,this.game.tweens)},group:function(t,e,i,r,n){return new s.Group(this.game,t,e,i,r,n)},spriteBatch:function(t,e,i){if(e===undefined){e="group"}if(i===undefined){i=false}return new s.SpriteBatch(this.game,t,e,i)},audio:function(t,e,i,r){return this.game.sound.add(t,e,i,r)},audioSprite:function(t){return this.game.sound.addSprite(t)},sound:function(t,e,i,r){return this.game.sound.add(t,e,i,r)},tileSprite:function(t,e,i,r,n,a){return new s.TileSprite(this.game,t,e,i,r,n,a)},rope:function(t,e,i,r,n){return new s.Rope(this.game,t,e,i,r,n)},text:function(t,e,i,r){return new s.Text(this.game,t,e,i,r)},button:function(t,e,i,r,n,a,o,h,l){return new s.Button(this.game,t,e,i,r,n,a,o,h,l)},graphics:function(t,e){return new s.Graphics(this.game,t,e)},emitter:function(t,e,i){return new s.Particles.Arcade.Emitter(this.game,t,e,i)},retroFont:function(t,e,i,r,n,a,o,h,l){return new s.RetroFont(this.game,t,e,i,r,n,a,o,h,l)},bitmapText:function(t,e,i,r,n,a){return new s.BitmapText(this.game,t,e,i,r,n,a)},tilemap:function(t,e,i,r,n){return new s.Tilemap(this.game,t,e,i,r,n)},renderTexture:function(t,e,i,r){if(i===undefined||i===""){i=this.game.rnd.uuid()}if(r===undefined){r=false}var n=new s.RenderTexture(this.game,t,e,i);if(r){this.game.cache.addRenderTexture(i,n)}return n},bitmapData:function(t,e,i,r){if(r===undefined){r=false}if(i===undefined||i===""){i=this.game.rnd.uuid()}var n=new s.BitmapData(this.game,i,t,e);if(r){this.game.cache.addBitmapData(i,n)}return n},filter:function(t){var e=Array.prototype.slice.call(arguments,1);var t=new s.Filter[t](this.game);t.init.apply(t,e);return t}};s.GameObjectCreator.prototype.constructor=s.GameObjectCreator;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Sprite=function(t,e,i,r,n){e=e||0;i=i||0;r=r||null;n=n||null;this.type=s.SPRITE;this.physicsType=s.SPRITE;PIXI.Sprite.call(this,s.Cache.DEFAULT);s.Component.Core.init.call(this,t,e,i,r,n)};s.Sprite.prototype=Object.create(PIXI.Sprite.prototype);s.Sprite.prototype.constructor=s.Sprite;s.Component.Core.install.call(s.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);s.Sprite.prototype.preUpdatePhysics=s.Component.PhysicsBody.preUpdate;s.Sprite.prototype.preUpdateLifeSpan=s.Component.LifeSpan.preUpdate;s.Sprite.prototype.preUpdateInWorld=s.Component.InWorld.preUpdate;s.Sprite.prototype.preUpdateCore=s.Component.Core.preUpdate;s.Sprite.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Image=function(t,e,i,r,n){e=e||0;i=i||0;r=r||null;n=n||null;this.type=s.IMAGE;PIXI.Sprite.call(this,s.Cache.DEFAULT);s.Component.Core.init.call(this,t,e,i,r,n)};s.Image.prototype=Object.create(PIXI.Sprite.prototype);s.Image.prototype.constructor=s.Image;s.Component.Core.install.call(s.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]);s.Image.prototype.preUpdateInWorld=s.Component.InWorld.preUpdate;s.Image.prototype.preUpdateCore=s.Component.Core.preUpdate;s.Image.prototype.preUpdate=function(){if(!this.preUpdateInWorld()){return false}return this.preUpdateCore()};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Button=function(t,e,i,r,n,a,o,h,l,u){e=e||0;i=i||0;r=r||null;n=n||null;a=a||this;s.Image.call(this,t,e,i,r,h);this.type=s.BUTTON;this.physicsType=s.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new s.Signal;this.onInputOut=new s.Signal;this.onInputDown=new s.Signal;this.onInputUp=new s.Signal;this.onOverMouseOnly=true;this.justReleasedPreventsOver=s.PointerMode.TOUCH;this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.input.useHandCursor=true;this.setFrames(o,h,l,u);if(n!==null){this.onInputUp.add(n,a)}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};s.Button.prototype=Object.create(s.Image.prototype);s.Button.prototype.constructor=s.Button;var l="Over";var u="Out";var c="Down";var f="Up";s.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};s.Button.prototype.removedFromWorld=function(){this.inputEnabled=false};s.Button.prototype.setStateFrame=function(t,e,i){var r="_on"+t+"Frame";if(e!==null){this[r]=e;if(i){this.changeStateFrame(t)}}else{this[r]=null}};s.Button.prototype.changeStateFrame=function(t){if(this.freezeFrames){return false}var e="_on"+t+"Frame";var i=this[e];if(typeof i==="string"){this.frameName=i;return true}else if(typeof i==="number"){this.frame=i;return true}else{return false}};s.Button.prototype.setFrames=function(t,e,i,r){this.setStateFrame(l,t,this.input.pointerOver());this.setStateFrame(u,e,!this.input.pointerOver());this.setStateFrame(c,i,this.input.pointerDown());this.setStateFrame(f,r,this.input.pointerUp())};s.Button.prototype.setStateSound=function(t,e,i){var r="on"+t+"Sound";var n="on"+t+"SoundMarker";if(e instanceof s.Sound||e instanceof s.AudioSprite){this[r]=e;this[n]=typeof i==="string"?i:""}else{this[r]=null;this[n]=""}};s.Button.prototype.playStateSound=function(t){var e="on"+t+"Sound";var i=this[e];if(i){var r="on"+t+"SoundMarker";var s=this[r];i.play(s);return true}else{return false}};s.Button.prototype.setSounds=function(t,e,i,r,s,n,a,o){this.setStateSound(l,t,e);this.setStateSound(u,s,n);this.setStateSound(c,i,r);this.setStateSound(f,a,o)};s.Button.prototype.setOverSound=function(t,e){this.setStateSound(l,t,e)};s.Button.prototype.setOutSound=function(t,e){this.setStateSound(u,t,e)};s.Button.prototype.setDownSound=function(t,e){this.setStateSound(c,t,e)};s.Button.prototype.setUpSound=function(t,e){this.setStateSound(f,t,e)};s.Button.prototype.onInputOverHandler=function(t,e){if(e.justReleased()&&(this.justReleasedPreventsOver&e.pointerMode)===e.pointerMode){return}this.changeStateFrame(l);if(this.onOverMouseOnly&&!e.isMouse){return}this.playStateSound(l);if(this.onInputOver){this.onInputOver.dispatch(this,e)}};s.Button.prototype.onInputOutHandler=function(t,e){this.changeStateFrame(u);this.playStateSound(u);if(this.onInputOut){this.onInputOut.dispatch(this,e)}};s.Button.prototype.onInputDownHandler=function(t,e){this.changeStateFrame(c);this.playStateSound(c);if(this.onInputDown){this.onInputDown.dispatch(this,e)}};s.Button.prototype.onInputUpHandler=function(t,e,i){this.playStateSound(f);if(this.onInputUp){this.onInputUp.dispatch(this,e,i)}if(this.freezeFrames){return}if(this.forceOut===true||(this.forceOut&e.pointerMode)===e.pointerMode){this.changeStateFrame(u)}else{var r=this.changeStateFrame(f);if(!r){if(i){this.changeStateFrame(l)}else{this.changeStateFrame(u)}}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.SpriteBatch=function(t,e,i,r){if(e===undefined||e===null){e=t.world}PIXI.SpriteBatch.call(this);s.Group.call(this,t,e,i,r);this.type=s.SPRITEBATCH};s.SpriteBatch.prototype=s.Utils.extend(true,s.SpriteBatch.prototype,PIXI.SpriteBatch.prototype,s.Group.prototype);s.SpriteBatch.prototype.constructor=s.SpriteBatch;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.BitmapData=function(t,e,i,r,n){if(i===undefined||i===0){i=256}if(r===undefined||r===0){r=256}if(n===undefined){n=false}this.game=t;this.key=e;this.width=i;this.height=r;this.canvas=s.Canvas.create(this,i,r,null,n);this.context=this.canvas.getContext("2d",{alpha:true});this.ctx=this.context;this.smoothProperty=t.renderType===s.CANVAS?t.renderer.renderSession.smoothProperty:s.Canvas.getSmoothingPrefix(this.context);this.imageData=this.context.getImageData(0,0,i,r);this.data=null;if(this.imageData){this.data=this.imageData.data}this.pixels=null;if(this.data){if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window["ArrayBuffer"]){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}}this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.frameData=new s.FrameData;this.textureFrame=this.frameData.addFrame(new s.Frame(0,0,0,i,r,"bitmapData"));this.texture.frame=this.textureFrame;this.type=s.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this._image=null;this._pos=new s.Point;this._size=new s.Point;this._scale=new s.Point;this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new s.Point;this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new s.Circle;this._swapCanvas=undefined};s.BitmapData.prototype={move:function(t,e,i){if(t!==0){this.moveH(t,i)}if(e!==0){this.moveV(e,i)}return this},moveH:function(t,e){if(e===undefined){e=true}if(this._swapCanvas===undefined){this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height)}var i=this._swapCanvas;var r=i.getContext("2d");var s=this.height;var n=this.canvas;r.clearRect(0,0,this.width,this.height);if(t<0){t=Math.abs(t);var a=this.width-t;if(e){r.drawImage(n,0,0,t,s,a,0,t,s)}r.drawImage(n,t,0,a,s,0,0,a,s)}else{var a=this.width-t;if(e){r.drawImage(n,a,0,t,s,0,0,t,s)}r.drawImage(n,0,0,a,s,t,0,a,s)}this.clear();return this.copy(this._swapCanvas)},moveV:function(t,e){if(e===undefined){e=true}if(this._swapCanvas===undefined){this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height)}var i=this._swapCanvas;var r=i.getContext("2d");var s=this.width;var n=this.canvas;r.clearRect(0,0,this.width,this.height);if(t<0){t=Math.abs(t);var a=this.height-t;if(e){r.drawImage(n,0,0,s,t,0,a,s,t)}r.drawImage(n,0,t,s,a,0,0,s,a)}else{var a=this.height-t;if(e){r.drawImage(n,0,a,s,t,0,0,s,t)}r.drawImage(n,0,0,s,a,0,t,s,a)}this.clear();return this.copy(this._swapCanvas)},add:function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){if(t[e]["loadTexture"]){t[e].loadTexture(this)}}}else{t.loadTexture(this)}return this},load:function(t){if(typeof t==="string"){t=this.game.cache.getImage(t)}if(t){this.resize(t.width,t.height);this.cls()}else{return}this.draw(t);this.update();return this},clear:function(t,e,i,r){if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i=this.width}if(r===undefined){r=this.height}this.context.clearRect(t,e,i,r);this.dirty=true;return this},fill:function(t,e,i,r){if(r===undefined){r=1}this.context.fillStyle="rgba("+t+","+e+","+i+","+r+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=true;return this},generateTexture:function(t){var e=new Image;e.src=this.canvas.toDataURL("image/png");var i=this.game.cache.addImage(t,"",e);return new PIXI.Texture(i.base)},resize:function(t,e){if(t!==this.width||e!==this.height){this.width=t;this.height=e;this.canvas.width=t;this.canvas.height=e;if(this._swapCanvas!==undefined){this._swapCanvas.width=t;this._swapCanvas.height=e}this.baseTexture.width=t;this.baseTexture.height=e;this.textureFrame.width=t;this.textureFrame.height=e;this.texture.width=t;this.texture.height=e;this.texture.crop.width=t;this.texture.crop.height=e;this.update();this.dirty=true}return this},update:function(t,e,i,r){if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i=Math.max(1,this.width)}if(r===undefined){r=Math.max(1,this.height)}this.imageData=this.context.getImageData(t,e,i,r);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window["ArrayBuffer"]){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}return this},processPixelRGB:function(t,e,i,r,n,a){if(i===undefined){i=0}if(r===undefined){r=0}if(n===undefined){n=this.width}if(a===undefined){a=this.height}var o=i+n;var h=r+a;var l=s.Color.createColor();var u={r:0,g:0,b:0,a:0};var c=false;for(var f=r;f<h;f++){for(var d=i;d<o;d++){s.Color.unpackPixel(this.getPixel32(d,f),l);u=t.call(e,l,d,f);if(u!==false&&u!==null&&u!==undefined){this.setPixel32(d,f,u.r,u.g,u.b,u.a,false);c=true}}}if(c){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},processPixel:function(t,e,i,r,s,n){if(i===undefined){i=0}if(r===undefined){r=0}if(s===undefined){s=this.width}if(n===undefined){n=this.height}var a=i+s;var o=r+n;var h=0;var l=0;var u=false;for(var c=r;c<o;c++){for(var f=i;f<a;f++){h=this.getPixel32(f,c);l=t.call(e,h,f,c);if(l!==h){this.pixels[c*this.width+f]=l;u=true}}}if(u){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},replaceRGB:function(t,e,i,r,n,a,o,h,l){var u=0;var c=0;var f=this.width;var d=this.height;var p=s.Color.packPixel(t,e,i,r);if(l!==undefined&&l instanceof s.Rectangle){u=l.x;c=l.y;f=l.width;d=l.height}for(var g=0;g<d;g++){for(var v=0;v<f;v++){if(this.getPixel32(u+v,c+g)===p){this.setPixel32(u+v,c+g,n,a,o,h,false)}}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setHSL:function(t,e,i,r){var n=t||t===0;var a=e||e===0;var o=i||i===0;if(!n&&!a&&!o){return}if(r===undefined){r=new s.Rectangle(0,0,this.width,this.height)}var h=s.Color.createColor();for(var l=r.y;l<r.bottom;l++){for(var u=r.x;u<r.right;u++){s.Color.unpackPixel(this.getPixel32(u,l),h,true);if(n){h.h=t}if(a){h.s=e}if(o){h.l=i}s.Color.HSLtoRGB(h.h,h.s,h.l,h);this.setPixel32(u,l,h.r,h.g,h.b,h.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},shiftHSL:function(t,e,i,r){if(t===undefined||t===null){t=false}if(e===undefined||e===null){e=false}if(i===undefined||i===null){i=false}if(!t&&!e&&!i){return}if(r===undefined){r=new s.Rectangle(0,0,this.width,this.height)}var n=s.Color.createColor();for(var a=r.y;a<r.bottom;a++){for(var o=r.x;o<r.right;o++){s.Color.unpackPixel(this.getPixel32(o,a),n,true);if(t){n.h=this.game.math.wrap(n.h+t,0,1)}if(e){n.s=this.game.math.clamp(n.s+e,0,1)}if(i){n.l=this.game.math.clamp(n.l+i,0,1)}s.Color.HSLtoRGB(n.h,n.s,n.l,n);this.setPixel32(o,a,n.r,n.g,n.b,n.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setPixel32:function(t,e,i,r,n,a,o){if(o===undefined){o=true}if(t>=0&&t<=this.width&&e>=0&&e<=this.height){if(s.Device.LITTLE_ENDIAN){this.pixels[e*this.width+t]=a<<24|n<<16|r<<8|i}else{this.pixels[e*this.width+t]=i<<24|r<<16|n<<8|a}if(o){this.context.putImageData(this.imageData,0,0);this.dirty=true}}return this},setPixel:function(t,e,i,r,s,n){return this.setPixel32(t,e,i,r,s,255,n)},getPixel:function(t,e,i){if(!i){i=s.Color.createColor()}var r=~~(t+e*this.width);r*=4;i.r=this.data[r];i.g=this.data[++r];i.b=this.data[++r];i.a=this.data[++r];return i},getPixel32:function(t,e){if(t>=0&&t<=this.width&&e>=0&&e<=this.height){return this.pixels[e*this.width+t]}},getPixelRGB:function(t,e,i,r,n){return s.Color.unpackPixel(this.getPixel32(t,e),i,r,n)},getPixels:function(t){return this.context.getImageData(t.x,t.y,t.width,t.height)},getFirstPixel:function(t){if(t===undefined){t=0}var e=s.Color.createColor();var i=0;var r=0;var n=1;var a=false;if(t===1){n=-1;r=this.height}else if(t===3){n=-1;i=this.width}do{s.Color.unpackPixel(this.getPixel32(i,r),e);if(t===0||t===1){i++;if(i===this.width){i=0;r+=n;if(r>=this.height||r<=0){a=true}}}else if(t===2||t===3){r++;if(r===this.height){r=0;i+=n;if(i>=this.width||i<=0){a=true}}}}while(e.a===0&&!a);e.x=i;e.y=r;return e},getBounds:function(t){if(t===undefined){t=new s.Rectangle}t.x=this.getFirstPixel(2).x;if(t.x===this.width){return t.setTo(0,0,0,0)}t.y=this.getFirstPixel(0).y;t.width=this.getFirstPixel(3).x-t.x+1;t.height=this.getFirstPixel(1).y-t.y+1;return t},addToWorld:function(t,e,i,r,s,n){s=s||1;n=n||1;var a=this.game.add.image(t,e,this);a.anchor.set(i,r);a.scale.set(s,n);return a},copy:function(t,e,i,r,n,a,o,h,l,u,c,f,d,p,g,v,m){if(t===undefined||t===null){t=this}if(t instanceof s.RenderTexture||t instanceof PIXI.RenderTexture){t=t.getCanvas()}this._image=t;if(t instanceof s.Sprite||t instanceof s.Image||t instanceof s.Text||t instanceof PIXI.Sprite){this._pos.set(t.texture.crop.x,t.texture.crop.y);this._size.set(t.texture.crop.width,t.texture.crop.height);this._scale.set(t.scale.x,t.scale.y);this._anchor.set(t.anchor.x,t.anchor.y);this._rotate=t.rotation;this._alpha.current=t.alpha;if(t.texture instanceof s.RenderTexture||t.texture instanceof PIXI.RenderTexture){this._image=t.texture.getCanvas()}else{this._image=t.texture.baseTexture.source}if(a===undefined||a===null){a=t.x}if(o===undefined||o===null){o=t.y}if(t.texture.trim){a+=t.texture.trim.x-t.anchor.x*t.texture.trim.width;o+=t.texture.trim.y-t.anchor.y*t.texture.trim.height}if(t.tint!==16777215){if(t.cachedTint!==t.tint){t.cachedTint=t.tint;t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)}this._image=t.tintedTexture;this._pos.set(0)}}else{this._pos.set(0);this._scale.set(1);this._anchor.set(0);this._rotate=0;this._alpha.current=1;if(t instanceof s.BitmapData){this._image=t.canvas}else if(typeof t==="string"){t=this.game.cache.getImage(t);if(t===null){return}else{this._image=t}}this._size.set(this._image.width,this._image.height)}if(e===undefined||e===null){e=0}if(i===undefined||i===null){i=0}if(r){this._size.x=r}if(n){this._size.y=n}if(a===undefined||a===null){a=e}if(o===undefined||o===null){o=i}if(h===undefined||h===null){h=this._size.x}if(l===undefined||l===null){l=this._size.y}if(typeof u==="number"){this._rotate=u}if(typeof c==="number"){this._anchor.x=c}if(typeof f==="number"){this._anchor.y=f}if(typeof d==="number"){this._scale.x=d}if(typeof p==="number"){this._scale.y=p}if(typeof g==="number"){this._alpha.current=g}if(v===undefined){v=null}if(m===undefined){m=false}if(this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0){return}var y=this.context;this._alpha.prev=y.globalAlpha;y.save();y.globalAlpha=this._alpha.current;if(v){this.op=v}if(m){a|=0;o|=0}y.translate(a,o);y.scale(this._scale.x,this._scale.y);y.rotate(this._rotate);y.drawImage(this._image,this._pos.x+e,this._pos.y+i,this._size.x,this._size.y,-h*this._anchor.x,-l*this._anchor.y,h,l);y.restore();y.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyTransform:function(t,e,i){if(e===undefined){e=null}if(i===undefined){i=false}if(!t.hasOwnProperty("worldTransform")||!t.worldVisible||t.worldAlpha===0){return this}var r=t.worldTransform;this._pos.set(t.texture.crop.x,t.texture.crop.y);this._size.set(t.texture.crop.width,t.texture.crop.height);if(r.a===0||r.d===0||this._size.x===0||this._size.y===0){return this}if(t.texture instanceof s.RenderTexture||t.texture instanceof PIXI.RenderTexture){this._image=t.texture.getCanvas()}else{this._image=t.texture.baseTexture.source}var n=r.tx;var a=r.ty;if(t.texture.trim){n+=t.texture.trim.x-t.anchor.x*t.texture.trim.width;a+=t.texture.trim.y-t.anchor.y*t.texture.trim.height}if(t.tint!==16777215){if(t.cachedTint!==t.tint){t.cachedTint=t.tint;t.tintedTexture=PIXI.CanvasTinter.getTintedTexture(t,t.tint)}this._image=t.tintedTexture;this._pos.set(0)}if(i){n|=0;a|=0}var o=this.context;this._alpha.prev=o.globalAlpha;o.save();o.globalAlpha=this._alpha.current;if(e){this.op=e}o[this.smoothProperty]=t.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR;o.setTransform(r.a,r.b,r.c,r.d,n,a);o.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*t.anchor.x,-this._size.y*t.anchor.y,this._size.x,this._size.y);o.restore();o.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyRect:function(t,e,i,r,s,n,a){return this.copy(t,e.x,e.y,e.width,e.height,i,r,e.width,e.height,0,0,0,1,1,s,n,a)},draw:function(t,e,i,r,s,n,a){return this.copy(t,null,null,null,null,e,i,r,s,null,null,null,null,null,null,n,a)},drawGroup:function(t,e,i){if(t.total>0){t.forEachExists(this.drawGroupProxy,this,e,i)}return this},drawGroupProxy:function(t,e,i){if(t.hasOwnProperty("texture")){this.copyTransform(t,e,i)}if(t.type===s.GROUP&&t.exists){this.drawGroup(t,e,i)}else{if(t.hasOwnProperty("children")&&t.children.length>0){for(var r=0;r<t.children.length;r++){if(t.children[r].exists){this.copyTransform(t.children[r],e,i)}}}}},drawFull:function(t,e,i){if(t.worldVisible===false||t.worldAlpha===0||t.hasOwnProperty("exists")&&t.exists===false){return this}if(t.type!==s.GROUP&&t.type!==s.EMITTER&&t.type!==s.BITMAPTEXT){if(t.type===s.GRAPHICS){var r=t.getBounds();this.ctx.save();this.ctx.translate(r.x,r.y);PIXI.CanvasGraphics.renderGraphics(t,this.ctx);this.ctx.restore()}else{this.copy(t,null,null,null,null,t.worldPosition.x,t.worldPosition.y,null,null,t.worldRotation,null,null,t.worldScale.x,t.worldScale.y,t.worldAlpha,e,i)}}if(t.children){for(var n=0;n<t.children.length;n++){this.drawFull(t.children[n],e,i)}}return this},shadow:function(t,e,i,r){var s=this.context;if(t===undefined||t===null){s.shadowColor="rgba(0,0,0,0)"}else{s.shadowColor=t;s.shadowBlur=e||5;s.shadowOffsetX=i||10;s.shadowOffsetY=r||10}return this},alphaMask:function(t,e,i,r){if(r===undefined||r===null){this.draw(e).blendSourceAtop()}else{this.draw(e,r.x,r.y,r.width,r.height).blendSourceAtop()}if(i===undefined||i===null){this.draw(t).blendReset()}else{this.draw(t,i.x,i.y,i.width,i.height).blendReset()}return this},extract:function(t,e,i,r,s,n,a,o,h){if(s===undefined){s=255}if(n===undefined){n=false}if(a===undefined){a=e}if(o===undefined){o=i}if(h===undefined){h=r}if(n){t.resize(this.width,this.height)}this.processPixelRGB(function(n,l,u){if(n.r===e&&n.g===i&&n.b===r){t.setPixel32(l,u,a,o,h,s,false)}return false},this);t.context.putImageData(t.imageData,0,0);t.dirty=true;return t},rect:function(t,e,i,r,s){if(typeof s!=="undefined"){this.context.fillStyle=s}this.context.fillRect(t,e,i,r);return this},text:function(t,e,i,r,s,n){if(e===undefined){e=0}if(i===undefined){i=0}if(r===undefined){r="14px Courier"}if(s===undefined){s="rgb(255,255,255)"}if(n===undefined){n=true}var a=this.context;var o=a.font;a.font=r;if(n){a.fillStyle="rgb(0,0,0)";a.fillText(t,e+1,i+1)}a.fillStyle=s;a.fillText(t,e,i);a.font=o;return this},circle:function(t,e,i,r){var s=this.context;if(r!==undefined){s.fillStyle=r}s.beginPath();s.arc(t,e,i,0,Math.PI*2,false);s.closePath();s.fill();return this},line:function(t,e,i,r,s,n){if(s===undefined){s="#fff"}if(n===undefined){n=1}var a=this.context;a.beginPath();a.moveTo(t,e);a.lineTo(i,r);a.lineWidth=n;a.strokeStyle=s;a.stroke();a.closePath();return this},textureLine:function(t,e,i){if(i===undefined){i="repeat-x"}if(typeof e==="string"){e=this.game.cache.getImage(e);if(!e){return}}var r=t.length;if(i==="no-repeat"&&r>e.width){r=e.width}var n=this.context;n.fillStyle=n.createPattern(e,i);this._circle=new s.Circle(t.start.x,t.start.y,e.height);this._circle.circumferencePoint(t.angle-1.5707963267948966,false,this._pos);n.save();n.translate(this._pos.x,this._pos.y);n.rotate(t.angle);n.fillRect(0,0,r,e.height);n.restore();this.dirty=true;return this},render:function(){if(!this.disableTextureUpload&&this.dirty){this.baseTexture.dirty();this.dirty=false}return this},destroy:function(){this.frameData.destroy();this.texture.destroy(true);PIXI.CanvasPool.remove(this)},blendReset:function(){this.op="source-over";return this},blendSourceOver:function(){this.op="source-over";return this},blendSourceIn:function(){this.op="source-in";return this},blendSourceOut:function(){this.op="source-out";return this},blendSourceAtop:function(){this.op="source-atop";return this},blendDestinationOver:function(){this.op="destination-over";return this},blendDestinationIn:function(){this.op="destination-in";return this},blendDestinationOut:function(){this.op="destination-out";return this},blendDestinationAtop:function(){this.op="destination-atop";return this},blendXor:function(){this.op="xor";return this},blendAdd:function(){this.op="lighter";return this},blendMultiply:function(){this.op="multiply";return this},blendScreen:function(){this.op="screen";return this},blendOverlay:function(){this.op="overlay";return this},blendDarken:function(){this.op="darken";return this},blendLighten:function(){this.op="lighten";return this},blendColorDodge:function(){this.op="color-dodge";return this},blendColorBurn:function(){this.op="color-burn";return this},blendHardLight:function(){this.op="hard-light";return this},blendSoftLight:function(){this.op="soft-light";return this},blendDifference:function(){this.op="difference";return this},blendExclusion:function(){this.op="exclusion";return this},blendHue:function(){this.op="hue";return this},blendSaturation:function(){this.op="saturation";return this},blendColor:function(){this.op="color";return this},blendLuminosity:function(){this.op="luminosity";return this}};Object.defineProperty(s.BitmapData.prototype,"smoothed",{get:function(){s.Canvas.getSmoothingEnabled(this.context)},set:function(t){s.Canvas.setSmoothingEnabled(this.context,t)}});Object.defineProperty(s.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(t){this.context.globalCompositeOperation=t}});s.BitmapData.getTransform=function(t,e,i,r,s,n){if(typeof t!=="number"){t=0}if(typeof e!=="number"){e=0}if(typeof i!=="number"){i=1}if(typeof r!=="number"){r=1}if(typeof s!=="number"){s=0}if(typeof n!=="number"){n=0}return{sx:i,sy:r,scaleX:i,scaleY:r,skewX:s,skewY:n,translateX:t,translateY:e,tx:t,ty:e}};s.BitmapData.prototype.constructor=s.BitmapData;PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=PIXI.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=false;this.boundsPadding=0;this._localBounds=new PIXI.Rectangle(0,0,1,1);this.dirty=true;this._boundsDirty=false;this.webGLDirty=false;this.cachedSpriteDirty=false};PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Graphics.prototype.constructor=PIXI.Graphics;PIXI.Graphics.prototype.lineStyle=function(t,e,i){this.lineWidth=t||0;this.lineColor=e||0;this.lineAlpha=i===undefined?1:i;if(this.currentPath){if(this.currentPath.shape.points.length){this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2)))}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}}return this};PIXI.Graphics.prototype.moveTo=function(t,e){this.drawShape(new PIXI.Polygon([t,e]));return this};PIXI.Graphics.prototype.lineTo=function(t,e){if(!this.currentPath){this.moveTo(0,0)}this.currentPath.shape.points.push(t,e);this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.quadraticCurveTo=function(t,e,i,r){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var s,n,a=20,o=this.currentPath.shape.points;if(o.length===0){this.moveTo(0,0)}var h=o[o.length-2];var l=o[o.length-1];var u=0;for(var c=1;c<=a;++c){u=c/a;s=h+(t-h)*u;n=l+(e-l)*u;o.push(s+(t+(i-t)*u-s)*u,n+(e+(r-e)*u-n)*u)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.bezierCurveTo=function(t,e,i,r,s,n){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var a=20,o,h,l,u,c,f=this.currentPath.shape.points;var d=f[f.length-2];var p=f[f.length-1];var g=0;for(var v=1;v<=a;++v){g=v/a;o=1-g;h=o*o;l=h*o;u=g*g;c=u*g;f.push(l*d+3*h*g*t+3*o*u*i+c*s,l*p+3*h*g*e+3*o*u*r+c*n)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.arcTo=function(t,e,i,r,s){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(t,e)}}else{this.moveTo(t,e)}var n=this.currentPath.shape.points,a=n[n.length-2],o=n[n.length-1],h=o-e,l=a-t,u=r-e,c=i-t,f=Math.abs(h*c-l*u);if(f<1e-8||s===0){if(n[n.length-2]!==t||n[n.length-1]!==e){n.push(t,e)}}else{var d=h*h+l*l,p=u*u+c*c,g=h*u+l*c,v=s*Math.sqrt(d)/f,m=s*Math.sqrt(p)/f,y=v*g/d,x=m*g/p,b=v*c+m*l,w=v*u+m*h,_=l*(m+y),P=h*(m+y),T=c*(v+x),C=u*(v+x),S=Math.atan2(P-w,_-b),A=Math.atan2(C-w,T-b);this.arc(b+t,w+e,s,S,A,l*u>c*h)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.arc=function(t,e,i,r,s,n,a){if(r===s){return this}if(n===undefined){n=false}if(a===undefined){a=40}if(!n&&s<=r){s+=Math.PI*2}else if(n&&r<=s){r+=Math.PI*2}var o=n?(r-s)*-1:s-r;var h=Math.ceil(Math.abs(o)/(Math.PI*2))*a;if(o===0){return this}var l=t+Math.cos(r)*i;var u=e+Math.sin(r)*i;if(n&&this.filling){this.moveTo(t,e)}else{this.moveTo(l,u)}var c=this.currentPath.shape.points;var f=o/(h*2);var d=f*2;var p=Math.cos(f);var g=Math.sin(f);var v=h-1;var m=v%1/v;for(var y=0;y<=v;y++){var x=y+m*y;var b=f+r+d*x;var w=Math.cos(b);var _=-Math.sin(b);c.push((p*w+g*_)*i+t,(p*-_+g*w)*i+e)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.beginFill=function(t,e){this.filling=true;this.fillColor=t||0;this.fillAlpha=e===undefined?1:e;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};PIXI.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};PIXI.Graphics.prototype.drawRect=function(t,e,i,r){this.drawShape(new PIXI.Rectangle(t,e,i,r));return this};PIXI.Graphics.prototype.drawRoundedRect=function(t,e,i,r,s){this.drawShape(new PIXI.RoundedRectangle(t,e,i,r,s));return this};PIXI.Graphics.prototype.drawCircle=function(t,e,i){this.drawShape(new PIXI.Circle(t,e,i));return this};PIXI.Graphics.prototype.drawEllipse=function(t,e,i,r){this.drawShape(new PIXI.Ellipse(t,e,i,r));return this};PIXI.Graphics.prototype.drawPolygon=function(t){if(t instanceof s.Polygon||t instanceof PIXI.Polygon){t=t.points}var e=t;if(!Array.isArray(e)){e=new Array(arguments.length);for(var i=0;i<e.length;++i){e[i]=arguments[i]}}this.drawShape(new s.Polygon(e));return this};PIXI.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this._boundsDirty=true;this.clearDirty=true;this.graphicsData=[];this.updateLocalBounds();return this};PIXI.Graphics.prototype.generateTexture=function(t,e,i){if(t===undefined){t=1}if(e===undefined){e=PIXI.scaleModes.DEFAULT}if(i===undefined){i=0}var r=this.getBounds();r.width+=i;r.height+=i;var s=new PIXI.CanvasBuffer(r.width*t,r.height*t);var n=PIXI.Texture.fromCanvas(s.canvas,e);n.baseTexture.resolution=t;s.context.scale(t,t);s.context.translate(-r.x,-r.y);PIXI.CanvasGraphics.renderGraphics(this,s.context);return n};PIXI.Graphics.prototype._renderWebGL=function(t){if(this.visible===false||this.alpha===0||this.isMask===true)return;if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.worldAlpha=this.worldAlpha;PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);return}else{t.spriteBatch.stop();t.blendModeManager.setBlendMode(this.blendMode);if(this._mask)t.maskManager.pushMask(this._mask,t);if(this._filters)t.filterManager.pushFilter(this._filterBlock);if(this.blendMode!==t.spriteBatch.currentBlendMode){t.spriteBatch.currentBlendMode=this.blendMode;var e=PIXI.blendModesWebGL[t.spriteBatch.currentBlendMode];t.spriteBatch.gl.blendFunc(e[0],e[1])}if(this.webGLDirty){this.dirty=true;this.webGLDirty=false}PIXI.WebGLGraphics.renderGraphics(this,t);if(this.children.length){t.spriteBatch.start();for(var i=0;i<this.children.length;i++){this.children[i]._renderWebGL(t)}t.spriteBatch.stop()}if(this._filters)t.filterManager.popFilter();if(this._mask)t.maskManager.popMask(this.mask,t);t.drawCount++;t.spriteBatch.start()}};PIXI.Graphics.prototype._renderCanvas=function(t){if(this.visible===false||this.alpha===0||this.isMask===true)return;if(this._prevTint!==this.tint){this.dirty=true;this._prevTint=this.tint}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.alpha=this.alpha;PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,t);return}else{var e=t.context;var i=this.worldTransform;if(this.blendMode!==t.currentBlendMode){t.currentBlendMode=this.blendMode;e.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]}if(this._mask){t.maskManager.pushMask(this._mask,t)}var r=t.resolution;var s=i.tx*t.resolution+t.shakeX;var n=i.ty*t.resolution+t.shakeY;e.setTransform(i.a*r,i.b*r,i.c*r,i.d*r,s,n);PIXI.CanvasGraphics.renderGraphics(this,e);for(var a=0;a<this.children.length;a++){this.children[a]._renderCanvas(t)}if(this._mask){t.maskManager.popMask(t)}}};PIXI.Graphics.prototype.getBounds=function(t){if(!this._currentBounds){if(!this.renderable){return PIXI.EmptyRectangle}if(this.dirty){this.updateLocalBounds();this.webGLDirty=true;this.cachedSpriteDirty=true;this.dirty=false}var e=this._localBounds;var i=e.x;var r=e.width+e.x;var s=e.y;var n=e.height+e.y;var a=t||this.worldTransform;var o=a.a;var h=a.b;var l=a.c;var u=a.d;var c=a.tx;var f=a.ty;var d=o*r+l*n+c;var p=u*n+h*r+f;var g=o*i+l*n+c;var v=u*n+h*i+f;var m=o*i+l*s+c;var y=u*s+h*i+f;var x=o*r+l*s+c;var b=u*s+h*r+f;var w=d;var _=p;var P=d;var T=p;P=g<P?g:P;P=m<P?m:P;P=x<P?x:P;T=v<T?v:T;T=y<T?y:T;T=b<T?b:T;w=g>w?g:w;w=m>w?m:w;w=x>w?x:w;_=v>_?v:_;_=y>_?y:_;_=b>_?b:_;this._bounds.x=P;this._bounds.width=w-P;this._bounds.y=T;this._bounds.height=_-T;this._currentBounds=this._bounds}return this._currentBounds};PIXI.Graphics.prototype.getLocalBounds=function(){var t=this.worldTransform;this.worldTransform=PIXI.identityMatrix;for(var e=0;e<this.children.length;e++){this.children[e].updateTransform()}var i=this.getBounds();this.worldTransform=t;for(e=0;e<this.children.length;e++){this.children[e].updateTransform()}return i};PIXI.Graphics.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,tempPoint);var e=this.graphicsData;for(var i=0;i<e.length;i++){var r=e[i];if(!r.fill){continue}if(r.shape){if(r.shape.contains(tempPoint.x,tempPoint.y)){return true}}}return false};PIXI.Graphics.prototype.updateLocalBounds=function(){var t=Infinity;var e=-Infinity;var i=Infinity;var r=-Infinity;if(this.graphicsData.length){var n,a,o,h,l,u;for(var c=0;c<this.graphicsData.length;c++){var f=this.graphicsData[c];var d=f.type;var p=f.lineWidth;n=f.shape;if(d===PIXI.Graphics.RECT||d===PIXI.Graphics.RREC){o=n.x-p/2;h=n.y-p/2;l=n.width+p;u=n.height+p;t=o<t?o:t;e=o+l>e?o+l:e;i=h<i?h:i;r=h+u>r?h+u:r}else if(d===PIXI.Graphics.CIRC){o=n.x;h=n.y;l=n.radius+p/2;u=n.radius+p/2;t=o-l<t?o-l:t;e=o+l>e?o+l:e;i=h-u<i?h-u:i;r=h+u>r?h+u:r}else if(d===PIXI.Graphics.ELIP){o=n.x;h=n.y;l=n.width+p/2;u=n.height+p/2;t=o-l<t?o-l:t;e=o+l>e?o+l:e;i=h-u<i?h-u:i;r=h+u>r?h+u:r}else{a=n.points;for(var g=0;g<a.length;g++){if(a[g]instanceof s.Point){o=a[g].x;h=a[g].y}else{o=a[g];h=a[g+1];if(g<a.length-1){g++}}t=o-p<t?o-p:t;e=o+p>e?o+p:e;i=h-p<i?h-p:i;r=h+p>r?h+p:r}}}}else{t=0;e=0;i=0;r=0}var v=this.boundsPadding;this._localBounds.x=t-v;this._localBounds.width=e-t+v*2;this._localBounds.y=i-v;this._localBounds.height=r-i+v*2};PIXI.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds();if(!this._cachedSprite){var e=new PIXI.CanvasBuffer(t.width,t.height);var i=PIXI.Texture.fromCanvas(e.canvas);this._cachedSprite=new PIXI.Sprite(i);this._cachedSprite.buffer=e;this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.buffer.resize(t.width,t.height)}this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._cachedSprite.buffer.context.translate(-t.x,-t.y);this.worldAlpha=1;PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var t=this._cachedSprite;var e=t.texture;var i=t.buffer.canvas;e.baseTexture.width=i.width;e.baseTexture.height=i.height;e.crop.width=e.frame.width=i.width;e.crop.height=e.frame.height=i.height;t._width=i.width;t._height=i.height;e.baseTexture.dirty()};PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null};PIXI.Graphics.prototype.drawShape=function(t){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;if(t instanceof s.Polygon){t=t.clone();t.flatten()}var e=new PIXI.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,t);this.graphicsData.push(e);if(e.type===PIXI.Graphics.POLY){e.shape.closed=this.filling;this.currentPath=e}this.dirty=true;this._boundsDirty=true;return e};Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(t){this._cacheAsBitmap=t;if(this._cacheAsBitmap){this._generateCachedSprite()}else{this.destroyCachedSprite()}this.dirty=true;this.webGLDirty=true}});PIXI.GraphicsData=function(t,e,i,r,s,n,a){this.lineWidth=t;this.lineColor=e;this.lineAlpha=i;this._lineTint=e;this.fillColor=r;this.fillAlpha=s;this._fillTint=r;this.fill=n;this.shape=a;this.type=a.type};PIXI.GraphicsData.prototype.constructor=PIXI.GraphicsData;PIXI.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};PIXI.EarCut={};PIXI.EarCut.Triangulate=function(t,e,i){i=i||2;var r=e&&e.length,s=r?e[0]*i:t.length,n=PIXI.EarCut.linkedList(t,0,s,i,true),a=[];if(!n)return a;var o,h,l,u,c,f,d;if(r)n=PIXI.EarCut.eliminateHoles(t,e,n,i);if(t.length>80*i){o=l=t[0];h=u=t[1];for(var p=i;p<s;p+=i){c=t[p];f=t[p+1];if(c<o)o=c;if(f<h)h=f;if(c>l)l=c;if(f>u)u=f}d=Math.max(l-o,u-h)}PIXI.EarCut.earcutLinked(n,a,i,o,h,d);return a};PIXI.EarCut.linkedList=function(t,e,i,r,s){var n=0,a,o,h;for(a=e,o=i-r;a<i;a+=r){n+=(t[o]-t[a])*(t[a+1]+t[o+1]);o=a}if(s===n>0){for(a=e;a<i;a+=r)h=PIXI.EarCut.insertNode(a,t[a],t[a+1],h)}else{for(a=i-r;a>=e;a-=r)h=PIXI.EarCut.insertNode(a,t[a],t[a+1],h)}return h};PIXI.EarCut.filterPoints=function(t,e){if(!t)return t;if(!e)e=t;var i=t,r;do{r=false;if(!i.steiner&&(PIXI.EarCut.equals(i,i.next)||PIXI.EarCut.area(i.prev,i,i.next)===0)){PIXI.EarCut.removeNode(i);i=e=i.prev;if(i===i.next)return null;r=true}else{i=i.next}}while(r||i!==e);return e};PIXI.EarCut.earcutLinked=function(t,e,i,r,s,n,a){if(!t)return;if(!a&&n)PIXI.EarCut.indexCurve(t,r,s,n);var o=t,h,l;while(t.prev!==t.next){h=t.prev;l=t.next;if(n?PIXI.EarCut.isEarHashed(t,r,s,n):PIXI.EarCut.isEar(t)){e.push(h.i/i);e.push(t.i/i);e.push(l.i/i);PIXI.EarCut.removeNode(t);t=l.next;o=l.next;continue}t=l;if(t===o){if(!a){PIXI.EarCut.earcutLinked(PIXI.EarCut.filterPoints(t),e,i,r,s,n,1)}else if(a===1){t=PIXI.EarCut.cureLocalIntersections(t,e,i);PIXI.EarCut.earcutLinked(t,e,i,r,s,n,2)}else if(a===2){PIXI.EarCut.splitEarcut(t,e,i,r,s,n)}break}}};PIXI.EarCut.isEar=function(t){var e=t.prev,i=t,r=t.next;if(PIXI.EarCut.area(e,i,r)>=0)return false;var s=t.next.next;while(s!==t.prev){if(PIXI.EarCut.pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,s.x,s.y)&&PIXI.EarCut.area(s.prev,s,s.next)>=0)return false;s=s.next}return true};PIXI.EarCut.isEarHashed=function(t,e,i,r){var s=t.prev,n=t,a=t.next;if(PIXI.EarCut.area(s,n,a)>=0)return false;var o=s.x<n.x?s.x<a.x?s.x:a.x:n.x<a.x?n.x:a.x,h=s.y<n.y?s.y<a.y?s.y:a.y:n.y<a.y?n.y:a.y,l=s.x>n.x?s.x>a.x?s.x:a.x:n.x>a.x?n.x:a.x,u=s.y>n.y?s.y>a.y?s.y:a.y:n.y>a.y?n.y:a.y;var c=PIXI.EarCut.zOrder(o,h,e,i,r),f=PIXI.EarCut.zOrder(l,u,e,i,r);var d=t.nextZ;while(d&&d.z<=f){if(d!==t.prev&&d!==t.next&&PIXI.EarCut.pointInTriangle(s.x,s.y,n.x,n.y,a.x,a.y,d.x,d.y)&&PIXI.EarCut.area(d.prev,d,d.next)>=0)return false;d=d.nextZ}d=t.prevZ;while(d&&d.z>=c){if(d!==t.prev&&d!==t.next&&PIXI.EarCut.pointInTriangle(s.x,s.y,n.x,n.y,a.x,a.y,d.x,d.y)&&PIXI.EarCut.area(d.prev,d,d.next)>=0)return false;d=d.prevZ}return true};PIXI.EarCut.cureLocalIntersections=function(t,e,i){var r=t;do{var s=r.prev,n=r.next.next;if(PIXI.EarCut.intersects(s,r,r.next,n)&&PIXI.EarCut.locallyInside(s,n)&&PIXI.EarCut.locallyInside(n,s)){e.push(s.i/i);e.push(r.i/i);e.push(n.i/i);PIXI.EarCut.removeNode(r);PIXI.EarCut.removeNode(r.next);r=t=n}r=r.next}while(r!==t);return r};PIXI.EarCut.splitEarcut=function(t,e,i,r,s,n){var a=t;do{var o=a.next.next;while(o!==a.prev){if(a.i!==o.i&&PIXI.EarCut.isValidDiagonal(a,o)){var h=PIXI.EarCut.splitPolygon(a,o);a=PIXI.EarCut.filterPoints(a,a.next);h=PIXI.EarCut.filterPoints(h,h.next);PIXI.EarCut.earcutLinked(a,e,i,r,s,n);PIXI.EarCut.earcutLinked(h,e,i,r,s,n);return}o=o.next}a=a.next}while(a!==t)};PIXI.EarCut.eliminateHoles=function(t,e,i,r){var s=[],n,a,o,h,l;for(n=0,a=e.length;n<a;n++){o=e[n]*r;h=n<a-1?e[n+1]*r:t.length;l=PIXI.EarCut.linkedList(t,o,h,r,false);if(l===l.next)l.steiner=true;s.push(PIXI.EarCut.getLeftmost(l))}s.sort(compareX);for(n=0;n<s.length;n++){PIXI.EarCut.eliminateHole(s[n],i);i=PIXI.EarCut.filterPoints(i,i.next)}return i};PIXI.EarCut.compareX=function(t,e){return t.x-e.x};PIXI.EarCut.eliminateHole=function(t,e){e=PIXI.EarCut.findHoleBridge(t,e);if(e){var i=PIXI.EarCut.splitPolygon(e,t);PIXI.EarCut.filterPoints(i,i.next)}};PIXI.EarCut.findHoleBridge=function(t,e){var i=e,r=t.x,s=t.y,n=-Infinity,a;do{if(s<=i.y&&s>=i.next.y){var o=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=r&&o>n){n=o;a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!a)return null;if(t.x===a.x)return a.prev;var h=a,l=Infinity,u;i=a.next;while(i!==h){if(r>=i.x&&i.x>=a.x&&PIXI.EarCut.pointInTriangle(s<a.y?r:n,s,a.x,a.y,s<a.y?n:r,s,i.x,i.y)){u=Math.abs(s-i.y)/(r-i.x);if((u<l||u===l&&i.x>a.x)&&PIXI.EarCut.locallyInside(i,t)){a=i;l=u}}i=i.next}return a};PIXI.EarCut.indexCurve=function(t,e,i,r){var s=t;do{if(s.z===null)s.z=PIXI.EarCut.zOrder(s.x,s.y,e,i,r);s.prevZ=s.prev;s.nextZ=s.next;s=s.next}while(s!==t);s.prevZ.nextZ=null;s.prevZ=null;PIXI.EarCut.sortLinked(s)};PIXI.EarCut.sortLinked=function(t){var e,i,r,s,n,a,o,h,l=1;do{i=t;t=null;n=null;a=0;while(i){a++;r=i;o=0;for(e=0;e<l;e++){o++;r=r.nextZ;if(!r)break}h=l;while(o>0||h>0&&r){if(o===0){s=r;r=r.nextZ;h--}else if(h===0||!r){s=i;i=i.nextZ;o--}else if(i.z<=r.z){s=i;i=i.nextZ;o--}else{s=r;r=r.nextZ;h--}if(n)n.nextZ=s;else t=s;s.prevZ=n;n=s}i=r}n.nextZ=null;l*=2}while(a>1);return t};PIXI.EarCut.zOrder=function(t,e,i,r,s){t=32767*(t-i)/s;e=32767*(e-r)/s;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;t=(t|t<<1)&1431655765;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;e=(e|e<<1)&1431655765;return t|e<<1};PIXI.EarCut.getLeftmost=function(t){var e=t,i=t;do{if(e.x<i.x)i=e;e=e.next}while(e!==t);return i};PIXI.EarCut.pointInTriangle=function(t,e,i,r,s,n,a,o){return(s-a)*(e-o)-(t-a)*(n-o)>=0&&(t-a)*(r-o)-(i-a)*(e-o)>=0&&(i-a)*(n-o)-(s-a)*(r-o)>=0};PIXI.EarCut.isValidDiagonal=function(t,e){return PIXI.EarCut.equals(t,e)||t.next.i!==e.i&&t.prev.i!==e.i&&!PIXI.EarCut.intersectsPolygon(t,e)&&PIXI.EarCut.locallyInside(t,e)&&PIXI.EarCut.locallyInside(e,t)&&PIXI.EarCut.middleInside(t,e)};PIXI.EarCut.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)};PIXI.EarCut.equals=function(t,e){return t.x===e.x&&t.y===e.y};PIXI.EarCut.intersects=function(t,e,i,r){return PIXI.EarCut.area(t,e,i)>0!==PIXI.EarCut.area(t,e,r)>0&&PIXI.EarCut.area(i,r,t)>0!==PIXI.EarCut.area(i,r,e)>0};PIXI.EarCut.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&PIXI.EarCut.intersects(i,i.next,t,e))return true;i=i.next}while(i!==t);return false};PIXI.EarCut.locallyInside=function(t,e){return PIXI.EarCut.area(t.prev,t,t.next)<0?PIXI.EarCut.area(t,e,t.next)>=0&&PIXI.EarCut.area(t,t.prev,e)>=0:PIXI.EarCut.area(t,e,t.prev)<0||PIXI.EarCut.area(t,t.next,e)<0};PIXI.EarCut.middleInside=function(t,e){var i=t,r=false,s=(t.x+e.x)/2,n=(t.y+e.y)/2;do{if(i.y>n!==i.next.y>n&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x)r=!r;i=i.next}while(i!==t);return r};PIXI.EarCut.splitPolygon=function(t,e){var i=new PIXI.EarCut.Node(t.i,t.x,t.y),r=new PIXI.EarCut.Node(e.i,e.x,e.y),s=t.next,n=e.prev;t.next=e;e.prev=t;i.next=s;s.prev=i;r.next=i;i.prev=r;n.next=r;r.prev=n;return r};PIXI.EarCut.insertNode=function(t,e,i,r){var s=new PIXI.EarCut.Node(t,e,i);if(!r){s.prev=s;s.next=s}else{s.next=r.next;s.prev=r;r.next.prev=s;r.next=s}return s};PIXI.EarCut.removeNode=function(t){t.next.prev=t.prev;t.prev.next=t.next;if(t.prevZ)t.prevZ.nextZ=t.nextZ;if(t.nextZ)t.nextZ.prevZ=t.prevZ};PIXI.EarCut.Node=function(t,e,i){this.i=t;this.x=e;this.y=i;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false};PIXI.WebGLGraphics=function(){};PIXI.WebGLGraphics.stencilBufferLimit=6;PIXI.WebGLGraphics.renderGraphics=function(t,e){var i=e.gl;var r=e.projection,s=e.offset,n=e.shaderManager.primitiveShader,a;if(t.dirty){PIXI.WebGLGraphics.updateGraphics(t,i)}var o=t._webGL[i.id];for(var h=0;h<o.data.length;h++){if(o.data[h].mode===1){a=o.data[h];e.stencilManager.pushStencil(t,a,e);i.drawElements(i.TRIANGLE_FAN,4,i.UNSIGNED_SHORT,(a.indices.length-4)*2);e.stencilManager.popStencil(t,a,e)}else{a=o.data[h];e.shaderManager.setShader(n);n=e.shaderManager.primitiveShader;i.uniformMatrix3fv(n.translationMatrix,false,t.worldTransform.toArray(true));i.uniform1f(n.flipY,1);i.uniform2f(n.projectionVector,r.x,-r.y);i.uniform2f(n.offsetVector,-s.x,-s.y);i.uniform3fv(n.tintColor,PIXI.hex2rgb(t.tint));i.uniform1f(n.alpha,t.worldAlpha);i.bindBuffer(i.ARRAY_BUFFER,a.buffer);i.vertexAttribPointer(n.aVertexPosition,2,i.FLOAT,false,4*6,0);i.vertexAttribPointer(n.colorAttribute,4,i.FLOAT,false,4*6,2*4);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a.indexBuffer);i.drawElements(i.TRIANGLE_STRIP,a.indices.length,i.UNSIGNED_SHORT,0)}}};PIXI.WebGLGraphics.updateGraphics=function(t,e){var i=t._webGL[e.id];if(!i)i=t._webGL[e.id]={lastIndex:0,data:[],gl:e};t.dirty=false;var r;if(t.clearDirty){t.clearDirty=false;for(r=0;r<i.data.length;r++){var s=i.data[r];s.reset();PIXI.WebGLGraphics.graphicsDataPool.push(s)}i.data=[];i.lastIndex=0}var n;for(r=i.lastIndex;r<t.graphicsData.length;r++){var a=t.graphicsData[r];if(a.type===PIXI.Graphics.POLY){a.points=a.shape.points.slice();if(a.shape.closed){if(a.points[0]!==a.points[a.points.length-2]||a.points[1]!==a.points[a.points.length-1]){a.points.push(a.points[0],a.points[1])}}if(a.fill){if(a.points.length>=PIXI.WebGLGraphics.stencilBufferLimit){if(a.points.length<PIXI.WebGLGraphics.stencilBufferLimit*2){n=PIXI.WebGLGraphics.switchMode(i,0);var o=PIXI.WebGLGraphics.buildPoly(a,n);if(!o){n=PIXI.WebGLGraphics.switchMode(i,1);PIXI.WebGLGraphics.buildComplexPoly(a,n)}}else{n=PIXI.WebGLGraphics.switchMode(i,1);PIXI.WebGLGraphics.buildComplexPoly(a,n)}}}if(a.lineWidth>0){n=PIXI.WebGLGraphics.switchMode(i,0);PIXI.WebGLGraphics.buildLine(a,n)}}else{n=PIXI.WebGLGraphics.switchMode(i,0);if(a.type===PIXI.Graphics.RECT){PIXI.WebGLGraphics.buildRectangle(a,n)}else if(a.type===PIXI.Graphics.CIRC||a.type===PIXI.Graphics.ELIP){PIXI.WebGLGraphics.buildCircle(a,n)}else if(a.type===PIXI.Graphics.RREC){PIXI.WebGLGraphics.buildRoundedRectangle(a,n)}}i.lastIndex++}for(r=0;r<i.data.length;r++){n=i.data[r];if(n.dirty)n.upload()}};PIXI.WebGLGraphics.switchMode=function(t,e){var i;if(!t.data.length){i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl);i.mode=e;t.data.push(i)}else{i=t.data[t.data.length-1];if(i.mode!==e||e===1){i=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(t.gl);i.mode=e;t.data.push(i)}}i.dirty=true;return i};PIXI.WebGLGraphics.buildRectangle=function(t,e){var i=t.shape;var r=i.x;var s=i.y;var n=i.width;var a=i.height;if(t.fill){var o=PIXI.hex2rgb(t.fillColor);var h=t.fillAlpha;var l=o[0]*h;var u=o[1]*h;var c=o[2]*h;var f=e.points;var d=e.indices;var p=f.length/6;f.push(r,s);f.push(l,u,c,h);f.push(r+n,s);f.push(l,u,c,h);f.push(r,s+a);f.push(l,u,c,h);f.push(r+n,s+a);f.push(l,u,c,h);d.push(p,p,p+1,p+2,p+3,p+3)}if(t.lineWidth){var g=t.points;t.points=[r,s,r+n,s,r+n,s+a,r,s+a,r,s];PIXI.WebGLGraphics.buildLine(t,e);t.points=g}};PIXI.WebGLGraphics.buildRoundedRectangle=function(t,e){var i=t.shape;var r=i.x;var s=i.y;var n=i.width;var a=i.height;var o=i.radius;var h=[];h.push(r,s+o);h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(r,s+a-o,r,s+a,r+o,s+a));h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(r+n-o,s+a,r+n,s+a,r+n,s+a-o));h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(r+n,s+o,r+n,s,r+n-o,s));h=h.concat(PIXI.WebGLGraphics.quadraticBezierCurve(r+o,s,r,s,r,s+o));if(t.fill){var l=PIXI.hex2rgb(t.fillColor);var u=t.fillAlpha;var c=l[0]*u;var f=l[1]*u;var d=l[2]*u;var p=e.points;var g=e.indices;var v=p.length/6;var m=PIXI.EarCut.Triangulate(h,null,2);var y=0;for(y=0;y<m.length;y+=3){g.push(m[y]+v);g.push(m[y]+v);g.push(m[y+1]+v);g.push(m[y+2]+v);g.push(m[y+2]+v)}for(y=0;y<h.length;y++){p.push(h[y],h[++y],c,f,d,u)}}if(t.lineWidth){var x=t.points;t.points=h;PIXI.WebGLGraphics.buildLine(t,e);t.points=x}};PIXI.WebGLGraphics.quadraticBezierCurve=function(t,e,i,r,s,n){var a,o,h,l,u,c,f=20,d=[];function p(t,e,i){var r=e-t;return t+r*i}var g=0;for(var v=0;v<=f;v++){g=v/f;a=p(t,i,g);o=p(e,r,g);h=p(i,s,g);l=p(r,n,g);u=p(a,h,g);c=p(o,l,g);d.push(u,c)}return d};PIXI.WebGLGraphics.buildCircle=function(t,e){var i=t.shape;var r=i.x;var s=i.y;var n;var a;if(t.type===PIXI.Graphics.CIRC){n=i.radius;a=i.radius}else{n=i.width;a=i.height}var o=40;var h=Math.PI*2/o;var l=0;if(t.fill){var u=PIXI.hex2rgb(t.fillColor);var c=t.fillAlpha;var f=u[0]*c;var d=u[1]*c;var p=u[2]*c;var g=e.points;var v=e.indices;var m=g.length/6;v.push(m);for(l=0;l<o+1;l++){g.push(r,s,f,d,p,c);g.push(r+Math.sin(h*l)*n,s+Math.cos(h*l)*a,f,d,p,c);v.push(m++,m++)}v.push(m-1)}if(t.lineWidth){var y=t.points;t.points=[];for(l=0;l<o+1;l++){t.points.push(r+Math.sin(h*l)*n,s+Math.cos(h*l)*a)}PIXI.WebGLGraphics.buildLine(t,e);t.points=y}};PIXI.WebGLGraphics.buildLine=function(t,e){var i=0;var r=t.points;if(r.length===0)return;if(t.lineWidth%2){for(i=0;i<r.length;i++){r[i]+=.5}}var s=new PIXI.Point(r[0],r[1]);var n=new PIXI.Point(r[r.length-2],r[r.length-1]);if(s.x===n.x&&s.y===n.y){r=r.slice();r.pop();r.pop();n=new PIXI.Point(r[r.length-2],r[r.length-1]);var a=n.x+(s.x-n.x)*.5;var o=n.y+(s.y-n.y)*.5;r.unshift(a,o);r.push(a,o)}var h=e.points;var l=e.indices;var u=r.length/2;var c=r.length;var f=h.length/6;var d=t.lineWidth/2;var p=PIXI.hex2rgb(t.lineColor);var g=t.lineAlpha;var v=p[0]*g;var m=p[1]*g;var y=p[2]*g;var x,b,w,_,P,T,C,S;var A,E,I,M,R,B;var L,k,O,F,D,U;var G,N,X;w=r[0];_=r[1];P=r[2];T=r[3];A=-(_-T);E=w-P;X=Math.sqrt(A*A+E*E);A/=X;E/=X;A*=d;E*=d;h.push(w-A,_-E,v,m,y,g);h.push(w+A,_+E,v,m,y,g);for(i=1;i<u-1;i++){w=r[(i-1)*2];_=r[(i-1)*2+1];P=r[i*2];T=r[i*2+1];C=r[(i+1)*2];S=r[(i+1)*2+1];A=-(_-T);E=w-P;X=Math.sqrt(A*A+E*E);A/=X;E/=X;A*=d;E*=d;I=-(T-S);M=P-C;X=Math.sqrt(I*I+M*M);I/=X;M/=X;I*=d;M*=d;L=-E+_-(-E+T);k=-A+P-(-A+w);O=(-A+w)*(-E+T)-(-A+P)*(-E+_);F=-M+S-(-M+T);D=-I+P-(-I+C);U=(-I+C)*(-M+T)-(-I+P)*(-M+S);G=L*D-F*k;if(Math.abs(G)<.1){G+=10.1;h.push(P-A,T-E,v,m,y,g);h.push(P+A,T+E,v,m,y,g);continue}x=(k*U-D*O)/G;b=(F*O-L*U)/G;N=(x-P)*(x-P)+(b-T)+(b-T);if(N>140*140){R=A-I;B=E-M;X=Math.sqrt(R*R+B*B);R/=X;B/=X;R*=d;B*=d;h.push(P-R,T-B);h.push(v,m,y,g);h.push(P+R,T+B);h.push(v,m,y,g);h.push(P-R,T-B);h.push(v,m,y,g);c++}else{h.push(x,b);h.push(v,m,y,g);h.push(P-(x-P),T-(b-T));h.push(v,m,y,g)}}w=r[(u-2)*2];_=r[(u-2)*2+1];P=r[(u-1)*2];T=r[(u-1)*2+1];A=-(_-T);E=w-P;X=Math.sqrt(A*A+E*E);A/=X;E/=X;A*=d;E*=d;h.push(P-A,T-E);h.push(v,m,y,g);h.push(P+A,T+E);h.push(v,m,y,g);l.push(f);for(i=0;i<c;i++){l.push(f++)}l.push(f-1)};PIXI.WebGLGraphics.buildComplexPoly=function(t,e){var i=t.points.slice();if(i.length<6)return;var r=e.indices;e.points=i;e.alpha=t.fillAlpha;e.color=PIXI.hex2rgb(t.fillColor);var s=Infinity;var n=-Infinity;var a=Infinity;var o=-Infinity;var h,l;for(var u=0;u<i.length;u+=2){h=i[u];l=i[u+1];s=h<s?h:s;n=h>n?h:n;a=l<a?l:a;o=l>o?l:o}i.push(s,a,n,a,n,o,s,o);var c=i.length/2;for(u=0;u<c;u++){r.push(u)}};PIXI.WebGLGraphics.buildPoly=function(t,e){var i=t.points;if(i.length<6)return;var r=e.points;var s=e.indices;var n=i.length/2;var a=PIXI.hex2rgb(t.fillColor);var o=t.fillAlpha;var h=a[0]*o;var l=a[1]*o;var u=a[2]*o;var c=PIXI.EarCut.Triangulate(i,null,2);if(!c)return false;var f=r.length/6;var d=0;for(d=0;d<c.length;d+=3){s.push(c[d]+f);s.push(c[d]+f);s.push(c[d+1]+f);s.push(c[d+2]+f);s.push(c[d+2]+f)}for(d=0;d<n;d++){r.push(i[d*2],i[d*2+1],h,l,u,o)}return true};PIXI.WebGLGraphics.graphicsDataPool=[];PIXI.WebGLGraphicsData=function(t){this.gl=t;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=t.createBuffer();this.indexBuffer=t.createBuffer();this.mode=1;this.alpha=1;this.dirty=true};PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};PIXI.WebGLGraphicsData.prototype.upload=function(){var t=this.gl;this.glPoints=new PIXI.Float32Array(this.points);t.bindBuffer(t.ARRAY_BUFFER,this.buffer);t.bufferData(t.ARRAY_BUFFER,this.glPoints,t.STATIC_DRAW);this.glIndicies=new PIXI.Uint16Array(this.indices);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.glIndicies,t.STATIC_DRAW);this.dirty=false};PIXI.CanvasGraphics=function(){};PIXI.CanvasGraphics.renderGraphics=function(t,e){var i=t.worldAlpha;if(t.dirty){this.updateGraphicsTint(t);t.dirty=false}for(var r=0;r<t.graphicsData.length;r++){var s=t.graphicsData[r];var n=s.shape;var a=s._fillTint;var o=s._lineTint;e.lineWidth=s.lineWidth;if(s.type===PIXI.Graphics.POLY){e.beginPath();var h=n.points;e.moveTo(h[0],h[1]);for(var l=1;l<h.length/2;l++){e.lineTo(h[l*2],h[l*2+1])}if(n.closed){e.lineTo(h[0],h[1])}if(h[0]===h[h.length-2]&&h[1]===h[h.length-1]){e.closePath()}if(s.fill){e.globalAlpha=s.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(s.lineWidth){e.globalAlpha=s.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}else if(s.type===PIXI.Graphics.RECT){if(s.fillColor||s.fillColor===0){e.globalAlpha=s.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fillRect(n.x,n.y,n.width,n.height)}if(s.lineWidth){e.globalAlpha=s.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.strokeRect(n.x,n.y,n.width,n.height)}}else if(s.type===PIXI.Graphics.CIRC){e.beginPath();e.arc(n.x,n.y,n.radius,0,2*Math.PI);e.closePath();if(s.fill){e.globalAlpha=s.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(s.lineWidth){e.globalAlpha=s.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}else if(s.type===PIXI.Graphics.ELIP){var u=n.width*2;var c=n.height*2;var f=n.x-u/2;var d=n.y-c/2;e.beginPath();var p=.5522848,g=u/2*p,v=c/2*p,m=f+u,y=d+c,x=f+u/2,b=d+c/2;e.moveTo(f,b);e.bezierCurveTo(f,b-v,x-g,d,x,d);e.bezierCurveTo(x+g,d,m,b-v,m,b);e.bezierCurveTo(m,b+v,x+g,y,x,y);e.bezierCurveTo(x-g,y,f,b+v,f,b);e.closePath();if(s.fill){e.globalAlpha=s.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(s.lineWidth){e.globalAlpha=s.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}else if(s.type===PIXI.Graphics.RREC){var w=n.x;var _=n.y;var P=n.width;var T=n.height;var C=n.radius;var S=Math.min(P,T)/2|0;C=C>S?S:C;e.beginPath();e.moveTo(w,_+C);e.lineTo(w,_+T-C);e.quadraticCurveTo(w,_+T,w+C,_+T);e.lineTo(w+P-C,_+T);e.quadraticCurveTo(w+P,_+T,w+P,_+T-C);e.lineTo(w+P,_+C);e.quadraticCurveTo(w+P,_,w+P-C,_);e.lineTo(w+C,_);e.quadraticCurveTo(w,_,w,_+C);e.closePath();if(s.fillColor||s.fillColor===0){e.globalAlpha=s.fillAlpha*i;e.fillStyle="#"+("00000"+(a|0).toString(16)).substr(-6);e.fill()}if(s.lineWidth){e.globalAlpha=s.lineAlpha*i;e.strokeStyle="#"+("00000"+(o|0).toString(16)).substr(-6);e.stroke()}}}};PIXI.CanvasGraphics.renderGraphicsMask=function(t,e){var i=t.graphicsData.length;if(i===0){return}e.beginPath();for(var r=0;r<i;r++){var s=t.graphicsData[r];var n=s.shape;if(s.type===PIXI.Graphics.POLY){var a=n.points;e.moveTo(a[0],a[1]);for(var o=1;o<a.length/2;o++){e.lineTo(a[o*2],a[o*2+1])}if(a[0]===a[a.length-2]&&a[1]===a[a.length-1]){e.closePath()}}else if(s.type===PIXI.Graphics.RECT){e.rect(n.x,n.y,n.width,n.height);e.closePath()}else if(s.type===PIXI.Graphics.CIRC){e.arc(n.x,n.y,n.radius,0,2*Math.PI);e.closePath()}else if(s.type===PIXI.Graphics.ELIP){var h=n.width*2;var l=n.height*2;var u=n.x-h/2;var c=n.y-l/2;var f=.5522848,d=h/2*f,p=l/2*f,g=u+h,v=c+l,m=u+h/2,y=c+l/2;e.moveTo(u,y);e.bezierCurveTo(u,y-p,m-d,c,m,c);e.bezierCurveTo(m+d,c,g,y-p,g,y);e.bezierCurveTo(g,y+p,m+d,v,m,v);e.bezierCurveTo(m-d,v,u,y+p,u,y);e.closePath()}else if(s.type===PIXI.Graphics.RREC){var x=n.x;var b=n.y;var w=n.width;var _=n.height;var P=n.radius;var T=Math.min(w,_)/2|0;P=P>T?T:P;e.moveTo(x,b+P);e.lineTo(x,b+_-P);e.quadraticCurveTo(x,b+_,x+P,b+_);e.lineTo(x+w-P,b+_);e.quadraticCurveTo(x+w,b+_,x+w,b+_-P);e.lineTo(x+w,b+P);e.quadraticCurveTo(x+w,b,x+w-P,b);e.lineTo(x+P,b);e.quadraticCurveTo(x,b,x,b+P);e.closePath()}}};PIXI.CanvasGraphics.updateGraphicsTint=function(t){if(t.tint===16777215){return}var e=(t.tint>>16&255)/255;var i=(t.tint>>8&255)/255;var r=(t.tint&255)/255;for(var s=0;s<t.graphicsData.length;s++){var n=t.graphicsData[s];var a=n.fillColor|0;var o=n.lineColor|0;n._fillTint=((a>>16&255)/255*e*255<<16)+((a>>8&255)/255*i*255<<8)+(a&255)/255*r*255;n._lineTint=((o>>16&255)/255*e*255<<16)+((o>>8&255)/255*i*255<<8)+(o&255)/255*r*255}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Graphics=function(t,e,i){if(e===undefined){e=0}if(i===undefined){i=0}this.type=s.GRAPHICS;this.physicsType=s.SPRITE;this.anchor=new s.Point;PIXI.Graphics.call(this);s.Component.Core.init.call(this,t,e,i,"",null)};s.Graphics.prototype=Object.create(PIXI.Graphics.prototype);s.Graphics.prototype.constructor=s.Graphics;s.Component.Core.install.call(s.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);s.Graphics.prototype.preUpdatePhysics=s.Component.PhysicsBody.preUpdate;s.Graphics.prototype.preUpdateLifeSpan=s.Component.LifeSpan.preUpdate;s.Graphics.prototype.preUpdateInWorld=s.Component.InWorld.preUpdate;s.Graphics.prototype.preUpdateCore=s.Component.Core.preUpdate;s.Graphics.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};s.Graphics.prototype.postUpdate=function(){s.Component.PhysicsBody.postUpdate.call(this);s.Component.FixedToCamera.postUpdate.call(this);if(this._boundsDirty){this.updateLocalBounds();this._boundsDirty=false}for(var t=0;t<this.children.length;t++){this.children[t].postUpdate()}};s.Graphics.prototype.destroy=function(t){this.clear();s.Component.Destroy.prototype.destroy.call(this,t)};s.Graphics.prototype.drawTriangle=function(t,e){if(e===undefined){e=false}var i=new s.Polygon(t);if(e){var r=new s.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y);var n=new s.Point(t[1].x-t[0].x,t[1].y-t[0].y);var a=new s.Point(t[1].x-t[2].x,t[1].y-t[2].y);var o=a.cross(n);if(r.dot(o)>0){this.drawPolygon(i)}}else{this.drawPolygon(i)}};s.Graphics.prototype.drawTriangles=function(t,e,i){if(i===undefined){i=false}var r=new s.Point;var n=new s.Point;var a=new s.Point;var o=[];var h;if(!e){if(t[0]instanceof s.Point){for(h=0;h<t.length/3;h++){this.drawTriangle([t[h*3],t[h*3+1],t[h*3+2]],i)}}else{for(h=0;h<t.length/6;h++){r.x=t[h*6+0];r.y=t[h*6+1];n.x=t[h*6+2];n.y=t[h*6+3];a.x=t[h*6+4];a.y=t[h*6+5];this.drawTriangle([r,n,a],i)}}}else{if(t[0]instanceof s.Point){for(h=0;h<e.length/3;h++){o.push(t[e[h*3]]);o.push(t[e[h*3+1]]);o.push(t[e[h*3+2]]);if(o.length===3){this.drawTriangle(o,i);o=[]}}}else{for(h=0;h<e.length;h++){r.x=t[e[h]*2];r.y=t[e[h]*2+1];o.push(r.copyTo({}));if(o.length===3){this.drawTriangle(o,i);o=[]}}}}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.RenderTexture=function(t,e,i,r,n,a){if(r===undefined){r=""}if(n===undefined){n=s.scaleModes.DEFAULT}if(a===undefined){a=1}this.game=t;this.key=r;this.type=s.RENDERTEXTURE;this._tempMatrix=new PIXI.Matrix;PIXI.RenderTexture.call(this,e,i,this.game.renderer,n,a);this.render=s.RenderTexture.prototype.render};s.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);s.RenderTexture.prototype.constructor=s.RenderTexture;s.RenderTexture.prototype.renderXY=function(t,e,i,r){t.updateTransform();this._tempMatrix.copyFrom(t.worldTransform);this._tempMatrix.tx=e;this._tempMatrix.ty=i;if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(t,this._tempMatrix,r)}else{this.renderCanvas(t,this._tempMatrix,r)}};s.RenderTexture.prototype.renderRawXY=function(t,e,i,r){this._tempMatrix.identity().translate(e,i);if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(t,this._tempMatrix,r)}else{this.renderCanvas(t,this._tempMatrix,r)}};s.RenderTexture.prototype.render=function(t,e,i){if(e===undefined||e===null){this._tempMatrix.copyFrom(t.worldTransform)}else{this._tempMatrix.copyFrom(e)}if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(t,this._tempMatrix,i)}else{this.renderCanvas(t,this._tempMatrix,i)}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Text=function(t,e,i,r,n){e=e||0;i=i||0;if(r===undefined||r===null){r=""}else{r=r.toString()}n=s.Utils.extend({},n);this.type=s.TEXT;this.physicsType=s.SPRITE;this.padding=new s.Point;this.textBounds=null;this.canvas=PIXI.CanvasPool.create(this);this.context=this.canvas.getContext("2d");this.colors=[];this.strokeColors=[];this.fontStyles=[];this.fontWeights=[];this.autoRound=false;this.useAdvancedWrap=false;this._res=t.renderer.resolution;this._text=r;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this._width=0;this._height=0;s.Sprite.call(this,t,e,i,PIXI.Texture.fromCanvas(this.canvas));this.setStyle(n);if(r!==""){this.updateText()}};s.Text.prototype=Object.create(s.Sprite.prototype);s.Text.prototype.constructor=s.Text;s.Text.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};s.Text.prototype.update=function(){};s.Text.prototype.destroy=function(t){this.texture.destroy(true);s.Component.Destroy.prototype.destroy.call(this,t)};s.Text.prototype.setShadow=function(t,e,i,r,s,n){if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i="rgba(0, 0, 0, 1)"}if(r===undefined){r=0}if(s===undefined){s=true}if(n===undefined){n=true}this.style.shadowOffsetX=t;this.style.shadowOffsetY=e;this.style.shadowColor=i;this.style.shadowBlur=r;this.style.shadowStroke=s;this.style.shadowFill=n;this.dirty=true;return this};s.Text.prototype.setStyle=function(t,e){if(e===undefined){e=false}t=t||{};t.font=t.font||"bold 20pt Arial";t.backgroundColor=t.backgroundColor||null;t.fill=t.fill||"black";t.align=t.align||"left";t.boundsAlignH=t.boundsAlignH||"left";t.boundsAlignV=t.boundsAlignV||"top";t.stroke=t.stroke||"black";t.strokeThickness=t.strokeThickness||0;t.wordWrap=t.wordWrap||false;t.wordWrapWidth=t.wordWrapWidth||100;t.maxLines=t.maxLines||0;t.shadowOffsetX=t.shadowOffsetX||0;t.shadowOffsetY=t.shadowOffsetY||0;t.shadowColor=t.shadowColor||"rgba(0,0,0,0)";t.shadowBlur=t.shadowBlur||0;t.tabs=t.tabs||0;var i=this.fontToComponents(t.font);if(t.fontStyle){i.fontStyle=t.fontStyle}if(t.fontVariant){i.fontVariant=t.fontVariant}if(t.fontWeight){i.fontWeight=t.fontWeight}if(t.fontSize){if(typeof t.fontSize==="number"){t.fontSize=t.fontSize+"px"}i.fontSize=t.fontSize}this._fontComponents=i;t.font=this.componentsToFont(this._fontComponents);this.style=t;this.dirty=true;if(e){this.updateText()}return this};s.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var t=this.text;if(this.style.wordWrap){t=this.runWordWrap(this.text)}var e=t.split(/(?:\r\n|\r|\n)/);var i=this.style.tabs;var r=[];var s=0;var n=this.determineFontProperties(this.style.font);var a=e.length;if(this.style.maxLines>0&&this.style.maxLines<e.length){a=this.style.maxLines}this._charCount=0;for(var o=0;o<a;o++){if(i===0){var h=this.style.strokeThickness+this.padding.x;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){h+=this.measureLine(e[o])}else{h+=this.context.measureText(e[o]).width}if(this.style.wordWrap){h-=this.context.measureText(" ").width}}else{var l=e[o].split(/(?:\t)/);var h=this.padding.x+this.style.strokeThickness;if(Array.isArray(i)){var u=0;for(var c=0;c<l.length;c++){var f=0;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){f=this.measureLine(l[c])}else{f=Math.ceil(this.context.measureText(l[c]).width)}if(c>0){u+=i[c-1]}h=u+f}}else{for(var c=0;c<l.length;c++){if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){h+=this.measureLine(l[c])}else{h+=Math.ceil(this.context.measureText(l[c]).width)}var d=this.game.math.snapToCeil(h,i)-h;h+=d}}}r[o]=Math.ceil(h);s=Math.max(s,r[o])}this.canvas.width=s*this._res;var p=n.fontSize+this.style.strokeThickness+this.padding.y;var g=p*a;var v=this._lineSpacing;if(v<0&&Math.abs(v)>p){v=-p}if(v!==0){g+=v>0?v*e.length:v*(e.length-1)}this.canvas.height=g*this._res;this.context.scale(this._res,this._res);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}if(this.style.backgroundColor){this.context.fillStyle=this.style.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline="alphabetic";this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";var m;var y;this._charCount=0;for(o=0;o<a;o++){m=this.style.strokeThickness/2;y=this.style.strokeThickness/2+o*p+n.ascent;if(o>0){y+=v*o}if(this.style.align==="right"){m+=s-r[o]}else if(this.style.align==="center"){m+=(s-r[o])/2}if(this.autoRound){m=Math.round(m);y=Math.round(y)}if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){this.updateLine(e[o],m,y)}else{if(this.style.stroke&&this.style.strokeThickness){this.updateShadow(this.style.shadowStroke);if(i===0){this.context.strokeText(e[o],m,y)}else{this.renderTabLine(e[o],m,y,false)}}if(this.style.fill){this.updateShadow(this.style.shadowFill);if(i===0){this.context.fillText(e[o],m,y)}else{this.renderTabLine(e[o],m,y,true)}}}}this.updateTexture();this.dirty=false};s.Text.prototype.renderTabLine=function(t,e,i,r){var s=t.split(/(?:\t)/);var n=this.style.tabs;var a=0;if(Array.isArray(n)){var o=0;for(var h=0;h<s.length;h++){if(h>0){o+=n[h-1]}a=e+o;if(r){this.context.fillText(s[h],a,i)}else{this.context.strokeText(s[h],a,i)}}}else{for(var h=0;h<s.length;h++){var l=Math.ceil(this.context.measureText(s[h]).width);a=this.game.math.snapToCeil(e,n);if(r){this.context.fillText(s[h],a,i)}else{this.context.strokeText(s[h],a,i)}e=a+l}}};s.Text.prototype.updateShadow=function(t){if(t){this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur}else{this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowColor=0;this.context.shadowBlur=0}};s.Text.prototype.measureLine=function(t){var e=0;for(var i=0;i<t.length;i++){var r=t[i];if(this.fontWeights.length>0||this.fontStyles.length>0){var s=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){s.fontStyle=this.fontStyles[this._charCount]}if(this.fontWeights[this._charCount]){s.fontWeight=this.fontWeights[this._charCount]}this.context.font=this.componentsToFont(s)}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount]}this.updateShadow(this.style.shadowStroke)}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount]}this.updateShadow(this.style.shadowFill)}e+=this.context.measureText(r).width;this._charCount++}return Math.ceil(e)};s.Text.prototype.updateLine=function(t,e,i){for(var r=0;r<t.length;r++){var s=t[r];if(this.fontWeights.length>0||this.fontStyles.length>0){var n=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){n.fontStyle=this.fontStyles[this._charCount]}if(this.fontWeights[this._charCount]){n.fontWeight=this.fontWeights[this._charCount]}this.context.font=this.componentsToFont(n)}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount]}this.updateShadow(this.style.shadowStroke);this.context.strokeText(s,e,i)}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount]}this.updateShadow(this.style.shadowFill);this.context.fillText(s,e,i)}e+=this.context.measureText(s).width;this._charCount++}};s.Text.prototype.clearColors=function(){this.colors=[];this.strokeColors=[];this.dirty=true;return this};s.Text.prototype.clearFontValues=function(){this.fontStyles=[];this.fontWeights=[];this.dirty=true;return this};s.Text.prototype.addColor=function(t,e){this.colors[e]=t;this.dirty=true;return this};s.Text.prototype.addStrokeColor=function(t,e){this.strokeColors[e]=t;this.dirty=true;return this};s.Text.prototype.addFontStyle=function(t,e){this.fontStyles[e]=t;this.dirty=true;return this};s.Text.prototype.addFontWeight=function(t,e){this.fontWeights[e]=t;this.dirty=true;return this};s.Text.prototype.precalculateWordWrap=function(t){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var e=this.runWordWrap(t);return e.split(/(?:\r\n|\r|\n)/)};s.Text.prototype.runWordWrap=function(t){if(this.useAdvancedWrap){return this.advancedWordWrap(t)}else{return this.basicWordWrap(t)}};s.Text.prototype.advancedWordWrap=function(t){var e=this.context;var i=this.style.wordWrapWidth;var r="";var s=t.replace(/ +/gi," ").split(/\r?\n/gi);var n=s.length;for(var a=0;a<n;a++){var o=s[a];var h="";o=o.replace(/^ *|\s*$/gi,"");var l=e.measureText(o).width;if(l<i){r+=o+"\n";continue}var u=i;var c=o.split(" ");for(var f=0;f<c.length;f++){var d=c[f];var p=d+" ";var g=e.measureText(p).width;if(g>u){if(f===0){var v=p;while(v.length){v=v.slice(0,-1);g=e.measureText(v).width;if(g<=u){break}}if(!v.length){throw new Error("This text's wordWrapWidth setting is less than a single character!")}var m=d.substr(v.length);c[f]=m;h+=v}var y=c[f].length?f:f+1;var x=c.slice(y).join(" ").replace(/[ \n]*$/gi,"");s[a+1]=x+" "+(s[a+1]||"");n=s.length;break}else{h+=p;u-=g}}r+=h.replace(/[ \n]*$/gi,"")+"\n"}r=r.replace(/[\s|\n]*$/gi,"");return r};s.Text.prototype.basicWordWrap=function(t){var e="";var i=t.split("\n");for(var r=0;r<i.length;r++){var s=this.style.wordWrapWidth;var n=i[r].split(" ");for(var a=0;a<n.length;a++){var o=this.context.measureText(n[a]).width;var h=o+this.context.measureText(" ").width;if(h>s){if(a>0){e+="\n"}e+=n[a]+" ";s=this.style.wordWrapWidth-o}else{s-=h;e+=n[a]+" "}}if(r<i.length-1){e+="\n"}}return e};s.Text.prototype.updateFont=function(t){var e=this.componentsToFont(t);if(this.style.font!==e){this.style.font=e;this.dirty=true;if(this.parent){this.updateTransform()}}};s.Text.prototype.fontToComponents=function(t){var e=t.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(e){var i=e[5].trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(i)&&!/['",]/.exec(i)){i="'"+i+"'"}return{font:t,fontStyle:e[1]||"normal",fontVariant:e[2]||"normal",fontWeight:e[3]||"normal",fontSize:e[4]||"medium",fontFamily:i}}else{console.warn("Phaser.Text - unparsable CSS font: "+t);return{font:t}}};s.Text.prototype.componentsToFont=function(t){var e=[];var i;i=t.fontStyle;if(i&&i!=="normal"){e.push(i)}i=t.fontVariant;if(i&&i!=="normal"){e.push(i)}i=t.fontWeight;if(i&&i!=="normal"){e.push(i)}i=t.fontSize;if(i&&i!=="medium"){e.push(i)}i=t.fontFamily;if(i){e.push(i)}if(!e.length){e.push(t.font)}return e.join(" ")};s.Text.prototype.setText=function(t,e){if(e===undefined){e=false}this.text=t.toString()||"";if(e){this.updateText()}else{this.dirty=true}return this};s.Text.prototype.parseList=function(t){if(!Array.isArray(t)){return this}else{var e="";for(var i=0;i<t.length;i++){if(Array.isArray(t[i])){e+=t[i].join("\t");if(i<t.length-1){e+="\n"}}else{e+=t[i];if(i<t.length-1){e+="\t"}}}}this.text=e;this.dirty=true;return this};s.Text.prototype.setTextBounds=function(t,e,i,r){if(t===undefined){this.textBounds=null}else{if(!this.textBounds){this.textBounds=new s.Rectangle(t,e,i,r)}else{this.textBounds.setTo(t,e,i,r)}if(this.style.wordWrapWidth>i){this.style.wordWrapWidth=i}}this.updateTexture();return this};s.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture;var e=this.texture.crop;var i=this.texture.frame;var r=this.canvas.width;var s=this.canvas.height;t.width=r;t.height=s;e.width=r;e.height=s;i.width=r;i.height=s;this.texture.width=r;this.texture.height=s;this._width=r;this._height=s;if(this.textBounds){var n=this.textBounds.x;var a=this.textBounds.y;if(this.style.boundsAlignH==="right"){n+=this.textBounds.width-this.canvas.width/this.resolution}else if(this.style.boundsAlignH==="center"){n+=this.textBounds.halfWidth-this.canvas.width/this.resolution/2}if(this.style.boundsAlignV==="bottom"){a+=this.textBounds.height-this.canvas.height/this.resolution}else if(this.style.boundsAlignV==="middle"){a+=this.textBounds.halfHeight-this.canvas.height/this.resolution/2}this.pivot.x=-n;this.pivot.y=-a}this.renderable=r!==0&&s!==0;this.texture.requiresReTint=true;this.texture.baseTexture.dirty()};s.Text.prototype._renderWebGL=function(t){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderWebGL.call(this,t)};s.Text.prototype._renderCanvas=function(t){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderCanvas.call(this,t)};s.Text.prototype.determineFontProperties=function(t){var e=s.Text.fontPropertiesCache[t];if(!e){e={};var i=s.Text.fontPropertiesCanvas;var r=s.Text.fontPropertiesContext;r.font=t;var n=Math.ceil(r.measureText("|MÉq").width);var a=Math.ceil(r.measureText("|MÉq").width);var o=2*a;a=a*1.4|0;i.width=n;i.height=o;r.fillStyle="#f00";r.fillRect(0,0,n,o);r.font=t;r.textBaseline="alphabetic";r.fillStyle="#000";r.fillText("|MÉq",0,a);if(!r.getImageData(0,0,n,o)){e.ascent=a;e.descent=a+6;e.fontSize=e.ascent+e.descent;s.Text.fontPropertiesCache[t]=e;return e}var h=r.getImageData(0,0,n,o).data;var l=h.length;var u=n*4;var c,f;var d=0;var p=false;for(c=0;c<a;c++){for(f=0;f<u;f+=4){if(h[d+f]!==255){p=true;break}}if(!p){d+=u}else{break}}e.ascent=a-c;d=l-u;p=false;for(c=o;c>a;c--){for(f=0;f<u;f+=4){if(h[d+f]!==255){p=true;break}}if(!p){d-=u}else{break}}e.descent=c-a;e.descent+=6;e.fontSize=e.ascent+e.descent;s.Text.fontPropertiesCache[t]=e}return e};s.Text.prototype.getBounds=function(t){if(this.dirty){this.updateText();this.dirty=false}return PIXI.Sprite.prototype.getBounds.call(this,t)};Object.defineProperty(s.Text.prototype,"text",{get:function(){return this._text},set:function(t){if(t!==this._text){this._text=t.toString()||"";this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(s.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(t){t=t||"bold 20pt Arial";this._fontComponents=this.fontToComponents(t);this.updateFont(this._fontComponents)}});Object.defineProperty(s.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(t){t=t||"Arial";t=t.trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)&&!/['",]/.exec(t)){t="'"+t+"'"}this._fontComponents.fontFamily=t;this.updateFont(this._fontComponents)}});Object.defineProperty(s.Text.prototype,"fontSize",{get:function(){var t=this._fontComponents.fontSize;if(t&&/(?:^0$|px$)/.exec(t)){return parseInt(t,10)}else{return t}},set:function(t){t=t||"0";if(typeof t==="number"){t=t+"px"}this._fontComponents.fontSize=t;this.updateFont(this._fontComponents)}});Object.defineProperty(s.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontWeight=t;this.updateFont(this._fontComponents)}});Object.defineProperty(s.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontStyle=t;this.updateFont(this._fontComponents)}});Object.defineProperty(s.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(t){t=t||"normal";this._fontComponents.fontVariant=t;this.updateFont(this._fontComponents)}});Object.defineProperty(s.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(t){if(t!==this.style.fill){this.style.fill=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"align",{get:function(){return this.style.align},set:function(t){if(t!==this.style.align){this.style.align=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"resolution",{get:function(){return this._res},set:function(t){if(t!==this._res){this._res=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(t){if(t!==this.style.tabs){this.style.tabs=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(t){if(t!==this.style.boundsAlignH){this.style.boundsAlignH=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(t){if(t!==this.style.boundsAlignV){this.style.boundsAlignV=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(t){if(t!==this.style.stroke){this.style.stroke=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(t){if(t!==this.style.strokeThickness){this.style.strokeThickness=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(t){if(t!==this.style.wordWrap){this.style.wordWrap=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(t){if(t!==this.style.wordWrapWidth){this.style.wordWrapWidth=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(t){if(t!==this._lineSpacing){this._lineSpacing=parseFloat(t);this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(s.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(t){if(t!==this.style.shadowOffsetX){this.style.shadowOffsetX=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(t){if(t!==this.style.shadowOffsetY){this.style.shadowOffsetY=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(t){if(t!==this.style.shadowColor){this.style.shadowColor=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(t){if(t!==this.style.shadowBlur){this.style.shadowBlur=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(t){if(t!==this.style.shadowStroke){this.style.shadowStroke=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(t){if(t!==this.style.shadowFill){this.style.shadowFill=t;this.dirty=true}}});Object.defineProperty(s.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*this.texture.frame.width},set:function(t){this.scale.x=t/this.texture.frame.width;this._width=t}});Object.defineProperty(s.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*this.texture.frame.height},set:function(t){this.scale.y=t/this.texture.frame.height;this._height=t}});s.Text.fontPropertiesCache={};s.Text.fontPropertiesCanvas=document.createElement("canvas");s.Text.fontPropertiesContext=s.Text.fontPropertiesCanvas.getContext("2d");/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.BitmapText=function(t,e,i,r,n,a,o){e=e||0;i=i||0;r=r||"";n=n||"";a=a||32;o=o||"left";PIXI.DisplayObjectContainer.call(this);this.type=s.BITMAPTEXT;this.physicsType=s.SPRITE;this.textWidth=0;this.textHeight=0;this.anchor=new s.Point;this._prevAnchor=new s.Point;this._glyphs=[];this._maxWidth=0;this._text=n.toString()||"";this._data=t.cache.getBitmapFont(r);this._font=r;this._fontSize=a;this._align=o;this._tint=16777215;this.updateText();this.dirty=false;s.Component.Core.init.call(this,t,e,i,"",null)};s.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);s.BitmapText.prototype.constructor=s.BitmapText;s.Component.Core.install.call(s.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);s.BitmapText.prototype.preUpdatePhysics=s.Component.PhysicsBody.preUpdate;s.BitmapText.prototype.preUpdateLifeSpan=s.Component.LifeSpan.preUpdate;s.BitmapText.prototype.preUpdateInWorld=s.Component.InWorld.preUpdate;s.BitmapText.prototype.preUpdateCore=s.Component.Core.preUpdate;s.BitmapText.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};s.BitmapText.prototype.postUpdate=function(){s.Component.PhysicsBody.postUpdate.call(this);s.Component.FixedToCamera.postUpdate.call(this);if(this.body&&this.body.type===s.Physics.ARCADE){if(this.textWidth!==this.body.sourceWidth||this.textHeight!==this.body.sourceHeight){this.body.setSize(this.textWidth,this.textHeight)}}};s.BitmapText.prototype.setText=function(t){this.text=t};s.BitmapText.prototype.scanLine=function(t,e,i){var r=0;var s=0;var n=-1;var a=0;var o=null;var h=this._maxWidth>0?this._maxWidth:null;var l=[];for(var u=0;u<i.length;u++){var c=u===i.length-1?true:false;if(/(?:\r\n|\r|\n)/.test(i.charAt(u))){return{width:s,text:i.substr(0,u),end:c,chars:l}}else{var f=i.charCodeAt(u);var d=t.chars[f];var p=0;if(d===undefined){f=32;d=t.chars[f]}var g=o&&d.kerning[o]?d.kerning[o]:0;if(/(\s)/.test(i.charAt(u))){n=u;a=s}p=(g+d.texture.width+d.xOffset)*e;if(h&&s+p>=h&&n>-1){return{width:a||s,text:i.substr(0,u-(u-n)),end:c,chars:l}}else{s+=(d.xAdvance+g)*e;l.push(r+(d.xOffset+g)*e);r+=(d.xAdvance+g)*e;o=f}}}return{width:s,text:i,end:c,chars:l}};s.BitmapText.prototype.cleanText=function(t,e){if(e===undefined){e=""}var i=this._data.font;if(!i){return""}var r=/\r\n|\n\r|\n|\r/g;var s=t.replace(r,"\n").split("\n");for(var n=0;n<s.length;n++){var a="";var o=s[n];for(var h=0;h<o.length;h++){if(i.chars[o.charCodeAt(h)]){a=a.concat(o[h])}else{a=a.concat(e)}}s[n]=a}return s.join("\n")};s.BitmapText.prototype.updateText=function(){var t=this._data.font;if(!t){return}var e=this.text;var i=this._fontSize/t.size;var r=[];var s=0;this.textWidth=0;do{var n=this.scanLine(t,i,e);n.y=s;r.push(n);if(n.width>this.textWidth){this.textWidth=n.width}s+=t.lineHeight*i;e=e.substr(n.text.length+1)}while(n.end===false);this.textHeight=s;var a=0;var o=0;var h=this.textWidth*this.anchor.x;var l=this.textHeight*this.anchor.y;for(var u=0;u<r.length;u++){var n=r[u];if(this._align==="right"){o=this.textWidth-n.width}else if(this._align==="center"){o=(this.textWidth-n.width)/2}for(var c=0;c<n.text.length;c++){var f=n.text.charCodeAt(c);var d=t.chars[f];if(d===undefined){f=32;d=t.chars[f]}var p=this._glyphs[a];if(p){p.texture=d.texture}else{p=new PIXI.Sprite(d.texture);p.name=n.text[c];this._glyphs.push(p)}p.position.x=n.chars[c]+o-h;p.position.y=n.y+d.yOffset*i-l;p.scale.set(i);p.tint=this.tint;p.texture.requiresReTint=true;if(!p.parent){this.addChild(p)}a++}}for(u=a;u<this._glyphs.length;u++){this.removeChild(this._glyphs[u])}};s.BitmapText.prototype.purgeGlyphs=function(){var t=this._glyphs.length;var e=[];for(var i=0;i<this._glyphs.length;i++){if(this._glyphs[i].parent!==this){this._glyphs[i].destroy()}else{e.push(this._glyphs[i])}}this._glyphs=[];this._glyphs=e;this.updateText();return t-e.length};s.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor)){this.updateText();this.dirty=false;this._prevAnchor.copyFrom(this.anchor)}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};Object.defineProperty(s.BitmapText.prototype,"align",{get:function(){return this._align},set:function(t){if(t!==this._align&&(t==="left"||t==="center"||t==="right")){this._align=t;this.updateText()}}});Object.defineProperty(s.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(t){if(t!==this._tint){this._tint=t;this.updateText()}}});Object.defineProperty(s.BitmapText.prototype,"font",{get:function(){return this._font},set:function(t){if(t!==this._font){this._font=t.trim();this._data=this.game.cache.getBitmapFont(this._font);this.updateText()}}});Object.defineProperty(s.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){t=parseInt(t,10);if(t!==this._fontSize&&t>0){this._fontSize=t;this.updateText()}}});Object.defineProperty(s.BitmapText.prototype,"text",{get:function(){return this._text},set:function(t){if(t!==this._text){this._text=t.toString()||"";this.updateText()}}});Object.defineProperty(s.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){if(t!==this._maxWidth){this._maxWidth=t;this.updateText()}}});Object.defineProperty(s.BitmapText.prototype,"smoothed",{get:function(){return!this._data.base.scaleMode},set:function(t){if(t){this._data.base.scaleMode=0}else{this._data.base.scaleMode=1}}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.RetroFont=function(t,e,i,r,n,a,o,h,l,u){if(!t.cache.checkImageKey(e)){return false}if(a===undefined||a===null){a=t.cache.getImage(e).width/i}this.characterWidth=i;this.characterHeight=r;this.characterSpacingX=o||0;this.characterSpacingY=h||0;this.characterPerRow=a;this.offsetX=l||0;this.offsetY=u||0;this.align="left";this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=t.cache.getImage(e);this._text="";this.grabData=[];this.frameData=new s.FrameData;var c=this.offsetX;var f=this.offsetY;var d=0;for(var p=0;p<n.length;p++){var g=this.frameData.addFrame(new s.Frame(p,c,f,this.characterWidth,this.characterHeight));this.grabData[n.charCodeAt(p)]=g.index;d++;if(d===this.characterPerRow){d=0;c=this.offsetX;f+=this.characterHeight+this.characterSpacingY}else{c+=this.characterWidth+this.characterSpacingX}}t.cache.updateFrameData(e,this.frameData);this.stamp=new s.Image(t,0,0,e,0);s.RenderTexture.call(this,t,100,100,"",s.scaleModes.NEAREST);this.type=s.RETROFONT};s.RetroFont.prototype=Object.create(s.RenderTexture.prototype);s.RetroFont.prototype.constructor=s.RetroFont;s.RetroFont.ALIGN_LEFT="left";s.RetroFont.ALIGN_RIGHT="right";s.RetroFont.ALIGN_CENTER="center";s.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";s.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";s.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";s.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";s.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";s.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";s.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";s.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";s.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";s.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";s.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";s.RetroFont.prototype.setFixedWidth=function(t,e){if(e===undefined){e="left"}this.fixedWidth=t;this.align=e};s.RetroFont.prototype.setText=function(t,e,i,r,s,n){this.multiLine=e||false;this.customSpacingX=i||0;this.customSpacingY=r||0;this.align=s||"left";if(n){this.autoUpperCase=false}else{this.autoUpperCase=true}if(t.length>0){this.text=t}};s.RetroFont.prototype.buildRetroFontText=function(){var t=0;var e=0;this.clear();if(this.multiLine){var i=this._text.split("\n");if(this.fixedWidth>0){this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,true)}for(var r=0;r<i.length;r++){t=0;if(this.align===s.RetroFont.ALIGN_RIGHT){t=this.width-i[r].length*(this.characterWidth+this.customSpacingX)}else if(this.align===s.RetroFont.ALIGN_CENTER){t=this.width/2-i[r].length*(this.characterWidth+this.customSpacingX)/2;t+=this.customSpacingX/2}if(t<0){t=0}this.pasteLine(i[r],t,e,this.customSpacingX);e+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}t=0;if(this.align===s.RetroFont.ALIGN_RIGHT){t=this.width-this._text.length*(this.characterWidth+this.customSpacingX)}else if(this.align===s.RetroFont.ALIGN_CENTER){t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2;t+=this.customSpacingX/2}if(t<0){t=0}this.pasteLine(this._text,t,0,this.customSpacingX)}this.requiresReTint=true};s.RetroFont.prototype.pasteLine=function(t,e,i,r){for(var s=0;s<t.length;s++){if(t.charAt(s)===" "){e+=this.characterWidth+r}else{if(this.grabData[t.charCodeAt(s)]>=0){this.stamp.frame=this.grabData[t.charCodeAt(s)];this.renderXY(this.stamp,e,i,false);e+=this.characterWidth+r;if(e>this.width){break}}}}};s.RetroFont.prototype.getLongestLine=function(){var t=0;if(this._text.length>0){var e=this._text.split("\n");for(var i=0;i<e.length;i++){if(e[i].length>t){t=e[i].length}}}return t};s.RetroFont.prototype.removeUnsupportedCharacters=function(t){var e="";for(var i=0;i<this._text.length;i++){var r=this._text[i];var s=r.charCodeAt(0);if(this.grabData[s]>=0||!t&&r==="\n"){e=e.concat(r)}}return e};s.RetroFont.prototype.updateOffset=function(t,e){if(this.offsetX===t&&this.offsetY===e){return}var i=t-this.offsetX;var r=e-this.offsetY;var s=this.game.cache.getFrameData(this.stamp.key).getFrames();var n=s.length;while(n--){s[n].x+=i;s[n].y+=r}this.buildRetroFontText()};Object.defineProperty(s.RetroFont.prototype,"text",{get:function(){return this._text},set:function(t){var e;if(this.autoUpperCase){e=t.toUpperCase()}else{e=t}if(e!==this._text){this._text=e;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});Object.defineProperty(s.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(t){this.stamp.smoothed=t;this.buildRetroFontText()}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd, Richard Davey
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Rope=function(t,e,i,r,n,a){this.points=[];this.points=a;this._hasUpdateAnimation=false;this._updateAnimationCallback=null;e=e||0;i=i||0;r=r||null;n=n||null;this.type=s.ROPE;PIXI.Rope.call(this,s.Cache.DEFAULT,this.points);s.Component.Core.init.call(this,t,e,i,r,n)};s.Rope.prototype=Object.create(PIXI.Rope.prototype);s.Rope.prototype.constructor=s.Rope;s.Component.Core.install.call(s.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);s.Rope.prototype.preUpdatePhysics=s.Component.PhysicsBody.preUpdate;s.Rope.prototype.preUpdateLifeSpan=s.Component.LifeSpan.preUpdate;s.Rope.prototype.preUpdateInWorld=s.Component.InWorld.preUpdate;s.Rope.prototype.preUpdateCore=s.Component.Core.preUpdate;s.Rope.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};s.Rope.prototype.update=function(){if(this._hasUpdateAnimation){this.updateAnimation.call(this)}};s.Rope.prototype.reset=function(t,e){s.Component.Reset.prototype.reset.call(this,t,e);return this};Object.defineProperty(s.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(t){if(t&&typeof t==="function"){this._hasUpdateAnimation=true;this._updateAnimation=t}else{this._hasUpdateAnimation=false;this._updateAnimation=null}}});Object.defineProperty(s.Rope.prototype,"segments",{get:function(){var t=[];var e,i,r,n,a,o,h,l;for(var u=0;u<this.points.length;u++){e=u*4;i=this.vertices[e]*this.scale.x;r=this.vertices[e+1]*this.scale.y;n=this.vertices[e+4]*this.scale.x;a=this.vertices[e+3]*this.scale.y;o=s.Math.difference(i,n);h=s.Math.difference(r,a);i+=this.world.x;r+=this.world.y;l=new s.Rectangle(i,r,o,h);t.push(l)}return t}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.TileSprite=function(t,e,i,r,n,a,o){e=e||0;i=i||0;r=r||256;n=n||256;a=a||null;o=o||null;this.type=s.TILESPRITE;this.physicsType=s.SPRITE;this._scroll=new s.Point;var h=t.cache.getImage("__default",true);PIXI.TilingSprite.call(this,new PIXI.Texture(h.base),r,n);s.Component.Core.init.call(this,t,e,i,a,o)};s.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);s.TileSprite.prototype.constructor=s.TileSprite;s.Component.Core.install.call(s.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]);s.TileSprite.prototype.preUpdatePhysics=s.Component.PhysicsBody.preUpdate;s.TileSprite.prototype.preUpdateLifeSpan=s.Component.LifeSpan.preUpdate;s.TileSprite.prototype.preUpdateInWorld=s.Component.InWorld.preUpdate;s.TileSprite.prototype.preUpdateCore=s.Component.Core.preUpdate;s.TileSprite.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};s.TileSprite.prototype.autoScroll=function(t,e){this._scroll.set(t,e)};s.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};s.TileSprite.prototype.destroy=function(t){s.Component.Destroy.prototype.destroy.call(this,t);PIXI.TilingSprite.prototype.destroy.call(this)};s.TileSprite.prototype.reset=function(t,e){s.Component.Reset.prototype.reset.call(this,t,e);this.tilePosition.x=0;this.tilePosition.y=0;return this};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Device=function(){this.deviceReadyAt=0;this.initialized=false;this.desktop=false;this.iOS=false;this.iOSVersion=0;this.cocoonJS=false;this.cocoonJSApp=false;this.cordova=false;this.node=false;this.nodeWebkit=false;this.electron=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.canvasBitBltShift=null;this.webGL=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.worker=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=true;this.quirksMode=false;this.touch=false;this.mspointer=false;this.wheelEvent=null;this.arora=false;this.chrome=false;this.chromeVersion=0;this.epiphany=false;this.firefox=false;this.firefoxVersion=0;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.edge=false;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.safariVersion=0;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.dolby=false;this.oggVideo=false;this.h264Video=false;this.mp4Video=false;this.webmVideo=false;this.vp9Video=false;this.hlsVideo=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.LITTLE_ENDIAN=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=false};s.Device=new s.Device;s.Device.onInitialized=new s.Signal;s.Device.whenReady=function(t,e,i){var r=this._readyCheck;if(this.deviceReadyAt||!r){t.call(e,this)}else if(r._monitor||i){r._queue=r._queue||[];r._queue.push([t,e])}else{r._monitor=r.bind(this);r._queue=r._queue||[];r._queue.push([t,e]);var s=typeof window.cordova!=="undefined";var n=navigator["isCocoonJS"];if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(r._monitor,0)}else if(s&&!n){document.addEventListener("deviceready",r._monitor,false)}else{document.addEventListener("DOMContentLoaded",r._monitor,false);window.addEventListener("load",r._monitor,false)}}};s.Device._readyCheck=function(){var t=this._readyCheck;if(!document.body){window.setTimeout(t._monitor,20)}else if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",t._monitor);document.removeEventListener("DOMContentLoaded",t._monitor);window.removeEventListener("load",t._monitor);this._initialize();this.initialized=true;this.onInitialized.dispatch(this);var e;while(e=t._queue.shift()){var i=e[0];var r=e[1];i.call(r,this)}this._readyCheck=null;this._initialize=null;this.onInitialized=null}};s.Device._initialize=function(){var t=this;function e(){var e=navigator.userAgent;if(/Playstation Vita/.test(e)){t.vita=true}else if(/Kindle/.test(e)||/\bKF[A-Z][A-Z]+/.test(e)||/Silk.*Mobile Safari/.test(e)){t.kindle=true}else if(/Android/.test(e)){t.android=true}else if(/CrOS/.test(e)){t.chromeOS=true}else if(/iP[ao]d|iPhone/i.test(e)){t.iOS=true;navigator.appVersion.match(/OS (\d+)/);t.iOSVersion=parseInt(RegExp.$1,10)}else if(/Linux/.test(e)){t.linux=true}else if(/Mac OS/.test(e)){t.macOS=true}else if(/Windows/.test(e)){t.windows=true}if(/Windows Phone/i.test(e)||/IEMobile/i.test(e)){t.android=false;t.iOS=false;t.macOS=false;t.windows=true;t.windowsPhone=true}var i=/Silk/.test(e);if(t.windows||t.macOS||t.linux&&!i||t.chromeOS){t.desktop=true}if(t.windowsPhone||/Windows NT/i.test(e)&&/Touch/i.test(e)){t.desktop=false}}function r(){t.canvas=!!window["CanvasRenderingContext2D"]||t.cocoonJS;try{t.localStorage=!!localStorage.getItem}catch(e){t.localStorage=false}t.file=!!window["File"]&&!!window["FileReader"]&&!!window["FileList"]&&!!window["Blob"];t.fileSystem=!!window["requestFileSystem"];t.webGL=function(){try{var t=document.createElement("canvas");t.screencanvas=false;return!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(t){return false}}();t.webGL=!!t.webGL;t.worker=!!window["Worker"];t.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;t.quirksMode=document.compatMode==="CSS1Compat"?false:true;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;t.getUserMedia=t.getUserMedia&&!!navigator.getUserMedia&&!!window.URL;if(t.firefox&&t.firefoxVersion<21){t.getUserMedia=false}if(!t.iOS&&(t.ie||t.firefox||t.chrome)){t.canvasBitBltShift=true}if(t.safari||t.mobileSafari){t.canvasBitBltShift=false}}function s(){if("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1){t.touch=true}if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled){t.mspointer=true}if(!t.cocoonJS){if("onwheel"in window||t.ie&&"WheelEvent"in window){t.wheelEvent="wheel"}else if("onmousewheel"in window){t.wheelEvent="mousewheel"}else if(t.firefox&&"MouseScrollEvent"in window){t.wheelEvent="DOMMouseScroll"}}}function n(){var e=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];var i=document.createElement("div");for(var r=0;r<e.length;r++){if(i[e[r]]){t.fullscreen=true;t.requestFullscreen=e[r];break}}var s=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(t.fullscreen){for(var r=0;r<s.length;r++){if(document[s[r]]){t.cancelFullscreen=s[r];break}}}if(window["Element"]&&Element["ALLOW_KEYBOARD_INPUT"]){t.fullscreenKeyboard=true}}function a(){var e=navigator.userAgent;if(/Arora/.test(e)){t.arora=true}else if(/Edge\/\d+/.test(e)){t.edge=true}else if(/Chrome\/(\d+)/.test(e)&&!t.windowsPhone){t.chrome=true;t.chromeVersion=parseInt(RegExp.$1,10)}else if(/Epiphany/.test(e)){t.epiphany=true}else if(/Firefox\D+(\d+)/.test(e)){t.firefox=true;t.firefoxVersion=parseInt(RegExp.$1,10)}else if(/AppleWebKit/.test(e)&&t.iOS){t.mobileSafari=true}else if(/MSIE (\d+\.\d+);/.test(e)){t.ie=true;t.ieVersion=parseInt(RegExp.$1,10)}else if(/Midori/.test(e)){t.midori=true}else if(/Opera/.test(e)){t.opera=true}else if(/Safari\/(\d+)/.test(e)&&!t.windowsPhone){t.safari=true;if(/Version\/(\d+)\./.test(e)){t.safariVersion=parseInt(RegExp.$1,10)}}else if(/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(e)){t.ie=true;t.trident=true;t.tridentVersion=parseInt(RegExp.$1,10);t.ieVersion=parseInt(RegExp.$3,10)}if(/Silk/.test(e)){t.silk=true}if(navigator["standalone"]){t.webApp=true}if(typeof window.cordova!=="undefined"){t.cordova=true}if(typeof i!=="undefined"&&"function"!=="undefined"){t.node=true}if(t.node&&typeof i.versions==="object"){t.nodeWebkit=!!i.versions["node-webkit"];t.electron=!!i.versions.electron}if(navigator["isCocoonJS"]){t.cocoonJS=true}if(t.cocoonJS){try{t.cocoonJSApp=typeof CocoonJS!=="undefined"}catch(e){t.cocoonJSApp=false}}if(typeof window.ejecta!=="undefined"){t.ejecta=true}if(/Crosswalk/.test(e)){t.crosswalk=true}}function o(){var e=document.createElement("video");var i=false;try{if(i=!!e.canPlayType){if(e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")){t.oggVideo=true}if(e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")){t.h264Video=true;t.mp4Video=true}if(e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")){t.webmVideo=true}if(e.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")){t.vp9Video=true}if(e.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")){t.hlsVideo=true}}}catch(t){}}function h(){t.audioData=!!window["Audio"];t.webAudio=!!(window["AudioContext"]||window["webkitAudioContext"]);var e=document.createElement("audio");var i=false;try{if(i=!!e.canPlayType){if(e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){t.ogg=true}if(e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||e.canPlayType("audio/opus;").replace(/^no$/,"")){t.opus=true}if(e.canPlayType("audio/mpeg;").replace(/^no$/,"")){t.mp3=true}if(e.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){t.wav=true}if(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/aac;").replace(/^no$/,"")){t.m4a=true}if(e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){t.webm=true}if(e.canPlayType('audio/mp4;codecs="ec-3"')!==""){if(t.edge){t.dolby=true}else if(t.safari&&t.safariVersion>=9){if(/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var r=parseInt(RegExp.$1,10);var s=parseInt(RegExp.$2,10);if(r===10&&s>=11||r>10){t.dolby=true}}}}}}catch(t){}}function l(){var t=new ArrayBuffer(4);var e=new Uint8Array(t);var i=new Uint32Array(t);e[0]=161;e[1]=178;e[2]=195;e[3]=212;if(i[0]===3569595041){return true}if(i[0]===2712847316){return false}else{return null}}function u(){if(Uint8ClampedArray===undefined){return false}var t=PIXI.CanvasPool.create(this,1,1);var e=t.getContext("2d");if(!e){return false}var i=e.createImageData(1,1);PIXI.CanvasPool.remove(this);return i.data instanceof Uint8ClampedArray}function c(){t.pixelRatio=window["devicePixelRatio"]||1;t.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!==-1;t.iPhone4=t.pixelRatio===2&&t.iPhone;t.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!==-1;if(typeof Int8Array!=="undefined"){t.typedArray=true}else{t.typedArray=false}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint32Array!=="undefined"){t.littleEndian=l();t.LITTLE_ENDIAN=t.littleEndian}t.support32bit=typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&t.littleEndian!==null&&u();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){t.vibration=true}}function f(){var e=document.createElement("p");var i;var r={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(e,null);for(var s in r){if(e.style[s]!==undefined){e.style[s]="translate3d(1px,1px,1px)";i=window.getComputedStyle(e).getPropertyValue(r[s])}}document.body.removeChild(e);t.css3D=i!==undefined&&i.length>0&&i!=="none"}e();a();h();o();f();c();r();n();s()};s.Device.canPlayAudio=function(t){if(t==="mp3"&&this.mp3){return true}else if(t==="ogg"&&(this.ogg||this.opus)){return true}else if(t==="m4a"&&this.m4a){return true}else if(t==="opus"&&this.opus){return true}else if(t==="wav"&&this.wav){return true}else if(t==="webm"&&this.webm){return true}else if(t==="mp4"&&this.dolby){return true}return false};s.Device.canPlayVideo=function(t){if(t==="webm"&&(this.webmVideo||this.vp9Video)){return true}else if(t==="mp4"&&(this.mp4Video||this.h264Video)){return true}else if((t==="ogg"||t==="ogv")&&this.oggVideo){return true}else if(t==="mpeg"&&this.hlsVideo){return true}return false};s.Device.isConsoleOpen=function(){if(window.console&&window.console["firebug"]){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}if(console["profiles"]){return console["profiles"].length>0}}return false};s.Device.isAndroidStockBrowser=function(){var t=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return t&&t[1]<537};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Canvas={create:function(t,e,i,r,s){e=e||256;i=i||256;var n=s?document.createElement("canvas"):PIXI.CanvasPool.create(t,e,i);if(typeof r==="string"&&r!==""){n.id=r}n.width=e;n.height=i;n.style.display="block";return n},setBackgroundColor:function(t,e){e=e||"rgb(0,0,0)";t.style.backgroundColor=e;return t},setTouchAction:function(t,e){e=e||"none";t.style.msTouchAction=e;t.style["ms-touch-action"]=e;t.style["touch-action"]=e;return t},setUserSelect:function(t,e){e=e||"none";t.style["-webkit-touch-callout"]=e;t.style["-webkit-user-select"]=e;t.style["-khtml-user-select"]=e;t.style["-moz-user-select"]=e;t.style["-ms-user-select"]=e;t.style["user-select"]=e;t.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return t},addToDOM:function(t,e,i){var r;if(i===undefined){i=true}if(e){if(typeof e==="string"){r=document.getElementById(e)}else if(typeof e==="object"&&e.nodeType===1){r=e}}if(!r){r=document.body}if(i&&r.style){r.style.overflow="hidden"}r.appendChild(t);return t},removeFromDOM:function(t){if(t.parentNode){t.parentNode.removeChild(t)}},setTransform:function(t,e,i,r,s,n,a){t.setTransform(r,n,a,s,e,i);return t},setSmoothingEnabled:function(t,e){var i=s.Canvas.getSmoothingPrefix(t);if(i){t[i]=e}return t},getSmoothingPrefix:function(t){var e=["i","webkitI","msI","mozI","oI"];for(var i in e){var r=e[i]+"mageSmoothingEnabled";if(r in t){return r}}return null},getSmoothingEnabled:function(t){var e=s.Canvas.getSmoothingPrefix(t);if(e){return t[e]}},setImageRenderingCrisp:function(t){var e=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"];for(var i=0;i<e.length;i++){t.style["image-rendering"]=e[i]}t.style.msInterpolationMode="nearest-neighbor";return t},setImageRenderingBicubic:function(t){t.style["image-rendering"]="auto";t.style.msInterpolationMode="bicubic";return t}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.RequestAnimationFrame=function(t,e){if(e===undefined){e=false}this.game=t;this.isRunning=false;this.forceSetTimeOut=e;var i=["ms","moz","webkit","o"];for(var r=0;r<i.length&&!window.requestAnimationFrame;r++){window.requestAnimationFrame=window[i[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[i[r]+"CancelAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};s.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var t=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return t.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(e){return t.updateRAF(e)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(t){if(this.isRunning){this.game.update(Math.floor(t));this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateSetTimeout:function(){if(this.isRunning){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)}},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===false}};s.RequestAnimationFrame.prototype.constructor=s.RequestAnimationFrame;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Math={PI2:Math.PI*2,between:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},fuzzyEqual:function(t,e,i){if(i===undefined){i=1e-4}return Math.abs(t-e)<i},fuzzyLessThan:function(t,e,i){if(i===undefined){i=1e-4}return t<e+i},fuzzyGreaterThan:function(t,e,i){if(i===undefined){i=1e-4}return t>e-i},fuzzyCeil:function(t,e){if(e===undefined){e=1e-4}return Math.ceil(t-e)},fuzzyFloor:function(t,e){if(e===undefined){e=1e-4}return Math.floor(t+e)},average:function(){var t=0;var e=arguments.length;for(var i=0;i<e;i++){t+=+arguments[i]}return t/e},shear:function(t){return t%1},snapTo:function(t,e,i){if(i===undefined){i=0}if(e===0){return t}t-=i;t=e*Math.round(t/e);return i+t},snapToFloor:function(t,e,i){if(i===undefined){i=0}if(e===0){return t}t-=i;t=e*Math.floor(t/e);return i+t},snapToCeil:function(t,e,i){if(i===undefined){i=0}if(e===0){return t}t-=i;t=e*Math.ceil(t/e);return i+t},roundTo:function(t,e,i){if(e===undefined){e=0}if(i===undefined){i=10}var r=Math.pow(i,-e);return Math.round(t*r)/r},floorTo:function(t,e,i){if(e===undefined){e=0}if(i===undefined){i=10}var r=Math.pow(i,-e);return Math.floor(t*r)/r},ceilTo:function(t,e,i){if(e===undefined){e=0}if(i===undefined){i=10}var r=Math.pow(i,-e);return Math.ceil(t*r)/r},rotateToAngle:function(t,e,i){if(i===undefined){i=.05}if(t===e){return t}if(Math.abs(e-t)<=i||Math.abs(e-t)>=s.Math.PI2-i){t=e}else{if(Math.abs(e-t)>Math.PI){if(e<t){e+=s.Math.PI2}else{e-=s.Math.PI2}}if(e>t){t+=i}else if(e<t){t-=i}}return t},getShortestAngle:function(t,e){var i=e-t;if(i===0){return 0}var r=Math.floor((i- -180)/360);return i-r*360},angleBetween:function(t,e,i,r){return Math.atan2(r-e,i-t)},angleBetweenY:function(t,e,i,r){return Math.atan2(i-t,r-e)},angleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},angleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},reverseAngle:function(t){return this.normalizeAngle(t+Math.PI,true)},normalizeAngle:function(t){t=t%(2*Math.PI);return t>=0?t:t+2*Math.PI},maxAdd:function(t,e,i){return Math.min(t+e,i)},minSub:function(t,e,i){return Math.max(t-e,i)},wrap:function(t,e,i){var r=i-e;if(r<=0){return 0}var s=(t-e)%r;if(s<0){s+=r}return s+e},wrapValue:function(t,e,i){var r;t=Math.abs(t);e=Math.abs(e);i=Math.abs(i);r=(t+e)%i;return r},isOdd:function(t){return!!(t&1)},isEven:function(t){return!(t&1)},min:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var t=arguments[0]}else{var t=arguments}for(var e=1,i=0,r=t.length;e<r;e++){if(t[e]<t[i]){i=e}}return t[i]},max:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var t=arguments[0]}else{var t=arguments}for(var e=1,i=0,r=t.length;e<r;e++){if(t[e]>t[i]){i=e}}return t[i]},minProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var e=arguments[1]}else{var e=arguments.slice(1)}for(var i=1,r=0,s=e.length;i<s;i++){if(e[i][t]<e[r][t]){r=i}}return e[r][t]},maxProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var e=arguments[1]}else{var e=arguments.slice(1)}for(var i=1,r=0,s=e.length;i<s;i++){if(e[i][t]>e[r][t]){r=i}}return e[r][t]},wrapAngle:function(t,e){return e?this.wrap(t,-Math.PI,Math.PI):this.wrap(t,-180,180)},linearInterpolation:function(t,e){var i=t.length-1;var r=i*e;var s=Math.floor(r);if(e<0){return this.linear(t[0],t[1],r)}if(e>1){return this.linear(t[i],t[i-1],i-r)}return this.linear(t[s],t[s+1>i?i:s+1],r-s)},bezierInterpolation:function(t,e){var i=0;var r=t.length-1;for(var s=0;s<=r;s++){i+=Math.pow(1-e,r-s)*Math.pow(e,s)*t[s]*this.bernstein(r,s)}return i},catmullRomInterpolation:function(t,e){var i=t.length-1;var r=i*e;var s=Math.floor(r);if(t[0]===t[i]){if(e<0){s=Math.floor(r=i*(1+e))}return this.catmullRom(t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i],r-s)}else{if(e<0){return t[0]-(this.catmullRom(t[0],t[0],t[1],t[1],-r)-t[0])}if(e>1){return t[i]-(this.catmullRom(t[i],t[i],t[i-1],t[i-1],r-i)-t[i])}return this.catmullRom(t[s?s-1:0],t[s],t[i<s+1?i:s+1],t[i<s+2?i:s+2],r-s)}},linear:function(t,e,i){return(e-t)*i+t},bernstein:function(t,e){return this.factorial(t)/this.factorial(e)/this.factorial(t-e)},factorial:function(t){if(t===0){return 1}var e=t;while(--t){e*=t}return e},catmullRom:function(t,e,i,r,s){var n=(i-t)*.5,a=(r-e)*.5,o=s*s,h=s*o;return(2*e-2*i+n+a)*h+(-3*e+3*i-2*n-a)*o+n*s+e},difference:function(t,e){return Math.abs(t-e)},roundAwayFromZero:function(t){return t>0?Math.ceil(t):Math.floor(t)},sinCosGenerator:function(t,e,i,r){if(e===undefined){e=1}if(i===undefined){i=1}if(r===undefined){r=1}var s=e;var n=i;var a=r*Math.PI/t;var o=[];var h=[];for(var l=0;l<t;l++){n-=s*a;s+=n*a;o[l]=n;h[l]=s}return{sin:h,cos:o,length:t}},distance:function(t,e,i,r){var s=t-i;var n=e-r;return Math.sqrt(s*s+n*n)},distanceSq:function(t,e,i,r){var s=t-i;var n=e-r;return s*s+n*n},distancePow:function(t,e,i,r,s){if(s===undefined){s=2}return Math.sqrt(Math.pow(i-t,s)+Math.pow(r-e,s))},clamp:function(t,e,i){if(t<e){return e}else if(i<t){return i}else{return t}},clampBottom:function(t,e){return t<e?e:t},within:function(t,e,i){return Math.abs(t-e)<=i},mapLinear:function(t,e,i,r,s){return r+(t-e)*(s-r)/(i-e)},smoothstep:function(t,e,i){t=Math.max(0,Math.min(1,(t-e)/(i-e)));return t*t*(3-2*t)},smootherstep:function(t,e,i){t=Math.max(0,Math.min(1,(t-e)/(i-e)));return t*t*t*(t*(t*6-15)+10)},sign:function(t){return t<0?-1:t>0?1:0},percent:function(t,e,i){if(i===undefined){i=0}if(t>e||i>e){return 1}else if(t<i||i>t){return 0}else{return(t-i)/e}}};var d=Math.PI/180;var p=180/Math.PI;s.Math.degToRad=function t(e){return e*d};s.Math.radToDeg=function t(e){return e*p};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.RandomDataGenerator=function(t){if(t===undefined){t=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;if(typeof t==="string"){this.state(t)}else{this.sow(t)}};s.RandomDataGenerator.prototype={rnd:function(){var t=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=t|0;this.s0=this.s1;this.s1=this.s2;this.s2=t-this.c;return this.s2},sow:function(t){this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;if(!t){return}for(var e=0;e<t.length&&t[e]!=null;e++){var i=t[e];this.s0-=this.hash(i);this.s0+=~~(this.s0<0);this.s1-=this.hash(i);this.s1+=~~(this.s1<0);this.s2-=this.hash(i);this.s2+=~~(this.s2<0)}},hash:function(t){var e,i,r;r=4022871197;t=t.toString();for(i=0;i<t.length;i++){r+=t.charCodeAt(i);e=.02519603282416938*r;r=e>>>0;e-=r;e*=r;r=e>>>0;e-=r;r+=e*4294967296}return(r>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t)},between:function(t,e){return this.integerInRange(t,e)},realInRange:function(t,e){return this.frac()*(e-t)+t},normal:function(){return 1-2*this.frac()},uuid:function(){var t="";var e="";for(e=t="";t++<36;e+=~t%5|t*3&4?(t^15?8^this.frac()*(t^20?16:4):4).toString(16):"-"){}return e},pick:function(t){return t[this.integerInRange(0,t.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(t){return t[~~(Math.pow(this.frac(),2)*(t.length-1)+.5)]},timestamp:function(t,e){return this.realInRange(t||9466848e5,e||1577862e6)},angle:function(){return this.integerInRange(-180,180)},state:function(t){if(typeof t==="string"&&t.match(/^!rnd/)){t=t.split(",");this.c=parseFloat(t[1]);this.s0=parseFloat(t[2]);this.s1=parseFloat(t[3]);this.s2=parseFloat(t[4])}return["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}};s.RandomDataGenerator.prototype.constructor=s.RandomDataGenerator;/**
 * @author       Timo Hausmann
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2016 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
s.QuadTree=function(t,e,i,r,s,n,a){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(t,e,i,r,s,n,a)};s.QuadTree.prototype={reset:function(t,e,i,r,s,n,a){this.maxObjects=s||10;this.maxLevels=n||4;this.level=a||0;this.bounds={x:Math.round(t),y:Math.round(e),width:i,height:r,subWidth:Math.floor(i/2),subHeight:Math.floor(r/2),right:Math.round(t)+Math.floor(i/2),bottom:Math.round(e)+Math.floor(r/2)};this.objects.length=0;this.nodes.length=0},populate:function(t){t.forEach(this.populateHandler,this,true)},populateHandler:function(t){if(t.body&&t.exists){this.insert(t.body)}},split:function(){this.nodes[0]=new s.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new s.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new s.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new s.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(t){var e=0;var i;if(this.nodes[0]!=null){i=this.getIndex(t);if(i!==-1){this.nodes[i].insert(t);return}}this.objects.push(t);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(e<this.objects.length){i=this.getIndex(this.objects[e]);if(i!==-1){this.nodes[i].insert(this.objects.splice(e,1)[0])}else{e++}}}},getIndex:function(t){var e=-1;if(t.x<this.bounds.right&&t.right<this.bounds.right){if(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom){e=1}else if(t.y>this.bounds.bottom){e=2}}else if(t.x>this.bounds.right){if(t.y<this.bounds.bottom&&t.bottom<this.bounds.bottom){e=0}else if(t.y>this.bounds.bottom){e=3}}return e},retrieve:function(t){if(t instanceof s.Rectangle){var e=this.objects;var i=this.getIndex(t)}else{if(!t.body){return this._empty}var e=this.objects;var i=this.getIndex(t.body)}if(this.nodes[0]){if(i!==-1){e=e.concat(this.nodes[i].retrieve(t))}else{e=e.concat(this.nodes[0].retrieve(t));e=e.concat(this.nodes[1].retrieve(t));e=e.concat(this.nodes[2].retrieve(t));e=e.concat(this.nodes[3].retrieve(t))}}return e},clear:function(){this.objects.length=0;var t=this.nodes.length;while(t--){this.nodes[t].clear();this.nodes.splice(t,1)}this.nodes.length=0}};s.QuadTree.prototype.constructor=s.QuadTree;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Net=function(t){this.game=t};s.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(t){return window.location.hostname.indexOf(t)!==-1},updateQueryString:function(t,e,i,r){if(i===undefined){i=false}if(r===undefined||r===""){r=window.location.href}var s="";var n=new RegExp("([?|&])"+t+"=.*?(&|#|$)(.*)","gi");if(n.test(r)){if(typeof e!=="undefined"&&e!==null){s=r.replace(n,"$1"+t+"="+e+"$2$3")}else{s=r.replace(n,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof e!=="undefined"&&e!==null){var a=r.indexOf("?")!==-1?"&":"?";var o=r.split("#");r=o[0]+a+t+"="+e;if(o[1]){r+="#"+o[1]}s=r}else{s=r}}if(i){window.location.href=s}else{return s}},getQueryString:function(t){if(t===undefined){t=""}var e={};var i=location.search.substring(1).split("&");for(var r in i){var s=i[r].split("=");if(s.length>1){if(t&&t===this.decodeURI(s[0])){return this.decodeURI(s[1])}else{e[this.decodeURI(s[0])]=this.decodeURI(s[1])}}}return e},decodeURI:function(t){return decodeURIComponent(t.replace(/\+/g," "))}};s.Net.prototype.constructor=s.Net;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.TweenManager=function(t){this.game=t;this.frameBased=false;this._tweens=[];this._add=[];this.easeMap={Power0:s.Easing.Power0,Power1:s.Easing.Power1,Power2:s.Easing.Power2,Power3:s.Easing.Power3,Power4:s.Easing.Power4,Linear:s.Easing.Linear.None,Quad:s.Easing.Quadratic.Out,Cubic:s.Easing.Cubic.Out,Quart:s.Easing.Quartic.Out,Quint:s.Easing.Quintic.Out,Sine:s.Easing.Sinusoidal.Out,Expo:s.Easing.Exponential.Out,Circ:s.Easing.Circular.Out,Elastic:s.Easing.Elastic.Out,Back:s.Easing.Back.Out,Bounce:s.Easing.Bounce.Out,"Quad.easeIn":s.Easing.Quadratic.In,"Cubic.easeIn":s.Easing.Cubic.In,"Quart.easeIn":s.Easing.Quartic.In,"Quint.easeIn":s.Easing.Quintic.In,"Sine.easeIn":s.Easing.Sinusoidal.In,"Expo.easeIn":s.Easing.Exponential.In,"Circ.easeIn":s.Easing.Circular.In,"Elastic.easeIn":s.Easing.Elastic.In,"Back.easeIn":s.Easing.Back.In,"Bounce.easeIn":s.Easing.Bounce.In,"Quad.easeOut":s.Easing.Quadratic.Out,"Cubic.easeOut":s.Easing.Cubic.Out,"Quart.easeOut":s.Easing.Quartic.Out,"Quint.easeOut":s.Easing.Quintic.Out,"Sine.easeOut":s.Easing.Sinusoidal.Out,"Expo.easeOut":s.Easing.Exponential.Out,"Circ.easeOut":s.Easing.Circular.Out,"Elastic.easeOut":s.Easing.Elastic.Out,"Back.easeOut":s.Easing.Back.Out,"Bounce.easeOut":s.Easing.Bounce.Out,"Quad.easeInOut":s.Easing.Quadratic.InOut,"Cubic.easeInOut":s.Easing.Cubic.InOut,"Quart.easeInOut":s.Easing.Quartic.InOut,"Quint.easeInOut":s.Easing.Quintic.InOut,"Sine.easeInOut":s.Easing.Sinusoidal.InOut,"Expo.easeInOut":s.Easing.Exponential.InOut,"Circ.easeInOut":s.Easing.Circular.InOut,"Elastic.easeInOut":s.Easing.Elastic.InOut,"Back.easeInOut":s.Easing.Back.InOut,"Bounce.easeInOut":s.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};s.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var t=0;t<this._tweens.length;t++){this._tweens[t].pendingDelete=true}this._add=[]},removeFrom:function(t,e){if(e===undefined){e=true}var i;var r;if(Array.isArray(t)){for(i=0,r=t.length;i<r;i++){this.removeFrom(t[i])}}else if(t.type===s.GROUP&&e){for(var i=0,r=t.children.length;i<r;i++){this.removeFrom(t.children[i])}}else{for(i=0,r=this._tweens.length;i<r;i++){if(t===this._tweens[i].target){this.remove(this._tweens[i])}}for(i=0,r=this._add.length;i<r;i++){if(t===this._add[i].target){this.remove(this._add[i])}}}},add:function(t){t._manager=this;this._add.push(t)},create:function(t){return new s.Tween(t,this.game,this)},remove:function(t){var e=this._tweens.indexOf(t);if(e!==-1){this._tweens[e].pendingDelete=true}else{e=this._add.indexOf(t);if(e!==-1){this._add[e].pendingDelete=true}}},update:function(){var t=this._add.length;var e=this._tweens.length;if(e===0&&t===0){return false}var i=0;while(i<e){if(this._tweens[i].update(this.game.time.time)){i++}else{this._tweens.splice(i,1);e--}}if(t>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(t){return this._tweens.some(function(e){return e.target===t})},_pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t]._pause()}},_resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t]._resume()}},pauseAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t].pause()}},resumeAll:function(){for(var t=this._tweens.length-1;t>=0;t--){this._tweens[t].resume(true)}}};s.TweenManager.prototype.constructor=s.TweenManager;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Tween=function(t,e,i){this.game=e;this.target=t;this.manager=i;this.timeline=[];this.reverse=false;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=false;this.onStart=new s.Signal;this.onLoop=new s.Signal;this.onRepeat=new s.Signal;this.onChildComplete=new s.Signal;this.onComplete=new s.Signal;this.isRunning=false;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=false;this.frameBased=i.frameBased;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=false;this._hasStarted=false};s.Tween.prototype={to:function(t,e,i,r,n,a,o){if(e===undefined||e<=0){e=1e3}if(i===undefined||i===null){i=s.Easing.Default}if(r===undefined){r=false}if(n===undefined){n=0}if(a===undefined){a=0}if(o===undefined){o=false}if(typeof i==="string"&&this.manager.easeMap[i]){i=this.manager.easeMap[i]}if(this.isRunning){console.warn("Phaser.Tween.to cannot be called after Tween.start");return this}this.timeline.push(new s.TweenData(this).to(t,e,i,n,a,o));if(r){this.start()}return this},from:function(t,e,i,r,n,a,o){if(e===undefined){e=1e3}if(i===undefined||i===null){i=s.Easing.Default}if(r===undefined){r=false}if(n===undefined){n=0}if(a===undefined){a=0}if(o===undefined){o=false}if(typeof i==="string"&&this.manager.easeMap[i]){i=this.manager.easeMap[i]}if(this.isRunning){console.warn("Phaser.Tween.from cannot be called after Tween.start");return this}this.timeline.push(new s.TweenData(this).from(t,e,i,n,a,o));if(r){this.start()}return this},start:function(t){if(t===undefined){t=0}if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning){return this}for(var e=0;e<this.timeline.length;e++){for(var i in this.timeline[e].vEnd){this.properties[i]=this.target[i]||0;if(!Array.isArray(this.properties[i])){this.properties[i]*=1}}}for(var e=0;e<this.timeline.length;e++){this.timeline[e].loadValues()}this.manager.add(this);this.isRunning=true;if(t<0||t>this.timeline.length-1){t=0}this.current=t;this.timeline[this.current].start();return this},stop:function(t){if(t===undefined){t=false}this.isRunning=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;if(t){this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}}this.manager.remove(this);return this},updateTweenData:function(t,e,i){if(this.timeline.length===0){return this}if(i===undefined){i=0}if(i===-1){for(var r=0;r<this.timeline.length;r++){this.timeline[r][t]=e}}else{this.timeline[i][t]=e}return this},delay:function(t,e){return this.updateTweenData("delay",t,e)},repeat:function(t,e,i){if(e===undefined){e=0}this.updateTweenData("repeatCounter",t,i);return this.updateTweenData("repeatDelay",e,i)},repeatDelay:function(t,e){return this.updateTweenData("repeatDelay",t,e)},yoyo:function(t,e,i){if(e===undefined){e=0}this.updateTweenData("yoyo",t,i);return this.updateTweenData("yoyoDelay",e,i)},yoyoDelay:function(t,e){return this.updateTweenData("yoyoDelay",t,e)},easing:function(t,e){if(typeof t==="string"&&this.manager.easeMap[t]){t=this.manager.easeMap[t]}return this.updateTweenData("easingFunction",t,e)},interpolation:function(t,e,i){if(e===undefined){e=s.Math}this.updateTweenData("interpolationFunction",t,i);return this.updateTweenData("interpolationContext",e,i)},repeatAll:function(t){if(t===undefined){t=0}this.repeatCounter=t;return this},chain:function(){var t=arguments.length;while(t--){if(t>0){arguments[t-1].chainedTween=arguments[t]}else{this.chainedTween=arguments[t]}}return this},loop:function(t){if(t===undefined){t=true}this.repeatCounter=t?-1:0;return this},onUpdateCallback:function(t,e){this._onUpdateCallback=t;this._onUpdateCallbackContext=e;return this},pause:function(){this.isPaused=true;this._codePaused=true;this._pausedTime=this.game.time.time},_pause:function(){if(!this._codePaused){this.isPaused=true;this._pausedTime=this.game.time.time}},resume:function(){if(this.isPaused){this.isPaused=false;this._codePaused=false;for(var t=0;t<this.timeline.length;t++){if(!this.timeline[t].isRunning){this.timeline[t].startTime+=this.game.time.time-this._pausedTime}}}},_resume:function(){if(this._codePaused){return}else{this.resume()}},update:function(t){if(this.pendingDelete||!this.target){return false}if(this.isPaused){return true}var e=this.timeline[this.current].update(t);if(e===s.TweenData.PENDING){return true}else if(e===s.TweenData.RUNNING){if(!this._hasStarted){this.onStart.dispatch(this.target,this);this._hasStarted=true}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current])}return this.isRunning}else if(e===s.TweenData.LOOPED){if(this.timeline[this.current].repeatCounter===-1){this.onLoop.dispatch(this.target,this)}else{this.onRepeat.dispatch(this.target,this)}return true}else if(e===s.TweenData.COMPLETE){var i=false;if(this.reverse){this.current--;if(this.current<0){this.current=this.timeline.length-1;i=true}}else{this.current++;if(this.current===this.timeline.length){this.current=0;i=true}}if(i){if(this.repeatCounter===-1){this.timeline[this.current].start();this.onLoop.dispatch(this.target,this);return true}else if(this.repeatCounter>0){this.repeatCounter--;this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{this.isRunning=false;this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}return false}}else{this.onChildComplete.dispatch(this.target,this);this.timeline[this.current].start();return true}}},generateData:function(t,e){if(this.game===null||this.target===null){return null}if(t===undefined){t=60}if(e===undefined){e=[]}for(var i=0;i<this.timeline.length;i++){for(var r in this.timeline[i].vEnd){this.properties[r]=this.target[r]||0;if(!Array.isArray(this.properties[r])){this.properties[r]*=1}}}for(var i=0;i<this.timeline.length;i++){this.timeline[i].loadValues()}for(var i=0;i<this.timeline.length;i++){e=e.concat(this.timeline[i].generateData(t))}return e}};Object.defineProperty(s.Tween.prototype,"totalDuration",{get:function(){var t=0;for(var e=0;e<this.timeline.length;e++){t+=this.timeline[e].duration}return t}});s.Tween.prototype.constructor=s.Tween;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.TweenData=function(t){this.parent=t;this.game=t.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1e3;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.repeatTotal=0;this.interpolate=false;this.yoyo=false;this.yoyoDelay=0;this.inReverse=false;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=s.Easing.Default;this.interpolationFunction=s.Math.linearInterpolation;this.interpolationContext=s.Math;this.isRunning=false;this.isFrom=false};s.TweenData.PENDING=0;s.TweenData.RUNNING=1;s.TweenData.LOOPED=2;s.TweenData.COMPLETE=3;s.TweenData.prototype={to:function(t,e,i,r,s,n){this.vEnd=t;this.duration=e;this.easingFunction=i;this.delay=r;this.repeatTotal=s;this.yoyo=n;this.isFrom=false;return this},from:function(t,e,i,r,s,n){this.vEnd=t;this.duration=e;this.easingFunction=i;this.delay=r;this.repeatTotal=s;this.yoyo=n;this.isFrom=true;return this},start:function(){this.startTime=this.game.time.time+this.delay;if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}if(this.delay>0){this.isRunning=false}else{this.isRunning=true}if(this.isFrom){for(var t in this.vStartCache){this.vStart[t]=this.vEndCache[t];this.vEnd[t]=this.vStartCache[t];this.parent.target[t]=this.vStart[t]}}this.value=0;this.yoyoCounter=0;this.repeatCounter=this.repeatTotal;return this},loadValues:function(){for(var t in this.parent.properties){this.vStart[t]=this.parent.properties[t];if(Array.isArray(this.vEnd[t])){if(this.vEnd[t].length===0){continue}if(this.percent===0){this.vEnd[t]=[this.vStart[t]].concat(this.vEnd[t])}}if(typeof this.vEnd[t]!=="undefined"){if(typeof this.vEnd[t]==="string"){this.vEnd[t]=this.vStart[t]+parseFloat(this.vEnd[t],10)}this.parent.properties[t]=this.vEnd[t]}else{this.vEnd[t]=this.vStart[t]}this.vStartCache[t]=this.vStart[t];this.vEndCache[t]=this.vEnd[t]}return this},update:function(t){if(!this.isRunning){if(t>=this.startTime){this.isRunning=true}else{return s.TweenData.PENDING}}else{if(t<this.startTime){return s.TweenData.RUNNING}}var e=this.parent.frameBased?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;if(this.parent.reverse){this.dt-=e*this.parent.timeScale;this.dt=Math.max(this.dt,0)}else{this.dt+=e*this.parent.timeScale;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var i in this.vEnd){var r=this.vStart[i];var n=this.vEnd[i];if(Array.isArray(n)){this.parent.target[i]=this.interpolationFunction.call(this.interpolationContext,n,this.value)}else{this.parent.target[i]=r+(n-r)*this.value}}if(!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0){return this.repeat()}return s.TweenData.RUNNING},generateData:function(t){if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}var e=[];var i=false;var r=1/t*1e3;do{if(this.parent.reverse){this.dt-=r;this.dt=Math.max(this.dt,0)}else{this.dt+=r;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var s={};for(var n in this.vEnd){var a=this.vStart[n];var o=this.vEnd[n];if(Array.isArray(o)){s[n]=this.interpolationFunction(o,this.value)}else{s[n]=a+(o-a)*this.value}}e.push(s);if(!this.parent.reverse&&this.percent===1||this.parent.reverse&&this.percent===0){i=true}}while(!i);if(this.yoyo){var h=e.slice();h.reverse();e=e.concat(h)}return e},repeat:function(){if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){for(var t in this.vStartCache){this.vStart[t]=this.vStartCache[t];this.vEnd[t]=this.vEndCache[t]}this.inReverse=false;return s.TweenData.COMPLETE}this.inReverse=!this.inReverse}else{if(this.repeatCounter===0){return s.TweenData.COMPLETE}}if(this.inReverse){for(var t in this.vStartCache){this.vStart[t]=this.vEndCache[t];this.vEnd[t]=this.vStartCache[t]}}else{for(var t in this.vStartCache){this.vStart[t]=this.vStartCache[t];this.vEnd[t]=this.vEndCache[t]}if(this.repeatCounter>0){this.repeatCounter--}}this.startTime=this.game.time.time;if(this.yoyo&&this.inReverse){this.startTime+=this.yoyoDelay}else if(!this.inReverse){this.startTime+=this.repeatDelay}if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}return s.TweenData.LOOPED}};s.TweenData.prototype.constructor=s.TweenData;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){if((t*=2)<1)return.5*t*t;return-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){if((t*=2)<1)return.5*t*t*t;return.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){if((t*=2)<1)return.5*t*t*t*t;return-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){if((t*=2)<1)return.5*t*t*t*t*t;return.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){if(t===0)return 0;if(t===1)return 1;return 1-Math.cos(t*Math.PI/2)},Out:function(t){if(t===0)return 0;if(t===1)return 1;return Math.sin(t*Math.PI/2)},InOut:function(t){if(t===0)return 0;if(t===1)return 1;return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return t===0?0:Math.pow(1024,t-1)},Out:function(t){return t===1?1:1-Math.pow(2,-10*t)},InOut:function(t){if(t===0)return 0;if(t===1)return 1;if((t*=2)<1)return.5*Math.pow(1024,t-1);return.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){if((t*=2)<1)return-.5*(Math.sqrt(1-t*t)-1);return.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,r=.4;if(t===0)return 0;if(t===1)return 1;if(!i||i<1){i=1;e=r/4}else e=r*Math.asin(1/i)/(2*Math.PI);return-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r))},Out:function(t){var e,i=.1,r=.4;if(t===0)return 0;if(t===1)return 1;if(!i||i<1){i=1;e=r/4}else e=r*Math.asin(1/i)/(2*Math.PI);return i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/r)+1},InOut:function(t){var e,i=.1,r=.4;if(t===0)return 0;if(t===1)return 1;if(!i||i<1){i=1;e=r/4}else e=r*Math.asin(1/i)/(2*Math.PI);if((t*=2)<1)return-.5*(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r));return i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)*.5+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=1.70158*1.525;if((t*=2)<1)return.5*(t*t*((e+1)*t-e));return.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-s.Easing.Bounce.Out(1-t)},Out:function(t){if(t<1/2.75){return 7.5625*t*t}else if(t<2/2.75){return 7.5625*(t-=1.5/2.75)*t+.75}else if(t<2.5/2.75){return 7.5625*(t-=2.25/2.75)*t+.9375}else{return 7.5625*(t-=2.625/2.75)*t+.984375}},InOut:function(t){if(t<.5)return s.Easing.Bounce.In(t*2)*.5;return s.Easing.Bounce.Out(t*2-1)*.5+.5}}};s.Easing.Default=s.Easing.Linear.None;s.Easing.Power0=s.Easing.Linear.None;s.Easing.Power1=s.Easing.Quadratic.Out;s.Easing.Power2=s.Easing.Cubic.Out;s.Easing.Power3=s.Easing.Quartic.Out;s.Easing.Power4=s.Easing.Quintic.Out;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Time=function(t){this.game=t;this.time=0;this.prevTime=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.physicsElapsed=1/60;this.physicsElapsedMS=1/60*1e3;this.desiredFpsMult=1/60;this._desiredFps=60;this.suggestedFps=this.desiredFps;this.slowMotion=1;this.advancedTiming=false;this.frames=0;this.fps=0;this.fpsMin=1e3;this.fpsMax=0;this.msMin=1e3;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new s.Timer(this.game,false);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=false;this._timers=[]};s.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start();this.timeExpected=this.time},add:function(t){this._timers.push(t);return t},create:function(t){if(t===undefined){t=true}var e=new s.Timer(this.game,t);this._timers.push(e);return e},removeAll:function(){for(var t=0;t<this._timers.length;t++){this._timers[t].destroy()}this._timers=[];this.events.removeAll()},refresh:function(){var t=this.time;this.time=Date.now();this.elapsedMS=this.time-t},update:function(t){var e=this.time;this.time=Date.now();this.elapsedMS=this.time-e;this.prevTime=this.now;this.now=t;this.elapsed=this.now-this.prevTime;if(this.game.raf._isSetTimeOut){this.timeToCall=Math.floor(Math.max(0,1e3/this._desiredFps-(this.timeExpected-t)));this.timeExpected=t+this.timeToCall}if(this.advancedTiming){this.updateAdvancedTiming()}if(!this.game.paused){this.events.update(this.time);if(this._timers.length){this.updateTimers()}}},updateTimers:function(){var t=0;var e=this._timers.length;while(t<e){if(this._timers[t].update(this.time)){t++}else{this._timers.splice(t,1);e--}}},updateAdvancedTiming:function(){this._frameCount++;this._elapsedAccumulator+=this.elapsed;if(this._frameCount>=this._desiredFps*2){this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5;this._frameCount=0;this._elapsedAccumulator=0}this.msMin=Math.min(this.msMin,this.elapsed);this.msMax=Math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1e3){this.fps=Math.round(this.frames*1e3/(this.now-this._timeLastSecond));this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();var t=this._timers.length;while(t--){this._timers[t]._pause()}},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();var t=this._timers.length;while(t--){this._timers[t]._resume()}},totalElapsedSeconds:function(){return(this.time-this._started)*.001},elapsedSince:function(t){return this.time-t},elapsedSecondsSince:function(t){return(this.time-t)*.001},reset:function(){this._started=this.time;this.removeAll()}};Object.defineProperty(s.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(t){this._desiredFps=t;this.physicsElapsed=1/t;this.physicsElapsedMS=this.physicsElapsed*1e3;this.desiredFpsMult=1/t}});s.Time.prototype.constructor=s.Time;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Timer=function(t,e){if(e===undefined){e=true}this.game=t;this.running=false;this.autoDestroy=e;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new s.Signal;this.nextTick=0;this.timeCap=1e3;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};s.Timer.MINUTE=6e4;s.Timer.SECOND=1e3;s.Timer.HALF=500;s.Timer.QUARTER=250;s.Timer.prototype={create:function(t,e,i,r,n,a){t=Math.round(t);var o=t;if(this._now===0){o+=this.game.time.time}else{o+=this._now}var h=new s.TimerEvent(this,t,o,i,e,r,n,a);this.events.push(h);this.order();this.expired=false;return h},add:function(t,e,i){return this.create(t,false,0,e,i,Array.prototype.slice.call(arguments,3))},repeat:function(t,e,i,r){return this.create(t,false,e,i,r,Array.prototype.slice.call(arguments,4))},loop:function(t,e,i){return this.create(t,true,0,e,i,Array.prototype.slice.call(arguments,3))},start:function(t){if(this.running){return}this._started=this.game.time.time+(t||0);this.running=true;for(var e=0;e<this.events.length;e++){this.events[e].tick=this.events[e].delay+this._started}},stop:function(t){this.running=false;if(t===undefined){t=true}if(t){this.events.length=0}},remove:function(t){for(var e=0;e<this.events.length;e++){if(this.events[e]===t){this.events[e].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(t,e){if(t.tick<e.tick){return-1}else if(t.tick>e.tick){return 1}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(t){if(this.paused){return true}this.elapsed=t-this._now;this._now=t;if(this.elapsed>this.timeCap){this.adjustEvents(t-this.elapsed)}this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete){this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick);if(this._newTick<0){this._newTick=this._now+this.events[this._i].delay}if(this.events[this._i].loop===true){this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else if(this.events[this._i].repeatCount>0){this.events[this._i].repeatCount--;this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{this._marked++;this.events[this._i].pendingDelete=true;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.time;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.time;this.paused=true},adjustEvents:function(t){for(var e=0;e<this.events.length;e++){if(!this.events[e].pendingDelete){var i=this.events[e].tick-t;if(i<0){i=0}this.events[e].tick=this._now+i}}var r=this.nextTick-t;if(r<0){this.nextTick=this._now}else{this.nextTick=this._now+r}},resume:function(){if(!this.paused){return}var t=this.game.time.time;this._pauseTotal+=t-this._now;this._now=t;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.events=[];this._len=0;this._i=0}};Object.defineProperty(s.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(s.Timer.prototype,"duration",{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(s.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(s.Timer.prototype,"ms",{get:function(){if(this.running){return this._now-this._started-this._pauseTotal}else{return 0}}});Object.defineProperty(s.Timer.prototype,"seconds",{get:function(){if(this.running){return this.ms*.001}else{return 0}}});s.Timer.prototype.constructor=s.Timer;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.TimerEvent=function(t,e,i,r,s,n,a,o){this.timer=t;this.delay=e;this.tick=i;this.repeatCount=r-1;this.loop=s;this.callback=n;this.callbackContext=a;this.args=o;this.pendingDelete=false};s.TimerEvent.prototype.constructor=s.TimerEvent;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.AnimationManager=function(t){this.sprite=t;this.game=t.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};s.AnimationManager.prototype={loadFrameData:function(t,e){if(t===undefined){return false}if(this.isLoaded){for(var i in this._anims){this._anims[i].updateFrameData(t)}}this._frameData=t;if(e===undefined||e===null){this.frame=0}else{if(typeof e==="string"){this.frameName=e}else{this.frame=e}}this.isLoaded=true;return true},copyFrameData:function(t,e){this._frameData=t.clone();if(this.isLoaded){for(var i in this._anims){this._anims[i].updateFrameData(this._frameData)}}if(e===undefined||e===null){this.frame=0}else{if(typeof e==="string"){this.frameName=e}else{this.frame=e}}this.isLoaded=true;return true},add:function(t,e,i,r,n){e=e||[];i=i||60;if(r===undefined){r=false}if(n===undefined){if(e&&typeof e[0]==="number"){n=true}else{n=false}}this._outputFrames=[];this._frameData.getFrameIndexes(e,n,this._outputFrames);this._anims[t]=new s.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,r);this.currentAnim=this._anims[t];if(this.sprite.tilingTexture){this.sprite.refreshTexture=true}return this._anims[t]},validateFrames:function(t,e){if(e===undefined){e=true}for(var i=0;i<t.length;i++){if(e===true){if(t[i]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(t[i])===false){return false}}}return true},play:function(t,e,i,r){if(this._anims[t]){if(this.currentAnim===this._anims[t]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(e,i,r)}return this.currentAnim}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[t];this.currentAnim.paused=false;this.currentFrame=this.currentAnim.currentFrame;return this.currentAnim.play(e,i,r)}}},stop:function(t,e){if(e===undefined){e=false}if(this.currentAnim&&(typeof t!=="string"||t===this.currentAnim.name)){this.currentAnim.stop(e)}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()){this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(t){if(this.currentAnim){this.currentAnim.next(t);this.currentFrame=this.currentAnim.currentFrame}},previous:function(t){if(this.currentAnim){this.currentAnim.previous(t);this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(t){if(typeof t==="string"){if(this._anims[t]){return this._anims[t]}}return null},refreshFrame:function(){},destroy:function(){var t=null;for(var t in this._anims){if(this._anims.hasOwnProperty(t)){this._anims[t].destroy()}}this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};s.AnimationManager.prototype.constructor=s.AnimationManager;Object.defineProperty(s.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(s.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(s.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}});Object.defineProperty(s.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim){return this.currentAnim.name}}});Object.defineProperty(s.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this.currentFrame.index}},set:function(t){if(typeof t==="number"&&this._frameData&&this._frameData.getFrame(t)!==null){this.currentFrame=this._frameData.getFrame(t);if(this.currentFrame){this.sprite.setFrame(this.currentFrame)}}}});Object.defineProperty(s.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(t){if(typeof t==="string"&&this._frameData&&this._frameData.getFrameByName(t)!==null){this.currentFrame=this._frameData.getFrameByName(t);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame)}}else{console.warn("Cannot set frameName: "+t)}}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Animation=function(t,e,i,r,n,a,o){if(o===undefined){o=false}this.game=t;this._parent=e;this._frameData=r;this.name=i;this._frames=[];this._frames=this._frames.concat(n);this.delay=1e3/a;this.loop=o;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new s.Signal;this.onUpdate=null;this.onComplete=new s.Signal;this.onLoop=new s.Signal;this.isReversed=false;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};s.Animation.prototype={play:function(t,e,i){if(typeof t==="number"){this.delay=1e3/t}if(typeof e==="boolean"){this.loop=e}if(typeof i!=="undefined"){this.killOnComplete=i}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=this.isReversed?this._frames.length-1:0;this.updateCurrentFrame(false,true);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},reverse:function(){this.reversed=!this.reversed;return this},reverseOnce:function(){this.onComplete.addOnce(this.reverse,this);return this.reverse()},setFrame:function(t,e){var i;if(e===undefined){e=false}if(typeof t==="string"){for(var r=0;r<this._frames.length;r++){if(this._frameData.getFrame(this._frames[r]).name===t){i=r}}}else if(typeof t==="number"){if(e){i=t}else{for(var r=0;r<this._frames.length;r++){if(this._frames[r]===t){i=r}}}}if(i){this._frameIndex=i-1;this._timeNextFrame=this.game.time.time;this.update()}},stop:function(t,e){if(t===undefined){t=false}if(e===undefined){e=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(t){this.currentFrame=this._frameData.getFrame(this._frames[0]);this._parent.setFrame(this.currentFrame)}if(e){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.time}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.time+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying&&this.game.time.time>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.time-this._timeNextFrame;this._timeLastFrame=this.game.time.time;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=this._frameSkip*this.delay}this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff);if(this.isReversed){this._frameIndex-=this._frameSkip}else{this._frameIndex+=this._frameSkip}if(!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1){if(this.loop){this._frameIndex=Math.abs(this._frameIndex)%this._frames.length;if(this.isReversed){this._frameIndex=this._frames.length-1-this._frameIndex}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame)}this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame);return!!this._frameData}else{return true}}else{this.complete();return false}}else{return this.updateCurrentFrame(true)}}return false},updateCurrentFrame:function(t,e){if(e===undefined){e=false}if(!this._frameData){return false}var i=this.currentFrame.index;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame&&(e||!e&&i!==this.currentFrame.index)){this._parent.setFrame(this.currentFrame)}if(this.onUpdate&&t){this.onUpdate.dispatch(this,this.currentFrame);return!!this._frameData}else{return true}},next:function(t){if(t===undefined){t=1}var e=this._frameIndex+t;if(e>=this._frames.length){if(this.loop){e%=this._frames.length}else{e=this._frames.length-1}}if(e!==this._frameIndex){this._frameIndex=e;this.updateCurrentFrame(true)}},previous:function(t){if(t===undefined){t=1}var e=this._frameIndex-t;if(e<0){if(this.loop){e=this._frames.length+e}else{e++}}if(e!==this._frameIndex){this._frameIndex=e;this.updateCurrentFrame(true)}},updateFrameData:function(t){this._frameData=t;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){if(!this._frameData){return}this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();if(this.onUpdate){this.onUpdate.dispose()}},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};s.Animation.prototype.constructor=s.Animation;Object.defineProperty(s.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t;if(t){this._pauseStartTime=this.game.time.time}else{if(this.isPlaying){this._timeNextFrame=this.game.time.time+this.delay}}}});Object.defineProperty(s.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(t){this.isReversed=t}});Object.defineProperty(s.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(s.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(t){this.currentFrame=this._frameData.getFrame(this._frames[t]);if(this.currentFrame!==null){this._frameIndex=t;this._parent.setFrame(this.currentFrame);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame)}}}});Object.defineProperty(s.Animation.prototype,"speed",{get:function(){return 1e3/this.delay},set:function(t){if(t>0){this.delay=1e3/t}}});Object.defineProperty(s.Animation.prototype,"enableUpdate",{get:function(){return this.onUpdate!==null},set:function(t){if(t&&this.onUpdate===null){this.onUpdate=new s.Signal}else if(!t&&this.onUpdate!==null){this.onUpdate.dispose();this.onUpdate=null}}});s.Animation.generateFrameNames=function(t,e,i,r,n){if(r===undefined){r=""}var a=[];var o="";if(e<i){for(var h=e;h<=i;h++){if(typeof n==="number"){o=s.Utils.pad(h.toString(),n,"0",1)}else{o=h.toString()}o=t+o+r;a.push(o)}}else{for(var h=e;h>=i;h--){if(typeof n==="number"){o=s.Utils.pad(h.toString(),n,"0",1)}else{o=h.toString()}o=t+o+r;a.push(o)}}return a};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Frame=function(t,e,i,r,n,a){this.index=t;this.x=e;this.y=i;this.width=r;this.height=n;this.name=a;this.centerX=Math.floor(r/2);this.centerY=Math.floor(n/2);this.distance=s.Math.distance(0,0,r,n);this.rotated=false;this.rotationDirection="cw";this.trimmed=false;this.sourceSizeW=r;this.sourceSizeH=n;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};s.Frame.prototype={resize:function(t,e){this.width=t;this.height=e;this.centerX=Math.floor(t/2);this.centerY=Math.floor(e/2);this.distance=s.Math.distance(0,0,t,e);this.sourceSizeW=t;this.sourceSizeH=e;this.right=this.x+t;this.bottom=this.y+e},setTrim:function(t,e,i,r,s,n,a){this.trimmed=t;if(t){this.sourceSizeW=e;this.sourceSizeH=i;this.centerX=Math.floor(e/2);this.centerY=Math.floor(i/2);this.spriteSourceSizeX=r;this.spriteSourceSizeY=s;this.spriteSourceSizeW=n;this.spriteSourceSizeH=a}},clone:function(){var t=new s.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var e in this){if(this.hasOwnProperty(e)){t[e]=this[e]}}return t},getRect:function(t){if(t===undefined){t=new s.Rectangle(this.x,this.y,this.width,this.height)}else{t.setTo(this.x,this.y,this.width,this.height)}return t}};s.Frame.prototype.constructor=s.Frame;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.FrameData=function(){this._frames=[];this._frameNames=[]};s.FrameData.prototype={addFrame:function(t){t.index=this._frames.length;this._frames.push(t);if(t.name!==""){this._frameNames[t.name]=t.index}return t},getFrame:function(t){if(t>=this._frames.length){t=0}return this._frames[t]},getFrameByName:function(t){if(typeof this._frameNames[t]==="number"){return this._frames[this._frameNames[t]]}return null},checkFrameName:function(t){if(this._frameNames[t]==null){return false}return true},clone:function(){var t=new s.FrameData;for(var e=0;e<this._frames.length;e++){t._frames.push(this._frames[e].clone())}for(var i in this._frameNames){if(this._frameNames.hasOwnProperty(i)){t._frameNames.push(this._frameNames[i])}}return t},getFrameRange:function(t,e,i){if(i===undefined){i=[]}for(var r=t;r<=e;r++){i.push(this._frames[r])}return i},getFrames:function(t,e,i){if(e===undefined){e=true}if(i===undefined){i=[]}if(t===undefined||t.length===0){for(var r=0;r<this._frames.length;r++){i.push(this._frames[r])}}else{for(var r=0;r<t.length;r++){if(e){i.push(this.getFrame(t[r]))}else{i.push(this.getFrameByName(t[r]))}}}return i},getFrameIndexes:function(t,e,i){if(e===undefined){e=true}if(i===undefined){i=[]}if(t===undefined||t.length===0){for(var r=0;r<this._frames.length;r++){i.push(this._frames[r].index)}}else{for(var r=0;r<t.length;r++){if(e&&this._frames[t[r]]){i.push(this._frames[t[r]].index)}else{if(this.getFrameByName(t[r])){i.push(this.getFrameByName(t[r]).index)}}}}return i},destroy:function(){this._frames=null;this._frameNames=null}};s.FrameData.prototype.constructor=s.FrameData;Object.defineProperty(s.FrameData.prototype,"total",{get:function(){return this._frames.length}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.AnimationParser={spriteSheet:function(t,e,i,r,n,a,o){var h=e;if(typeof e==="string"){h=t.cache.getImage(e)}if(h===null){return null}var l=h.width;var u=h.height;if(i<=0){i=Math.floor(-l/Math.min(-1,i))}if(r<=0){r=Math.floor(-u/Math.min(-1,r))}var c=Math.floor((l-a)/(i+o));var f=Math.floor((u-a)/(r+o));var d=c*f;if(n!==-1){d=n}if(l===0||u===0||l<i||u<r||d===0){console.warn("Phaser.AnimationParser.spriteSheet: '"+e+"'s width/height zero or width/height < given frameWidth/frameHeight");return null}var p=new s.FrameData;var g=a;var v=a;for(var m=0;m<d;m++){p.addFrame(new s.Frame(m,g,v,i,r,""));g+=i+o;if(g+i>l){g=a;v+=r+o}}return p},JSONData:function(t,e){if(!e["frames"]){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(e);return}var i=new s.FrameData;var r=e["frames"];var n;for(var a=0;a<r.length;a++){n=i.addFrame(new s.Frame(a,r[a].frame.x,r[a].frame.y,r[a].frame.w,r[a].frame.h,r[a].filename));if(r[a].trimmed){n.setTrim(r[a].trimmed,r[a].sourceSize.w,r[a].sourceSize.h,r[a].spriteSourceSize.x,r[a].spriteSourceSize.y,r[a].spriteSourceSize.w,r[a].spriteSourceSize.h)}}return i},JSONDataPyxel:function(t,e){var i=["layers","tilewidth","tileheight","tileswide","tileshigh"];i.forEach(function(t){if(!e[t]){console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+t+'" key.');console.log(e);return}});if(e["layers"].length!==1){console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps.");console.log(e);return}var r=new s.FrameData;var n=e["tileheight"];var a=e["tilewidth"];var o=e["layers"][0]["tiles"];var h;for(var l=0;l<o.length;l++){h=r.addFrame(new s.Frame(l,o[l].x,o[l].y,a,n,"frame_"+l));h.setTrim(false)}return r},JSONDataHash:function(t,e){if(!e["frames"]){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(e);return}var i=new s.FrameData;var r=e["frames"];var n;var a=0;for(var o in r){n=i.addFrame(new s.Frame(a,r[o].frame.x,r[o].frame.y,r[o].frame.w,r[o].frame.h,o));if(r[o].trimmed){n.setTrim(r[o].trimmed,r[o].sourceSize.w,r[o].sourceSize.h,r[o].spriteSourceSize.x,r[o].spriteSourceSize.y,r[o].spriteSourceSize.w,r[o].spriteSourceSize.h)}a++}return i},XMLData:function(t,e){if(!e.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var i=new s.FrameData;var r=e.getElementsByTagName("SubTexture");var n;var a;var o;var h;var l;var u;var c;var f;var d;var p;var g;for(var v=0;v<r.length;v++){o=r[v].attributes;a=o.name.value;h=parseInt(o.x.value,10);l=parseInt(o.y.value,10);u=parseInt(o.width.value,10);c=parseInt(o.height.value,10);f=null;d=null;if(o.frameX){f=Math.abs(parseInt(o.frameX.value,10));d=Math.abs(parseInt(o.frameY.value,10));p=parseInt(o.frameWidth.value,10);g=parseInt(o.frameHeight.value,10)}n=i.addFrame(new s.Frame(v,h,l,u,c,a));if(f!==null||d!==null){n.setTrim(true,u,c,f,d,p,g)}}return i}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Cache=function(t){this.game=t;this.autoResolveURL=false;this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{}};this._urlMap={};this._urlResolver=new Image;this._urlTemp=null;this.onSoundUnlock=new s.Signal;this._cacheMap=[];this._cacheMap[s.Cache.CANVAS]=this._cache.canvas;this._cacheMap[s.Cache.IMAGE]=this._cache.image;this._cacheMap[s.Cache.TEXTURE]=this._cache.texture;this._cacheMap[s.Cache.SOUND]=this._cache.sound;this._cacheMap[s.Cache.TEXT]=this._cache.text;this._cacheMap[s.Cache.PHYSICS]=this._cache.physics;this._cacheMap[s.Cache.TILEMAP]=this._cache.tilemap;this._cacheMap[s.Cache.BINARY]=this._cache.binary;this._cacheMap[s.Cache.BITMAPDATA]=this._cache.bitmapData;this._cacheMap[s.Cache.BITMAPFONT]=this._cache.bitmapFont;this._cacheMap[s.Cache.JSON]=this._cache.json;this._cacheMap[s.Cache.XML]=this._cache.xml;this._cacheMap[s.Cache.VIDEO]=this._cache.video;this._cacheMap[s.Cache.SHADER]=this._cache.shader;this._cacheMap[s.Cache.RENDER_TEXTURE]=this._cache.renderTexture;this.addDefaultImage();this.addMissingImage()};s.Cache.CANVAS=1;s.Cache.IMAGE=2;s.Cache.TEXTURE=3;s.Cache.SOUND=4;s.Cache.TEXT=5;s.Cache.PHYSICS=6;s.Cache.TILEMAP=7;s.Cache.BINARY=8;s.Cache.BITMAPDATA=9;s.Cache.BITMAPFONT=10;s.Cache.JSON=11;s.Cache.XML=12;s.Cache.VIDEO=13;s.Cache.SHADER=14;s.Cache.RENDER_TEXTURE=15;s.Cache.DEFAULT=null;s.Cache.MISSING=null;s.Cache.prototype={addCanvas:function(t,e,i){if(i===undefined){i=e.getContext("2d")}this._cache.canvas[t]={canvas:e,context:i}},addImage:function(t,e,i){if(this.checkImageKey(t)){this.removeImage(t)}var r={key:t,url:e,data:i,base:new PIXI.BaseTexture(i),frame:new s.Frame(0,0,0,i.width,i.height,t),frameData:new s.FrameData};r.frameData.addFrame(new s.Frame(0,0,0,i.width,i.height,e));this._cache.image[t]=r;this._resolveURL(e,r);if(t==="__default"){s.Cache.DEFAULT=new PIXI.Texture(r.base)}else if(t==="__missing"){s.Cache.MISSING=new PIXI.Texture(r.base)}return r},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";var e=this.addImage("__default",null,t);e.base.skipRender=true;s.Cache.DEFAULT=new PIXI.Texture(e.base)},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";var e=this.addImage("__missing",null,t);s.Cache.MISSING=new PIXI.Texture(e.base)},addSound:function(t,e,i,r,s){if(r===undefined){r=true;s=false}if(s===undefined){r=false;s=true}var n=false;if(s){n=true}this._cache.sound[t]={url:e,data:i,isDecoding:false,decoded:n,webAudio:r,audioTag:s,locked:this.game.sound.touchLocked};this._resolveURL(e,this._cache.sound[t])},addText:function(t,e,i){this._cache.text[t]={url:e,data:i};this._resolveURL(e,this._cache.text[t])},addPhysicsData:function(t,e,i,r){this._cache.physics[t]={url:e,data:i,format:r};this._resolveURL(e,this._cache.physics[t])},addTilemap:function(t,e,i,r){this._cache.tilemap[t]={url:e,data:i,format:r};this._resolveURL(e,this._cache.tilemap[t])},addBinary:function(t,e){this._cache.binary[t]=e},addBitmapData:function(t,e,i){e.key=t;if(i===undefined){i=new s.FrameData;i.addFrame(e.textureFrame)}this._cache.bitmapData[t]={data:e,frameData:i};return e},addBitmapFont:function(t,e,i,r,n,a,o){var h={url:e,data:i,font:null,base:new PIXI.BaseTexture(i)};if(a===undefined){a=0}if(o===undefined){o=0}if(n==="json"){h.font=s.LoaderParser.jsonBitmapFont(r,h.base,a,o)}else{h.font=s.LoaderParser.xmlBitmapFont(r,h.base,a,o)}this._cache.bitmapFont[t]=h;this._resolveURL(e,h)},addJSON:function(t,e,i){this._cache.json[t]={url:e,data:i};this._resolveURL(e,this._cache.json[t])},addXML:function(t,e,i){this._cache.xml[t]={url:e,data:i};this._resolveURL(e,this._cache.xml[t])},addVideo:function(t,e,i,r){this._cache.video[t]={url:e,data:i,isBlob:r,locked:true};this._resolveURL(e,this._cache.video[t])},addShader:function(t,e,i){this._cache.shader[t]={url:e,data:i};this._resolveURL(e,this._cache.shader[t])},addRenderTexture:function(t,e){this._cache.renderTexture[t]={texture:e,frame:new s.Frame(0,0,0,e.width,e.height,"","")}},addSpriteSheet:function(t,e,i,r,n,a,o,h){if(a===undefined){a=-1}if(o===undefined){o=0}if(h===undefined){h=0}var l={key:t,url:e,data:i,frameWidth:r,frameHeight:n,margin:o,spacing:h,base:new PIXI.BaseTexture(i),frameData:s.AnimationParser.spriteSheet(this.game,i,r,n,a,o,h)};this._cache.image[t]=l;this._resolveURL(e,l)},addTextureAtlas:function(t,e,i,r,n){var a={key:t,url:e,data:i,base:new PIXI.BaseTexture(i)};if(n===s.Loader.TEXTURE_ATLAS_XML_STARLING){a.frameData=s.AnimationParser.XMLData(this.game,r,t)}else if(n===s.Loader.TEXTURE_ATLAS_JSON_PYXEL){a.frameData=s.AnimationParser.JSONDataPyxel(this.game,r,t)}else{if(Array.isArray(r.frames)){a.frameData=s.AnimationParser.JSONData(this.game,r,t)}else{a.frameData=s.AnimationParser.JSONDataHash(this.game,r,t)}}this._cache.image[t]=a;this._resolveURL(e,a)},reloadSound:function(t){var e=this;var i=this.getSound(t);if(i){i.data.src=i.url;i.data.addEventListener("canplaythrough",function(){return e.reloadSoundComplete(t)},false);i.data.load()}},reloadSoundComplete:function(t){var e=this.getSound(t);if(e){e.locked=false;this.onSoundUnlock.dispatch(t)}},updateSound:function(t,e,i){var r=this.getSound(t);if(r){r[e]=i}},decodedSound:function(t,e){var i=this.getSound(t);i.data=e;i.decoded=true;i.isDecoding=false},isSoundDecoded:function(t){var e=this.getItem(t,s.Cache.SOUND,"isSoundDecoded");if(e){return e.decoded}},isSoundReady:function(t){var e=this.getItem(t,s.Cache.SOUND,"isSoundDecoded");if(e){return e.decoded&&!this.game.sound.touchLocked}},checkKey:function(t,e){if(this._cacheMap[t][e]){return true}return false},checkURL:function(t){if(this._urlMap[this._resolveURL(t)]){return true}return false},checkCanvasKey:function(t){return this.checkKey(s.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(s.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(s.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(s.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(s.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(s.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(s.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(s.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(s.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(s.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(s.Cache.JSON,t)},checkXMLKey:function(t){return this.checkKey(s.Cache.XML,t)},checkVideoKey:function(t){return this.checkKey(s.Cache.VIDEO,t)},checkShaderKey:function(t){return this.checkKey(s.Cache.SHADER,t)},checkRenderTextureKey:function(t){return this.checkKey(s.Cache.RENDER_TEXTURE,t)},getItem:function(t,e,i,r){if(!this.checkKey(e,t)){if(i){console.warn("Phaser.Cache."+i+': Key "'+t+'" not found in Cache.')}}else{if(r===undefined){return this._cacheMap[e][t]}else{return this._cacheMap[e][t][r]}}return null},getCanvas:function(t){return this.getItem(t,s.Cache.CANVAS,"getCanvas","canvas")},getImage:function(t,e){if(t===undefined||t===null){t="__default"}if(e===undefined){e=false}var i=this.getItem(t,s.Cache.IMAGE,"getImage");if(i===null){i=this.getItem("__missing",s.Cache.IMAGE,"getImage")}if(e){return i}else{return i.data}},getTextureFrame:function(t){return this.getItem(t,s.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(t){return this.getItem(t,s.Cache.SOUND,"getSound")},getSoundData:function(t){return this.getItem(t,s.Cache.SOUND,"getSoundData","data")},getText:function(t){return this.getItem(t,s.Cache.TEXT,"getText","data")},getPhysicsData:function(t,e,i){var r=this.getItem(t,s.Cache.PHYSICS,"getPhysicsData","data");if(r===null||e===undefined||e===null){return r}else{if(r[e]){var n=r[e];if(n&&i){for(var a in n){a=n[a];if(a.fixtureKey===i){return a}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+i+" in "+t+'"')}else{return n}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+t+" / "+e+'"')}}return null},getTilemapData:function(t){return this.getItem(t,s.Cache.TILEMAP,"getTilemapData")},getBinary:function(t){return this.getItem(t,s.Cache.BINARY,"getBinary")},getBitmapData:function(t){return this.getItem(t,s.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(t){return this.getItem(t,s.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(t,e){var i=this.getItem(t,s.Cache.JSON,"getJSON","data");if(i){if(e){return s.Utils.extend(true,Array.isArray(i)?[]:{},i)}else{return i}}else{return null}},getXML:function(t){return this.getItem(t,s.Cache.XML,"getXML","data")},getVideo:function(t){return this.getItem(t,s.Cache.VIDEO,"getVideo")},getShader:function(t){return this.getItem(t,s.Cache.SHADER,"getShader","data")},getRenderTexture:function(t){return this.getItem(t,s.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(t,e){if(e===undefined){e=s.Cache.IMAGE}return this.getItem(t,e,"getBaseTexture","base")},getFrame:function(t,e){if(e===undefined){e=s.Cache.IMAGE}return this.getItem(t,e,"getFrame","frame")},getFrameCount:function(t,e){var i=this.getFrameData(t,e);if(i){return i.total}else{return 0}},getFrameData:function(t,e){if(e===undefined){e=s.Cache.IMAGE}return this.getItem(t,e,"getFrameData","frameData")},hasFrameData:function(t,e){if(e===undefined){e=s.Cache.IMAGE}return this.getItem(t,e,"","frameData")!==null},updateFrameData:function(t,e,i){if(i===undefined){i=s.Cache.IMAGE}if(this._cacheMap[i][t]){this._cacheMap[i][t].frameData=e}},getFrameByIndex:function(t,e,i){var r=this.getFrameData(t,i);if(r){return r.getFrame(e)}else{return null}},getFrameByName:function(t,e,i){var r=this.getFrameData(t,i);if(r){return r.getFrameByName(e)}else{return null}},getURL:function(t){var t=this._resolveURL(t);if(t){return this._urlMap[t]}else{console.warn('Phaser.Cache.getUrl: Invalid url: "'+t+'" or Cache.autoResolveURL was false');return null}},getKeys:function(t){if(t===undefined){t=s.Cache.IMAGE}var e=[];if(this._cacheMap[t]){for(var i in this._cacheMap[t]){if(i!=="__default"&&i!=="__missing"){e.push(i)}}}return e},removeCanvas:function(t){delete this._cache.canvas[t]},removeImage:function(t,e){if(e===undefined){e=true}var i=this.getImage(t,true);if(e&&i.base){i.base.destroy()}delete this._cache.image[t]},removeSound:function(t){delete this._cache.sound[t]},removeText:function(t){delete this._cache.text[t]},removePhysics:function(t){delete this._cache.physics[t]},removeTilemap:function(t){delete this._cache.tilemap[t]},removeBinary:function(t){delete this._cache.binary[t]},removeBitmapData:function(t){delete this._cache.bitmapData[t]},removeBitmapFont:function(t){delete this._cache.bitmapFont[t]},removeJSON:function(t){delete this._cache.json[t]},removeXML:function(t){delete this._cache.xml[t]},removeVideo:function(t){delete this._cache.video[t]},removeShader:function(t){delete this._cache.shader[t]},removeRenderTexture:function(t){delete this._cache.renderTexture[t]},removeSpriteSheet:function(t){delete this._cache.spriteSheet[t]},removeTextureAtlas:function(t){delete this._cache.atlas[t]},clearGLTextures:function(){for(var t in this._cache.image){this._cache.image[t].base._glTextures=[]}},_resolveURL:function(t,e){if(!this.autoResolveURL){return null}this._urlResolver.src=this.game.load.baseURL+t;this._urlTemp=this._urlResolver.src;this._urlResolver.src="";if(e){this._urlMap[this._urlTemp]=e}return this._urlTemp},destroy:function(){for(var t=0;t<this._cacheMap.length;t++){var e=this._cacheMap[t];for(var i in e){if(i!=="__default"&&i!=="__missing"){if(e[i]["destroy"]){e[i].destroy()}delete e[i]}}}this._urlMap=null;this._urlResolver=null;this._urlTemp=null}};s.Cache.prototype.constructor=s.Cache;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Loader=function(t){this.game=t;this.cache=t.cache;this.resetLocked=false;this.isLoading=false;this.hasLoaded=false;this.preloadSprite=null;this.crossOrigin=false;this.baseURL="";this.path="";this.headers={requestedWith:false,json:"application/json",xml:"application/xml"};this.onLoadStart=new s.Signal;this.onLoadComplete=new s.Signal;this.onPackComplete=new s.Signal;this.onFileStart=new s.Signal;this.onFileComplete=new s.Signal;this.onFileError=new s.Signal;this.useXDomainRequest=false;this._warnedAboutXDomainRequest=false;this.enableParallel=true;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=false;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};s.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;s.Loader.TEXTURE_ATLAS_JSON_HASH=1;s.Loader.TEXTURE_ATLAS_XML_STARLING=2;s.Loader.PHYSICS_LIME_CORONA_JSON=3;s.Loader.PHYSICS_PHASER_JSON=4;s.Loader.TEXTURE_ATLAS_JSON_PYXEL=5;s.Loader.prototype={setPreloadSprite:function(t,e){e=e||0;this.preloadSprite={sprite:t,direction:e,width:t.width,height:t.height,rect:null};if(e===0){this.preloadSprite.rect=new s.Rectangle(0,0,1,t.height)}else{this.preloadSprite.rect=new s.Rectangle(0,0,t.width,1)}t.crop(this.preloadSprite.rect);t.visible=true},resize:function(){if(this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height){this.preloadSprite.rect.height=this.preloadSprite.sprite.height}},checkKeyExists:function(t,e){return this.getAssetIndex(t,e)>-1},getAssetIndex:function(t,e){var i=-1;for(var r=0;r<this._fileList.length;r++){var s=this._fileList[r];if(s.type===t&&s.key===e){i=r;if(!s.loaded&&!s.loading){break}}}return i},getAsset:function(t,e){var i=this.getAssetIndex(t,e);if(i>-1){return{index:i,file:this._fileList[i]}}return false},reset:function(t,e){if(e===undefined){e=false}if(this.resetLocked){return}if(t){this.preloadSprite=null}this.isLoading=false;this._processingHead=0;this._fileList.length=0;this._flightQueue.length=0;this._fileLoadStarted=false;this._totalFileCount=0;this._totalPackCount=0;this._loadedPackCount=0;this._loadedFileCount=0;if(e){this.onLoadStart.removeAll();this.onLoadComplete.removeAll();this.onPackComplete.removeAll();this.onFileStart.removeAll();this.onFileComplete.removeAll();this.onFileError.removeAll()}},addToFileList:function(t,e,i,r,s,n){if(s===undefined){s=false}if(e===undefined||e===""){console.warn("Phaser.Loader: Invalid or no key given of type "+t);return this}if(i===undefined||i===null){if(n){i=e+n}else{console.warn("Phaser.Loader: No URL given for file type: "+t+" key: "+e);return this}}var a={type:t,key:e,path:this.path,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:false,loaded:false,error:false};if(r){for(var o in r){a[o]=r[o]}}var h=this.getAssetIndex(t,e);if(s&&h>-1){var l=this._fileList[h];if(!l.loading&&!l.loaded){this._fileList[h]=a}else{this._fileList.push(a);this._totalFileCount++}}else if(h===-1){this._fileList.push(a);this._totalFileCount++}return this},replaceInFileList:function(t,e,i,r){return this.addToFileList(t,e,i,r,true)},pack:function(t,e,i,r){if(e===undefined){e=null}if(i===undefined){i=null}if(r===undefined){r=null}if(!e&&!i){console.warn("Phaser.Loader.pack - Both url and data are null. One must be set.");return this}var s={type:"packfile",key:t,url:e,path:this.path,syncPoint:true,data:null,loading:false,loaded:false,error:false,callbackContext:r};if(i){if(typeof i==="string"){i=JSON.parse(i)}s.data=i||{};s.loaded=true}for(var n=0;n<this._fileList.length+1;n++){var a=this._fileList[n];if(!a||!a.loaded&&!a.loading&&a.type!=="packfile"){this._fileList.splice(n,0,s);this._totalPackCount++;break}}return this},image:function(t,e,i){return this.addToFileList("image",t,e,undefined,i,".png")},images:function(t,e){if(Array.isArray(e)){for(var i=0;i<t.length;i++){this.image(t[i],e[i])}}else{for(var i=0;i<t.length;i++){this.image(t[i])}}return this},text:function(t,e,i){return this.addToFileList("text",t,e,undefined,i,".txt")},json:function(t,e,i){return this.addToFileList("json",t,e,undefined,i,".json")},shader:function(t,e,i){return this.addToFileList("shader",t,e,undefined,i,".frag")},xml:function(t,e,i){return this.addToFileList("xml",t,e,undefined,i,".xml")},script:function(t,e,i,r){if(i===undefined){i=false}if(i!==false&&r===undefined){r=this}return this.addToFileList("script",t,e,{syncPoint:true,callback:i,callbackContext:r},false,".js")},binary:function(t,e,i,r){if(i===undefined){i=false}if(i!==false&&r===undefined){r=i}return this.addToFileList("binary",t,e,{callback:i,callbackContext:r},false,".bin")},spritesheet:function(t,e,i,r,s,n,a){if(s===undefined){s=-1}if(n===undefined){n=0}if(a===undefined){a=0}return this.addToFileList("spritesheet",t,e,{frameWidth:i,frameHeight:r,frameMax:s,margin:n,spacing:a},false,".png")},audio:function(t,e,i){if(this.game.sound.noAudio){return this}if(i===undefined){i=true}if(typeof e==="string"){e=[e]}return this.addToFileList("audio",t,e,{buffer:null,autoDecode:i})},audioSprite:function(t,e,i,r,s){if(this.game.sound.noAudio){return this}if(i===undefined){i=null}if(r===undefined){r=null}if(s===undefined){s=true}this.audio(t,e,s);if(i){this.json(t+"-audioatlas",i)}else if(r){if(typeof r==="string"){r=JSON.parse(r)}this.cache.addJSON(t+"-audioatlas","",r)}else{console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object")}return this},audiosprite:function(t,e,i,r,s){return this.audioSprite(t,e,i,r,s)},video:function(t,e,i,r){if(i===undefined){if(this.game.device.firefox){i="loadeddata"}else{i="canplaythrough"}}if(r===undefined){r=false}if(typeof e==="string"){e=[e]}return this.addToFileList("video",t,e,{buffer:null,asBlob:r,loadEvent:i})},tilemap:function(t,e,i,r){if(e===undefined){e=null}if(i===undefined){i=null}if(r===undefined){r=s.Tilemap.CSV}if(!e&&!i){if(r===s.Tilemap.CSV){e=t+".csv"}else{e=t+".json"}}if(i){switch(r){case s.Tilemap.CSV:break;case s.Tilemap.TILED_JSON:if(typeof i==="string"){i=JSON.parse(i)}break}this.cache.addTilemap(t,null,i,r)}else{this.addToFileList("tilemap",t,e,{format:r})}return this},physics:function(t,e,i,r){if(e===undefined){e=null}if(i===undefined){i=null}if(r===undefined){r=s.Physics.LIME_CORONA_JSON}if(!e&&!i){e=t+".json"}if(i){if(typeof i==="string"){i=JSON.parse(i)}this.cache.addPhysicsData(t,null,i,r)}else{this.addToFileList("physics",t,e,{format:r})}return this},bitmapFont:function(t,e,i,r,s,n){if(e===undefined||e===null){e=t+".png"}if(i===undefined){i=null}if(r===undefined){r=null}if(i===null&&r===null){i=t+".xml"}if(s===undefined){s=0}if(n===undefined){n=0}if(i){this.addToFileList("bitmapfont",t,e,{atlasURL:i,xSpacing:s,ySpacing:n})}else{if(typeof r==="string"){var a,o;try{a=JSON.parse(r)}catch(t){o=this.parseXml(r)}if(!o&&!a){throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given")}this.addToFileList("bitmapfont",t,e,{atlasURL:null,atlasData:a||o,atlasType:!!a?"json":"xml",xSpacing:s,ySpacing:n})}}return this},atlasJSONArray:function(t,e,i,r){return this.atlas(t,e,i,r,s.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,e,i,r){return this.atlas(t,e,i,r,s.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,e,i,r){if(i===undefined){i=null}if(r===undefined){r=null}if(!i&&!r){i=t+".xml"}return this.atlas(t,e,i,r,s.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,e,i,r,n){if(e===undefined||e===null){e=t+".png"}if(i===undefined){i=null}if(r===undefined){r=null}if(n===undefined){n=s.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(!i&&!r){if(n===s.Loader.TEXTURE_ATLAS_XML_STARLING){i=t+".xml"}else{i=t+".json"}}if(i){this.addToFileList("textureatlas",t,e,{atlasURL:i,format:n})}else{switch(n){case s.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof r==="string"){r=JSON.parse(r)}break;case s.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof r==="string"){var a=this.parseXml(r);if(!a){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}r=a}break}this.addToFileList("textureatlas",t,e,{atlasURL:null,atlasData:r,format:n})}return this},withSyncPoint:function(t,e){this._withSyncPointDepth++;try{t.call(e||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(t,e){var i=this.getAsset(t,e);if(i){i.file.syncPoint=true}return this},removeFile:function(t,e){var i=this.getAsset(t,e);if(i){if(!i.loaded&&!i.loading){this._fileList.splice(i.index,1)}}},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){if(this.isLoading){return}this.hasLoaded=false;this.isLoading=true;this.updateProgress();this.processLoadQueue()},processLoadQueue:function(){if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset");this.finishedLoading(true);return}for(var t=0;t<this._flightQueue.length;t++){var e=this._flightQueue[t];if(e.loaded||e.error){this._flightQueue.splice(t,1);t--;e.loading=false;e.requestUrl=null;e.requestObject=null;if(e.error){this.onFileError.dispatch(e.key,e)}if(e.type!=="packfile"){this._loadedFileCount++;this.onFileComplete.dispatch(this.progress,e.key,!e.error,this._loadedFileCount,this._totalFileCount)}else if(e.type==="packfile"&&e.error){this._loadedPackCount++;this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)}}}var i=false;var r=this.enableParallel?s.Math.clamp(this.maxParallelDownloads,1,12):1;for(var t=this._processingHead;t<this._fileList.length;t++){var e=this._fileList[t];if(e.type==="packfile"&&!e.error&&e.loaded&&t===this._processingHead){this.processPack(e);this._loadedPackCount++;this.onPackComplete.dispatch(e.key,!e.error,this._loadedPackCount,this._totalPackCount)}if(e.loaded||e.error){if(t===this._processingHead){this._processingHead=t+1}}else if(!e.loading&&this._flightQueue.length<r){if(e.type==="packfile"&&!e.data){this._flightQueue.push(e);e.loading=true;this.loadFile(e)}else if(!i){if(!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this._flightQueue.push(e);e.loading=true;this.onFileStart.dispatch(this.progress,e.key,e.url);this.loadFile(e)}}if(!e.loaded&&e.syncPoint){i=true}if(this._flightQueue.length>=r||i&&this._loadedPackCount===this._totalPackCount){break}}this.updateProgress();if(this._processingHead>=this._fileList.length){this.finishedLoading()}else if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var n=this;setTimeout(function(){n.finishedLoading(true)},2e3)}},finishedLoading:function(t){if(this.hasLoaded){return}this.hasLoaded=true;this.isLoading=false;if(!t&&!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this.onLoadComplete.dispatch();this.game.state.loadComplete();this.reset()},asyncComplete:function(t,e){if(e===undefined){e=""}t.loaded=true;t.error=!!e;if(e){t.errorMessage=e;console.warn("Phaser.Loader - "+t.type+"["+t.key+"]"+": "+e)}this.processLoadQueue()},processPack:function(t){var e=t.data[t.key];if(!e){console.warn("Phaser.Loader - "+t.key+": pack has data, but not for pack key");return}for(var i=0;i<e.length;i++){var r=e[i];switch(r.type){case"image":this.image(r.key,r.url,r.overwrite);break;case"text":this.text(r.key,r.url,r.overwrite);break;case"json":this.json(r.key,r.url,r.overwrite);break;case"xml":this.xml(r.key,r.url,r.overwrite);break;case"script":this.script(r.key,r.url,r.callback,t.callbackContext||this);break;case"binary":this.binary(r.key,r.url,r.callback,t.callbackContext||this);break;case"spritesheet":this.spritesheet(r.key,r.url,r.frameWidth,r.frameHeight,r.frameMax,r.margin,r.spacing);break;case"video":this.video(r.key,r.urls);break;case"audio":this.audio(r.key,r.urls,r.autoDecode);break;case"audiosprite":this.audiosprite(r.key,r.urls,r.jsonURL,r.jsonData,r.autoDecode);break;case"tilemap":this.tilemap(r.key,r.url,r.data,s.Tilemap[r.format]);break;case"physics":this.physics(r.key,r.url,r.data,s.Loader[r.format]);break;case"bitmapFont":this.bitmapFont(r.key,r.textureURL,r.atlasURL,r.atlasData,r.xSpacing,r.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlasXML":this.atlasXML(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlas":this.atlas(r.key,r.textureURL,r.atlasURL,r.atlasData,s.Loader[r.format]);break;case"shader":this.shader(r.key,r.url,r.overwrite);break}}},transformUrl:function(t,e){if(!t){return false}if(t.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)){return t}else{return this.baseURL+e.path+t}},loadFile:function(t){switch(t.type){case"packfile":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(t);break;case"audio":t.url=this.getAudioURL(t.url);if(t.url){if(this.game.sound.usingWebAudio){this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete)}else if(this.game.sound.usingAudioTag){this.loadAudioTag(t)}}else{this.fileError(t,null,"No supported audio URL specified or device does not have audio playback support")}break;case"video":t.url=this.getVideoURL(t.url);if(t.url){if(t.asBlob){this.xhrLoad(t,this.transformUrl(t.url,t),"blob",this.fileComplete)}else{this.loadVideoTag(t)}}else{this.fileError(t,null,"No supported video URL specified or device does not have video playback support")}break;case"json":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.xmlLoadComplete);break;case"tilemap":if(t.format===s.Tilemap.TILED_JSON){this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.jsonLoadComplete)}else if(t.format===s.Tilemap.CSV){this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.csvLoadComplete)}else{this.asyncComplete(t,"invalid Tilemap format: "+t.format)}break;case"text":case"script":case"shader":case"physics":this.xhrLoad(t,this.transformUrl(t.url,t),"text",this.fileComplete);break;case"binary":this.xhrLoad(t,this.transformUrl(t.url,t),"arraybuffer",this.fileComplete);break}},loadImageTag:function(t){var e=this;t.data=new Image;t.data.name=t.key;if(this.crossOrigin){t.data.crossOrigin=this.crossOrigin}t.data.onload=function(){if(t.data.onload){t.data.onload=null;t.data.onerror=null;e.fileComplete(t)}};t.data.onerror=function(){if(t.data.onload){t.data.onload=null;t.data.onerror=null;e.fileError(t)}};t.data.src=this.transformUrl(t.url,t);if(t.data.complete&&t.data.width&&t.data.height){t.data.onload=null;t.data.onerror=null;this.fileComplete(t)}},loadVideoTag:function(t){var e=this;t.data=document.createElement("video");t.data.name=t.key;t.data.controls=false;t.data.autoplay=false;var i=function(){t.data.removeEventListener(t.loadEvent,i,false);t.data.onerror=null;t.data.canplay=true;s.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener(t.loadEvent,i,false);t.data.onerror=null;t.data.canplay=false;e.fileError(t)};t.data.addEventListener(t.loadEvent,i,false);t.data.src=this.transformUrl(t.url,t);t.data.load()},loadAudioTag:function(t){var e=this;if(this.game.sound.touchLocked){t.data=new Audio;t.data.name=t.key;t.data.preload="auto";t.data.src=this.transformUrl(t.url,t);this.fileComplete(t)}else{t.data=new Audio;t.data.name=t.key;var i=function(){t.data.removeEventListener("canplaythrough",i,false);t.data.onerror=null;e.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,false);t.data.onerror=null;e.fileError(t)};t.data.preload="auto";t.data.src=this.transformUrl(t.url,t);t.data.addEventListener("canplaythrough",i,false);t.data.load()}},xhrLoad:function(t,e,i,r,s){if(this.useXDomainRequest&&window.XDomainRequest){this.xhrLoadWithXDR(t,e,i,r,s);return}var n=new XMLHttpRequest;n.open("GET",e,true);n.responseType=i;if(this.headers["requestedWith"]!==false){n.setRequestHeader("X-Requested-With",this.headers["requestedWith"])}if(this.headers[t.type]){n.setRequestHeader("Accept",this.headers[t.type])}s=s||this.fileError;var a=this;n.onload=function(){try{if(n.readyState===4&&n.status>=400&&n.status<=599){return s.call(a,t,n)}else{return r.call(a,t,n)}}catch(e){if(!a.hasLoaded){a.asyncComplete(t,e.message||"Exception")}else{if(window["console"]){console.error(e)}}}};n.onerror=function(){try{return s.call(a,t,n)}catch(e){if(!a.hasLoaded){a.asyncComplete(t,e.message||"Exception")}else{if(window["console"]){console.error(e)}}}};t.requestObject=n;t.requestUrl=e;n.send()},xhrLoadWithXDR:function(t,e,i,r,s){if(!this._warnedAboutXDomainRequest&&(!this.game.device.ie||this.game.device.ieVersion>=10)){this._warnedAboutXDomainRequest=true;console.warn("Phaser.Loader - using XDomainRequest outside of IE 9")}var n=new window.XDomainRequest;n.open("GET",e,true);n.responseType=i;n.timeout=3e3;s=s||this.fileError;var a=this;n.onerror=function(){try{return s.call(a,t,n)}catch(e){a.asyncComplete(t,e.message||"Exception")}};n.ontimeout=function(){try{return s.call(a,t,n)}catch(e){a.asyncComplete(t,e.message||"Exception")}};n.onprogress=function(){};n.onload=function(){try{if(n.readyState===4&&n.status>=400&&n.status<=599){return s.call(a,t,n)}else{return r.call(a,t,n)}return r.call(a,t,n)}catch(e){a.asyncComplete(t,e.message||"Exception")}};t.requestObject=n;t.requestUrl=e;setTimeout(function(){n.send()},0)},getVideoURL:function(t){for(var e=0;e<t.length;e++){var i=t[e];var r;if(i.uri){r=i.type;i=i.uri;if(this.game.device.canPlayVideo(r)){return i}}else{if(i.indexOf("blob:")===0||i.indexOf("data:")===0){return i}if(i.indexOf("?")>=0){i=i.substr(0,i.indexOf("?"))}var s=i.substr((Math.max(0,i.lastIndexOf("."))||Infinity)+1);r=s.toLowerCase();if(this.game.device.canPlayVideo(r)){return t[e]}}}return null},getAudioURL:function(t){if(this.game.sound.noAudio){return null}for(var e=0;e<t.length;e++){var i=t[e];var r;if(i.uri){r=i.type;i=i.uri;if(this.game.device.canPlayAudio(r)){return i}}else{if(i.indexOf("blob:")===0||i.indexOf("data:")===0){return i}if(i.indexOf("?")>=0){i=i.substr(0,i.indexOf("?"))}var s=i.substr((Math.max(0,i.lastIndexOf("."))||Infinity)+1);r=s.toLowerCase();if(this.game.device.canPlayAudio(r)){return t[e]}}}return null},fileError:function(t,e,i){var r=t.requestUrl||this.transformUrl(t.url,t);var s="error loading asset from URL "+r;if(!i&&e){i=e.status}if(i){s=s+" ("+i+")"}this.asyncComplete(t,s)},fileComplete:function(t,e){var i=true;switch(t.type){case"packfile":var r=JSON.parse(e.responseText);t.data=r||{};break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(t.atlasURL==null){this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format)}else{i=false;if(t.format===s.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format===s.Loader.TEXTURE_ATLAS_JSON_HASH||t.format===s.Loader.TEXTURE_ATLAS_JSON_PYXEL){this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete)}else if(t.format===s.Loader.TEXTURE_ATLAS_XML_STARLING){this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format)}}break;case"bitmapfont":if(!t.atlasURL){this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing)}else{i=false;this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",function(t,e){var i;try{i=JSON.parse(e.responseText)}catch(t){}if(!!i){t.atlasType="json";this.jsonLoadComplete(t,e)}else{t.atlasType="xml";this.xmlLoadComplete(t,e)}})}break;case"video":if(t.asBlob){try{t.data=e.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key)}}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":if(this.game.sound.usingWebAudio){t.data=e.response;this.cache.addSound(t.key,t.url,t.data,true,false);if(t.autoDecode){this.game.sound.decode(t.key)}}else{this.cache.addSound(t.key,t.url,t.data,false,true)}break;case"text":t.data=e.responseText;this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=e.responseText;this.cache.addShader(t.key,t.url,t.data);break;case"physics":var r=JSON.parse(e.responseText);this.cache.addPhysicsData(t.key,t.url,r,t.format);break;case"script":t.data=document.createElement("script");t.data.language="javascript";t.data.type="text/javascript";t.data.defer=false;t.data.text=e.responseText;document.head.appendChild(t.data);if(t.callback){t.data=t.callback.call(t.callbackContext,t.key,e.responseText)}break;case"binary":if(t.callback){t.data=t.callback.call(t.callbackContext,t.key,e.response)}else{t.data=e.response}this.cache.addBinary(t.key,t.data);break}if(i){this.asyncComplete(t)}},jsonLoadComplete:function(t,e){var i=JSON.parse(e.responseText);if(t.type==="tilemap"){this.cache.addTilemap(t.key,t.url,i,t.format)}else if(t.type==="bitmapfont"){this.cache.addBitmapFont(t.key,t.url,t.data,i,t.atlasType,t.xSpacing,t.ySpacing)}else if(t.type==="json"){this.cache.addJSON(t.key,t.url,i)}else{this.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format)}this.asyncComplete(t)},csvLoadComplete:function(t,e){var i=e.responseText;this.cache.addTilemap(t.key,t.url,i,t.format);this.asyncComplete(t)},xmlLoadComplete:function(t,e){var i=e.responseText;var r=this.parseXml(i);if(!r){var s=e.responseType||e.contentType;console.warn("Phaser.Loader - "+t.key+": invalid XML ("+s+")");this.asyncComplete(t,"invalid XML");return}if(t.type==="bitmapfont"){this.cache.addBitmapFont(t.key,t.url,t.data,r,t.atlasType,t.xSpacing,t.ySpacing)}else if(t.type==="textureatlas"){this.cache.addTextureAtlas(t.key,t.url,t.data,r,t.format)}else if(t.type==="xml"){this.cache.addXML(t.key,t.url,r)}this.asyncComplete(t)},parseXml:function(t){var e;try{if(window["DOMParser"]){var i=new DOMParser;e=i.parseFromString(t,"text/xml")}else{e=new ActiveXObject("Microsoft.XMLDOM");e.async="false";e.loadXML(t)}}catch(t){e=null}if(!e||!e.documentElement||e.getElementsByTagName("parsererror").length){return null}else{return e}},updateProgress:function(){if(this.preloadSprite){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress)}else{this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress)}if(this.preloadSprite.sprite){this.preloadSprite.sprite.updateCrop()}else{this.preloadSprite=null}}},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(s.Loader.prototype,"progressFloat",{get:function(){var t=this._loadedFileCount/this._totalFileCount*100;return s.Math.clamp(t||0,0,100)}});Object.defineProperty(s.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});s.Loader.prototype.constructor=s.Loader;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.LoaderParser={bitmapFont:function(t,e,i,r){return this.xmlBitmapFont(t,e,i,r)},xmlBitmapFont:function(t,e,i,r){var s={};var n=t.getElementsByTagName("info")[0];var a=t.getElementsByTagName("common")[0];s.font=n.getAttribute("face");s.size=parseInt(n.getAttribute("size"),10);s.lineHeight=parseInt(a.getAttribute("lineHeight"),10)+r;s.chars={};var o=t.getElementsByTagName("char");for(var h=0;h<o.length;h++){var l=parseInt(o[h].getAttribute("id"),10);s.chars[l]={x:parseInt(o[h].getAttribute("x"),10),y:parseInt(o[h].getAttribute("y"),10),width:parseInt(o[h].getAttribute("width"),10),height:parseInt(o[h].getAttribute("height"),10),xOffset:parseInt(o[h].getAttribute("xoffset"),10),yOffset:parseInt(o[h].getAttribute("yoffset"),10),xAdvance:parseInt(o[h].getAttribute("xadvance"),10)+i,kerning:{}}}var u=t.getElementsByTagName("kerning");for(h=0;h<u.length;h++){var c=parseInt(u[h].getAttribute("first"),10);var f=parseInt(u[h].getAttribute("second"),10);var d=parseInt(u[h].getAttribute("amount"),10);s.chars[f].kerning[c]=d}return this.finalizeBitmapFont(e,s)},jsonBitmapFont:function(t,e,i,r){var s={font:t.font.info._face,size:parseInt(t.font.info._size,10),lineHeight:parseInt(t.font.common._lineHeight,10)+r,chars:{}};t.font.chars["char"].forEach(function t(e){var r=parseInt(e._id,10);s.chars[r]={x:parseInt(e._x,10),y:parseInt(e._y,10),width:parseInt(e._width,10),height:parseInt(e._height,10),xOffset:parseInt(e._xoffset,10),yOffset:parseInt(e._yoffset,10),xAdvance:parseInt(e._xadvance,10)+i,kerning:{}}});if(t.font.kernings&&t.font.kernings.kerning){t.font.kernings.kerning.forEach(function t(e){s.chars[e._second].kerning[e._first]=parseInt(e._amount,10)})}return this.finalizeBitmapFont(e,s)},finalizeBitmapFont:function(t,e){Object.keys(e.chars).forEach(function i(r){var n=e.chars[r];n.texture=new PIXI.Texture(t,new s.Rectangle(n.x,n.y,n.width,n.height))});return e}};/**
 * @author       Jeremy Dowell <jeremy@codevinsky.com>
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2016 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
s.AudioSprite=function(t,e){this.game=t;this.key=e;this.config=this.game.cache.getJSON(e+"-audioatlas");this.autoplayKey=null;this.autoplay=false;this.sounds={};for(var i in this.config.spritemap){var r=this.config.spritemap[i];var s=this.game.add.sound(this.key);s.addMarker(i,r.start,r.end-r.start,null,r.loop);this.sounds[i]=s}if(this.config.autoplay){this.autoplayKey=this.config.autoplay;this.play(this.autoplayKey);this.autoplay=this.sounds[this.autoplayKey]}};s.AudioSprite.prototype={play:function(t,e){if(e===undefined){e=1}return this.sounds[t].play(t,null,e)},stop:function(t){if(!t){for(var e in this.sounds){this.sounds[e].stop()}}else{this.sounds[t].stop()}},get:function(t){return this.sounds[t]}};s.AudioSprite.prototype.constructor=s.AudioSprite;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Sound=function(t,e,i,r,n){if(i===undefined){i=1}if(r===undefined){r=false}if(n===undefined){n=t.sound.connectToMaster}this.game=t;this.name=e;this.key=e;this.loop=r;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.fadeTween=null;this.pendingPlayback=false;this.override=false;this.allowMultiple=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(this.context.createGain===undefined){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=i*this.game.sound.volume;if(n){this.gainNode.connect(this.masterGainNode)}}else if(this.usingAudioTag){if(this.game.cache.getSound(e)&&this.game.cache.isSoundReady(e)){this._sound=this.game.cache.getSoundData(e);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}this.onDecoded=new s.Signal;this.onPlay=new s.Signal;this.onPause=new s.Signal;this.onResume=new s.Signal;this.onLoop=new s.Signal;this.onStop=new s.Signal;this.onMute=new s.Signal;this.onMarkerComplete=new s.Signal;this.onFadeComplete=new s.Signal;this._volume=i;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._tempPause=0;this._muteVolume=0;this._tempLoop=0;this._paused=false;this._onDecodedEventDispatched=false};s.Sound.prototype={soundHasUnlocked:function(t){if(t===this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(t,e,i,r,s){if(i===undefined||i===null){i=1}if(r===undefined||r===null){r=1}if(s===undefined){s=false}this.markers[t]={name:t,start:e,stop:e+i,volume:r,duration:i,durationMS:i*1e3,loop:s}},removeMarker:function(t){delete this.markers[t]},onEndedHandler:function(){this._sound.onended=null;this.isPlaying=false;this.currentTime=this.durationMS;this.stop()},update:function(){if(!this.game.cache.checkSoundKey(this.key)){this.destroy();return}if(this.isDecoded&&!this._onDecodedEventDispatched){this.onDecoded.dispatch(this);this._onDecodedEventDispatched=true}if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.time-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);this.isPlaying=false;if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time;this.isPlaying=true}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true)}}else{if(this.currentMarker!==""){this.stop()}}}else{if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time}this.isPlaying=false;this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},loopFull:function(t){return this.play(null,0,t,true)},play:function(t,e,i,r,s){if(t===undefined||t===false||t===null){t=""}if(s===undefined){s=true}if(this.isPlaying&&!this.allowMultiple&&!s&&!this.override){return this}if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||s)){if(this.usingWebAudio){if(this._sound.stop===undefined){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(t){}}if(this.externalNode){this._sound.disconnect(this.externalNode)}else if(this.gainNode){this._sound.disconnect(this.gainNode)}}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}this.isPlaying=false}if(t===""&&Object.keys(this.markers).length>0){return this}if(t!==""){if(this.markers[t]){this.currentMarker=t;this.position=this.markers[t].start;this.volume=this.markers[t].volume;this.loop=this.markers[t].loop;this.duration=this.markers[t].duration;this.durationMS=this.markers[t].durationMS;if(typeof i!=="undefined"){this.volume=i}if(typeof r!=="undefined"){this.loop=r}this._tempMarker=t;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{console.warn("Phaser.Sound.play: audio marker "+t+" doesn't exist");return this}}else{e=e||0;if(i===undefined){i=this._volume}if(r===undefined){r=this.loop}this.position=Math.max(0,e);this.volume=i;this.loop=r;this.duration=0;this.durationMS=0;this._tempMarker=t;this._tempPosition=e;this._tempVolume=i;this._tempLoop=r}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){this._sound=this.context.createBufferSource();if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}this._buffer=this.game.cache.getSoundData(this.key);this._sound.buffer=this._buffer;if(this.loop&&t===""){this._sound.loop=true}if(!this.loop&&t===""){this._sound.onended=this.onEndedHandler.bind(this)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=Math.ceil(this.totalDuration*1e3)}if(this._sound.start===undefined){this._sound.noteGrainOn(0,this.position,this.duration)}else{if(this.loop&&t===""){this._sound.start(0,0)}else{this._sound.start(0,this.position,this.duration)}}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1e3}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted||this.game.sound.mute){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this},restart:function(t,e,i,r){t=t||"";e=e||0;i=i||1;if(r===undefined){r=false}this.play(t,e,i,r,true)},pause:function(){if(this.isPlaying&&this._sound){this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.time;this._tempPause=this._sound.currentTime;this.onPause.dispatch(this);this.stop()}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=Math.max(0,this.position+this.pausedPosition/1e3);this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(!this.loop&&this.currentMarker===""){this._sound.onended=this.onEndedHandler.bind(this)}var e=this.duration-this.pausedPosition/1e3;if(this._sound.start===undefined){this._sound.noteGrainOn(0,t,e)}else{if(this.loop&&this.game.device.chrome){if(this.game.device.chromeVersion===42){this._sound.start(0)}else{this._sound.start(0,t)}}else{this._sound.start(0,t,e)}}}else{this._sound.currentTime=this._tempPause;this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=this.game.time.time-this.pausedTime;this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(this._sound.stop===undefined){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(t){}}if(this.externalNode){this._sound.disconnect(this.externalNode)}else if(this.gainNode){this._sound.disconnect(this.gainNode)}}else if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}this.pendingPlayback=false;this.isPlaying=false;if(!this.paused){var t=this.currentMarker;if(this.currentMarker!==""){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker="";if(this.fadeTween!==null){this.fadeTween.stop()}this.onStop.dispatch(this,t)}},fadeIn:function(t,e,i){if(e===undefined){e=false}if(i===undefined){i=this.currentMarker}if(this.paused){return}this.play(i,0,0,e);this.fadeTo(t,1)},fadeOut:function(t){this.fadeTo(t,0)},fadeTo:function(t,e){if(!this.isPlaying||this.paused||e===this.volume){return}if(t===undefined){t=1e3}if(e===undefined){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:e},t,s.Easing.Linear.None,true);this.fadeTween.onComplete.add(this.fadeComplete,this)},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);if(this.volume===0){this.stop()}},updateGlobalVolume:function(t){if(this.usingAudioTag&&this._sound){this._sound.volume=t*this._volume}},destroy:function(t){if(t===undefined){t=true}this.stop();if(t){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}};s.Sound.prototype.constructor=s.Sound;Object.defineProperty(s.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(s.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(s.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(t){t=t||false;if(t===this._muted){return}if(t){this._muted=true;this._muteVolume=this._tempVolume;if(this.usingWebAudio){this.gainNode.gain.value=0}else if(this.usingAudioTag&&this._sound){this._sound.volume=0}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}this.onMute.dispatch(this)}});Object.defineProperty(s.Sound.prototype,"volume",{get:function(){return this._volume},set:function(t){if(this.game.device.firefox&&this.usingAudioTag){t=this.game.math.clamp(t,0,1)}if(this._muted){this._muteVolume=t;return}this._tempVolume=t;this._volume=t;if(this.usingWebAudio){this.gainNode.gain.value=t}else if(this.usingAudioTag&&this._sound){this._sound.volume=t}}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.SoundManager=function(t){this.game=t;this.onSoundDecode=new s.Signal;this.onVolumeChange=new s.Signal;this.onMute=new s.Signal;this.onUnMute=new s.Signal;this.context=null;this.usingWebAudio=false;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32;this.muteOnPause=true;this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new s.ArraySet;this._watching=false;this._watchCallback=null;this._watchContext=null};s.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(window["PhaserGlobal"]){if(window["PhaserGlobal"].disableAudio===true){this.noAudio=true;this.touchLocked=false;return}if(window["PhaserGlobal"].disableWebAudio===true){this.usingAudioTag=true;this.touchLocked=false;return}}if(window["PhaserGlobal"]&&window["PhaserGlobal"].audioContext){this.context=window["PhaserGlobal"].audioContext}else{if(!!window["AudioContext"]){try{this.context=new window["AudioContext"]}catch(t){this.context=null;this.usingWebAudio=false;this.touchLocked=false}}else if(!!window["webkitAudioContext"]){try{this.context=new window["webkitAudioContext"]}catch(t){this.context=null;this.usingWebAudio=false;this.touchLocked=false}}}if(this.context===null){if(window["Audio"]===undefined){this.noAudio=true;return}else{this.usingAudioTag=true}}else{this.usingWebAudio=true;if(this.context.createGain===undefined){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}if(!this.noAudio){if(!this.game.device.cocoonJS&&this.game.device.iOS||window["PhaserGlobal"]&&window["PhaserGlobal"].fakeiOSTouchLock){this.setTouchLock()}}},setTouchLock:function(){if(this.noAudio||window["PhaserGlobal"]&&window["PhaserGlobal"].disableAudio===true){return}if(this.game.device.iOSVersion>8){this.game.input.touch.addTouchLockCallback(this.unlock,this,true)}else{this.game.input.touch.addTouchLockCallback(this.unlock,this)}this.touchLocked=true},unlock:function(){if(this.noAudio||!this.touchLocked||this._unlockSource!==null){return true}if(this.usingAudioTag){this.touchLocked=false;this._unlockSource=null}else if(this.usingWebAudio){var t=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=t;this._unlockSource.connect(this.context.destination);if(this._unlockSource.start===undefined){this._unlockSource.noteOn(0)}else{this._unlockSource.start(0)}}return true},stopAll:function(){if(this.noAudio){return}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].stop()}}},pauseAll:function(){if(this.noAudio){return}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].pause()}}},resumeAll:function(){if(this.noAudio){return}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].resume()}}},decode:function(t,e){e=e||null;var i=this.game.cache.getSoundData(t);if(i){if(this.game.cache.isSoundDecoded(t)===false){this.game.cache.updateSound(t,"isDecoding",true);var r=this;try{this.context.decodeAudioData(i,function(i){if(i){r.game.cache.decodedSound(t,i);r.onSoundDecode.dispatch(t,e)}})}catch(t){}}}},setDecodedCallback:function(t,e,i){if(typeof t==="string"){t=[t]}this._watchList.reset();for(var r=0;r<t.length;r++){if(t[r]instanceof s.Sound){if(!this.game.cache.isSoundDecoded(t[r].key)){this._watchList.add(t[r].key)}}else if(!this.game.cache.isSoundDecoded(t[r])){this._watchList.add(t[r])}}if(this._watchList.total===0){this._watching=false;e.call(i)}else{this._watching=true;this._watchCallback=e;this._watchContext=i}},update:function(){if(this.noAudio){return}if(this.touchLocked&&this._unlockSource!==null&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)){this.touchLocked=false;this._unlockSource=null}for(var t=0;t<this._sounds.length;t++){this._sounds[t].update()}if(this._watching){var e=this._watchList.first;while(e){if(this.game.cache.isSoundDecoded(e)){this._watchList.remove(e)}e=this._watchList.next}if(this._watchList.total===0){this._watching=false;this._watchCallback.call(this._watchContext)}}},add:function(t,e,i,r){if(e===undefined){e=1}if(i===undefined){i=false}if(r===undefined){r=this.connectToMaster}var n=new s.Sound(this.game,t,e,i,r);this._sounds.push(n);return n},addSprite:function(t){var e=new s.AudioSprite(this.game,t);return e},remove:function(t){var e=this._sounds.length;while(e--){if(this._sounds[e]===t){this._sounds[e].destroy(false);this._sounds.splice(e,1);return true}}return false},removeByKey:function(t){var e=this._sounds.length;var i=0;while(e--){if(this._sounds[e].key===t){this._sounds[e].destroy(false);this._sounds.splice(e,1);i++}}return i},play:function(t,e,i){if(this.noAudio){return}var r=this.add(t,e,i);r.play();return r},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t].usingAudioTag){this._sounds[t].mute=true}}this.onMute.dispatch()},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var t=0;t<this._sounds.length;t++){if(this._sounds[t].usingAudioTag){this._sounds[t].mute=false}}this.onUnMute.dispatch()},destroy:function(){this.stopAll();for(var t=0;t<this._sounds.length;t++){if(this._sounds[t]){this._sounds[t].destroy()}}this._sounds=[];this.onSoundDecode.dispose();if(this.context){if(window["PhaserGlobal"]){window["PhaserGlobal"].audioContext=this.context}else{if(this.context.close){this.context.close()}}}}};s.SoundManager.prototype.constructor=s.SoundManager;Object.defineProperty(s.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(t){t=t||false;if(t){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(s.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(t){if(t<0){t=0}else if(t>1){t=1}if(this._volume!==t){this._volume=t;if(this.usingWebAudio){this.masterGain.gain.value=t}else{for(var e=0;e<this._sounds.length;e++){if(this._sounds[e].usingAudioTag){this._sounds[e].updateGlobalVolume(t)}}}this.onVolumeChange.dispatch(t)}}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.ScaleManager=function(t,e,i){this.game=t;this.dom=s.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new s.Point;this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this._pageAlignHorizontally=false;this._pageAlignVertically=false;this.onOrientationChange=new s.Signal;this.enterIncorrectOrientation=new s.Signal;this.leaveIncorrectOrientation=new s.Signal;this.hasPhaserSetFullScreen=false;this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new s.Signal;this.onFullScreenChange=new s.Signal;this.onFullScreenError=new s.Signal;this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new s.Point(1,1);this.scaleFactorInversed=new s.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new s.Rectangle;this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:false,orientationFallback:null,noMargins:false,scrollTo:null,forceMinimumDocumentHeight:false,canExpandParent:true,clickTrampoline:""};this._scaleMode=s.ScaleManager.NO_SCALE;this._fullScreenScaleMode=s.ScaleManager.NO_SCALE;this.parentIsWindow=false;this.parentNode=null;this.parentScaleFactor=new s.Point(1,1);this.trackParentInterval=2e3;this.onSizeChange=new s.Signal;this.onResize=null;this.onResizeContext=null;this._pendingScaleMode=null;this._fullScreenRestore=null;this._gameSize=new s.Rectangle;this._userScaleFactor=new s.Point(1,1);this._userScaleTrim=new s.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new s.Rectangle;this._tempBounds=new s.Rectangle;this._lastReportedCanvasSize=new s.Rectangle;this._lastReportedGameSize=new s.Rectangle;this._booted=false;if(t.config){this.parseConfig(t.config)}this.setupScale(e,i)};s.ScaleManager.EXACT_FIT=0;s.ScaleManager.NO_SCALE=1;s.ScaleManager.SHOW_ALL=2;s.ScaleManager.RESIZE=3;s.ScaleManager.USER_SCALE=4;s.ScaleManager.prototype={boot:function(){var t=this.compatibility;t.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){t.scrollTo=new s.Point(0,1)}else{t.scrollTo=new s.Point(0,0)}}if(this.game.device.desktop){t.orientationFallback="screen";t.clickTrampoline="when-not-mouse"}else{t.orientationFallback="";t.clickTrampoline=""}var e=this;this._orientationChange=function(t){return e.orientationChange(t)};this._windowResize=function(t){return e.windowResize(t)};window.addEventListener("orientationchange",this._orientationChange,false);window.addEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){this._fullScreenChange=function(t){return e.fullScreenChange(t)};this._fullScreenError=function(t){return e.fullScreenError(t)};document.addEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.addEventListener("mozfullscreenchange",this._fullScreenChange,false);document.addEventListener("MSFullscreenChange",this._fullScreenChange,false);document.addEventListener("fullscreenchange",this._fullScreenChange,false);document.addEventListener("webkitfullscreenerror",this._fullScreenError,false);document.addEventListener("mozfullscreenerror",this._fullScreenError,false);document.addEventListener("MSFullscreenError",this._fullScreenError,false);document.addEventListener("fullscreenerror",this._fullScreenError,false)}this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);if(s.FlexGrid){this.grid=new s.FlexGrid(this,this.width,this.height)}this._booted=true;if(this._pendingScaleMode!==null){this.scaleMode=this._pendingScaleMode;this._pendingScaleMode=null}},parseConfig:function(t){if(t["scaleMode"]!==undefined){if(this._booted){this.scaleMode=t["scaleMode"]}else{this._pendingScaleMode=t["scaleMode"]}}if(t["fullScreenScaleMode"]!==undefined){this.fullScreenScaleMode=t["fullScreenScaleMode"]}if(t["fullScreenTarget"]){this.fullScreenTarget=t["fullScreenTarget"]}},setupScale:function(t,e){var i;var r=new s.Rectangle;if(this.game.parent!==""){if(typeof this.game.parent==="string"){i=document.getElementById(this.game.parent)}else if(this.game.parent&&this.game.parent.nodeType===1){i=this.game.parent}}if(!i){this.parentNode=null;this.parentIsWindow=true;r.width=this.dom.visualBounds.width;r.height=this.dom.visualBounds.height;this.offset.set(0,0)}else{this.parentNode=i;this.parentIsWindow=false;this.getParentBounds(this._parentBounds);r.width=this._parentBounds.width;r.height=this._parentBounds.height;this.offset.set(this._parentBounds.x,this._parentBounds.y)}var n=0;var a=0;if(typeof t==="number"){n=t}else{this.parentScaleFactor.x=parseInt(t,10)/100;n=r.width*this.parentScaleFactor.x}if(typeof e==="number"){a=e}else{this.parentScaleFactor.y=parseInt(e,10)/100;a=r.height*this.parentScaleFactor.y}n=Math.floor(n);a=Math.floor(a);this._gameSize.setTo(0,0,n,a);this.updateDimensions(n,a,false)},_gameResumed:function(){this.queueUpdate(true)},setGameSize:function(t,e){this._gameSize.setTo(0,0,t,e);if(this.currentScaleMode!==s.ScaleManager.RESIZE){this.updateDimensions(t,e,true)}this.queueUpdate(true)},setUserScale:function(t,e,i,r){this._userScaleFactor.setTo(t,e);this._userScaleTrim.setTo(i|0,r|0);this.queueUpdate(true)},setResizeCallback:function(t,e){this.onResize=t;this.onResizeContext=e},signalSizeChange:function(){if(!s.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!s.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var t=this.width;var e=this.height;this._lastReportedCanvasSize.setTo(0,0,t,e);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);if(this.grid){this.grid.onResize(t,e)}this.onSizeChange.dispatch(this,t,e);if(this.currentScaleMode===s.ScaleManager.RESIZE){this.game.state.resize(t,e);this.game.load.resize(t,e)}}},setMinMax:function(t,e,i,r){this.minWidth=t;this.minHeight=e;if(typeof i!=="undefined"){this.maxWidth=i}if(typeof r!=="undefined"){this.maxHeight=r}},preUpdate:function(){if(this.game.time.time<this._lastUpdate+this._updateThrottle){return}var t=this._updateThrottle;this._updateThrottleReset=t>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var e=this._parentBounds.width;var i=this._parentBounds.height;var r=this.getParentBounds(this._parentBounds);var n=r.width!==e||r.height!==i;var a=this.updateOrientationState();if(n||a){if(this.onResize){this.onResize.call(this.onResizeContext,this,r)}this.updateLayout();this.signalSizeChange()}var o=this._updateThrottle*2;if(this._updateThrottle<t){o=Math.min(t,this._updateThrottleReset)}this._updateThrottle=s.Math.clamp(o,25,this.trackParentInterval);this._lastUpdate=this.game.time.time},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(t,e,i){this.width=t*this.parentScaleFactor.x;this.height=e*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();if(i){this.game.renderer.resize(this.width,this.height);this.game.camera.setSize(this.width,this.height);this.game.world.resize(this.width,this.height)}},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;if(this.game.canvas){this.dom.getOffset(this.game.canvas,this.offset)}this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);if(this.game.input&&this.game.input.scale){this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)}},forceOrientation:function(t,e){if(e===undefined){e=false}this.forceLandscape=t;this.forcePortrait=e;this.queueUpdate(true)},classifyOrientation:function(t){if(t==="portrait-primary"||t==="portrait-secondary"){return"portrait"}else if(t==="landscape-primary"||t==="landscape-secondary"){return"landscape"}else{return null}},updateOrientationState:function(){var t=this.screenOrientation;var e=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=this.forceLandscape&&!this.isLandscape||this.forcePortrait&&!this.isPortrait;var i=t!==this.screenOrientation;var r=e!==this.incorrectOrientation;if(r){if(this.incorrectOrientation){this.enterIncorrectOrientation.dispatch()}else{this.leaveIncorrectOrientation.dispatch()}}if(i||r){this.onOrientationChange.dispatch(this,t,e)}return i||r},orientationChange:function(t){this.event=t;this.queueUpdate(true)},windowResize:function(t){this.event=t;this.queueUpdate(true)},scrollTop:function(){var t=this.compatibility.scrollTo;if(t){window.scrollTo(t.x,t.y)}},refresh:function(){this.scrollTop();this.queueUpdate(true)},updateLayout:function(){var t=this.currentScaleMode;if(t===s.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();if(this.compatibility.forceMinimumDocumentHeight){document.documentElement.style.minHeight=window.innerHeight+"px"}if(this.incorrectOrientation){this.setMaximum()}else{if(t===s.ScaleManager.EXACT_FIT){this.setExactFit()}else if(t===s.ScaleManager.SHOW_ALL){if(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent){this.setShowAll(true);this.resetCanvas();this.setShowAll()}else{this.setShowAll()}}else if(t===s.ScaleManager.NO_SCALE){this.width=this.game.width;this.height=this.game.height}else if(t===s.ScaleManager.USER_SCALE){this.width=this.game.width*this._userScaleFactor.x-this._userScaleTrim.x;this.height=this.game.height*this._userScaleFactor.y-this._userScaleTrim.y}}if(!this.compatibility.canExpandParent&&(t===s.ScaleManager.SHOW_ALL||t===s.ScaleManager.USER_SCALE)){var e=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,e.width);this.height=Math.min(this.height,e.height)}this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(t){var e=t||new s.Rectangle;var i=this.boundingParent;var r=this.dom.visualBounds;var n=this.dom.layoutBounds;if(!i){e.setTo(0,0,r.width,r.height)}else{var a=i.getBoundingClientRect();var o=i.offsetParent?i.offsetParent.getBoundingClientRect():i.getBoundingClientRect();e.setTo(a.left-o.left,a.top-o.top,a.width,a.height);var h=this.windowConstraints;if(h.right){var l=h.right==="layout"?n:r;e.right=Math.min(e.right,l.width)}if(h.bottom){var l=h.bottom==="layout"?n:r;e.bottom=Math.min(e.bottom,l.height)}}e.setTo(Math.round(e.x),Math.round(e.y),Math.round(e.width),Math.round(e.height));return e},alignCanvas:function(t,e){var i=this.getParentBounds(this._tempBounds);var r=this.game.canvas;var s=this.margin;if(t){s.left=s.right=0;var n=r.getBoundingClientRect();if(this.width<i.width&&!this.incorrectOrientation){var a=n.left-i.x;var o=i.width/2-this.width/2;o=Math.max(o,0);var h=o-a;s.left=Math.round(h)}r.style.marginLeft=s.left+"px";if(s.left!==0){s.right=-(i.width-n.width-s.left);r.style.marginRight=s.right+"px"}}if(e){s.top=s.bottom=0;var n=r.getBoundingClientRect();if(this.height<i.height&&!this.incorrectOrientation){var a=n.top-i.y;var o=i.height/2-this.height/2;o=Math.max(o,0);var h=o-a;s.top=Math.round(h)}r.style.marginTop=s.top+"px";if(s.top!==0){s.bottom=-(i.height-n.height-s.top);r.style.marginBottom=s.bottom+"px"}}s.x=s.left;s.y=s.top},reflowGame:function(){this.resetCanvas("","");var t=this.getParentBounds(this._tempBounds);this.updateDimensions(t.width,t.height,true)},reflowCanvas:function(){if(!this.incorrectOrientation){this.width=s.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width);this.height=s.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)}this.resetCanvas();if(!this.compatibility.noMargins){if(this.isFullScreen&&this._createdFullScreenTarget){this.alignCanvas(true,true)}else{this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)}}this.updateScalingAndBounds()},resetCanvas:function(t,e){if(t===undefined){t=this.width+"px"}if(e===undefined){e=this.height+"px"}var i=this.game.canvas;if(!this.compatibility.noMargins){i.style.marginLeft="";i.style.marginTop="";i.style.marginRight="";i.style.marginBottom=""}i.style.width=t;i.style.height=e},queueUpdate:function(t){if(t){this._parentBounds.width=0;this._parentBounds.height=0}this._updateThrottle=this._updateThrottleReset},reset:function(t){if(t&&this.grid){this.grid.reset()}},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(t){var e=this.getParentBounds(this._tempBounds);var i=e.width;var r=e.height;var s;if(t){s=Math.max(r/this.game.height,i/this.game.width)}else{s=Math.min(r/this.game.height,i/this.game.width)}this.width=Math.round(this.game.width*s);this.height=Math.round(this.game.height*s)},setExactFit:function(){var t=this.getParentBounds(this._tempBounds);this.width=t.width;this.height=t.height;if(this.isFullScreen){return}if(this.maxWidth){this.width=Math.min(this.width,this.maxWidth)}if(this.maxHeight){this.height=Math.min(this.height,this.maxHeight)}},createFullScreenTarget:function(){var t=document.createElement("div");t.style.margin="0";t.style.padding="0";t.style.background="#000";return t},startFullScreen:function(t,e){if(this.isFullScreen){return false}if(!this.compatibility.supportsFullScreen){var i=this;setTimeout(function(){i.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"){var r=this.game.input;if(r.activePointer&&r.activePointer!==r.mousePointer&&(e||e!==false)){r.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[t,false]);return}}if(t!==undefined&&this.game.renderType===s.CANVAS){this.game.stage.smoothed=t}var n=this.fullScreenTarget;if(!n){this.cleanupCreatedTarget();this._createdFullScreenTarget=this.createFullScreenTarget();n=this._createdFullScreenTarget}var a={targetElement:n};this.hasPhaserSetFullScreen=true;this.onFullScreenInit.dispatch(this,a);if(this._createdFullScreenTarget){var o=this.game.canvas;var h=o.parentNode;h.insertBefore(n,o);n.appendChild(o)}if(this.game.device.fullscreenKeyboard){n[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{n[this.game.device.requestFullscreen]()}return true},stopFullScreen:function(){if(!this.isFullScreen||!this.compatibility.supportsFullScreen){return false}this.hasPhaserSetFullScreen=false;document[this.game.device.cancelFullscreen]();return true},cleanupCreatedTarget:function(){var t=this._createdFullScreenTarget;if(t&&t.parentNode){var e=t.parentNode;e.insertBefore(this.game.canvas,t);e.removeChild(t)}this._createdFullScreenTarget=null},prepScreenMode:function(t){var e=!!this._createdFullScreenTarget;var i=this._createdFullScreenTarget||this.fullScreenTarget;if(t){if(e||this.fullScreenScaleMode===s.ScaleManager.EXACT_FIT){if(i!==this.game.canvas){this._fullScreenRestore={targetWidth:i.style.width,targetHeight:i.style.height};i.style.width="100%";i.style.height="100%"}}}else{if(this._fullScreenRestore){i.style.width=this._fullScreenRestore.targetWidth;i.style.height=this._fullScreenRestore.targetHeight;this._fullScreenRestore=null}this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.resetCanvas()}},fullScreenChange:function(t){this.event=t;if(this.isFullScreen){this.prepScreenMode(true);this.updateLayout();this.queueUpdate(true)}else{this.prepScreenMode(false);this.cleanupCreatedTarget();this.updateLayout();this.queueUpdate(true)}this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(t){this.event=t;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(t,e,i,r){if(e===undefined){e=this.width}if(i===undefined){i=this.height}if(r===undefined){r=false}if(!t||!t["scale"]){return t}t.scale.x=1;t.scale.y=1;if(t.width<=0||t.height<=0||e<=0||i<=0){return t}var s=e;var n=t.height*e/t.width;var a=t.width*i/t.height;var o=i;var h=a>e;if(h){h=r}else{h=!r}if(h){t.width=Math.floor(s);t.height=Math.floor(n)}else{t.width=Math.floor(a);t.height=Math.floor(o)}return t},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,false);window.removeEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.removeEventListener("mozfullscreenchange",this._fullScreenChange,false);document.removeEventListener("MSFullscreenChange",this._fullScreenChange,false);document.removeEventListener("fullscreenchange",this._fullScreenChange,false);document.removeEventListener("webkitfullscreenerror",this._fullScreenError,false);document.removeEventListener("mozfullscreenerror",this._fullScreenError,false);document.removeEventListener("MSFullscreenError",this._fullScreenError,false);document.removeEventListener("fullscreenerror",this._fullScreenError,false)}}};s.ScaleManager.prototype.constructor=s.ScaleManager;Object.defineProperty(s.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget){return null}var t=this.game.canvas&&this.game.canvas.parentNode;return t||null}});Object.defineProperty(s.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(t){if(t!==this._scaleMode){if(!this.isFullScreen){this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.queueUpdate(true)}this._scaleMode=t}return this._scaleMode}});Object.defineProperty(s.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(t){if(t!==this._fullScreenScaleMode){if(this.isFullScreen){this.prepScreenMode(false);this._fullScreenScaleMode=t;this.prepScreenMode(true);this.queueUpdate(true)}else{this._fullScreenScaleMode=t}}return this._fullScreenScaleMode}});Object.defineProperty(s.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(s.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(t){if(t!==this._pageAlignHorizontally){this._pageAlignHorizontally=t;this.queueUpdate(true)}}});Object.defineProperty(s.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(t){if(t!==this._pageAlignVertically){this._pageAlignVertically=t;this.queueUpdate(true)}}});Object.defineProperty(s.ScaleManager.prototype,"isFullScreen",{get:function(){return!!(document["fullscreenElement"]||document["webkitFullscreenElement"]||document["mozFullScreenElement"]||document["msFullscreenElement"])}});Object.defineProperty(s.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}});Object.defineProperty(s.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}});Object.defineProperty(s.ScaleManager.prototype,"isGamePortrait",{get:function(){return this.height>this.width}});Object.defineProperty(s.ScaleManager.prototype,"isGameLandscape",{get:function(){return this.width>this.height}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Utils.Debug=function(t){this.game=t;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false};s.Utils.Debug.prototype={boot:function(){if(this.game.renderType===s.CANVAS){this.context=this.game.context}else{this.bmd=new s.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,true);this.sprite=this.game.make.image(0,0,this.bmd);this.game.stage.addChild(this.sprite);this.game.scale.onSizeChange.add(this.resize,this);this.canvas=PIXI.CanvasPool.create(this,this.game.width,this.game.height);this.context=this.canvas.getContext("2d")}},resize:function(t,e,i){this.bmd.resize(e,i);this.canvas.width=e;this.canvas.height=i},preUpdate:function(){if(this.dirty&&this.sprite){this.bmd.clear();this.bmd.draw(this.canvas,0,0);this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},reset:function(){if(this.context){this.context.clearRect(0,0,this.game.width,this.game.height)}if(this.sprite){this.bmd.clear()}},start:function(t,e,i,r){if(typeof t!=="number"){t=0}if(typeof e!=="number"){e=0}i=i||"rgb(255,255,255)";if(r===undefined){r=0}this.currentX=t;this.currentY=e;this.currentColor=i;this.columnWidth=r;this.dirty=true;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=i;this.context.fillStyle=i;this.context.font=this.font;this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){var t=this.currentX;for(var e=0;e<arguments.length;e++){if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(arguments[e],t+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[e],t,this.currentY);t+=this.columnWidth}this.currentY+=this.lineHeight},soundInfo:function(t,e,i,r){this.start(e,i,r);this.line("Sound: "+t.key+" Locked: "+t.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(t.key)+" Pending Playback: "+t.pendingPlayback);this.line("Decoded: "+t.isDecoded+" Decoding: "+t.isDecoding);this.line("Total Duration: "+t.totalDuration+" Playing: "+t.isPlaying);this.line("Time: "+t.currentTime);this.line("Volume: "+t.volume+" Muted: "+t.mute);this.line("WebAudio: "+t.usingWebAudio+" Audio: "+t.usingAudioTag);if(t.currentMarker!==""){this.line("Marker: "+t.currentMarker+" Duration: "+t.duration+" (ms: "+t.durationMS+")");this.line("Start: "+t.markers[t.currentMarker].start+" Stop: "+t.markers[t.currentMarker].stop);this.line("Position: "+t.position)}this.stop()},cameraInfo:function(t,e,i,r){this.start(e,i,r);this.line("Camera ("+t.width+" x "+t.height+")");this.line("X: "+t.x+" Y: "+t.y);if(t.bounds){this.line("Bounds x: "+t.bounds.x+" Y: "+t.bounds.y+" w: "+t.bounds.width+" h: "+t.bounds.height)}this.line("View x: "+t.view.x+" Y: "+t.view.y+" w: "+t.view.width+" h: "+t.view.height);this.line("Total in view: "+t.totalInView);this.stop()},timer:function(t,e,i,r){this.start(e,i,r);this.line("Timer (running: "+t.running+" expired: "+t.expired+")");this.line("Next Tick: "+t.next+" Duration: "+t.duration);this.line("Paused: "+t.paused+" Length: "+t.length);this.stop()},pointer:function(t,e,i,r,s){if(t==null){return}if(e===undefined){e=false}i=i||"rgba(0,255,0,0.5)";r=r||"rgba(255,0,0,0.5)";if(e===true&&t.isUp===true){return}this.start(t.x,t.y-100,s);this.context.beginPath();this.context.arc(t.x,t.y,t.circle.radius,0,Math.PI*2);if(t.active){this.context.fillStyle=i}else{this.context.fillStyle=r}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(t.positionDown.x,t.positionDown.y);this.context.lineTo(t.position.x,t.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+t.id+" Active: "+t.active);this.line("World X: "+t.worldX+" World Y: "+t.worldY);this.line("Screen X: "+t.x+" Screen Y: "+t.y+" In: "+t.withinGame);this.line("Duration: "+t.duration+" ms");this.line("is Down: "+t.isDown+" is Up: "+t.isUp);this.stop()},spriteInputInfo:function(t,e,i,r){this.start(e,i,r);this.line("Sprite Input: ("+t.width+" x "+t.height+")");this.line("x: "+t.input.pointerX().toFixed(1)+" y: "+t.input.pointerY().toFixed(1));this.line("over: "+t.input.pointerOver()+" duration: "+t.input.overDuration().toFixed(0));this.line("down: "+t.input.pointerDown()+" duration: "+t.input.downDuration().toFixed(0));this.line("just over: "+t.input.justOver()+" just out: "+t.input.justOut());this.stop()},key:function(t,e,i,r){this.start(e,i,r,150);this.line("Key:",t.keyCode,"isDown:",t.isDown);this.line("justDown:",t.justDown,"justUp:",t.justUp);this.line("Time Down:",t.timeDown.toFixed(0),"duration:",t.duration.toFixed(0));this.stop()},inputInfo:function(t,e,i){this.start(t,e,i);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(t,e,i){var r=t.getBounds();r.x+=this.game.camera.x;r.y+=this.game.camera.y;this.rectangle(r,e,i)},ropeSegments:function(t,e,i){var r=t.segments;var s=this;r.forEach(function(t){s.rectangle(t,e,i)},this)},spriteInfo:function(t,e,i,r){this.start(e,i,r);this.line("Sprite: "+" ("+t.width+" x "+t.height+") anchor: "+t.anchor.x+" x "+t.anchor.y);this.line("x: "+t.x.toFixed(1)+" y: "+t.y.toFixed(1));this.line("angle: "+t.angle.toFixed(1)+" rotation: "+t.rotation.toFixed(1));this.line("visible: "+t.visible+" in camera: "+t.inCamera);this.line("bounds x: "+t._bounds.x.toFixed(1)+" y: "+t._bounds.y.toFixed(1)+" w: "+t._bounds.width.toFixed(1)+" h: "+t._bounds.height.toFixed(1));this.stop()},spriteCoords:function(t,e,i,r){this.start(e,i,r,100);if(t.name){this.line(t.name)}this.line("x:",t.x.toFixed(2),"y:",t.y.toFixed(2));this.line("pos x:",t.position.x.toFixed(2),"pos y:",t.position.y.toFixed(2));this.line("world x:",t.world.x.toFixed(2),"world y:",t.world.y.toFixed(2));this.stop()},lineInfo:function(t,e,i,r){this.start(e,i,r,80);this.line("start.x:",t.start.x.toFixed(2),"start.y:",t.start.y.toFixed(2));this.line("end.x:",t.end.x.toFixed(2),"end.y:",t.end.y.toFixed(2));this.line("length:",t.length.toFixed(2),"angle:",t.angle);this.stop()},pixel:function(t,e,i,r){r=r||2;this.start();this.context.fillStyle=i;this.context.fillRect(t,e,r,r);this.stop()},geom:function(t,e,i,r){if(i===undefined){i=true}if(r===undefined){r=0}e=e||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=e;this.context.strokeStyle=e;if(t instanceof s.Rectangle||r===1){if(i){this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}else{this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}}else if(t instanceof s.Circle||r===2){this.context.beginPath();this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,Math.PI*2,false);this.context.closePath();if(i){this.context.fill()}else{this.context.stroke()}}else if(t instanceof s.Point||r===3){this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4)}else if(t instanceof s.Line||r===4){this.context.lineWidth=1;this.context.beginPath();this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y);this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y);this.context.closePath();this.context.stroke()}this.stop()},rectangle:function(t,e,i){if(i===undefined){i=true}e=e||"rgba(0, 255, 0, 0.4)";this.start();if(i){this.context.fillStyle=e;this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}else{this.context.strokeStyle=e;this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height)}this.stop()},text:function(t,e,i,r,s){r=r||"rgb(255,255,255)";s=s||"16px Courier";this.start();this.context.font=s;if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(t,e+1,i+1)}this.context.fillStyle=r;this.context.fillText(t,e,i);this.stop()},quadTree:function(t,e){e=e||"rgba(255,0,0,0.3)";this.start();var i=t.bounds;if(t.nodes.length===0){this.context.strokeStyle=e;this.context.strokeRect(i.x,i.y,i.width,i.height);this.text("size: "+t.objects.length,i.x+4,i.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var r=0;r<t.objects.length;r++){this.context.strokeRect(t.objects[r].x,t.objects[r].y,t.objects[r].width,t.objects[r].height)}}else{for(var r=0;r<t.nodes.length;r++){this.quadTree(t.nodes[r])}}this.stop()},body:function(t,e,i){if(t.body){this.start();if(t.body.type===s.Physics.ARCADE){s.Physics.Arcade.Body.render(this.context,t.body,e,i)}else if(t.body.type===s.Physics.NINJA){s.Physics.Ninja.Body.render(this.context,t.body,e,i)}else if(t.body.type===s.Physics.BOX2D){s.Physics.Box2D.renderBody(this.context,t.body,e)}this.stop()}},bodyInfo:function(t,e,i,r){if(t.body){this.start(e,i,r,210);if(t.body.type===s.Physics.ARCADE){s.Physics.Arcade.Body.renderBodyInfo(this,t.body)}else if(t.body.type===s.Physics.BOX2D){this.game.physics.box2d.renderBodyInfo(this,t.body)}this.stop()}},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(t,e){this.start();s.Physics.Box2D.renderBody(this.context,t,e);this.stop()},displayList:function(t){if(t===undefined){t=this.game.world}if(t.hasOwnProperty("renderOrderID")){console.log("["+t.renderOrderID+"]",t)}else{console.log("[]",t)}if(t.children&&t.children.length>0){for(var e=0;e<t.children.length;e++){this.game.debug.displayList(t.children[e])}}},destroy:function(){PIXI.CanvasPool.remove(this)}};s.Utils.Debug.prototype.constructor=s.Utils.Debug;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.DOM={getOffset:function(t,e){e=e||new s.Point;var i=t.getBoundingClientRect();var r=s.DOM.scrollY;var n=s.DOM.scrollX;var a=document.documentElement.clientTop;var o=document.documentElement.clientLeft;e.x=i.left+n-o;e.y=i.top+r-a;return e},getBounds:function(t,e){if(e===undefined){e=0}t=t&&!t.nodeType?t[0]:t;if(!t||t.nodeType!==1){return false}else{return this.calibrate(t.getBoundingClientRect(),e)}},calibrate:function(t,e){e=+e||0;var i={width:0,height:0,left:0,right:0,top:0,bottom:0};i.width=(i.right=t.right+e)-(i.left=t.left-e);i.height=(i.bottom=t.bottom+e)-(i.top=t.top-e);return i},getAspectRatio:function(t){t=null==t?this.visualBounds:1===t.nodeType?this.getBounds(t):t;var e=t["width"];var i=t["height"];if(typeof e==="function"){e=e.call(t)}if(typeof i==="function"){i=i.call(t)}return e/i},inLayoutViewport:function(t,e){var i=this.getBounds(t,e);return!!i&&i.bottom>=0&&i.right>=0&&i.top<=this.layoutBounds.width&&i.left<=this.layoutBounds.height},getScreenOrientation:function(t){var e=window.screen;var i=e.orientation||e.mozOrientation||e.msOrientation;if(i&&typeof i.type==="string"){return i.type}else if(typeof i==="string"){return i}var r="portrait-primary";var s="landscape-primary";if(t==="screen"){return e.height>e.width?r:s}else if(t==="viewport"){return this.visualBounds.height>this.visualBounds.width?r:s}else if(t==="window.orientation"&&typeof window.orientation==="number"){return window.orientation===0||window.orientation===180?r:s}else if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches){return r}else if(window.matchMedia("(orientation: landscape)").matches){return s}}return this.visualBounds.height>this.visualBounds.width?r:s},visualBounds:new s.Rectangle,layoutBounds:new s.Rectangle,documentBounds:new s.Rectangle};s.Device.whenReady(function(t){var e=window&&"pageXOffset"in window?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft};var i=window&&"pageYOffset"in window?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(s.DOM,"scrollX",{get:e});Object.defineProperty(s.DOM,"scrollY",{get:i});Object.defineProperty(s.DOM.visualBounds,"x",{get:e});Object.defineProperty(s.DOM.visualBounds,"y",{get:i});Object.defineProperty(s.DOM.layoutBounds,"x",{value:0});Object.defineProperty(s.DOM.layoutBounds,"y",{value:0});var r=t.desktop&&document.documentElement.clientWidth<=window.innerWidth&&document.documentElement.clientHeight<=window.innerHeight;if(r){var n=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)};var a=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(s.DOM.visualBounds,"width",{get:n});Object.defineProperty(s.DOM.visualBounds,"height",{get:a});Object.defineProperty(s.DOM.layoutBounds,"width",{get:n});Object.defineProperty(s.DOM.layoutBounds,"height",{get:a})}else{Object.defineProperty(s.DOM.visualBounds,"width",{get:function(){return window.innerWidth}});Object.defineProperty(s.DOM.visualBounds,"height",{get:function(){return window.innerHeight}});Object.defineProperty(s.DOM.layoutBounds,"width",{get:function(){var t=document.documentElement.clientWidth;var e=window.innerWidth;return t<e?e:t}});Object.defineProperty(s.DOM.layoutBounds,"height",{get:function(){var t=document.documentElement.clientHeight;var e=window.innerHeight;return t<e?e:t}})}Object.defineProperty(s.DOM.documentBounds,"x",{value:0});Object.defineProperty(s.DOM.documentBounds,"y",{value:0});Object.defineProperty(s.DOM.documentBounds,"width",{get:function(){var t=document.documentElement;return Math.max(t.clientWidth,t.offsetWidth,t.scrollWidth)}});Object.defineProperty(s.DOM.documentBounds,"height",{get:function(){var t=document.documentElement;return Math.max(t.clientHeight,t.offsetHeight,t.scrollHeight)}})},null,true);/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.ArraySet=function(t){this.position=0;this.list=t||[]};s.ArraySet.prototype={add:function(t){if(!this.exists(t)){this.list.push(t)}return t},getIndex:function(t){return this.list.indexOf(t)},getByKey:function(t,e){var i=this.list.length;while(i--){if(this.list[i][t]===e){return this.list[i]}}return null},exists:function(t){return this.list.indexOf(t)>-1},reset:function(){this.list.length=0},remove:function(t){var e=this.list.indexOf(t);if(e>-1){this.list.splice(e,1);return t}},setAll:function(t,e){var i=this.list.length;while(i--){if(this.list[i]){this.list[i][t]=e}}},callAll:function(t){var e=Array.prototype.slice.call(arguments,1);var i=this.list.length;while(i--){if(this.list[i]&&this.list[i][t]){this.list[i][t].apply(this.list[i],e)}}},removeAll:function(t){if(t===undefined){t=false}var e=this.list.length;while(e--){if(this.list[e]){var i=this.remove(this.list[e]);if(t){i.destroy()}}}this.position=0;this.list=[]}};Object.defineProperty(s.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(s.ArraySet.prototype,"first",{get:function(){this.position=0;if(this.list.length>0){return this.list[0]}else{return null}}});Object.defineProperty(s.ArraySet.prototype,"next",{get:function(){if(this.position<this.list.length){this.position++;return this.list[this.position]}else{return null}}});s.ArraySet.prototype.constructor=s.ArraySet;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.ArrayUtils={getRandomItem:function(t,e,i){if(t===null){return null}if(e===undefined){e=0}if(i===undefined){i=t.length}var r=e+Math.floor(Math.random()*i);return t[r]===undefined?null:t[r]},removeRandomItem:function(t,e,i){if(t==null){return null}if(e===undefined){e=0}if(i===undefined){i=t.length}var r=e+Math.floor(Math.random()*i);if(r<t.length){var s=t.splice(r,1);return s[0]===undefined?null:s[0]}else{return null}},shuffle:function(t){for(var e=t.length-1;e>0;e--){var i=Math.floor(Math.random()*(e+1));var r=t[e];t[e]=t[i];t[i]=r}return t},transposeMatrix:function(t){var e=t.length;var i=t[0].length;var r=new Array(i);for(var s=0;s<i;s++){r[s]=new Array(e);for(var n=e-1;n>-1;n--){r[s][n]=t[n][s]}}return r},rotateMatrix:function(t,e){if(typeof e!=="string"){e=(e%360+360)%360}if(e===90||e===-270||e==="rotateLeft"){t=s.ArrayUtils.transposeMatrix(t);t=t.reverse()}else if(e===-90||e===270||e==="rotateRight"){t=t.reverse();t=s.ArrayUtils.transposeMatrix(t)}else if(Math.abs(e)===180||e==="rotate180"){for(var i=0;i<t.length;i++){t[i].reverse()}t=t.reverse()}return t},findClosest:function(t,e){if(!e.length){return NaN}else if(e.length===1||t<e[0]){return e[0]}var i=1;while(e[i]<t){i++}var r=e[i-1];var s=i<e.length?e[i]:Number.POSITIVE_INFINITY;return s-t<=t-r?s:r},rotateRight:function(t){var e=t.pop();t.unshift(e);return e},rotateLeft:function(t){var e=t.shift();t.push(e);return e},rotate:function(t){var e=t.shift();t.push(e);return e},numberArray:function(t,e){var i=[];for(var r=t;r<=e;r++){i.push(r)}return i},numberArrayStep:function(t,e,i){if(t===undefined||t===null){t=0}if(e===undefined||e===null){e=t;t=0}if(i===undefined){i=1}var r=[];var n=Math.max(s.Math.roundAwayFromZero((e-t)/(i||1)),0);for(var a=0;a<n;a++){r.push(t);t+=i}return r}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};s.LinkedList.prototype={add:function(t){if(this.total===0&&this.first===null&&this.last===null){this.first=t;this.last=t;this.next=t;t.prev=this;this.total++;return t}this.last.next=t;t.prev=this.last;this.last=t;this.total++;return t},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(t){if(this.total===1){this.reset();t.next=t.prev=null;return}if(t===this.first){this.first=this.first.next}else if(t===this.last){this.last=this.last.prev}if(t.prev){t.prev.next=t.next}if(t.next){t.next.prev=t.prev}t.next=t.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(t){if(!this.first||!this.last){return}var e=this.first;do{if(e&&e[t]){e[t].call(e)}e=e.next}while(e!==this.last.next)}};s.LinkedList.prototype.constructor=s.LinkedList;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Create=function(t){this.game=t;this.bmd=null;this.canvas=null;this.ctx=null;this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]};s.Create.PALETTE_ARNE=0;s.Create.PALETTE_JMP=1;s.Create.PALETTE_CGA=2;s.Create.PALETTE_C64=3;s.Create.PALETTE_JAPANESE_MACHINE=4;s.Create.prototype={texture:function(t,e,i,r,s){if(i===undefined){i=8}if(r===undefined){r=i}if(s===undefined){s=0}var n=e[0].length*i;var a=e.length*r;if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(n,a);this.bmd.clear();for(var o=0;o<e.length;o++){var h=e[o];for(var l=0;l<h.length;l++){var u=h[l];if(u!=="."&&u!==" "){this.ctx.fillStyle=this.palettes[s][u];this.ctx.fillRect(l*i,o*r,i,r)}}}return this.bmd.generateTexture(t)},grid:function(t,e,i,r,s,n){if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(e,i);this.ctx.fillStyle=n;for(var a=0;a<i;a+=s){this.ctx.fillRect(0,a,e,1)}for(var o=0;o<e;o+=r){this.ctx.fillRect(o,0,1,i)}return this.bmd.generateTexture(t)}};s.Create.prototype.constructor=s.Create;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.FlexGrid=function(t,e,i){this.game=t.game;this.manager=t;this.width=e;this.height=i;this.boundsCustom=new s.Rectangle(0,0,e,i);this.boundsFluid=new s.Rectangle(0,0,e,i);this.boundsFull=new s.Rectangle(0,0,e,i);this.boundsNone=new s.Rectangle(0,0,e,i);this.positionCustom=new s.Point(0,0);this.positionFluid=new s.Point(0,0);this.positionFull=new s.Point(0,0);this.positionNone=new s.Point(0,0);this.scaleCustom=new s.Point(1,1);this.scaleFluid=new s.Point(1,1);this.scaleFluidInversed=new s.Point(1,1);this.scaleFull=new s.Point(1,1);this.scaleNone=new s.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=e/i;this.ratioV=i/e;this.multiplier=0;this.layers=[]};s.FlexGrid.prototype={setSize:function(t,e){this.width=t;this.height=e;this.ratioH=t/e;this.ratioV=e/t;this.scaleNone=new s.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(t,e,i,r){if(r===undefined){r=true}this.customWidth=t;this.customHeight=e;this.boundsCustom.width=t;this.boundsCustom.height=e;var n=new s.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);if(r){this.game.world.add(n)}this.layers.push(n);if(typeof i!=="undefined"&&typeof i!==null){n.addMultiple(i)}return n},createFluidLayer:function(t,e){if(e===undefined){e=true}var i=new s.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);if(e){this.game.world.add(i)}this.layers.push(i);if(typeof t!=="undefined"&&typeof t!==null){i.addMultiple(t)}return i},createFullLayer:function(t){var e=new s.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);this.game.world.add(e);this.layers.push(e);if(typeof t!=="undefined"){e.addMultiple(t)}return e},createFixedLayer:function(t){var e=new s.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);this.game.world.add(e);this.layers.push(e);if(typeof t!=="undefined"){e.addMultiple(t)}return e},reset:function(){var t=this.layers.length;while(t--){if(!this.layers[t].persist){this.layers[t].position=null;this.layers[t].scale=null;this.layers.slice(t,1)}}},onResize:function(t,e){this.ratioH=t/e;this.ratioV=e/t;this.refresh(t,e)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(t){this.manager.scaleSprite(t);t.x=this.manager.bounds.centerX;t.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",false)}};s.FlexGrid.prototype.constructor=s.FlexGrid;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.FlexLayer=function(t,e,i,r){s.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),false);this.manager=t.manager;this.grid=t;this.persist=false;this.position=e;this.bounds=i;this.scale=r;this.topLeft=i.topLeft;this.topMiddle=new s.Point(i.halfWidth,0);this.topRight=i.topRight;this.bottomLeft=i.bottomLeft;this.bottomMiddle=new s.Point(i.halfWidth,i.bottom);this.bottomRight=i.bottomRight};s.FlexLayer.prototype=Object.create(s.Group.prototype);s.FlexLayer.prototype.constructor=s.FlexLayer;s.FlexLayer.prototype.resize=function(){};s.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",false);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Color={packPixel:function(t,e,i,r){if(s.Device.LITTLE_ENDIAN){return(r<<24|i<<16|e<<8|t)>>>0}else{return(t<<24|e<<16|i<<8|r)>>>0}},unpackPixel:function(t,e,i,r){if(e===undefined||e===null){e=s.Color.createColor()}if(i===undefined||i===null){i=false}if(r===undefined||r===null){r=false}if(s.Device.LITTLE_ENDIAN){e.a=(t&4278190080)>>>24;e.b=(t&16711680)>>>16;e.g=(t&65280)>>>8;e.r=t&255}else{e.r=(t&4278190080)>>>24;e.g=(t&16711680)>>>16;e.b=(t&65280)>>>8;e.a=t&255}e.color=t;e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a/255+")";if(i){s.Color.RGBtoHSL(e.r,e.g,e.b,e)}if(r){s.Color.RGBtoHSV(e.r,e.g,e.b,e)}return e},fromRGBA:function(t,e){if(!e){e=s.Color.createColor()}e.r=(t&4278190080)>>>24;e.g=(t&16711680)>>>16;e.b=(t&65280)>>>8;e.a=t&255;e.rgba="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";return e},toRGBA:function(t,e,i,r){return t<<24|e<<16|i<<8|r},toABGR:function(t,e,i,r){return(r<<24|i<<16|e<<8|t)>>>0},RGBtoHSL:function(t,e,i,r){if(!r){r=s.Color.createColor(t,e,i,1)}t/=255;e/=255;i/=255;var n=Math.min(t,e,i);var a=Math.max(t,e,i);r.h=0;r.s=0;r.l=(a+n)/2;if(a!==n){var o=a-n;r.s=r.l>.5?o/(2-a-n):o/(a+n);if(a===t){r.h=(e-i)/o+(e<i?6:0)}else if(a===e){r.h=(i-t)/o+2}else if(a===i){r.h=(t-e)/o+4}r.h/=6}return r},HSLtoRGB:function(t,e,i,r){if(!r){r=s.Color.createColor(i,i,i)}else{r.r=i;r.g=i;r.b=i}if(e!==0){var n=i<.5?i*(1+e):i+e-i*e;var a=2*i-n;r.r=s.Color.hueToColor(a,n,t+1/3);r.g=s.Color.hueToColor(a,n,t);r.b=s.Color.hueToColor(a,n,t-1/3)}r.r=Math.floor(r.r*255|0);r.g=Math.floor(r.g*255|0);r.b=Math.floor(r.b*255|0);s.Color.updateColor(r);return r},RGBtoHSV:function(t,e,i,r){if(!r){r=s.Color.createColor(t,e,i,255)}t/=255;e/=255;i/=255;var n=Math.min(t,e,i);var a=Math.max(t,e,i);var o=a-n;r.h=0;r.s=a===0?0:o/a;r.v=a;if(a!==n){if(a===t){r.h=(e-i)/o+(e<i?6:0)}else if(a===e){r.h=(i-t)/o+2}else if(a===i){r.h=(t-e)/o+4}r.h/=6}return r},HSVtoRGB:function(t,e,i,r){if(r===undefined){r=s.Color.createColor(0,0,0,1,t,e,0,i)}var n,a,o;var h=Math.floor(t*6);var l=t*6-h;var u=i*(1-e);var c=i*(1-l*e);var f=i*(1-(1-l)*e);switch(h%6){case 0:n=i;a=f;o=u;break;case 1:n=c;a=i;o=u;break;case 2:n=u;a=i;o=f;break;case 3:n=u;a=c;o=i;break;case 4:n=f;a=u;o=i;break;case 5:n=i;a=u;o=c;break}r.r=Math.floor(n*255);r.g=Math.floor(a*255);r.b=Math.floor(o*255);s.Color.updateColor(r);return r},hueToColor:function(t,e,i){if(i<0){i+=1}if(i>1){i-=1}if(i<1/6){return t+(e-t)*6*i}if(i<1/2){return e}if(i<2/3){return t+(e-t)*(2/3-i)*6}return t},createColor:function(t,e,i,r,n,a,o,h){var l={r:t||0,g:e||0,b:i||0,a:r||1,h:n||0,s:a||0,l:o||0,v:h||0,color:0,color32:0,rgba:""};return s.Color.updateColor(l)},updateColor:function(t){t.rgba="rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+t.a.toString()+")";t.color=s.Color.getColor(t.r,t.g,t.b);t.color32=s.Color.getColor32(t.a*255,t.r,t.g,t.b);return t},getColor32:function(t,e,i,r){return t<<24|e<<16|i<<8|r},getColor:function(t,e,i){return t<<16|e<<8|i},RGBtoString:function(t,e,i,r,n){if(r===undefined){r=255}if(n===undefined){n="#"}if(n==="#"){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}else{return"0x"+s.Color.componentToHex(r)+s.Color.componentToHex(t)+s.Color.componentToHex(e)+s.Color.componentToHex(i)}},hexToRGB:function(t){var e=s.Color.hexToColor(t);if(e){return s.Color.getColor32(e.a,e.r,e.g,e.b)}},hexToColor:function(t,e){t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,r){return e+e+i+i+r+r});var i=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(i){var r=parseInt(i[1],16);var n=parseInt(i[2],16);var a=parseInt(i[3],16);if(!e){e=s.Color.createColor(r,n,a)}else{e.r=r;e.g=n;e.b=a}}return e},webToColor:function(t,e){if(!e){e=s.Color.createColor()}var i=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t);if(i){e.r=parseInt(i[1],10);e.g=parseInt(i[2],10);e.b=parseInt(i[3],10);e.a=i[4]!==undefined?parseFloat(i[4]):1;s.Color.updateColor(e)}return e},valueToColor:function(t,e){if(!e){e=s.Color.createColor()}if(typeof t==="string"){if(t.indexOf("rgb")===0){return s.Color.webToColor(t,e)}else{e.a=1;return s.Color.hexToColor(t,e)}}else if(typeof t==="number"){var i=s.Color.getRGB(t);e.r=i.r;e.g=i.g;e.b=i.b;e.a=i.a/255;return e}else{return e}},componentToHex:function(t){var e=t.toString(16);return e.length===1?"0"+e:e},HSVColorWheel:function(t,e){if(t===undefined){t=1}if(e===undefined){e=1}var i=[];for(var r=0;r<=359;r++){i.push(s.Color.HSVtoRGB(r/359,t,e))}return i},HSLColorWheel:function(t,e){if(t===undefined){t=.5}if(e===undefined){e=.5}var i=[];for(var r=0;r<=359;r++){i.push(s.Color.HSLtoRGB(r/359,t,e))}return i},interpolateColor:function(t,e,i,r,n){if(n===undefined){n=255}var a=s.Color.getRGB(t);var o=s.Color.getRGB(e);var h=(o.red-a.red)*r/i+a.red;var l=(o.green-a.green)*r/i+a.green;var u=(o.blue-a.blue)*r/i+a.blue;return s.Color.getColor32(n,h,l,u)},interpolateColorWithRGB:function(t,e,i,r,n,a){var o=s.Color.getRGB(t);var h=(e-o.red)*a/n+o.red;var l=(i-o.green)*a/n+o.green;var u=(r-o.blue)*a/n+o.blue;return s.Color.getColor(h,l,u)},interpolateRGB:function(t,e,i,r,n,a,o,h){var l=(r-t)*h/o+t;var u=(n-e)*h/o+e;var c=(a-i)*h/o+i;return s.Color.getColor(l,u,c)},getRandomColor:function(t,e,i){if(t===undefined){t=0}if(e===undefined){e=255}if(i===undefined){i=255}if(e>255||t>e){return s.Color.getColor(255,255,255)}var r=t+Math.round(Math.random()*(e-t));var n=t+Math.round(Math.random()*(e-t));var a=t+Math.round(Math.random()*(e-t));return s.Color.getColor32(i,r,n,a)},getRGB:function(t){if(t>16777215){return{alpha:t>>>24,red:t>>16&255,green:t>>8&255,blue:t&255,a:t>>>24,r:t>>16&255,g:t>>8&255,b:t&255}}else{return{alpha:255,red:t>>16&255,green:t>>8&255,blue:t&255,a:255,r:t>>16&255,g:t>>8&255,b:t&255}}},getWebRGB:function(t){if(typeof t==="object"){return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")"}else{var e=s.Color.getRGB(t);return"rgba("+e.r.toString()+","+e.g.toString()+","+e.b.toString()+","+(e.a/255).toString()+")"}},getAlpha:function(t){return t>>>24},getAlphaFloat:function(t){return(t>>>24)/255},getRed:function(t){return t>>16&255},getGreen:function(t){return t>>8&255},getBlue:function(t){return t&255},blendNormal:function(t){return t},blendLighten:function(t,e){return e>t?e:t},blendDarken:function(t,e){return e>t?t:e},blendMultiply:function(t,e){return t*e/255},blendAverage:function(t,e){return(t+e)/2},blendAdd:function(t,e){return Math.min(255,t+e)},blendSubtract:function(t,e){return Math.max(0,t+e-255)},blendDifference:function(t,e){return Math.abs(t-e)},blendNegation:function(t,e){return 255-Math.abs(255-t-e)},blendScreen:function(t,e){return 255-((255-t)*(255-e)>>8)},blendExclusion:function(t,e){return t+e-2*t*e/255},blendOverlay:function(t,e){return e<128?2*t*e/255:255-2*(255-t)*(255-e)/255},blendSoftLight:function(t,e){return e<128?2*((t>>1)+64)*(e/255):255-2*(255-((t>>1)+64))*(255-e)/255},blendHardLight:function(t,e){return s.Color.blendOverlay(e,t)},blendColorDodge:function(t,e){return e===255?e:Math.min(255,(t<<8)/(255-e))},blendColorBurn:function(t,e){return e===0?e:Math.max(0,255-(255-t<<8)/e)},blendLinearDodge:function(t,e){return s.Color.blendAdd(t,e)},blendLinearBurn:function(t,e){return s.Color.blendSubtract(t,e)},blendLinearLight:function(t,e){return e<128?s.Color.blendLinearBurn(t,2*e):s.Color.blendLinearDodge(t,2*(e-128))},blendVividLight:function(t,e){return e<128?s.Color.blendColorBurn(t,2*e):s.Color.blendColorDodge(t,2*(e-128))},blendPinLight:function(t,e){return e<128?s.Color.blendDarken(t,2*e):s.Color.blendLighten(t,2*(e-128))},blendHardMix:function(t,e){return s.Color.blendVividLight(t,e)<128?0:255},blendReflect:function(t,e){return e===255?e:Math.min(255,t*t/(255-e))},blendGlow:function(t,e){return s.Color.blendReflect(e,t)},blendPhoenix:function(t,e){return Math.min(t,e)-Math.max(t,e)+255}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics=function(t,e){e=e||{};this.game=t;this.config=e;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.matter=null;this.parseConfig()};s.Physics.ARCADE=0;s.Physics.P2JS=1;s.Physics.NINJA=2;s.Physics.BOX2D=3;s.Physics.CHIPMUNK=4;s.Physics.MATTERJS=5;s.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty("arcade")||this.config["arcade"]===true)&&s.Physics.hasOwnProperty("Arcade")){this.arcade=new s.Physics.Arcade(this.game)}if(this.config.hasOwnProperty("ninja")&&this.config["ninja"]===true&&s.Physics.hasOwnProperty("Ninja")){this.ninja=new s.Physics.Ninja(this.game)}if(this.config.hasOwnProperty("p2")&&this.config["p2"]===true&&s.Physics.hasOwnProperty("P2")){this.p2=new s.Physics.P2(this.game,this.config)}if(this.config.hasOwnProperty("box2d")&&this.config["box2d"]===true&&s.Physics.hasOwnProperty("BOX2D")){this.box2d=new s.Physics.BOX2D(this.game,this.config)}if(this.config.hasOwnProperty("matter")&&this.config["matter"]===true&&s.Physics.hasOwnProperty("Matter")){this.matter=new s.Physics.Matter(this.game,this.config)}},startSystem:function(t){if(t===s.Physics.ARCADE){this.arcade=new s.Physics.Arcade(this.game)}else if(t===s.Physics.P2JS){if(this.p2===null){this.p2=new s.Physics.P2(this.game,this.config)}else{this.p2.reset()}}else if(t===s.Physics.NINJA){this.ninja=new s.Physics.Ninja(this.game)}else if(t===s.Physics.BOX2D){if(this.box2d===null){this.box2d=new s.Physics.Box2D(this.game,this.config)}else{this.box2d.reset()}}else if(t===s.Physics.MATTERJS){if(this.matter===null){this.matter=new s.Physics.Matter(this.game,this.config)}else{this.matter.reset()}}},enable:function(t,e,i){if(e===undefined){e=s.Physics.ARCADE}if(i===undefined){i=false}if(e===s.Physics.ARCADE){this.arcade.enable(t)}else if(e===s.Physics.P2JS&&this.p2){this.p2.enable(t,i)}else if(e===s.Physics.NINJA&&this.ninja){this.ninja.enableAABB(t)}else if(e===s.Physics.BOX2D&&this.box2d){this.box2d.enable(t)}else if(e===s.Physics.MATTERJS&&this.matter){this.matter.enable(t)}else{console.warn(t.key+" is attempting to enable a physics body using an unknown physics system.")}},preUpdate:function(){if(this.p2){this.p2.preUpdate()}if(this.box2d){this.box2d.preUpdate()}if(this.matter){this.matter.preUpdate()}},update:function(){if(this.p2){this.p2.update()}if(this.box2d){this.box2d.update()}if(this.matter){this.matter.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}if(this.box2d){this.box2d.setBoundsToWorld()}if(this.matter){this.matter.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}if(this.box2d){this.box2d.clear()}if(this.matter){this.matter.clear()}},reset:function(){if(this.p2){this.p2.reset()}if(this.box2d){this.box2d.reset()}if(this.matter){this.matter.reset()}},destroy:function(){if(this.p2){this.p2.destroy()}if(this.box2d){this.box2d.destroy()}if(this.matter){this.matter.destroy()}this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null;this.matter=null}};s.Physics.prototype.constructor=s.Physics;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.Arcade=function(t){this.game=t;this.gravity=new s.Point;this.bounds=new s.Rectangle(0,0,t.world.width,t.world.height);this.checkCollision={up:true,down:true,left:true,right:true};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.forceX=false;this.sortDirection=s.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=true;this.isPaused=false;this.quadTree=new s.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};s.Physics.Arcade.prototype.constructor=s.Physics.Arcade;s.Physics.Arcade.SORT_NONE=0;s.Physics.Arcade.LEFT_RIGHT=1;s.Physics.Arcade.RIGHT_LEFT=2;s.Physics.Arcade.TOP_BOTTOM=3;s.Physics.Arcade.BOTTOM_TOP=4;s.Physics.Arcade.prototype={setBounds:function(t,e,i,r){this.bounds.setTo(t,e,i,r)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(t,e){if(e===undefined){e=true}var i=1;if(Array.isArray(t)){i=t.length;while(i--){if(t[i]instanceof s.Group){this.enable(t[i].children,e)}else{this.enableBody(t[i]);if(e&&t[i].hasOwnProperty("children")&&t[i].children.length>0){this.enable(t[i],true)}}}}else{if(t instanceof s.Group){this.enable(t.children,e)}else{this.enableBody(t);if(e&&t.hasOwnProperty("children")&&t.children.length>0){this.enable(t.children,true)}}}},enableBody:function(t){if(t.hasOwnProperty("body")&&t.body===null){t.body=new s.Physics.Arcade.Body(t);if(t.parent&&t.parent instanceof s.Group){t.parent.addToHash(t)}}},updateMotion:function(t){var e=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity;t.angularVelocity+=e;t.rotation+=t.angularVelocity*this.game.time.physicsElapsed;t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x);t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y)},computeVelocity:function(t,e,i,r,s,n){if(n===undefined){n=1e4}if(t===1&&e.allowGravity){i+=(this.gravity.x+e.gravity.x)*this.game.time.physicsElapsed}else if(t===2&&e.allowGravity){i+=(this.gravity.y+e.gravity.y)*this.game.time.physicsElapsed}if(r){i+=r*this.game.time.physicsElapsed}else if(s){s*=this.game.time.physicsElapsed;if(i-s>0){i-=s}else if(i+s<0){i+=s}else{i=0}}if(i>n){i=n}else if(i<-n){i=-n}return i},overlap:function(t,e,i,r,s){i=i||null;r=r||null;s=s||i;this._total=0;if(!Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<e.length;n++){this.collideHandler(t,e[n],i,r,s,true)}}else if(Array.isArray(t)&&!Array.isArray(e)){for(var n=0;n<t.length;n++){this.collideHandler(t[n],e,i,r,s,true)}}else if(Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<t.length;n++){for(var a=0;a<e.length;a++){this.collideHandler(t[n],e[a],i,r,s,true)}}}else{this.collideHandler(t,e,i,r,s,true)}return this._total>0},collide:function(t,e,i,r,s){i=i||null;r=r||null;s=s||i;this._total=0;if(!Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<e.length;n++){this.collideHandler(t,e[n],i,r,s,false)}}else if(Array.isArray(t)&&!Array.isArray(e)){for(var n=0;n<t.length;n++){this.collideHandler(t[n],e,i,r,s,false)}}else if(Array.isArray(t)&&Array.isArray(e)){for(var n=0;n<t.length;n++){for(var a=0;a<e.length;a++){this.collideHandler(t[n],e[a],i,r,s,false)}}}else{this.collideHandler(t,e,i,r,s,false)}return this._total>0},sortLeftRight:function(t,e){if(!t.body||!e.body){return 0}return t.body.x-e.body.x},sortRightLeft:function(t,e){if(!t.body||!e.body){return 0}return e.body.x-t.body.x},sortTopBottom:function(t,e){if(!t.body||!e.body){return 0}return t.body.y-e.body.y},sortBottomTop:function(t,e){if(!t.body||!e.body){return 0}return e.body.y-t.body.y},sort:function(t,e){if(t.physicsSortDirection!==null){e=t.physicsSortDirection}else{if(e===undefined){e=this.sortDirection}}if(e===s.Physics.Arcade.LEFT_RIGHT){t.hash.sort(this.sortLeftRight)}else if(e===s.Physics.Arcade.RIGHT_LEFT){t.hash.sort(this.sortRightLeft)}else if(e===s.Physics.Arcade.TOP_BOTTOM){t.hash.sort(this.sortTopBottom)}else if(e===s.Physics.Arcade.BOTTOM_TOP){t.hash.sort(this.sortBottomTop)}},collideHandler:function(t,e,i,r,n,a){if(e===undefined&&t.physicsType===s.GROUP){this.sort(t);this.collideGroupVsSelf(t,i,r,n,a);return}if(!t||!e||!t.exists||!e.exists){return}if(this.sortDirection!==s.Physics.Arcade.SORT_NONE){if(t.physicsType===s.GROUP){this.sort(t)}if(e.physicsType===s.GROUP){this.sort(e)}}if(t.physicsType===s.SPRITE){if(e.physicsType===s.SPRITE){this.collideSpriteVsSprite(t,e,i,r,n,a)}else if(e.physicsType===s.GROUP){this.collideSpriteVsGroup(t,e,i,r,n,a)}else if(e.physicsType===s.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(t,e,i,r,n,a)}}else if(t.physicsType===s.GROUP){if(e.physicsType===s.SPRITE){this.collideSpriteVsGroup(e,t,i,r,n,a)}else if(e.physicsType===s.GROUP){this.collideGroupVsGroup(t,e,i,r,n,a)}else if(e.physicsType===s.TILEMAPLAYER){this.collideGroupVsTilemapLayer(t,e,i,r,n,a)}}else if(t.physicsType===s.TILEMAPLAYER){if(e.physicsType===s.SPRITE){this.collideSpriteVsTilemapLayer(e,t,i,r,n,a)}else if(e.physicsType===s.GROUP){this.collideGroupVsTilemapLayer(e,t,i,r,n,a)}}},collideSpriteVsSprite:function(t,e,i,r,s,n){if(!t.body||!e.body){return false}if(this.separate(t.body,e.body,r,s,n)){if(i){i.call(s,t,e)}this._total++}return true},collideSpriteVsGroup:function(t,e,i,r,n,a){if(e.length===0||!t.body){return}if(this.skipQuadTree||t.body.skipQuadTree){var o={};for(var h=0;h<e.hash.length;h++){var l=e.hash[h];if(!l||!l.exists||!l.body){continue}o=l.body.getBounds(o);if(this.sortDirection===s.Physics.Arcade.LEFT_RIGHT){if(t.body.right<o.x){break}else if(o.right<t.body.x){continue}}else if(this.sortDirection===s.Physics.Arcade.RIGHT_LEFT){if(t.body.x>o.right){break}else if(o.x>t.body.right){continue}}else if(this.sortDirection===s.Physics.Arcade.TOP_BOTTOM){if(t.body.bottom<o.y){break}else if(o.bottom<t.body.y){continue}}else if(this.sortDirection===s.Physics.Arcade.BOTTOM_TOP){if(t.body.y>o.bottom){break}else if(o.y>t.body.bottom){continue}}this.collideSpriteVsSprite(t,l,i,r,n,a)}}else{this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(e);var u=this.quadTree.retrieve(t);for(var h=0;h<u.length;h++){if(this.separate(t.body,u[h],r,n,a)){if(i){i.call(n,t,u[h].sprite)}this._total++}}}},collideGroupVsSelf:function(t,e,i,r,n){if(t.length===0){return}for(var a=0;a<t.hash.length;a++){var o={};var h=t.hash[a];if(!h||!h.exists||!h.body){continue}o=h.body.getBounds(o);for(var l=a+1;l<t.hash.length;l++){var u={};var c=t.hash[l];if(!c||!c.exists||!c.body){continue}u=c.body.getBounds(u);if(this.sortDirection===s.Physics.Arcade.LEFT_RIGHT){if(o.right<u.x){break}else if(u.right<o.x){continue}}else if(this.sortDirection===s.Physics.Arcade.RIGHT_LEFT){if(o.x>u.right){continue}else if(u.x>o.right){break}}else if(this.sortDirection===s.Physics.Arcade.TOP_BOTTOM){if(o.bottom<u.y){continue}else if(u.bottom<o.y){break}}else if(this.sortDirection===s.Physics.Arcade.BOTTOM_TOP){if(o.y>u.bottom){continue}else if(u.y>h.body.bottom){break}}this.collideSpriteVsSprite(h,c,e,i,r,n)}}},collideGroupVsGroup:function(t,e,i,r,n,a){if(t.length===0||e.length===0){return}for(var o=0;o<t.children.length;o++){if(t.children[o].exists){if(t.children[o].physicsType===s.GROUP){this.collideGroupVsGroup(t.children[o],e,i,r,n,a)}else{this.collideSpriteVsGroup(t.children[o],e,i,r,n,a)}}}},separate:function(t,e,i,r,s){if(!t.enable||!e.enable||t.checkCollision.none||e.checkCollision.none||!this.intersects(t,e)){return false}if(i&&i.call(r,t.sprite,e.sprite)===false){return false}if(t.isCircle&&e.isCircle){return this.separateCircle(t,e,s)}if(t.isCircle!==e.isCircle){var n=t.isCircle?e:t;var a=t.isCircle?t:e;var o={x:n.x,y:n.y,right:n.right,bottom:n.bottom};var h={x:a.x+a.radius,y:a.y+a.radius};if(h.y<o.y||h.y>o.bottom){if(h.x<o.x||h.x>o.right){return this.separateCircle(t,e,s)}}}var l=false;var u=false;if(this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)){l=this.separateX(t,e,s);if(this.intersects(t,e)){u=this.separateY(t,e,s)}}else{u=this.separateY(t,e,s);if(this.intersects(t,e)){l=this.separateX(t,e,s)}}var c=l||u;if(c){if(s){if(t.onOverlap){t.onOverlap.dispatch(t.sprite,e.sprite)}if(e.onOverlap){e.onOverlap.dispatch(e.sprite,t.sprite)}}else{if(t.onCollide){t.onCollide.dispatch(t.sprite,e.sprite)}if(e.onCollide){e.onCollide.dispatch(e.sprite,t.sprite)}}}return c},intersects:function(t,e){if(t===e){return false}if(t.isCircle){if(e.isCircle){return s.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y)<=t.radius+e.radius}else{return this.circleBodyIntersects(t,e)}}else{if(e.isCircle){return this.circleBodyIntersects(e,t)}else{if(t.right<=e.position.x){return false}if(t.bottom<=e.position.y){return false}if(t.position.x>=e.right){return false}if(t.position.y>=e.bottom){return false}return true}}},circleBodyIntersects:function(t,e){var i=s.Math.clamp(t.center.x,e.left,e.right);var r=s.Math.clamp(t.center.y,e.top,e.bottom);var n=(t.center.x-i)*(t.center.x-i);var a=(t.center.y-r)*(t.center.y-r);return n+a<=t.radius*t.radius},separateCircle:function(t,e,i){this.getOverlapX(t,e);this.getOverlapY(t,e);var r=e.center.x-t.center.x;var n=e.center.y-t.center.y;var a=Math.atan2(n,r);var o=0;if(t.isCircle!==e.isCircle){var h={x:e.isCircle?t.position.x:e.position.x,y:e.isCircle?t.position.y:e.position.y,right:e.isCircle?t.right:e.right,bottom:e.isCircle?t.bottom:e.bottom};var l={x:t.isCircle?t.position.x+t.radius:e.position.x+e.radius,y:t.isCircle?t.position.y+t.radius:e.position.y+e.radius,radius:t.isCircle?t.radius:e.radius};if(l.y<h.y){if(l.x<h.x){o=s.Math.distance(l.x,l.y,h.x,h.y)-l.radius}else if(l.x>h.right){o=s.Math.distance(l.x,l.y,h.right,h.y)-l.radius}}else if(l.y>h.bottom){if(l.x<h.x){o=s.Math.distance(l.x,l.y,h.x,h.bottom)-l.radius}else if(l.x>h.right){o=s.Math.distance(l.x,l.y,h.right,h.bottom)-l.radius}}o*=-1}else{o=t.radius+e.radius-s.Math.distance(t.center.x,t.center.y,e.center.x,e.center.y)}if(i||o===0||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX){if(o!==0){if(t.onOverlap){t.onOverlap.dispatch(t.sprite,e.sprite)}if(e.onOverlap){e.onOverlap.dispatch(e.sprite,t.sprite)}}return o!==0}var u={x:t.velocity.x*Math.cos(a)+t.velocity.y*Math.sin(a),y:t.velocity.x*Math.sin(a)-t.velocity.y*Math.cos(a)};var c={x:e.velocity.x*Math.cos(a)+e.velocity.y*Math.sin(a),y:e.velocity.x*Math.sin(a)-e.velocity.y*Math.cos(a)};var f=((t.mass-e.mass)*u.x+2*e.mass*c.x)/(t.mass+e.mass);var d=(2*t.mass*u.x+(e.mass-t.mass)*c.x)/(t.mass+e.mass);if(!t.immovable){t.velocity.x=(f*Math.cos(a)-u.y*Math.sin(a))*t.bounce.x;t.velocity.y=(u.y*Math.cos(a)+f*Math.sin(a))*t.bounce.y}if(!e.immovable){e.velocity.x=(d*Math.cos(a)-c.y*Math.sin(a))*e.bounce.x;e.velocity.y=(c.y*Math.cos(a)+d*Math.sin(a))*e.bounce.y}if(Math.abs(a)<Math.PI/2){if(t.velocity.x>0&&!t.immovable&&e.velocity.x>t.velocity.x){t.velocity.x*=-1}else if(e.velocity.x<0&&!e.immovable&&t.velocity.x<e.velocity.x){e.velocity.x*=-1}else if(t.velocity.y>0&&!t.immovable&&e.velocity.y>t.velocity.y){t.velocity.y*=-1}else if(e.velocity.y<0&&!e.immovable&&t.velocity.y<e.velocity.y){e.velocity.y*=-1}}else if(Math.abs(a)>Math.PI/2){if(t.velocity.x<0&&!t.immovable&&e.velocity.x<t.velocity.x){t.velocity.x*=-1}else if(e.velocity.x>0&&!e.immovable&&t.velocity.x>e.velocity.x){e.velocity.x*=-1}else if(t.velocity.y<0&&!t.immovable&&e.velocity.y<t.velocity.y){t.velocity.y*=-1}else if(e.velocity.y>0&&!e.immovable&&t.velocity.x>e.velocity.y){e.velocity.y*=-1}}if(!t.immovable){t.x+=t.velocity.x*this.game.time.physicsElapsed-o*Math.cos(a);t.y+=t.velocity.y*this.game.time.physicsElapsed-o*Math.sin(a)}if(!e.immovable){e.x+=e.velocity.x*this.game.time.physicsElapsed+o*Math.cos(a);e.y+=e.velocity.y*this.game.time.physicsElapsed+o*Math.sin(a)}if(t.onCollide){t.onCollide.dispatch(t.sprite,e.sprite)}if(e.onCollide){e.onCollide.dispatch(e.sprite,t.sprite)}return true},getOverlapX:function(t,e,i){var r=0;var s=t.deltaAbsX()+e.deltaAbsX()+this.OVERLAP_BIAS;if(t.deltaX()===0&&e.deltaX()===0){t.embedded=true;e.embedded=true}else if(t.deltaX()>e.deltaX()){r=t.right-e.x;if(r>s&&!i||t.checkCollision.right===false||e.checkCollision.left===false){r=0}else{t.touching.none=false;t.touching.right=true;e.touching.none=false;e.touching.left=true}}else if(t.deltaX()<e.deltaX()){r=t.x-e.width-e.x;if(-r>s&&!i||t.checkCollision.left===false||e.checkCollision.right===false){r=0}else{t.touching.none=false;t.touching.left=true;e.touching.none=false;e.touching.right=true}}t.overlapX=r;e.overlapX=r;return r},getOverlapY:function(t,e,i){var r=0;var s=t.deltaAbsY()+e.deltaAbsY()+this.OVERLAP_BIAS;if(t.deltaY()===0&&e.deltaY()===0){t.embedded=true;e.embedded=true}else if(t.deltaY()>e.deltaY()){r=t.bottom-e.y;if(r>s&&!i||t.checkCollision.down===false||e.checkCollision.up===false){r=0}else{t.touching.none=false;t.touching.down=true;e.touching.none=false;e.touching.up=true}}else if(t.deltaY()<e.deltaY()){r=t.y-e.bottom;if(-r>s&&!i||t.checkCollision.up===false||e.checkCollision.down===false){r=0}else{t.touching.none=false;t.touching.up=true;e.touching.none=false;e.touching.down=true}}t.overlapY=r;e.overlapY=r;return r},separateX:function(t,e,i){var r=this.getOverlapX(t,e,i);if(i||r===0||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX){return r!==0||t.embedded&&e.embedded}var s=t.velocity.x;var n=e.velocity.x;if(!t.immovable&&!e.immovable){r*=.5;t.x-=r;e.x+=r;var a=Math.sqrt(n*n*e.mass/t.mass)*(n>0?1:-1);var o=Math.sqrt(s*s*t.mass/e.mass)*(s>0?1:-1);var h=(a+o)*.5;a-=h;o-=h;t.velocity.x=h+a*t.bounce.x;e.velocity.x=h+o*e.bounce.x}else if(!t.immovable){t.x-=r;t.velocity.x=n-s*t.bounce.x;if(e.moves){t.y+=(e.y-e.prev.y)*e.friction.y}}else{e.x+=r;e.velocity.x=s-n*e.bounce.x;if(t.moves){e.y+=(t.y-t.prev.y)*t.friction.y}}return true},separateY:function(t,e,i){var r=this.getOverlapY(t,e,i);if(i||r===0||t.immovable&&e.immovable||t.customSeparateY||e.customSeparateY){return r!==0||t.embedded&&e.embedded}var s=t.velocity.y;var n=e.velocity.y;if(!t.immovable&&!e.immovable){r*=.5;t.y-=r;e.y+=r;var a=Math.sqrt(n*n*e.mass/t.mass)*(n>0?1:-1);var o=Math.sqrt(s*s*t.mass/e.mass)*(s>0?1:-1);var h=(a+o)*.5;a-=h;o-=h;t.velocity.y=h+a*t.bounce.y;e.velocity.y=h+o*e.bounce.y}else if(!t.immovable){t.y-=r;t.velocity.y=n-s*t.bounce.y;if(e.moves){t.x+=(e.x-e.prev.x)*e.friction.x}}else{e.y+=r;e.velocity.y=s-n*e.bounce.y;if(t.moves){e.x+=(t.x-t.prev.x)*t.friction.x}}return true},getObjectsUnderPointer:function(t,e,i,r){if(e.length===0||!t.exists){return}return this.getObjectsAtLocation(t.x,t.y,e,i,r,t)},getObjectsAtLocation:function(t,e,i,r,n,a){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(i);var o=new s.Rectangle(t,e,1,1);var h=[];var l=this.quadTree.retrieve(o);for(var u=0;u<l.length;u++){if(l[u].hitTest(t,e)){if(r){r.call(n,a,l[u].sprite)}h.push(l[u].sprite)}}return h},moveToObject:function(t,e,i,r){if(i===undefined){i=60}if(r===undefined){r=0}var s=Math.atan2(e.y-t.y,e.x-t.x);if(r>0){i=this.distanceBetween(t,e)/(r/1e3)}t.body.velocity.x=Math.cos(s)*i;t.body.velocity.y=Math.sin(s)*i;return s},moveToPointer:function(t,e,i,r){if(e===undefined){e=60}i=i||this.game.input.activePointer;if(r===undefined){r=0}var s=this.angleToPointer(t,i);if(r>0){e=this.distanceToPointer(t,i)/(r/1e3)}t.body.velocity.x=Math.cos(s)*e;t.body.velocity.y=Math.sin(s)*e;return s},moveToXY:function(t,e,i,r,s){if(r===undefined){r=60}if(s===undefined){s=0}var n=Math.atan2(i-t.y,e-t.x);if(s>0){r=this.distanceToXY(t,e,i)/(s/1e3)}t.body.velocity.x=Math.cos(n)*r;t.body.velocity.y=Math.sin(n)*r;return n},velocityFromAngle:function(t,e,i){if(e===undefined){e=60}i=i||new s.Point;return i.setTo(Math.cos(this.game.math.degToRad(t))*e,Math.sin(this.game.math.degToRad(t))*e)},velocityFromRotation:function(t,e,i){if(e===undefined){e=60}i=i||new s.Point;return i.setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerationFromRotation:function(t,e,i){if(e===undefined){e=60}i=i||new s.Point;return i.setTo(Math.cos(t)*e,Math.sin(t)*e)},accelerateToObject:function(t,e,i,r,s){if(i===undefined){i=60}if(r===undefined){r=1e3}if(s===undefined){s=1e3}var n=this.angleBetween(t,e);t.body.acceleration.setTo(Math.cos(n)*i,Math.sin(n)*i);t.body.maxVelocity.setTo(r,s);return n},accelerateToPointer:function(t,e,i,r,s){if(i===undefined){i=60}if(e===undefined){e=this.game.input.activePointer}if(r===undefined){r=1e3}if(s===undefined){s=1e3}var n=this.angleToPointer(t,e);t.body.acceleration.setTo(Math.cos(n)*i,Math.sin(n)*i);t.body.maxVelocity.setTo(r,s);return n},accelerateToXY:function(t,e,i,r,s,n){if(r===undefined){r=60}if(s===undefined){s=1e3}if(n===undefined){n=1e3}var a=this.angleToXY(t,e,i);t.body.acceleration.setTo(Math.cos(a)*r,Math.sin(a)*r);t.body.maxVelocity.setTo(s,n);return a},distanceBetween:function(t,e,i){if(i===undefined){i=false}var r=i?t.world.x-e.world.x:t.x-e.x;var s=i?t.world.y-e.world.y:t.y-e.y;return Math.sqrt(r*r+s*s)},distanceToXY:function(t,e,i,r){if(r===undefined){r=false}var s=r?t.world.x-e:t.x-e;var n=r?t.world.y-i:t.y-i;return Math.sqrt(s*s+n*n)},distanceToPointer:function(t,e,i){if(e===undefined){e=this.game.input.activePointer}if(i===undefined){i=false}var r=i?t.world.x-e.worldX:t.x-e.worldX;var s=i?t.world.y-e.worldY:t.y-e.worldY;return Math.sqrt(r*r+s*s)},angleBetween:function(t,e,i){if(i===undefined){i=false}if(i){return Math.atan2(e.world.y-t.world.y,e.world.x-t.world.x)}else{return Math.atan2(e.y-t.y,e.x-t.x)}},angleBetweenCenters:function(t,e){var i=e.centerX-t.centerX;var r=e.centerY-t.centerY;return Math.atan2(r,i)},angleToXY:function(t,e,i,r){if(r===undefined){r=false}if(r){return Math.atan2(i-t.world.y,e-t.world.x)}else{return Math.atan2(i-t.y,e-t.x)}},angleToPointer:function(t,e,i){if(e===undefined){e=this.game.input.activePointer}if(i===undefined){i=false}if(i){return Math.atan2(e.worldY-t.world.y,e.worldX-t.world.x)}else{return Math.atan2(e.worldY-t.y,e.worldX-t.x)}},worldAngleToPointer:function(t,e){return this.angleToPointer(t,e,true)}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.Arcade.Body=function(t){this.sprite=t;this.game=t.game;this.type=s.Physics.ARCADE;this.enable=true;this.isCircle=false;this.radius=0;this.offset=new s.Point;this.position=new s.Point(t.x,t.y);this.prev=new s.Point(this.position.x,this.position.y);this.allowRotation=true;this.rotation=t.angle;this.preRotation=t.angle;this.width=t.width;this.height=t.height;this.sourceWidth=t.width;this.sourceHeight=t.height;if(t.texture){this.sourceWidth=t.texture.frame.width;this.sourceHeight=t.texture.frame.height}this.halfWidth=Math.abs(t.width/2);this.halfHeight=Math.abs(t.height/2);this.center=new s.Point(t.x+this.halfWidth,t.y+this.halfHeight);this.velocity=new s.Point;this.newVelocity=new s.Point;this.deltaMax=new s.Point;this.acceleration=new s.Point;this.drag=new s.Point;this.allowGravity=true;this.gravity=new s.Point;this.bounce=new s.Point;this.worldBounce=null;this.onWorldBounds=null;this.onCollide=null;this.onOverlap=null;this.maxVelocity=new s.Point(1e4,1e4);this.friction=new s.Point(1,0);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1e3;this.mass=1;this.angle=0;this.speed=0;this.facing=s.NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.overlapR=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={up:false,down:false,left:false,right:false};this.tilePadding=new s.Point;this.dirty=false;this.skipQuadTree=false;this.syncBounds=false;this.isMoving=false;this.stopVelocityOnCollide=true;this.moveTimer=0;this.moveDistance=0;this.moveDuration=0;this.moveTarget=null;this.moveEnd=null;this.onMoveComplete=new s.Signal;this.movementCallback=null;this.movementCallbackContext=null;this._reset=true;this._sx=t.scale.x;this._sy=t.scale.y;this._dx=0;this._dy=0};s.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var t=this.sprite.getBounds();t.ceilAll();if(t.width!==this.width||t.height!==this.height){this.width=t.width;this.height=t.height;this._reset=true}}else{var e=Math.abs(this.sprite.scale.x);var i=Math.abs(this.sprite.scale.y);if(e!==this._sx||i!==this._sy){this.width=this.sourceWidth*e;this.height=this.sourceHeight*i;this._sx=e;this._sy=i;this._reset=true}}if(this._reset){this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)}},preUpdate:function(){if(!this.enable||this.game.physics.arcade.isPaused){return}this.dirty=true;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.embedded=false;this.updateBounds();this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.rotation=this.sprite.angle;this.preRotation=this.rotation;if(this._reset||this.sprite.fresh){this.prev.x=this.position.x;this.prev.y=this.position.y}if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;if(this.position.x!==this.prev.x||this.position.y!==this.prev.y){this.angle=Math.atan2(this.velocity.y,this.velocity.x)}this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);if(this.collideWorldBounds){if(this.checkWorldBounds()&&this.onWorldBounds){this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)}}}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=false},updateMovement:function(){var t=0;var e=this.overlapX!==0||this.overlapY!==0;if(this.moveDuration>0){this.moveTimer+=this.game.time.elapsedMS;t=this.moveTimer/this.moveDuration}else{this.moveTarget.end.set(this.position.x,this.position.y);t=this.moveTarget.length/this.moveDistance}if(this.movementCallback){var i=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,t)}if(e||t>=1||i!==undefined&&i!==true){this.stopMovement(t>=1||this.stopVelocityOnCollide&&e);return false}return true},stopMovement:function(t){if(this.isMoving){this.isMoving=false;if(t){this.velocity.set(0)}this.onMoveComplete.dispatch(this.sprite,this.overlapX!==0||this.overlapY!==0)}},postUpdate:function(){if(!this.enable||!this.dirty){return}if(this.isMoving){this.updateMovement()}this.dirty=false;if(this.deltaX()<0){this.facing=s.LEFT}else if(this.deltaX()>0){this.facing=s.RIGHT}if(this.deltaY()<0){this.facing=s.UP}else if(this.deltaY()>0){this.facing=s.DOWN}if(this.moves){this._dx=this.deltaX();this._dy=this.deltaY();if(this.deltaMax.x!==0&&this._dx!==0){if(this._dx<0&&this._dx<-this.deltaMax.x){this._dx=-this.deltaMax.x}else if(this._dx>0&&this._dx>this.deltaMax.x){this._dx=this.deltaMax.x}}if(this.deltaMax.y!==0&&this._dy!==0){if(this._dy<0&&this._dy<-this.deltaMax.y){this._dy=-this.deltaMax.y}else if(this._dy>0&&this._dy>this.deltaMax.y){this._dy=this.deltaMax.y}}this.sprite.position.x+=this._dx;this.sprite.position.y+=this._dy;this._reset=true}this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);if(this.allowRotation){this.sprite.angle+=this.deltaZ()}this.prev.x=this.position.x;this.prev.y=this.position.y},checkWorldBounds:function(){var t=this.position;var e=this.game.physics.arcade.bounds;var i=this.game.physics.arcade.checkCollision;var r=this.worldBounce?-this.worldBounce.x:-this.bounce.x;var s=this.worldBounce?-this.worldBounce.y:-this.bounce.y;if(this.isCircle){var n={x:this.center.x-this.radius,y:this.center.y-this.radius,right:this.center.x+this.radius,bottom:this.center.y+this.radius};if(n.x<e.x&&i.left){t.x=e.x-this.halfWidth+this.radius;this.velocity.x*=r;this.blocked.left=true}else if(n.right>e.right&&i.right){t.x=e.right-this.halfWidth-this.radius;this.velocity.x*=r;this.blocked.right=true}if(n.y<e.y&&i.up){t.y=e.y-this.halfHeight+this.radius;this.velocity.y*=s;this.blocked.up=true}else if(n.bottom>e.bottom&&i.down){t.y=e.bottom-this.halfHeight-this.radius;this.velocity.y*=s;this.blocked.down=true}}else{if(t.x<e.x&&i.left){t.x=e.x;this.velocity.x*=r;this.blocked.left=true}else if(this.right>e.right&&i.right){t.x=e.right-this.width;this.velocity.x*=r;this.blocked.right=true}if(t.y<e.y&&i.up){t.y=e.y;this.velocity.y*=s;this.blocked.up=true}else if(this.bottom>e.bottom&&i.down){t.y=e.bottom-this.height;this.velocity.y*=s;this.blocked.down=true}}return this.blocked.up||this.blocked.down||this.blocked.left||this.blocked.right},moveFrom:function(t,e,i){if(e===undefined){e=this.speed}if(e===0){return false}var r;if(i===undefined){r=this.angle;i=this.game.math.radToDeg(r)}else{r=this.game.math.degToRad(i)}this.moveTimer=0;this.moveDuration=t;if(i===0||i===180){this.velocity.set(Math.cos(r)*e,0)}else if(i===90||i===270){this.velocity.set(0,Math.sin(r)*e)}else{this.velocity.set(Math.cos(r)*e,Math.sin(r)*e)}this.isMoving=true;return true},moveTo:function(t,e,i){var r=e/(t/1e3);if(r===0){return false}var n;if(i===undefined){n=this.angle;i=this.game.math.radToDeg(n)}else{n=this.game.math.degToRad(i)}e=Math.abs(e);this.moveDuration=0;this.moveDistance=e;if(this.moveTarget===null){this.moveTarget=new s.Line;this.moveEnd=new s.Point}this.moveTarget.fromAngle(this.x,this.y,n,e);this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y);this.moveTarget.setTo(this.x,this.y,this.x,this.y);if(i===0||i===180){this.velocity.set(Math.cos(n)*r,0)}else if(i===90||i===270){this.velocity.set(0,Math.sin(n)*r)}else{this.velocity.set(Math.cos(n)*r,Math.sin(n)*r)}this.isMoving=true;return true},setSize:function(t,e,i,r){if(i===undefined){i=this.offset.x}if(r===undefined){r=this.offset.y}this.sourceWidth=t;this.sourceHeight=e;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(i,r);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);this.isCircle=false;this.radius=0},setCircle:function(t,e,i){if(e===undefined){e=this.offset.x}if(i===undefined){i=this.offset.y}if(t>0){this.isCircle=true;this.radius=t;this.sourceWidth=t*2;this.sourceHeight=t*2;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(e,i);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)}else{this.isCircle=false}},reset:function(t,e){this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0;this.position.x=t-this.sprite.anchor.x*this.sprite.width+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=e-this.sprite.anchor.y*this.sprite.height+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},getBounds:function(t){if(this.isCircle){t.x=this.center.x-this.radius;t.y=this.center.y-this.radius;t.right=this.center.x+this.radius;t.bottom=this.center.y+this.radius}else{t.x=this.x;t.y=this.y;t.right=this.right;t.bottom=this.bottom}return t},hitTest:function(t,e){return this.isCircle?s.Circle.contains(this,t,e):s.Rectangle.contains(this,t,e)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){if(this.sprite.parent&&this.sprite.parent instanceof s.Group){this.sprite.parent.removeFromHash(this.sprite)}this.sprite.body=null;this.sprite=null}};Object.defineProperty(s.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}});Object.defineProperty(s.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(s.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}});Object.defineProperty(s.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(s.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t}});Object.defineProperty(s.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t}});s.Physics.Arcade.Body.render=function(t,e,i,r){if(r===undefined){r=true}i=i||"rgba(0,255,0,0.4)";t.fillStyle=i;t.strokeStyle=i;if(e.isCircle){t.beginPath();t.arc(e.center.x-e.game.camera.x,e.center.y-e.game.camera.y,e.radius,0,2*Math.PI);if(r){t.fill()}else{t.stroke()}}else{if(r){t.fillRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)}else{t.strokeRect(e.position.x-e.game.camera.x,e.position.y-e.game.camera.y,e.width,e.height)}}};s.Physics.Arcade.Body.renderBodyInfo=function(t,e){t.line("x: "+e.x.toFixed(2),"y: "+e.y.toFixed(2),"width: "+e.width,"height: "+e.height);t.line("velocity x: "+e.velocity.x.toFixed(2),"y: "+e.velocity.y.toFixed(2),"deltaX: "+e._dx.toFixed(2),"deltaY: "+e._dy.toFixed(2));t.line("acceleration x: "+e.acceleration.x.toFixed(2),"y: "+e.acceleration.y.toFixed(2),"speed: "+e.speed.toFixed(2),"angle: "+e.angle.toFixed(2));t.line("gravity x: "+e.gravity.x,"y: "+e.gravity.y,"bounce x: "+e.bounce.x.toFixed(2),"y: "+e.bounce.y.toFixed(2));t.line("touching left: "+e.touching.left,"right: "+e.touching.right,"up: "+e.touching.up,"down: "+e.touching.down);t.line("blocked left: "+e.blocked.left,"right: "+e.blocked.right,"up: "+e.blocked.up,"down: "+e.blocked.down)};s.Physics.Arcade.Body.prototype.constructor=s.Physics.Arcade.Body;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.Arcade.TilemapCollision=function(){};s.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(t,e,i,r,s,n){if(!t.body){return}var a=e.getTiles(t.body.position.x-t.body.tilePadding.x,t.body.position.y-t.body.tilePadding.y,t.body.width+t.body.tilePadding.x,t.body.height+t.body.tilePadding.y,false,false);if(a.length===0){return}for(var o=0;o<a.length;o++){if(r){if(r.call(s,t,a[o])){if(this.separateTile(o,t.body,a[o],e,n)){this._total++;if(i){i.call(s,t,a[o])}}}}else{if(this.separateTile(o,t.body,a[o],e,n)){this._total++;if(i){i.call(s,t,a[o])}}}}},collideGroupVsTilemapLayer:function(t,e,i,r,s,n){if(t.length===0){return}for(var a=0;a<t.children.length;a++){if(t.children[a].exists){this.collideSpriteVsTilemapLayer(t.children[a],e,i,r,s,n)}}},separateTile:function(t,e,i,r,s){if(!e.enable){return false}var n=!r.fixedToCamera?r.position.x:0;var a=!r.fixedToCamera?r.position.y:0;if(!i.intersects(e.position.x-n,e.position.y-a,e.right-n,e.bottom-a)){return false}else if(s){return true}if(i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,e.sprite,i)){return false}else if(typeof i.layer.callbacks!=="undefined"&&i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,e.sprite,i)){return false}if(!i.faceLeft&&!i.faceRight&&!i.faceTop&&!i.faceBottom){return false}var o=0;var h=0;var l=0;var u=1;if(e.deltaAbsX()>e.deltaAbsY()){l=-1}else if(e.deltaAbsX()<e.deltaAbsY()){u=-1}if(e.deltaX()!==0&&e.deltaY()!==0&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)){l=Math.min(Math.abs(e.position.x-n-i.right),Math.abs(e.right-n-i.left));u=Math.min(Math.abs(e.position.y-a-i.bottom),Math.abs(e.bottom-a-i.top))}if(l<u){if(i.faceLeft||i.faceRight){o=this.tileCheckX(e,i,r);if(o!==0&&!i.intersects(e.position.x-n,e.position.y-a,e.right-n,e.bottom-a)){return true}}if(i.faceTop||i.faceBottom){h=this.tileCheckY(e,i,r)}}else{if(i.faceTop||i.faceBottom){h=this.tileCheckY(e,i,r);if(h!==0&&!i.intersects(e.position.x-n,e.position.y-a,e.right-n,e.bottom-a)){return true}}if(i.faceLeft||i.faceRight){o=this.tileCheckX(e,i,r)}}return o!==0||h!==0},tileCheckX:function(t,e,i){var r=0;var s=!i.fixedToCamera?i.position.x:0;if(t.deltaX()<0&&!t.blocked.left&&e.collideRight&&t.checkCollision.left){if(e.faceRight&&t.x-s<e.right){r=t.x-s-e.right;if(r<-this.TILE_BIAS){r=0}}}else if(t.deltaX()>0&&!t.blocked.right&&e.collideLeft&&t.checkCollision.right){if(e.faceLeft&&t.right-s>e.left){r=t.right-s-e.left;if(r>this.TILE_BIAS){r=0}}}if(r!==0){if(t.customSeparateX){t.overlapX=r}else{this.processTileSeparationX(t,r)}}return r},tileCheckY:function(t,e,i){var r=0;var s=!i.fixedToCamera?i.position.y:0;if(t.deltaY()<0&&!t.blocked.up&&e.collideDown&&t.checkCollision.up){if(e.faceBottom&&t.y-s<e.bottom){r=t.y-s-e.bottom;if(r<-this.TILE_BIAS){r=0}}}else if(t.deltaY()>0&&!t.blocked.down&&e.collideUp&&t.checkCollision.down){if(e.faceTop&&t.bottom-s>e.top){r=t.bottom-s-e.top;if(r>this.TILE_BIAS){r=0}}}if(r!==0){if(t.customSeparateY){t.overlapY=r}else{this.processTileSeparationY(t,r)}}return r},processTileSeparationX:function(t,e){if(e<0){t.blocked.left=true}else if(e>0){t.blocked.right=true}t.position.x-=e;if(t.bounce.x===0){t.velocity.x=0}else{t.velocity.x=-t.velocity.x*t.bounce.x}},processTileSeparationY:function(t,e){if(e<0){t.blocked.up=true}else if(e>0){t.blocked.down=true}t.position.y-=e;if(t.bounce.y===0){t.velocity.y=0}else{t.velocity.y=-t.velocity.y*t.bounce.y}}};s.Utils.mixinPrototype(s.Physics.Arcade.prototype,s.Physics.Arcade.TilemapCollision.prototype);/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;s.Physics.P2=function(t,e){this.game=t;if(e===undefined){e={gravity:[0,0],broadphase:new p2.SAPBroadphase}}else{if(!e.hasOwnProperty("gravity")){e.gravity=[0,0]}if(!e.hasOwnProperty("broadphase")){e.broadphase=new p2.SAPBroadphase}}this.config=e;this.world=new p2.World(this.config);this.frameRate=1/60;this.useElapsedTime=false;this.paused=false;this.materials=[];this.gravity=new s.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new s.Signal;this.onBodyRemoved=new s.Signal;this.onSpringAdded=new s.Signal;this.onSpringRemoved=new s.Signal;this.onConstraintAdded=new s.Signal;this.onConstraintRemoved=new s.Signal;this.onContactMaterialAdded=new s.Signal;this.onContactMaterialRemoved=new s.Signal;this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new s.Signal;this.onEndContact=new s.Signal;if(e.hasOwnProperty("mpx")&&e.hasOwnProperty("pxm")&&e.hasOwnProperty("mpxi")&&e.hasOwnProperty("pxmi")){this.mpx=e.mpx;this.mpxi=e.mpxi;this.pxm=e.pxm;this.pxmi=e.pxmi}this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new s.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new s.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new s.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this._boundsLeft=true;this._boundsRight=true;this._boundsTop=true;this._boundsBottom=true;this._boundsOwnGroup=false;this.setBoundsToWorld(true,true,true,true,false)};s.Physics.P2.prototype={removeBodyNextStep:function(t){this._toRemove.push(t)},preUpdate:function(){var t=this._toRemove.length;while(t--){this.removeBody(this._toRemove[t])}this._toRemove.length=0},enable:function(t,e,i){if(e===undefined){e=false}if(i===undefined){i=true}var r=1;if(Array.isArray(t)){r=t.length;while(r--){if(t[r]instanceof s.Group){this.enable(t[r].children,e,i)}else{this.enableBody(t[r],e);if(i&&t[r].hasOwnProperty("children")&&t[r].children.length>0){this.enable(t[r],e,true)}}}}else{if(t instanceof s.Group){this.enable(t.children,e,i)}else{this.enableBody(t,e);if(i&&t.hasOwnProperty("children")&&t.children.length>0){this.enable(t.children,e,true)}}}},enableBody:function(t,e){if(t.hasOwnProperty("body")&&t.body===null){t.body=new s.Physics.P2.Body(this.game,t,t.x,t.y,1);t.body.debug=e;if(typeof t.anchor!=="undefined"){t.anchor.set(.5)}}},setImpactEvents:function(t){if(t){this.world.on("impact",this.impactHandler,this)}else{this.world.off("impact",this.impactHandler,this)}},setPostBroadphaseCallback:function(t,e){this.postBroadphaseCallback=t;this.callbackContext=e;if(t!==null){this.world.on("postBroadphase",this.postBroadphaseHandler,this)}else{this.world.off("postBroadphase",this.postBroadphaseHandler,this)}},postBroadphaseHandler:function(t){if(!this.postBroadphaseCallback||t.pairs.length===0){return}for(var e=t.pairs.length-2;e>=0;e-=2){if(t.pairs[e].parent&&t.pairs[e+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,t.pairs[e].parent,t.pairs[e+1].parent)){t.pairs.splice(e,2)}}},impactHandler:function(t){if(t.bodyA.parent&&t.bodyB.parent){var e=t.bodyA.parent;var i=t.bodyB.parent;if(e._bodyCallbacks[t.bodyB.id]){e._bodyCallbacks[t.bodyB.id].call(e._bodyCallbackContext[t.bodyB.id],e,i,t.shapeA,t.shapeB)}if(i._bodyCallbacks[t.bodyA.id]){i._bodyCallbacks[t.bodyA.id].call(i._bodyCallbackContext[t.bodyA.id],i,e,t.shapeB,t.shapeA)}if(e._groupCallbacks[t.shapeB.collisionGroup]){e._groupCallbacks[t.shapeB.collisionGroup].call(e._groupCallbackContext[t.shapeB.collisionGroup],e,i,t.shapeA,t.shapeB)}if(i._groupCallbacks[t.shapeA.collisionGroup]){i._groupCallbacks[t.shapeA.collisionGroup].call(i._groupCallbackContext[t.shapeA.collisionGroup],i,e,t.shapeB,t.shapeA)}}},beginContactHandler:function(t){if(t.bodyA&&t.bodyB){this.onBeginContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB,t.contactEquations);if(t.bodyA.parent){t.bodyA.parent.onBeginContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB,t.contactEquations)}if(t.bodyB.parent){t.bodyB.parent.onBeginContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA,t.contactEquations)}}},endContactHandler:function(t){if(t.bodyA&&t.bodyB){this.onEndContact.dispatch(t.bodyA,t.bodyB,t.shapeA,t.shapeB);if(t.bodyA.parent){t.bodyA.parent.onEndContact.dispatch(t.bodyB.parent,t.bodyB,t.shapeA,t.shapeB)}if(t.bodyB.parent){t.bodyB.parent.onEndContact.dispatch(t.bodyA.parent,t.bodyA,t.shapeB,t.shapeA)}}},setBoundsToWorld:function(t,e,i,r,s){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,t,e,i,r,s)},setWorldMaterial:function(t,e,i,r,s){if(e===undefined){e=true}if(i===undefined){i=true}if(r===undefined){r=true}if(s===undefined){s=true}if(e&&this.walls.left){this.walls.left.shapes[0].material=t}if(i&&this.walls.right){this.walls.right.shapes[0].material=t}if(r&&this.walls.top){this.walls.top.shapes[0].material=t}if(s&&this.walls.bottom){this.walls.bottom.shapes[0].material=t}},updateBoundsCollisionGroup:function(t){if(t===undefined){t=true}var e=t?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;if(this.walls.left){this.walls.left.shapes[0].collisionGroup=e}if(this.walls.right){this.walls.right.shapes[0].collisionGroup=e}if(this.walls.top){this.walls.top.shapes[0].collisionGroup=e}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionGroup=e}this._boundsOwnGroup=t},setBounds:function(t,e,i,r,s,n,a,o,h){if(s===undefined){s=this._boundsLeft}if(n===undefined){n=this._boundsRight}if(a===undefined){a=this._boundsTop}if(o===undefined){o=this._boundsBottom}if(h===undefined){h=this._boundsOwnGroup}this.setupWall(s,"left",t,e,1.5707963267948966,h);this.setupWall(n,"right",t+i,e,-1.5707963267948966,h);this.setupWall(a,"top",t,e,-3.141592653589793,h);this.setupWall(o,"bottom",t,e+r,0,h);this._boundsLeft=s;this._boundsRight=n;this._boundsTop=a;this._boundsBottom=o;this._boundsOwnGroup=h},setupWall:function(t,e,i,r,s,n){if(t){if(this.walls[e]){this.walls[e].position=[this.pxmi(i),this.pxmi(r)]}else{this.walls[e]=new p2.Body({mass:0,position:[this.pxmi(i),this.pxmi(r)],angle:s});this.walls[e].addShape(new p2.Plane);this.world.addBody(this.walls[e])}if(n){this.walls[e].shapes[0].collisionGroup=this.boundsCollisionGroup.mask}}else{if(this.walls[e]){this.world.removeBody(this.walls[e]);this.walls[e]=null}}},pause:function(){this.paused=true},resume:function(){this.paused=false},update:function(){if(this.paused){return}if(this.useElapsedTime){this.world.step(this.game.time.physicsElapsed)}else{this.world.step(this.frameRate)}},reset:function(){this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=new s.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new s.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new s.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(true,true,true,true,false)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;if(this.world.solver&&this.world.solver.equations.length){this.world.solver.removeAllEquations()}var t=this.world.constraints;for(var e=t.length-1;e>=0;e--){this.world.removeConstraint(t[e])}var i=this.world.bodies;for(var e=i.length-1;e>=0;e--){this.world.removeBody(i[e])}var r=this.world.springs;for(var e=r.length-1;e>=0;e--){this.world.removeSpring(r[e])}var s=this.world.contactMaterials;for(var e=s.length-1;e>=0;e--){this.world.removeContactMaterial(s[e])}this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[];this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear();this.game=null},addBody:function(t){if(t.data.world){return false}else{this.world.addBody(t.data);this.onBodyAdded.dispatch(t);return true}},removeBody:function(t){if(t.data.world===this.world){this.world.removeBody(t.data);this.onBodyRemoved.dispatch(t)}return t},addSpring:function(t){if(t instanceof s.Physics.P2.Spring||t instanceof s.Physics.P2.RotationalSpring){this.world.addSpring(t.data)}else{this.world.addSpring(t)}this.onSpringAdded.dispatch(t);return t},removeSpring:function(t){if(t instanceof s.Physics.P2.Spring||t instanceof s.Physics.P2.RotationalSpring){this.world.removeSpring(t.data)}else{this.world.removeSpring(t)}this.onSpringRemoved.dispatch(t);return t},createDistanceConstraint:function(t,e,i,r,n,a){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new s.Physics.P2.DistanceConstraint(this,t,e,i,r,n,a))}},createGearConstraint:function(t,e,i,r){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new s.Physics.P2.GearConstraint(this,t,e,i,r))}},createRevoluteConstraint:function(t,e,i,r,n,a){t=this.getBody(t);i=this.getBody(i);if(!t||!i){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new s.Physics.P2.RevoluteConstraint(this,t,e,i,r,n,a))}},createLockConstraint:function(t,e,i,r,n){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new s.Physics.P2.LockConstraint(this,t,e,i,r,n))}},createPrismaticConstraint:function(t,e,i,r,n,a,o){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new s.Physics.P2.PrismaticConstraint(this,t,e,i,r,n,a,o))}},addConstraint:function(t){this.world.addConstraint(t);this.onConstraintAdded.dispatch(t);return t},removeConstraint:function(t){this.world.removeConstraint(t);this.onConstraintRemoved.dispatch(t);return t},addContactMaterial:function(t){this.world.addContactMaterial(t);this.onContactMaterialAdded.dispatch(t);return t},removeContactMaterial:function(t){this.world.removeContactMaterial(t);this.onContactMaterialRemoved.dispatch(t);return t},getContactMaterial:function(t,e){return this.world.getContactMaterial(t,e)},setMaterial:function(t,e){var i=e.length;while(i--){e[i].setMaterial(t)}},createMaterial:function(t,e){t=t||"";var i=new s.Physics.P2.Material(t);this.materials.push(i);if(typeof e!=="undefined"){e.setMaterial(i)}return i},createContactMaterial:function(t,e,i){if(t===undefined){t=this.createMaterial()}if(e===undefined){e=this.createMaterial()}var r=new s.Physics.P2.ContactMaterial(t,e,i);return this.addContactMaterial(r)},getBodies:function(){var t=[];var e=this.world.bodies.length;while(e--){t.push(this.world.bodies[e].parent)}return t},getBody:function(t){if(t instanceof p2.Body){return t}else if(t instanceof s.Physics.P2.Body){return t.data}else if(t["body"]&&t["body"].type===s.Physics.P2JS){return t.body.data}return null},getSprings:function(){var t=[];var e=this.world.springs.length;while(e--){t.push(this.world.springs[e].parent)}return t},getConstraints:function(){var t=[];var e=this.world.constraints.length;while(e--){t.push(this.world.constraints[e])}return t},hitTest:function(t,e,i,r){if(e===undefined){e=this.world.bodies}if(i===undefined){i=5}if(r===undefined){r=false}var n=[this.pxmi(t.x),this.pxmi(t.y)];var a=[];var o=e.length;while(o--){if(e[o]instanceof s.Physics.P2.Body&&!(r&&e[o].data.type===p2.Body.STATIC)){a.push(e[o].data)}else if(e[o]instanceof p2.Body&&e[o].parent&&!(r&&e[o].type===p2.Body.STATIC)){a.push(e[o])}else if(e[o]instanceof s.Sprite&&e[o].hasOwnProperty("body")&&!(r&&e[o].body.data.type===p2.Body.STATIC)){a.push(e[o].body.data)}}return this.world.hitTest(n,a,i)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(t){var e=Math.pow(2,this._collisionGroupID);if(this.walls.left){this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|e}if(this.walls.right){this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|e}if(this.walls.top){this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|e}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|e}this._collisionGroupID++;var i=new s.Physics.P2.CollisionGroup(e);this.collisionGroups.push(i);if(t){this.setCollisionGroup(t,i)}return i},setCollisionGroup:function(t,e){if(t instanceof s.Group){for(var i=0;i<t.total;i++){if(t.children[i]["body"]&&t.children[i]["body"].type===s.Physics.P2JS){t.children[i].body.setCollisionGroup(e)}}}else{t.body.setCollisionGroup(e)}},createSpring:function(t,e,i,r,n,a,o,h,l){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Spring, invalid body objects given")}else{return this.addSpring(new s.Physics.P2.Spring(this,t,e,i,r,n,a,o,h,l))}},createRotationalSpring:function(t,e,i,r,n){t=this.getBody(t);e=this.getBody(e);if(!t||!e){console.warn("Cannot create Rotational Spring, invalid body objects given")}else{return this.addSpring(new s.Physics.P2.RotationalSpring(this,t,e,i,r,n))}},createBody:function(t,e,i,r,n,a){if(r===undefined){r=false}var o=new s.Physics.P2.Body(this.game,null,t,e,i);if(a){var h=o.addPolygon(n,a);if(!h){return false}}if(r){this.world.addBody(o.data)}return o},createParticle:function(t,e,i,r,n,a){if(r===undefined){r=false}var o=new s.Physics.P2.Body(this.game,null,t,e,i);if(a){var h=o.addPolygon(n,a);if(!h){return false}}if(r){this.world.addBody(o.data)}return o},convertCollisionObjects:function(t,e,i){if(i===undefined){i=true}var r=[];for(var s=0,n=t.collision[e].length;s<n;s++){var a=t.collision[e][s];var o=this.createBody(a.x,a.y,0,i,{},a.polyline);if(o){r.push(o)}}return r},clearTilemapLayerBodies:function(t,e){e=t.getLayer(e);var i=t.layers[e].bodies.length;while(i--){t.layers[e].bodies[i].destroy()}t.layers[e].bodies.length=0},convertTilemap:function(t,e,i,r){e=t.getLayer(e);if(i===undefined){i=true}if(r===undefined){r=true}this.clearTilemapLayerBodies(t,e);var s=0;var n=0;var a=0;for(var o=0,h=t.layers[e].height;o<h;o++){s=0;for(var l=0,u=t.layers[e].width;l<u;l++){var c=t.layers[e].data[o][l];if(c&&c.index>-1&&c.collides){if(r){var f=t.getTileRight(e,l,o);if(s===0){n=c.x*c.width;a=c.y*c.height;s=c.width}if(f&&f.collides){s+=c.width}else{var d=this.createBody(n,a,0,false);d.addRectangle(s,c.height,s/2,c.height/2,0);if(i){this.addBody(d)}t.layers[e].bodies.push(d);s=0}}else{var d=this.createBody(c.x*c.width,c.y*c.height,0,false);d.addRectangle(c.width,c.height,c.width/2,c.height/2,0);if(i){this.addBody(d)}t.layers[e].bodies.push(d)}}}}return t.layers[e].bodies},mpx:function(t){return t*=20},pxm:function(t){return t*.05},mpxi:function(t){return t*=-20},pxmi:function(t){return t*-.05}};Object.defineProperty(s.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(t){this.world.defaultContactMaterial.friction=t}});Object.defineProperty(s.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(t){this.world.defaultContactMaterial.restitution=t}});Object.defineProperty(s.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(t){this.world.defaultContactMaterial=t}});Object.defineProperty(s.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(t){this.world.applySpringForces=t}});Object.defineProperty(s.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(t){this.world.applyDamping=t}});Object.defineProperty(s.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(t){this.world.applyGravity=t}});Object.defineProperty(s.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(t){this.world.solveConstraints=t}});Object.defineProperty(s.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(s.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(t){this.world.emitImpactEvent=t}});Object.defineProperty(s.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(t){this.world.sleepMode=t}});Object.defineProperty(s.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});/**
* @author       Georgios Kaleadis https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.FixtureList=function(t){if(!Array.isArray(t)){t=[t]}this.rawList=t;this.init();this.parse(this.rawList)};s.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(t,e){var i=function(e){e.collisionGroup=t};this.getFixtures(e).forEach(i)},setMask:function(t,e){var i=function(e){e.collisionMask=t};this.getFixtures(e).forEach(i)},setSensor:function(t,e){var i=function(e){e.sensor=t};this.getFixtures(e).forEach(i)},setMaterial:function(t,e){var i=function(e){e.material=t};this.getFixtures(e).forEach(i)},getFixtures:function(t){var e=[];if(t){if(!(t instanceof Array)){t=[t]}var i=this;t.forEach(function(t){if(i.namedFixtures[t]){e.push(i.namedFixtures[t])}});return this.flatten(e)}else{return this.allFixtures}},getFixtureByKey:function(t){return this.namedFixtures[t]},getGroup:function(t){return this.groupedFixtures[t]},parse:function(){var t,e,i,r;i=this.rawList;r=[];for(t in i){e=i[t];if(!isNaN(t-0)){this.groupedFixtures[t]=this.groupedFixtures[t]||[];this.groupedFixtures[t]=this.groupedFixtures[t].concat(e)}else{this.namedFixtures[t]=this.flatten(e)}r.push(this.allFixtures=this.flatten(this.groupedFixtures))}},flatten:function(t){var e,i;e=[];i=arguments.callee;t.forEach(function(t){return Array.prototype.push.apply(e,Array.isArray(t)?i(t):[t])});return e}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.PointProxy=function(t,e){this.world=t;this.destination=e};s.Physics.P2.PointProxy.prototype.constructor=s.Physics.P2.PointProxy;Object.defineProperty(s.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(t){this.destination[0]=this.world.pxm(t)}});Object.defineProperty(s.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(t){this.destination[1]=this.world.pxm(t)}});Object.defineProperty(s.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=t}});Object.defineProperty(s.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=t}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.InversePointProxy=function(t,e){this.world=t;this.destination=e};s.Physics.P2.InversePointProxy.prototype.constructor=s.Physics.P2.InversePointProxy;Object.defineProperty(s.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(t){this.destination[0]=this.world.pxmi(t)}});Object.defineProperty(s.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(t){this.destination[1]=this.world.pxmi(t)}});Object.defineProperty(s.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(t){this.destination[0]=-t}});Object.defineProperty(s.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(t){this.destination[1]=-t}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.Body=function(t,e,i,r,n){e=e||null;i=i||0;r=r||0;if(n===undefined){n=1}this.game=t;this.world=t.physics.p2;this.sprite=e;this.type=s.Physics.P2JS;this.offset=new s.Point;this.data=new p2.Body({position:[this.world.pxmi(i),this.world.pxmi(r)],mass:n});this.data.parent=this;this.velocity=new s.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new s.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new s.Point;this.onBeginContact=new s.Signal;this.onEndContact=new s.Signal;this.collidesWith=[];this.removeNextStep=false;this.debugBody=null;this.dirty=false;this._collideWorldBounds=true;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=false;if(e){this.setRectangleFromSprite(e);if(e.exists){this.game.physics.p2.addBody(this)}}};s.Physics.P2.Body.prototype={createBodyCallback:function(t,e,i){var r=-1;if(t["id"]){r=t.id}else if(t["body"]){r=t.body.id}if(r>-1){if(e===null){delete this._bodyCallbacks[r];delete this._bodyCallbackContext[r]}else{this._bodyCallbacks[r]=e;this._bodyCallbackContext[r]=i}}},createGroupCallback:function(t,e,i){if(e===null){delete this._groupCallbacks[t.mask];delete this._groupCallbackContext[t.mask]}else{this._groupCallbacks[t.mask]=e;this._groupCallbackContext[t.mask]=i}},getCollisionMask:function(){var t=0;if(this._collideWorldBounds){t=this.game.physics.p2.boundsCollisionGroup.mask}for(var e=0;e<this.collidesWith.length;e++){t=t|this.collidesWith[e].mask}return t},updateCollisionMask:function(t){var e=this.getCollisionMask();if(t===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){this.data.shapes[i].collisionMask=e}}else{t.collisionMask=e}},setCollisionGroup:function(t,e){var i=this.getCollisionMask();if(e===undefined){for(var r=this.data.shapes.length-1;r>=0;r--){this.data.shapes[r].collisionGroup=t.mask;this.data.shapes[r].collisionMask=i}}else{e.collisionGroup=t.mask;e.collisionMask=i}},clearCollision:function(t,e,i){if(t===undefined){t=true}if(e===undefined){e=true}if(i===undefined){for(var r=this.data.shapes.length-1;r>=0;r--){if(t){this.data.shapes[r].collisionGroup=null}if(e){this.data.shapes[r].collisionMask=null}}}else{if(t){i.collisionGroup=null}if(e){i.collisionMask=null}}if(t){this.collidesWith.length=0}},removeCollisionGroup:function(t,e,i){if(e===undefined){e=true}var r;if(Array.isArray(t)){for(var s=0;s<t.length;s++){r=this.collidesWith.indexOf(t[s]);if(r>-1){this.collidesWith.splice(r,1);if(e){delete this._groupCallbacks[t.mask];delete this._groupCallbackContext[t.mask]}}}}else{r=this.collidesWith.indexOf(t);if(r>-1){this.collidesWith.splice(r,1);if(e){delete this._groupCallbacks[t.mask];delete this._groupCallbackContext[t.mask]}}}var n=this.getCollisionMask();if(i===undefined){for(var s=this.data.shapes.length-1;s>=0;s--){this.data.shapes[s].collisionMask=n}}else{i.collisionMask=n}},collides:function(t,e,i,r){if(Array.isArray(t)){for(var s=0;s<t.length;s++){if(this.collidesWith.indexOf(t[s])===-1){this.collidesWith.push(t[s]);if(e){this.createGroupCallback(t[s],e,i)}}}}else{if(this.collidesWith.indexOf(t)===-1){this.collidesWith.push(t);if(e){this.createGroupCallback(t,e,i)}}}var n=this.getCollisionMask();if(r===undefined){for(var s=this.data.shapes.length-1;s>=0;s--){this.data.shapes[s].collisionMask=n}}else{r.collisionMask=n}},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},getVelocityAtPoint:function(t,e){return this.data.getVelocityAtPoint(t,e)},applyDamping:function(t){this.data.applyDamping(t)},applyImpulse:function(t,e,i){this.data.applyImpulse(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyImpulseLocal:function(t,e,i){this.data.applyImpulseLocal(t,[this.world.pxmi(e),this.world.pxmi(i)])},applyForce:function(t,e,i){this.data.applyForce(t,[this.world.pxmi(e),this.world.pxmi(i)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(t,e){return this.data.toLocalFrame(t,e)},toWorldFrame:function(t,e){return this.data.toWorldFrame(t,e)},rotateLeft:function(t){this.data.angularVelocity=this.world.pxm(-t)},rotateRight:function(t){this.data.angularVelocity=this.world.pxm(t)},moveForward:function(t){var e=this.world.pxmi(-t);var i=this.data.angle+Math.PI/2;this.data.velocity[0]=e*Math.cos(i);this.data.velocity[1]=e*Math.sin(i)},moveBackward:function(t){var e=this.world.pxmi(-t);var i=this.data.angle+Math.PI/2;this.data.velocity[0]=-(e*Math.cos(i));this.data.velocity[1]=-(e*Math.sin(i))},thrust:function(t){var e=this.world.pxmi(-t);var i=this.data.angle+Math.PI/2;this.data.force[0]+=e*Math.cos(i);this.data.force[1]+=e*Math.sin(i)},thrustLeft:function(t){var e=this.world.pxmi(-t);var i=this.data.angle;this.data.force[0]+=e*Math.cos(i);this.data.force[1]+=e*Math.sin(i)},thrustRight:function(t){var e=this.world.pxmi(-t);var i=this.data.angle;this.data.force[0]-=e*Math.cos(i);this.data.force[1]-=e*Math.sin(i)},reverse:function(t){var e=this.world.pxmi(-t);var i=this.data.angle+Math.PI/2;this.data.force[0]-=e*Math.cos(i);this.data.force[1]-=e*Math.sin(i)},moveLeft:function(t){this.data.velocity[0]=this.world.pxmi(-t)},moveRight:function(t){this.data.velocity[0]=this.world.pxmi(t)},moveUp:function(t){this.data.velocity[1]=this.world.pxmi(-t)},moveDown:function(t){this.data.velocity[1]=this.world.pxmi(t)},preUpdate:function(){this.dirty=true;if(this.removeNextStep){this.removeFromWorld();this.removeNextStep=false}},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x;this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y;if(!this.fixedRotation){this.sprite.rotation=this.data.angle}if(this.debugBody){this.debugBody.updateSpriteTransform()}this.dirty=false},reset:function(t,e,i,r){if(i===undefined){i=false}if(r===undefined){r=false}this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();if(i){this.setZeroDamping()}if(r){this.mass=1}this.x=t;this.y=e},addToWorld:function(){if(this.game.physics.p2._toRemove){for(var t=0;t<this.game.physics.p2._toRemove.length;t++){if(this.game.physics.p2._toRemove[t]===this){this.game.physics.p2._toRemove.splice(t,1)}}}if(this.data.world!==this.game.physics.p2.world){this.game.physics.p2.addBody(this)}},removeFromWorld:function(){if(this.data.world===this.game.physics.p2.world){this.game.physics.p2.removeBodyNextStep(this)}},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(this.debugBody){this.debugBody.destroy(true,true)}this.debugBody=null;if(this.sprite){this.sprite.body=null;this.sprite=null}},clearShapes:function(){var t=this.data.shapes.length;while(t--){this.data.removeShape(this.data.shapes[t])}this.shapeChanged()},addShape:function(t,e,i,r){if(e===undefined){e=0}if(i===undefined){i=0}if(r===undefined){r=0}this.data.addShape(t,[this.world.pxmi(e),this.world.pxmi(i)],r);this.shapeChanged();return t},addCircle:function(t,e,i,r){var s=new p2.Circle({radius:this.world.pxm(t)});return this.addShape(s,e,i,r)},addRectangle:function(t,e,i,r,s){var n=new p2.Box({width:this.world.pxm(t),height:this.world.pxm(e)});return this.addShape(n,i,r,s)},addPlane:function(t,e,i){var r=new p2.Plane;return this.addShape(r,t,e,i)},addParticle:function(t,e,i){var r=new p2.Particle;return this.addShape(r,t,e,i)},addLine:function(t,e,i,r){var s=new p2.Line({length:this.world.pxm(t)});return this.addShape(s,e,i,r)},addCapsule:function(t,e,i,r,s){var n=new p2.Capsule({length:this.world.pxm(t),radius:this.world.pxm(e)});return this.addShape(n,i,r,s)},addPolygon:function(t,e){t=t||{};if(!Array.isArray(e)){e=Array.prototype.slice.call(arguments,1)}var i=[];if(e.length===1&&Array.isArray(e[0])){i=e[0].slice(0)}else if(Array.isArray(e[0])){i=e.slice()}else if(typeof e[0]==="number"){for(var r=0,s=e.length;r<s;r+=2){i.push([e[r],e[r+1]])}}var n=i.length-1;if(i[n][0]===i[0][0]&&i[n][1]===i[0][1]){i.pop()}for(var a=0;a<i.length;a++){i[a][0]=this.world.pxmi(i[a][0]);i[a][1]=this.world.pxmi(i[a][1])}var o=this.data.fromPolygon(i,t);this.shapeChanged();return o},removeShape:function(t){var e=this.data.removeShape(t);this.shapeChanged();return e},setCircle:function(t,e,i,r){this.clearShapes();return this.addCircle(t,e,i,r)},setRectangle:function(t,e,i,r,s){if(t===undefined){t=16}if(e===undefined){e=16}this.clearShapes();return this.addRectangle(t,e,i,r,s)},setRectangleFromSprite:function(t){if(t===undefined){t=this.sprite}this.clearShapes();return this.addRectangle(t.width,t.height,0,0,t.rotation)},setMaterial:function(t,e){if(e===undefined){for(var i=this.data.shapes.length-1;i>=0;i--){this.data.shapes[i].material=t}}else{e.material=t}},shapeChanged:function(){if(this.debugBody){this.debugBody.draw()}},addPhaserPolygon:function(t,e){var i=this.game.cache.getPhysicsData(t,e);var r=[];for(var s=0;s<i.length;s++){var n=i[s];var a=this.addFixture(n);r[n.filter.group]=r[n.filter.group]||[];r[n.filter.group]=r[n.filter.group].concat(a);if(n.fixtureKey){r[n.fixtureKey]=a}}this.data.aabbNeedsUpdate=true;this.shapeChanged();return r},addFixture:function(t){var e=[];if(t.circle){var i=new p2.Circle({radius:this.world.pxm(t.circle.radius)});i.collisionGroup=t.filter.categoryBits;i.collisionMask=t.filter.maskBits;i.sensor=t.isSensor;var r=p2.vec2.create();r[0]=this.world.pxmi(t.circle.position[0]-this.sprite.width/2);r[1]=this.world.pxmi(t.circle.position[1]-this.sprite.height/2);this.data.addShape(i,r);e.push(i)}else{var s=t.polygons;var n=p2.vec2.create();for(var a=0;a<s.length;a++){var o=s[a];var h=[];for(var l=0;l<o.length;l+=2){h.push([this.world.pxmi(o[l]),this.world.pxmi(o[l+1])])}var i=new p2.Convex({vertices:h});for(var u=0;u!==i.vertices.length;u++){var c=i.vertices[u];p2.vec2.sub(c,c,i.centerOfMass)}p2.vec2.scale(n,i.centerOfMass,1);n[0]-=this.world.pxmi(this.sprite.width/2);n[1]-=this.world.pxmi(this.sprite.height/2);i.updateTriangles();i.updateCenterOfMass();i.updateBoundingRadius();i.collisionGroup=t.filter.categoryBits;i.collisionMask=t.filter.maskBits;i.sensor=t.isSensor;this.data.addShape(i,n);e.push(i)}}return e},loadPolygon:function(t,e){if(t===null){var i=e}else{var i=this.game.cache.getPhysicsData(t,e)}var r=p2.vec2.create();for(var s=0;s<i.length;s++){var n=[];for(var a=0;a<i[s].shape.length;a+=2){n.push([this.world.pxmi(i[s].shape[a]),this.world.pxmi(i[s].shape[a+1])])}var o=new p2.Convex({vertices:n});for(var h=0;h!==o.vertices.length;h++){var l=o.vertices[h];p2.vec2.sub(l,l,o.centerOfMass)}p2.vec2.scale(r,o.centerOfMass,1);r[0]-=this.world.pxmi(this.sprite.width/2);r[1]-=this.world.pxmi(this.sprite.height/2);o.updateTriangles();o.updateCenterOfMass();o.updateBoundingRadius();this.data.addShape(o,r)}this.data.aabbNeedsUpdate=true;this.shapeChanged();return true}};s.Physics.P2.Body.prototype.constructor=s.Physics.P2.Body;s.Physics.P2.Body.DYNAMIC=1;s.Physics.P2.Body.STATIC=2;s.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(s.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===s.Physics.P2.Body.STATIC},set:function(t){if(t&&this.data.type!==s.Physics.P2.Body.STATIC){this.data.type=s.Physics.P2.Body.STATIC;this.mass=0}else if(!t&&this.data.type===s.Physics.P2.Body.STATIC){this.data.type=s.Physics.P2.Body.DYNAMIC;this.mass=1}}});Object.defineProperty(s.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===s.Physics.P2.Body.DYNAMIC},set:function(t){if(t&&this.data.type!==s.Physics.P2.Body.DYNAMIC){this.data.type=s.Physics.P2.Body.DYNAMIC;this.mass=1}else if(!t&&this.data.type===s.Physics.P2.Body.DYNAMIC){this.data.type=s.Physics.P2.Body.STATIC;this.mass=0}}});Object.defineProperty(s.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===s.Physics.P2.Body.KINEMATIC},set:function(t){if(t&&this.data.type!==s.Physics.P2.Body.KINEMATIC){this.data.type=s.Physics.P2.Body.KINEMATIC;this.mass=4}else if(!t&&this.data.type===s.Physics.P2.Body.KINEMATIC){this.data.type=s.Physics.P2.Body.STATIC;this.mass=0}}});Object.defineProperty(s.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(t){if(t!==this.data.allowSleep){this.data.allowSleep=t}}});Object.defineProperty(s.Physics.P2.Body.prototype,"angle",{get:function(){return s.Math.wrapAngle(s.Math.radToDeg(this.data.angle))},set:function(t){this.data.angle=s.Math.degToRad(s.Math.wrapAngle(t))}});Object.defineProperty(s.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(t){this.data.angularDamping=t}});Object.defineProperty(s.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(t){this.data.angularForce=t}});Object.defineProperty(s.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(t){this.data.angularVelocity=t}});Object.defineProperty(s.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(t){this.data.damping=t}});Object.defineProperty(s.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(t){if(t!==this.data.fixedRotation){this.data.fixedRotation=t}}});Object.defineProperty(s.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(t){this.data.inertia=t}});Object.defineProperty(s.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(t){if(t!==this.data.mass){this.data.mass=t;this.data.updateMassProperties()}}});Object.defineProperty(s.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(t){if(t!==this.data.type){this.data.type=t}}});Object.defineProperty(s.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(t){this.data.angle=t}});Object.defineProperty(s.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(t){this.data.sleepSpeedLimit=t}});Object.defineProperty(s.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(t){this.data.position[0]=this.world.pxmi(t)}});Object.defineProperty(s.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(t){this.data.position[1]=this.world.pxmi(t)}});Object.defineProperty(s.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(s.Physics.P2.Body.prototype,"debug",{get:function(){return this.debugBody!==null},set:function(t){if(t&&!this.debugBody){this.debugBody=new s.Physics.P2.BodyDebug(this.game,this.data)}else if(!t&&this.debugBody){this.debugBody.destroy();this.debugBody=null}}});Object.defineProperty(s.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(t){if(t&&!this._collideWorldBounds){this._collideWorldBounds=true;this.updateCollisionMask()}else if(!t&&this._collideWorldBounds){this._collideWorldBounds=false;this.updateCollisionMask()}}});/**
* @author       George https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.BodyDebug=function(t,e,i){s.Group.call(this,t);var r={pixelsPerLengthUnit:t.physics.p2.mpx(1),debugPolygons:false,lineWidth:1,alpha:.5};this.settings=s.Utils.extend(r,i);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=e;this.canvas=new s.Graphics(t);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};s.Physics.P2.BodyDebug.prototype=Object.create(s.Group.prototype);s.Physics.P2.BodyDebug.prototype.constructor=s.Physics.P2.BodyDebug;s.Utils.extend(s.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var t,e,i,r,s,n,a,o,h,l,u,c,f,d,p;o=this.body;l=this.canvas;l.clear();i=parseInt(this.randomPastelHex(),16);n=16711680;a=this.lineWidth;if(o instanceof p2.Body&&o.shapes.length){var g=o.shapes.length;r=0;while(r!==g){e=o.shapes[r];h=e.position||0;t=e.angle||0;if(e instanceof p2.Circle){this.drawCircle(l,h[0]*this.ppu,h[1]*this.ppu,t,e.radius*this.ppu,i,a)}else if(e instanceof p2.Capsule){this.drawCapsule(l,h[0]*this.ppu,h[1]*this.ppu,t,e.length*this.ppu,e.radius*this.ppu,n,i,a)}else if(e instanceof p2.Plane){this.drawPlane(l,h[0]*this.ppu,-h[1]*this.ppu,i,n,a*5,a*10,a*10,this.ppu*100,t)}else if(e instanceof p2.Line){this.drawLine(l,e.length*this.ppu,n,a)}else if(e instanceof p2.Box){this.drawRectangle(l,h[0]*this.ppu,h[1]*this.ppu,t,e.width*this.ppu,e.height*this.ppu,n,i,a)}else if(e instanceof p2.Convex){c=[];f=p2.vec2.create();for(s=d=0,p=e.vertices.length;0<=p?d<p:d>p;s=0<=p?++d:--d){u=e.vertices[s];p2.vec2.rotate(f,u,t);c.push([(f[0]+h[0])*this.ppu,-(f[1]+h[1])*this.ppu])}this.drawConvex(l,c,e.triangles,n,i,a,this.settings.debugPolygons,[h[0]*this.ppu,-h[1]*this.ppu])}r++}}},drawRectangle:function(t,e,i,r,s,n,a,o,h){if(h===undefined){h=1}if(a===undefined){a=0}t.lineStyle(h,a,1);t.beginFill(o);t.drawRect(e-s/2,i-n/2,s,n)},drawCircle:function(t,e,i,r,s,n,a){if(a===undefined){a=1}if(n===undefined){n=16777215}t.lineStyle(a,0,1);t.beginFill(n,1);t.drawCircle(e,i,-s*2);t.endFill();t.moveTo(e,i);t.lineTo(e+s*Math.cos(-r),i+s*Math.sin(-r))},drawLine:function(t,e,i,r){if(r===undefined){r=1}if(i===undefined){i=0}t.lineStyle(r*5,i,1);t.moveTo(-e/2,0);t.lineTo(e/2,0)},drawConvex:function(t,e,i,r,s,n,a,o){var h,l,u,c,f,d,p,g,v,m,y;if(n===undefined){n=1}if(r===undefined){r=0}if(!a){t.lineStyle(n,r,1);t.beginFill(s);l=0;while(l!==e.length){u=e[l];d=u[0];v=u[1];if(l===0){t.moveTo(d,-v)}else{t.lineTo(d,-v)}l++}t.endFill();if(e.length>2){t.moveTo(e[e.length-1][0],-e[e.length-1][1]);return t.lineTo(e[0][0],-e[0][1])}}else{h=[16711680,65280,255];l=0;while(l!==e.length+1){c=e[l%e.length];f=e[(l+1)%e.length];p=c[0];m=c[1];g=f[0];y=f[1];t.lineStyle(n,h[l%h.length],1);t.moveTo(p,-m);t.lineTo(g,-y);t.drawCircle(p,-m,n*2);l++}t.lineStyle(n,0,1);return t.drawCircle(o[0],o[1],n*2)}},drawPath:function(t,e,i,r,s){var n,a,o,h,l,u,c,f,d,p,g,v,m;if(s===undefined){s=1}if(i===undefined){i=0}t.lineStyle(s,i,1);if(typeof r==="number"){t.beginFill(r)}o=null;h=null;a=0;while(a<e.length){g=e[a];v=g[0];m=g[1];if(v!==o||m!==h){if(a===0){t.moveTo(v,m)}else{l=o;u=h;c=v;f=m;d=e[(a+1)%e.length][0];p=e[(a+1)%e.length][1];n=(c-l)*(p-u)-(d-l)*(f-u);if(n!==0){t.lineTo(v,m)}}o=v;h=m}a++}if(typeof r==="number"){t.endFill()}if(e.length>2&&typeof r==="number"){t.moveTo(e[e.length-1][0],e[e.length-1][1]);t.lineTo(e[0][0],e[0][1])}},drawPlane:function(t,e,i,r,s,n,a,o,h,l){var u,c,f;if(n===undefined){n=1}if(r===undefined){r=16777215}t.lineStyle(n,s,11);t.beginFill(r);u=h;t.moveTo(e,-i);c=e+Math.cos(l)*this.game.width;f=i+Math.sin(l)*this.game.height;t.lineTo(c,-f);t.moveTo(e,-i);c=e+Math.cos(l)*-this.game.width;f=i+Math.sin(l)*-this.game.height;t.lineTo(c,-f)},drawCapsule:function(t,e,i,r,s,n,a,o,h){if(h===undefined){h=1}if(a===undefined){a=0}t.lineStyle(h,a,1);var l=Math.cos(r);var u=Math.sin(r);t.beginFill(o,1);t.drawCircle(-s/2*l+e,-s/2*u+i,-n*2);t.drawCircle(s/2*l+e,s/2*u+i,-n*2);t.endFill();t.lineStyle(h,a,0);t.beginFill(o,1);t.moveTo(-s/2*l+n*u+e,-s/2*u+n*l+i);t.lineTo(s/2*l+n*u+e,s/2*u+n*l+i);t.lineTo(s/2*l-n*u+e,s/2*u-n*l+i);t.lineTo(-s/2*l-n*u+e,-s/2*u-n*l+i);t.endFill();t.lineStyle(h,a,1);t.moveTo(-s/2*l+n*u+e,-s/2*u+n*l+i);t.lineTo(s/2*l+n*u+e,s/2*u+n*l+i);t.moveTo(-s/2*l-n*u+e,-s/2*u-n*l+i);t.lineTo(s/2*l-n*u+e,s/2*u-n*l+i)},randomPastelHex:function(){var t,e,i,r;i=[255,255,255];r=Math.floor(Math.random()*256);e=Math.floor(Math.random()*256);t=Math.floor(Math.random()*256);r=Math.floor((r+3*i[0])/4);e=Math.floor((e+3*i[1])/4);t=Math.floor((t+3*i[2])/4);return this.rgbToHex(r,e,t)},rgbToHex:function(t,e,i){return this.componentToHex(t)+this.componentToHex(e)+this.componentToHex(i)},componentToHex:function(t){var e;e=t.toString(16);if(e.length===2){return e}else{return e+"0"}}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.Spring=function(t,e,i,r,s,n,a,o,h,l){this.game=t.game;this.world=t;if(r===undefined){r=1}if(s===undefined){s=100}if(n===undefined){n=1}r=t.pxm(r);var u={restLength:r,stiffness:s,damping:n};if(typeof a!=="undefined"&&a!==null){u.worldAnchorA=[t.pxm(a[0]),t.pxm(a[1])]}if(typeof o!=="undefined"&&o!==null){u.worldAnchorB=[t.pxm(o[0]),t.pxm(o[1])]}if(typeof h!=="undefined"&&h!==null){u.localAnchorA=[t.pxm(h[0]),t.pxm(h[1])]}if(typeof l!=="undefined"&&l!==null){u.localAnchorB=[t.pxm(l[0]),t.pxm(l[1])]}this.data=new p2.LinearSpring(e,i,u);this.data.parent=this};s.Physics.P2.Spring.prototype.constructor=s.Physics.P2.Spring;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.RotationalSpring=function(t,e,i,r,s,n){this.game=t.game;this.world=t;if(r===undefined){r=null}if(s===undefined){s=100}if(n===undefined){n=1}if(r){r=t.pxm(r)}var a={restAngle:r,stiffness:s,damping:n};this.data=new p2.RotationalSpring(e,i,a);this.data.parent=this};s.Physics.P2.Spring.prototype.constructor=s.Physics.P2.Spring;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.Material=function(t){this.name=t;p2.Material.call(this)};s.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);s.Physics.P2.Material.prototype.constructor=s.Physics.P2.Material;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.ContactMaterial=function(t,e,i){p2.ContactMaterial.call(this,t,e,i)};s.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);s.Physics.P2.ContactMaterial.prototype.constructor=s.Physics.P2.ContactMaterial;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.CollisionGroup=function(t){this.mask=t};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.DistanceConstraint=function(t,e,i,r,s,n,a){if(r===undefined){r=100}if(s===undefined){s=[0,0]}if(n===undefined){n=[0,0]}if(a===undefined){a=Number.MAX_VALUE}this.game=t.game;this.world=t;r=t.pxm(r);s=[t.pxmi(s[0]),t.pxmi(s[1])];n=[t.pxmi(n[0]),t.pxmi(n[1])];var o={distance:r,localAnchorA:s,localAnchorB:n,maxForce:a};p2.DistanceConstraint.call(this,e,i,o)};s.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);s.Physics.P2.DistanceConstraint.prototype.constructor=s.Physics.P2.DistanceConstraint;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.GearConstraint=function(t,e,i,r,s){if(r===undefined){r=0}if(s===undefined){s=1}this.game=t.game;this.world=t;var n={angle:r,ratio:s};p2.GearConstraint.call(this,e,i,n)};s.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);s.Physics.P2.GearConstraint.prototype.constructor=s.Physics.P2.GearConstraint;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.LockConstraint=function(t,e,i,r,s,n){if(r===undefined){r=[0,0]}if(s===undefined){s=0}if(n===undefined){n=Number.MAX_VALUE}this.game=t.game;this.world=t;r=[t.pxm(r[0]),t.pxm(r[1])];var a={localOffsetB:r,localAngleB:s,maxForce:n};p2.LockConstraint.call(this,e,i,a)};s.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);s.Physics.P2.LockConstraint.prototype.constructor=s.Physics.P2.LockConstraint;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.PrismaticConstraint=function(t,e,i,r,s,n,a,o){if(r===undefined){r=true}if(s===undefined){s=[0,0]}if(n===undefined){n=[0,0]}if(a===undefined){a=[0,0]}if(o===undefined){o=Number.MAX_VALUE}this.game=t.game;this.world=t;s=[t.pxmi(s[0]),t.pxmi(s[1])];n=[t.pxmi(n[0]),t.pxmi(n[1])];var h={localAnchorA:s,localAnchorB:n,localAxisA:a,maxForce:o,disableRotationalLock:!r};p2.PrismaticConstraint.call(this,e,i,h)};s.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);s.Physics.P2.PrismaticConstraint.prototype.constructor=s.Physics.P2.PrismaticConstraint;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Physics.P2.RevoluteConstraint=function(t,e,i,r,s,n,a){if(n===undefined){n=Number.MAX_VALUE}if(a===undefined){a=null}this.game=t.game;this.world=t;i=[t.pxmi(i[0]),t.pxmi(i[1])];s=[t.pxmi(s[0]),t.pxmi(s[1])];if(a){a=[t.pxmi(a[0]),t.pxmi(a[1])]}var o={worldPivot:a,localPivotA:i,localPivotB:s,maxForce:n};p2.RevoluteConstraint.call(this,e,r,o)};s.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);s.Physics.P2.RevoluteConstraint.prototype.constructor=s.Physics.P2.RevoluteConstraint;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.ImageCollection=function(t,e,i,r,s,n,a){if(i===undefined||i<=0){i=32}if(r===undefined||r<=0){r=32}if(s===undefined){s=0}if(n===undefined){n=0}this.name=t;this.firstgid=e|0;this.imageWidth=i|0;this.imageHeight=r|0;this.imageMargin=s|0;this.imageSpacing=n|0;this.properties=a||{};this.images=[];this.total=0};s.ImageCollection.prototype={containsImageIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},addImage:function(t,e){this.images.push({gid:t,image:e});this.total++}};s.ImageCollection.prototype.constructor=s.ImageCollection;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Tile=function(t,e,i,r,s,n){this.layer=t;this.index=e;this.x=i;this.y=r;this.rotation=0;this.flipped=false;this.worldX=i*s;this.worldY=r*n;this.width=s;this.height=n;this.centerX=Math.abs(s/2);this.centerY=Math.abs(n/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this};s.Tile.prototype={containsPoint:function(t,e){return!(t<this.worldX||e<this.worldY||t>this.right||e>this.bottom)},intersects:function(t,e,i,r){if(i<=this.worldX){return false}if(r<=this.worldY){return false}if(t>=this.worldX+this.width){return false}if(e>=this.worldY+this.height){return false}return true},setCollisionCallback:function(t,e){this.collisionCallback=t;this.collisionCallbackContext=e},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(t,e,i,r){this.collideLeft=t;this.collideRight=e;this.collideUp=i;this.collideDown=r;this.faceLeft=t;this.faceRight=e;this.faceTop=i;this.faceBottom=r},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(t,e){if(t&&e){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback}else if(t){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}else if(e){return this.faceTop||this.faceBottom||this.faceLeft||this.faceRight}return false},copy:function(t){this.index=t.index;this.alpha=t.alpha;this.properties=t.properties;this.collideUp=t.collideUp;this.collideDown=t.collideDown;this.collideLeft=t.collideLeft;this.collideRight=t.collideRight;this.collisionCallback=t.collisionCallback;this.collisionCallbackContext=t.collisionCallbackContext}};s.Tile.prototype.constructor=s.Tile;Object.defineProperty(s.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}});Object.defineProperty(s.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}});Object.defineProperty(s.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(s.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(s.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(s.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Tilemap=function(t,e,i,r,n,a){this.game=t;this.key=e;var o=s.TilemapParser.parse(this.game,e,i,r,n,a);if(o===null){return}this.width=o.width;this.height=o.height;this.tileWidth=o.tileWidth;this.tileHeight=o.tileHeight;this.orientation=o.orientation;this.format=o.format;this.version=o.version;this.properties=o.properties;this.widthInPixels=o.widthInPixels;this.heightInPixels=o.heightInPixels;this.layers=o.layers;this.tilesets=o.tilesets;this.imagecollections=o.imagecollections;this.tiles=o.tiles;this.objects=o.objects;this.collideIndexes=[];this.collision=o.collision;this.images=o.images;this.enableDebug=false;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};s.Tilemap.CSV=0;s.Tilemap.TILED_JSON=1;s.Tilemap.NORTH=0;s.Tilemap.EAST=1;s.Tilemap.SOUTH=2;s.Tilemap.WEST=3;s.Tilemap.prototype={create:function(t,e,i,r,s,n){if(n===undefined){n=this.game.world}this.width=e;this.height=i;this.setTileSize(r,s);this.layers.length=0;return this.createBlankLayer(t,e,i,r,s,n)},setTileSize:function(t,e){this.tileWidth=t;this.tileHeight=e;this.widthInPixels=this.width*t;this.heightInPixels=this.height*e},addTilesetImage:function(t,e,i,r,n,a,o){if(t===undefined){return null}if(i===undefined){i=this.tileWidth}if(r===undefined){r=this.tileHeight}if(n===undefined){n=0}if(a===undefined){a=0}if(o===undefined){o=0}if(i===0){i=32}if(r===0){r=32}var h=null;if(e===undefined||e===null){e=t}if(e instanceof s.BitmapData){h=e.canvas}else{if(!this.game.cache.checkImageKey(e)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+e+'"');return null}h=this.game.cache.getImage(e)}var l=this.getTilesetIndex(t);if(l===null&&this.format===s.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+t+'"');return null}if(this.tilesets[l]){this.tilesets[l].setImage(h);return this.tilesets[l]}else{var u=new s.Tileset(t,o,i,r,n,a,{});u.setImage(h);this.tilesets.push(u);var c=this.tilesets.length-1;var f=n;var d=n;var p=0;var g=0;var v=0;for(var m=o;m<o+u.total;m++){this.tiles[m]=[f,d,c];f+=i+a;p++;if(p===u.total){break}g++;if(g===u.columns){f=n;d+=r+a;g=0;v++;if(v===u.rows){break}}}return u}return null},createFromObjects:function(t,e,i,r,n,a,o,h,l){if(n===undefined){n=true}if(a===undefined){a=false}if(o===undefined){o=this.game.world}if(h===undefined){h=s.Sprite}if(l===undefined){l=true}if(!this.objects[t]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+t);return}for(var u=0;u<this.objects[t].length;u++){var c=false;var f=this.objects[t][u];if(f.gid!==undefined&&typeof e==="number"&&f.gid===e){c=true}else if(f.id!==undefined&&typeof e==="number"&&f.id===e){c=true}else if(f.name!==undefined&&typeof e==="string"&&f.name===e){c=true}if(c){var d=new h(this.game,parseFloat(f.x,10),parseFloat(f.y,10),i,r);d.name=f.name;d.visible=f.visible;d.autoCull=a;d.exists=n;if(f.width){d.width=f.width}if(f.height){d.height=f.height}if(f.rotation){d.angle=f.rotation}if(l){d.y-=d.height}o.add(d);for(var p in f.properties){o.set(d,p,f.properties[p],false,false,0,true)}}}},createFromTiles:function(t,e,i,r,n,a){if(typeof t==="number"){t=[t]}if(e===undefined||e===null){e=[]}else if(typeof e==="number"){e=[e]}r=this.getLayer(r);if(n===undefined){n=this.game.world}if(a===undefined){a={}}if(a.customClass===undefined){a.customClass=s.Sprite}if(a.adjustY===undefined){a.adjustY=true}var o=this.layers[r].width;var h=this.layers[r].height;this.copy(0,0,o,h,r);if(this._results.length<2){return 0}var l=0;var u;for(var c=1,f=this._results.length;c<f;c++){if(t.indexOf(this._results[c].index)!==-1){u=new a.customClass(this.game,this._results[c].worldX,this._results[c].worldY,i);for(var d in a){u[d]=a[d]}n.add(u);l++}}if(e.length===1){for(c=0;c<t.length;c++){this.replace(t[c],e[0],0,0,o,h,r)}}else if(e.length>1){for(c=0;c<t.length;c++){this.replace(t[c],e[c],0,0,o,h,r)}}return l},createLayer:function(t,e,i,r){if(e===undefined){e=this.game.width}if(i===undefined){i=this.game.height}if(r===undefined){r=this.game.world}var n=t;if(typeof t==="string"){n=this.getLayerIndex(t)}if(n===null||n>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+n);return}if(e===undefined||e<=0){e=Math.min(this.game.width,this.layers[n].widthInPixels)}else if(e>this.game.width){e=this.game.width}if(i===undefined||i<=0){i=Math.min(this.game.height,this.layers[n].heightInPixels)}else if(i>this.game.height){i=this.game.height}if(this.enableDebug){console.group("Tilemap.createLayer");console.log("Name:",this.layers[n].name);console.log("Size:",e,"x",i);console.log("Tileset:",this.tilesets[0].name,"index:",n)}var a=r.add(new s.TilemapLayer(this.game,this,n,e,i));if(this.enableDebug){console.groupEnd()}return a},createBlankLayer:function(t,e,i,r,n,a){if(a===undefined){a=this.game.world}if(this.getLayerIndex(t)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+t);return}var o={name:t,x:0,y:0,width:e,height:i,widthInPixels:e*r,heightInPixels:i*n,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var h;var l=[];for(var u=0;u<i;u++){h=[];for(var c=0;c<e;c++){h.push(new s.Tile(o,-1,c,u,r,n))}l.push(h)}o.data=l;this.layers.push(o);this.currentLayer=this.layers.length-1;var f=o.widthInPixels;var d=o.heightInPixels;if(f>this.game.width){f=this.game.width}if(d>this.game.height){d=this.game.height}var l=new s.TilemapLayer(this.game,this,this.layers.length-1,f,d);l.name=t;return a.add(l)},getIndex:function(t,e){for(var i=0;i<t.length;i++){if(t[i].name===e){return i}}return null},getLayerIndex:function(t){return this.getIndex(this.layers,t)},getTilesetIndex:function(t){return this.getIndex(this.tilesets,t)},getImageIndex:function(t){return this.getIndex(this.images,t)},setTileIndexCallback:function(t,e,i,r){r=this.getLayer(r);if(typeof t==="number"){this.layers[r].callbacks[t]={callback:e,callbackContext:i}}else{for(var s=0,n=t.length;s<n;s++){this.layers[r].callbacks[t[s]]={callback:e,callbackContext:i}}}},setTileLocationCallback:function(t,e,i,r,s,n,a){a=this.getLayer(a);this.copy(t,e,i,r,a);if(this._results.length<2){return}for(var o=1;o<this._results.length;o++){this._results[o].setCollisionCallback(s,n)}},setCollision:function(t,e,i,r){if(e===undefined){e=true}if(r===undefined){r=true}i=this.getLayer(i);if(typeof t==="number"){return this.setCollisionByIndex(t,e,i,true)}else if(Array.isArray(t)){for(var s=0;s<t.length;s++){this.setCollisionByIndex(t[s],e,i,false)}if(r){this.calculateFaces(i)}}},setCollisionBetween:function(t,e,i,r,s){if(i===undefined){i=true}if(s===undefined){s=true}r=this.getLayer(r);if(t>e){return}for(var n=t;n<=e;n++){this.setCollisionByIndex(n,i,r,false)}if(s){this.calculateFaces(r)}},setCollisionByExclusion:function(t,e,i,r){if(e===undefined){e=true}if(r===undefined){r=true}i=this.getLayer(i);for(var s=0,n=this.tiles.length;s<n;s++){if(t.indexOf(s)===-1){this.setCollisionByIndex(s,e,i,false)}}if(r){this.calculateFaces(i)}},setCollisionByIndex:function(t,e,i,r){if(e===undefined){e=true}if(i===undefined){i=this.currentLayer}if(r===undefined){r=true}if(e){this.collideIndexes.push(t)}else{var s=this.collideIndexes.indexOf(t);if(s>-1){this.collideIndexes.splice(s,1)}}for(var n=0;n<this.layers[i].height;n++){for(var a=0;a<this.layers[i].width;a++){var o=this.layers[i].data[n][a];if(o&&o.index===t){if(e){o.setCollision(true,true,true,true)}else{o.resetCollision()}o.faceTop=e;o.faceBottom=e;o.faceLeft=e;o.faceRight=e}}}if(r){this.calculateFaces(i)}return i},getLayer:function(t){if(t===undefined){t=this.currentLayer}else if(typeof t==="string"){t=this.getLayerIndex(t)}else if(t instanceof s.TilemapLayer){t=t.index}return t},setPreventRecalculate:function(t){if(t===true&&this.preventingRecalculate!==true){this.preventingRecalculate=true;this.needToRecalculate={}}if(t===false&&this.preventingRecalculate===true){this.preventingRecalculate=false;for(var e in this.needToRecalculate){this.calculateFaces(e)}this.needToRecalculate=false}},calculateFaces:function(t){if(this.preventingRecalculate){this.needToRecalculate[t]=true;return}var e=null;var i=null;var r=null;var s=null;for(var n=0,a=this.layers[t].height;n<a;n++){for(var o=0,h=this.layers[t].width;o<h;o++){var l=this.layers[t].data[n][o];if(l){e=this.getTileAbove(t,o,n);i=this.getTileBelow(t,o,n);r=this.getTileLeft(t,o,n);s=this.getTileRight(t,o,n);if(l.collides){l.faceTop=true;l.faceBottom=true;l.faceLeft=true;l.faceRight=true}if(e&&e.collides){l.faceTop=false}if(i&&i.collides){l.faceBottom=false}if(r&&r.collides){l.faceLeft=false}if(s&&s.collides){l.faceRight=false}}}}},getTileAbove:function(t,e,i){if(i>0){return this.layers[t].data[i-1][e]}return null},getTileBelow:function(t,e,i){if(i<this.layers[t].height-1){return this.layers[t].data[i+1][e]}return null},getTileLeft:function(t,e,i){if(e>0){return this.layers[t].data[i][e-1]}return null},getTileRight:function(t,e,i){if(e<this.layers[t].width-1){return this.layers[t].data[i][e+1]}return null},setLayer:function(t){t=this.getLayer(t);if(this.layers[t]){this.currentLayer=t}},hasTile:function(t,e,i){i=this.getLayer(i);if(this.layers[i].data[e]===undefined||this.layers[i].data[e][t]===undefined){return false}return this.layers[i].data[e][t].index>-1},removeTile:function(t,e,i){i=this.getLayer(i);if(t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height){if(this.hasTile(t,e,i)){var r=this.layers[i].data[e][t];this.layers[i].data[e][t]=new s.Tile(this.layers[i],-1,t,e,this.tileWidth,this.tileHeight);this.layers[i].dirty=true;this.calculateFaces(i);return r}}},removeTileWorldXY:function(t,e,i,r,s){s=this.getLayer(s);t=this.game.math.snapToFloor(t,i)/i;e=this.game.math.snapToFloor(e,r)/r;return this.removeTile(t,e,s)},putTile:function(t,e,i,r){if(t===null){return this.removeTile(e,i,r)}r=this.getLayer(r);if(e>=0&&e<this.layers[r].width&&i>=0&&i<this.layers[r].height){var n;if(t instanceof s.Tile){n=t.index;if(this.hasTile(e,i,r)){this.layers[r].data[i][e].copy(t)}else{this.layers[r].data[i][e]=new s.Tile(r,n,e,i,t.width,t.height)}}else{n=t;if(this.hasTile(e,i,r)){this.layers[r].data[i][e].index=n}else{this.layers[r].data[i][e]=new s.Tile(this.layers[r],n,e,i,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(n)>-1){this.layers[r].data[i][e].setCollision(true,true,true,true)}else{this.layers[r].data[i][e].resetCollision()}this.layers[r].dirty=true;this.calculateFaces(r);return this.layers[r].data[i][e]}return null},putTileWorldXY:function(t,e,i,r,s,n){n=this.getLayer(n);e=this.game.math.snapToFloor(e,r)/r;i=this.game.math.snapToFloor(i,s)/s;return this.putTile(t,e,i,n)},searchTileIndex:function(t,e,i,r){if(e===undefined){e=0}if(i===undefined){i=false}r=this.getLayer(r);var s=0;if(i){for(var n=this.layers[r].height-1;n>=0;n--){for(var a=this.layers[r].width-1;a>=0;a--){if(this.layers[r].data[n][a].index===t){if(s===e){return this.layers[r].data[n][a]}else{s++}}}}}else{for(var n=0;n<this.layers[r].height;n++){for(var a=0;a<this.layers[r].width;a++){if(this.layers[r].data[n][a].index===t){if(s===e){return this.layers[r].data[n][a]}else{s++}}}}}return null},getTile:function(t,e,i,r){if(r===undefined){r=false}i=this.getLayer(i);if(t>=0&&t<this.layers[i].width&&e>=0&&e<this.layers[i].height){if(this.layers[i].data[e][t].index===-1){if(r){return this.layers[i].data[e][t]}else{return null}}else{return this.layers[i].data[e][t]}}else{return null}},getTileWorldXY:function(t,e,i,r,s,n){if(i===undefined){i=this.tileWidth}if(r===undefined){r=this.tileHeight}s=this.getLayer(s);t=this.game.math.snapToFloor(t,i)/i;e=this.game.math.snapToFloor(e,r)/r;return this.getTile(t,e,s,n)},copy:function(t,e,i,r,s){s=this.getLayer(s);if(!this.layers[s]){this._results.length=0;return}if(t===undefined){t=0}if(e===undefined){e=0}if(i===undefined){i=this.layers[s].width}if(r===undefined){r=this.layers[s].height}if(t<0){t=0}if(e<0){e=0}if(i>this.layers[s].width){i=this.layers[s].width}if(r>this.layers[s].height){r=this.layers[s].height}this._results.length=0;this._results.push({x:t,y:e,width:i,height:r,layer:s});for(var n=e;n<e+r;n++){for(var a=t;a<t+i;a++){this._results.push(this.layers[s].data[n][a])}}return this._results},paste:function(t,e,i,r){if(t===undefined){t=0}if(e===undefined){e=0}r=this.getLayer(r);if(!i||i.length<2){return}var s=t-i[1].x;var n=e-i[1].y;for(var a=1;a<i.length;a++){this.layers[r].data[n+i[a].y][s+i[a].x].copy(i[a])}this.layers[r].dirty=true;this.calculateFaces(r)},swap:function(t,e,i,r,s,n,a){a=this.getLayer(a);this.copy(i,r,s,n,a);if(this._results.length<2){return}this._tempA=t;this._tempB=e;this._results.forEach(this.swapHandler,this);this.paste(i,r,this._results,a)},swapHandler:function(t){if(t.index===this._tempA){t.index=this._tempB}else if(t.index===this._tempB){t.index=this._tempA}},forEach:function(t,e,i,r,s,n,a){a=this.getLayer(a);this.copy(i,r,s,n,a);if(this._results.length<2){return}this._results.forEach(t,e);this.paste(i,r,this._results,a)},replace:function(t,e,i,r,s,n,a){a=this.getLayer(a);this.copy(i,r,s,n,a);if(this._results.length<2){return}for(var o=1;o<this._results.length;o++){if(this._results[o].index===t){this._results[o].index=e}}this.paste(i,r,this._results,a)},random:function(t,e,i,r,s){s=this.getLayer(s);this.copy(t,e,i,r,s);if(this._results.length<2){return}var n=[];for(var a=1;a<this._results.length;a++){if(this._results[a].index){var o=this._results[a].index;if(n.indexOf(o)===-1){n.push(o)}}}for(var h=1;h<this._results.length;h++){this._results[h].index=this.game.rnd.pick(n)}this.paste(t,e,this._results,s)},shuffle:function(t,e,i,r,n){n=this.getLayer(n);this.copy(t,e,i,r,n);if(this._results.length<2){return}var a=[];for(var o=1;o<this._results.length;o++){if(this._results[o].index){a.push(this._results[o].index)}}s.ArrayUtils.shuffle(a);for(var h=1;h<this._results.length;h++){this._results[h].index=a[h-1]}this.paste(t,e,this._results,n)},fill:function(t,e,i,r,s,n){n=this.getLayer(n);this.copy(e,i,r,s,n);if(this._results.length<2){return}for(var a=1;a<this._results.length;a++){this._results[a].index=t}this.paste(e,i,this._results,n)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var t="";var e=[""];for(var i=0;i<this.layers[this.currentLayer].height;i++){for(var r=0;r<this.layers[this.currentLayer].width;r++){t+="%c  ";if(this.layers[this.currentLayer].data[i][r]>1){if(this.debugMap[this.layers[this.currentLayer].data[i][r]]){e.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][r]])}else{e.push("background: #ffffff")}}else{e.push("background: rgb(0, 0, 0)")}}t+="\n"}e[0]=t;console.log.apply(console,e)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};s.Tilemap.prototype.constructor=s.Tilemap;Object.defineProperty(s.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(t){if(t!==this.currentLayer){this.setLayer(t)}}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.TilemapLayer=function(t,e,i,r,n){r|=0;n|=0;s.Sprite.call(this,t,0,0);this.map=e;this.index=i;this.layer=e.layers[i];this.canvas=PIXI.CanvasPool.create(this,r,n);this.context=this.canvas.getContext("2d");this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas)));this.type=s.TILEMAPLAYER;this.physicsType=s.TILEMAPLAYER;this.renderSettings={enableScrollDelta:false,overdrawRatio:.2,copyCanvas:null};this.debug=false;this.exists=true;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:true,debugAlpha:.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this._wrap=false;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:e.tileWidth,tileHeight:e.tileHeight,cw:e.tileWidth,ch:e.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this._results=[];if(!t.device.canvasBitBltShift){this.renderSettings.copyCanvas=s.TilemapLayer.ensureSharedCopyCanvas()}this.fixedToCamera=true};s.TilemapLayer.prototype=Object.create(s.Sprite.prototype);s.TilemapLayer.prototype.constructor=s.TilemapLayer;s.TilemapLayer.prototype.preUpdateCore=s.Component.Core.preUpdate;s.TilemapLayer.sharedCopyCanvas=null;s.TilemapLayer.ensureSharedCopyCanvas=function(){if(!this.sharedCopyCanvas){this.sharedCopyCanvas=PIXI.CanvasPool.create(this,2,2)}return this.sharedCopyCanvas};s.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()};s.TilemapLayer.prototype.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y};s.TilemapLayer.prototype._renderCanvas=function(t){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderCanvas.call(this,t)};s.TilemapLayer.prototype._renderWebGL=function(t){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderWebGL.call(this,t)};s.TilemapLayer.prototype.destroy=function(){PIXI.CanvasPool.remove(this);s.Component.Destroy.prototype.destroy.call(this)};s.TilemapLayer.prototype.resize=function(t,e){this.canvas.width=t;this.canvas.height=e;this.texture.frame.resize(t,e);this.texture.width=t;this.texture.height=e;this.texture.crop.width=t;this.texture.crop.height=e;this.texture.baseTexture.width=t;this.texture.baseTexture.height=e;this.texture.baseTexture.dirty();this.texture.requiresUpdate=true;this.texture._updateUvs();this.dirty=true};s.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};s.TilemapLayer.prototype._fixX=function(t){if(this.scrollFactorX===1||this.scrollFactorX===0&&this.position.x===0){return t}if(this.scrollFactorX===0&&this.position.x!==0){return t-this.position.x}return this._scrollX+(t-this._scrollX/this.scrollFactorX)};s.TilemapLayer.prototype._unfixX=function(t){if(this.scrollFactorX===1){return t}return this._scrollX/this.scrollFactorX+(t-this._scrollX)};s.TilemapLayer.prototype._fixY=function(t){if(this.scrollFactorY===1||this.scrollFactorY===0&&this.position.y===0){return t}if(this.scrollFactorY===0&&this.position.y!==0){return t-this.position.y}return this._scrollY+(t-this._scrollY/this.scrollFactorY)};s.TilemapLayer.prototype._unfixY=function(t){if(this.scrollFactorY===1){return t}return this._scrollY/this.scrollFactorY+(t-this._scrollY)};s.TilemapLayer.prototype.getTileX=function(t){return Math.floor(this._fixX(t)/this._mc.tileWidth)};s.TilemapLayer.prototype.getTileY=function(t){return Math.floor(this._fixY(t)/this._mc.tileHeight)};s.TilemapLayer.prototype.getTileXY=function(t,e,i){i.x=this.getTileX(t);i.y=this.getTileY(e);return i};s.TilemapLayer.prototype.getRayCastTiles=function(t,e,i,r){if(!e){e=this.rayStepRate}if(i===undefined){i=false}if(r===undefined){r=false}var s=this.getTiles(t.x,t.y,t.width,t.height,i,r);if(s.length===0){return[]}var n=t.coordinatesOnLine(e);var a=[];for(var o=0;o<s.length;o++){for(var h=0;h<n.length;h++){var l=s[o];var u=n[h];if(l.containsPoint(u[0],u[1])){a.push(l);break}}}return a};s.TilemapLayer.prototype.getTiles=function(t,e,i,r,s,n){if(s===undefined){s=false}if(n===undefined){n=false}var a=!(s||n);t=this._fixX(t);e=this._fixY(e);var o=Math.floor(t/(this._mc.cw*this.scale.x));var h=Math.floor(e/(this._mc.ch*this.scale.y));var l=Math.ceil((t+i)/(this._mc.cw*this.scale.x))-o;var u=Math.ceil((e+r)/(this._mc.ch*this.scale.y))-h;while(this._results.length){this._results.pop()}for(var c=h;c<h+u;c++){for(var f=o;f<o+l;f++){var d=this.layer.data[c];if(d&&d[f]){if(a||d[f].isInteresting(s,n)){this._results.push(d[f])}}}}return this._results.slice()};s.TilemapLayer.prototype.resolveTileset=function(t){var e=this._mc.tilesets;if(t<2e3){while(e.length<t){e.push(undefined)}}var i=this.map.tiles[t]&&this.map.tiles[t][2];if(i!==null){var r=this.map.tilesets[i];if(r&&r.containsTileIndex(t)){return e[t]=r}}return e[t]=null};s.TilemapLayer.prototype.resetTilesetCache=function(){var t=this._mc.tilesets;while(t.length){t.pop()}};s.TilemapLayer.prototype.setScale=function(t,e){t=t||1;e=e||t;for(var i=0;i<this.layer.data.length;i++){var r=this.layer.data[i];for(var s=0;s<r.length;s++){var n=r[s];n.width=this.map.tileWidth*t;n.height=this.map.tileHeight*e;n.worldX=n.x*n.width;n.worldY=n.y*n.height}}this.scale.setTo(t,e)};s.TilemapLayer.prototype.shiftCanvas=function(t,e,i){var r=t.canvas;var s=r.width-Math.abs(e);var n=r.height-Math.abs(i);var a=0;var o=0;var h=e;var l=i;if(e<0){a=-e;h=0}if(i<0){o=-i;l=0}var u=this.renderSettings.copyCanvas;if(u){if(u.width<s||u.height<n){u.width=s;u.height=n}var c=u.getContext("2d");c.clearRect(0,0,s,n);c.drawImage(r,a,o,s,n,0,0,s,n);t.clearRect(h,l,s,n);t.drawImage(u,0,0,s,n,h,l,s,n)}else{t.save();t.globalCompositeOperation="copy";t.drawImage(r,a,o,s,n,h,l,s,n);t.restore()}};s.TilemapLayer.prototype.renderRegion=function(t,e,i,r,s,n){var a=this.context;var o=this.layer.width;var h=this.layer.height;var l=this._mc.tileWidth;var u=this._mc.tileHeight;var c=this._mc.tilesets;var f=NaN;if(!this._wrap){if(i<=s){i=Math.max(0,i);s=Math.min(o-1,s)}if(r<=n){r=Math.max(0,r);n=Math.min(h-1,n)}}var d=i*l-t;var p=r*u-e;var g=(i+(1<<20)*o)%o;var v=(r+(1<<20)*h)%h;var m,y,x,b,w,_;for(b=v,_=n-r,y=p;_>=0;b++,_--,y+=u){if(b>=h){b-=h}var P=this.layer.data[b];for(x=g,w=s-i,m=d;w>=0;x++,w--,m+=l){if(x>=o){x-=o}var T=P[x];if(!T||T.index<0){continue}var C=T.index;var S=c[C];if(S===undefined){S=this.resolveTileset(C)}if(T.alpha!==f&&!this.debug){a.globalAlpha=T.alpha;f=T.alpha}if(S){if(T.rotation||T.flipped){a.save();a.translate(m+T.centerX,y+T.centerY);a.rotate(T.rotation);if(T.flipped){a.scale(-1,1)}S.draw(a,-T.centerX,-T.centerY,C);a.restore()}else{S.draw(a,m,y,C)}}else if(this.debugSettings.missingImageFill){a.fillStyle=this.debugSettings.missingImageFill;a.fillRect(m,y,l,u)}if(T.debug&&this.debugSettings.debuggedTileOverfill){a.fillStyle=this.debugSettings.debuggedTileOverfill;a.fillRect(m,y,l,u)}}}};s.TilemapLayer.prototype.renderDeltaScroll=function(t,e){var i=this._mc.scrollX;var r=this._mc.scrollY;var s=this.canvas.width;var n=this.canvas.height;var a=this._mc.tileWidth;var o=this._mc.tileHeight;var h=0;var l=-a;var u=0;var c=-o;if(t<0){h=s+t;l=s-1}else if(t>0){l=t}if(e<0){u=n+e;c=n-1}else if(e>0){c=e}this.shiftCanvas(this.context,t,e);h=Math.floor((h+i)/a);l=Math.floor((l+i)/a);u=Math.floor((u+r)/o);c=Math.floor((c+r)/o);if(h<=l){this.context.clearRect(h*a-i,0,(l-h+1)*a,n);var f=Math.floor((0+r)/o);var d=Math.floor((n-1+r)/o);this.renderRegion(i,r,h,f,l,d)}if(u<=c){this.context.clearRect(0,u*o-r,s,(c-u+1)*o);var p=Math.floor((0+i)/a);var g=Math.floor((s-1+i)/a);this.renderRegion(i,r,p,u,g,c)}};s.TilemapLayer.prototype.renderFull=function(){var t=this._mc.scrollX;var e=this._mc.scrollY;var i=this.canvas.width;var r=this.canvas.height;var s=this._mc.tileWidth;var n=this._mc.tileHeight;var a=Math.floor(t/s);var o=Math.floor((i-1+t)/s);var h=Math.floor(e/n);var l=Math.floor((r-1+e)/n);this.context.clearRect(0,0,i,r);this.renderRegion(t,e,a,h,o,l)};s.TilemapLayer.prototype.render=function(){var t=false;if(!this.visible){return}if(this.dirty||this.layer.dirty){this.layer.dirty=false;t=true}var e=this.canvas.width;var i=this.canvas.height;var r=this._scrollX|0;var s=this._scrollY|0;var n=this._mc;var a=n.scrollX-r;var o=n.scrollY-s;if(!t&&a===0&&o===0&&n.renderWidth===e&&n.renderHeight===i){return}this.context.save();n.scrollX=r;n.scrollY=s;if(n.renderWidth!==e||n.renderHeight!==i){n.renderWidth=e;n.renderHeight=i}if(this.debug){this.context.globalAlpha=this.debugSettings.debugAlpha;if(this.debugSettings.forceFullRedraw){t=true}}if(!t&&this.renderSettings.enableScrollDelta&&Math.abs(a)+Math.abs(o)<Math.min(e,i)){this.renderDeltaScroll(a,o)}else{this.renderFull()}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}this.texture.baseTexture.dirty();this.dirty=false;this.context.restore();return true};s.TilemapLayer.prototype.renderDebug=function(){var t=this._mc.scrollX;var e=this._mc.scrollY;var i=this.context;var r=this.canvas.width;var s=this.canvas.height;var n=this.layer.width;var a=this.layer.height;var o=this._mc.tileWidth;var h=this._mc.tileHeight;var l=Math.floor(t/o);var u=Math.floor((r-1+t)/o);var c=Math.floor(e/h);var f=Math.floor((s-1+e)/h);var d=l*o-t;var p=c*h-e;var g=(l+(1<<20)*n)%n;var v=(c+(1<<20)*a)%a;var m,y,x,b,w,_;i.strokeStyle=this.debugSettings.facingEdgeStroke;for(b=v,_=f-c,y=p;_>=0;b++,_--,y+=h){if(b>=a){b-=a}var P=this.layer.data[b];for(x=g,w=u-l,m=d;w>=0;x++,w--,m+=o){if(x>=n){x-=n}var T=P[x];if(!T||T.index<0||!T.collides){continue}if(this.debugSettings.collidingTileOverfill){i.fillStyle=this.debugSettings.collidingTileOverfill;i.fillRect(m,y,this._mc.cw,this._mc.ch)}if(this.debugSettings.facingEdgeStroke){i.beginPath();if(T.faceTop){i.moveTo(m,y);i.lineTo(m+this._mc.cw,y)}if(T.faceBottom){i.moveTo(m,y+this._mc.ch);i.lineTo(m+this._mc.cw,y+this._mc.ch)}if(T.faceLeft){i.moveTo(m,y);i.lineTo(m,y+this._mc.ch)}if(T.faceRight){i.moveTo(m+this._mc.cw,y);i.lineTo(m+this._mc.cw,y+this._mc.ch)}i.closePath();i.stroke()}}}};Object.defineProperty(s.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(t){this._wrap=t;this.dirty=true}});Object.defineProperty(s.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(t){this._scrollX=t}});Object.defineProperty(s.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(t){this._scrollY=t}});Object.defineProperty(s.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(t){this._mc.cw=t|0;this.dirty=true}});Object.defineProperty(s.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(t){this._mc.ch=t|0;this.dirty=true}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.TilemapParser={INSERT_NULL:false,parse:function(t,e,i,r,n,a){if(i===undefined){i=32}if(r===undefined){r=32}if(n===undefined){n=10}if(a===undefined){a=10}if(e===undefined){return this.getEmptyData()}if(e===null){return this.getEmptyData(i,r,n,a)}var o=t.cache.getTilemapData(e);if(o){if(o.format===s.Tilemap.CSV){return this.parseCSV(e,o.data,i,r)}else if(!o.format||o.format===s.Tilemap.TILED_JSON){return this.parseTiledJSON(o.data)}}else{console.warn("Phaser.TilemapParser.parse - No map data found for key "+e)}},parseCSV:function(t,e,i,r){var n=this.getEmptyData();e=e.trim();var a=[];var o=e.split("\n");var h=o.length;var l=0;for(var u=0;u<o.length;u++){a[u]=[];var c=o[u].split(",");for(var f=0;f<c.length;f++){a[u][f]=new s.Tile(n.layers[0],parseInt(c[f],10),f,u,i,r)}if(l===0){l=c.length}}n.format=s.Tilemap.CSV;n.name=t;n.width=l;n.height=h;n.tileWidth=i;n.tileHeight=r;n.widthInPixels=l*i;n.heightInPixels=h*r;n.layers[0].width=l;n.layers[0].height=h;n.layers[0].widthInPixels=n.widthInPixels;n.layers[0].heightInPixels=n.heightInPixels;n.layers[0].data=a;return n},getEmptyData:function(t,e,i,r){return{width:i!==undefined&&i!==null?i:0,height:r!==undefined&&r!==null?r:0,tileWidth:t!==undefined&&t!==null?t:0,tileHeight:e!==undefined&&e!==null?e:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},parseTiledJSON:function(t){if(t.orientation!=="orthogonal"){console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser");return null}var e={width:t.width,height:t.height,tileWidth:t.tilewidth,tileHeight:t.tileheight,orientation:t.orientation,format:s.Tilemap.TILED_JSON,version:t.version,properties:t.properties,widthInPixels:t.width*t.tilewidth,heightInPixels:t.height*t.tileheight};var i=[];for(var r=0;r<t.layers.length;r++){if(t.layers[r].type!=="tilelayer"){continue}var n=t.layers[r];if(!n.compression&&n.encoding&&n.encoding==="base64"){var a=window.atob(n.data);var o=a.length;var h=new Array(o);for(var l=0;l<o;l+=4){h[l/4]=(a.charCodeAt(l)|a.charCodeAt(l+1)<<8|a.charCodeAt(l+2)<<16|a.charCodeAt(l+3)<<24)>>>0}n.data=h;delete n.encoding}else if(n.compression){console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+n.name+"'");continue}var u={name:n.name,x:n.x,y:n.y,width:n.width,height:n.height,widthInPixels:n.width*t.tilewidth,heightInPixels:n.height*t.tileheight,alpha:n.opacity,visible:n.visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(n.properties){u.properties=n.properties}var c=0;var f=[];var d=[];var p,g,v,m;for(var y=0,o=n.data.length;y<o;y++){p=0;g=false;m=n.data[y];v=0;if(m>536870912){if(m>2147483648){m-=2147483648;v+=4}if(m>1073741824){m-=1073741824;v+=2}if(m>536870912){m-=536870912;v+=1}switch(v){case 5:p=Math.PI/2;break;case 6:p=Math.PI;break;case 3:p=3*Math.PI/2;break;case 4:p=0;g=true;break;case 7:p=Math.PI/2;g=true;break;case 2:p=Math.PI;g=true;break;case 1:p=3*Math.PI/2;g=true;break}}if(m>0){var x=new s.Tile(u,m,c,d.length,t.tilewidth,t.tileheight);x.rotation=p;x.flipped=g;if(v!==0){x.flippedVal=v}f.push(x)}else{if(s.TilemapParser.INSERT_NULL){f.push(null)}else{f.push(new s.Tile(u,-1,c,d.length,t.tilewidth,t.tileheight))}}c++;if(c===n.width){d.push(f);c=0;f=[]}}u.data=d;i.push(u)}e.layers=i;var b=[];for(var r=0;r<t.layers.length;r++){if(t.layers[r].type!=="imagelayer"){continue}var w=t.layers[r];var _={name:w.name,image:w.image,x:w.x,y:w.y,alpha:w.opacity,visible:w.visible,properties:{}};if(w.properties){_.properties=w.properties}b.push(_)}e.images=b;var P=[];var T=[];var C=null;for(var r=0;r<t.tilesets.length;r++){var S=t.tilesets[r];if(S.image){var A=new s.Tileset(S.name,S.firstgid,S.tilewidth,S.tileheight,S.margin,S.spacing,S.properties);if(S.tileproperties){A.tileProperties=S.tileproperties}A.updateTileData(S.imagewidth,S.imageheight);P.push(A)}else{var E=new s.ImageCollection(S.name,S.firstgid,S.tilewidth,S.tileheight,S.margin,S.spacing,S.properties);for(var I in S.tiles){var _=S.tiles[I].image;var m=S.firstgid+parseInt(I,10);E.addImage(m,_)}T.push(E)}if(C){C.lastgid=S.firstgid-1}C=S}e.tilesets=P;e.imagecollections=T;var M={};var R={};function B(t,e){var i={};for(var r in e){var s=e[r];if(typeof t[s]!=="undefined"){i[s]=t[s]}}return i}for(var r=0;r<t.layers.length;r++){if(t.layers[r].type!=="objectgroup"){continue}var L=t.layers[r];M[L.name]=[];R[L.name]=[];for(var k=0,o=L.objects.length;k<o;k++){if(L.objects[k].gid){var O={gid:L.objects[k].gid,name:L.objects[k].name,type:L.objects[k].hasOwnProperty("type")?L.objects[k].type:"",x:L.objects[k].x,y:L.objects[k].y,visible:L.objects[k].visible,properties:L.objects[k].properties};if(L.objects[k].rotation){O.rotation=L.objects[k].rotation}M[L.name].push(O)}else if(L.objects[k].polyline){var O={name:L.objects[k].name,type:L.objects[k].type,x:L.objects[k].x,y:L.objects[k].y,width:L.objects[k].width,height:L.objects[k].height,visible:L.objects[k].visible,properties:L.objects[k].properties};if(L.objects[k].rotation){O.rotation=L.objects[k].rotation}O.polyline=[];for(var F=0;F<L.objects[k].polyline.length;F++){O.polyline.push([L.objects[k].polyline[F].x,L.objects[k].polyline[F].y])}R[L.name].push(O);M[L.name].push(O)}else if(L.objects[k].polygon){var O=B(L.objects[k],["name","type","x","y","visible","rotation","properties"]);O.polygon=[];for(var F=0;F<L.objects[k].polygon.length;F++){O.polygon.push([L.objects[k].polygon[F].x,L.objects[k].polygon[F].y])}M[L.name].push(O)}else if(L.objects[k].ellipse){var O=B(L.objects[k],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);M[L.name].push(O)}else{var O=B(L.objects[k],["name","type","x","y","width","height","visible","rotation","properties"]);O.rectangle=true;M[L.name].push(O)}}}e.objects=M;e.collision=R;e.tiles=[];for(var r=0;r<e.tilesets.length;r++){var S=e.tilesets[r];var c=S.tileMargin;var D=S.tileMargin;var U=0;var G=0;var N=0;for(var y=S.firstgid;y<S.firstgid+S.total;y++){e.tiles[y]=[c,D,r];c+=S.tileWidth+S.tileSpacing;U++;if(U===S.total){break}G++;if(G===S.columns){c=S.tileMargin;D+=S.tileHeight+S.tileSpacing;G=0;N++;if(N===S.rows){break}}}}var u;var x;var X;var S;for(var r=0;r<e.layers.length;r++){u=e.layers[r];S=null;for(var l=0;l<u.data.length;l++){f=u.data[l];for(var j=0;j<f.length;j++){x=f[j];if(x===null||x.index<0){continue}X=e.tiles[x.index][2];S=e.tilesets[X];if(S.tileProperties&&S.tileProperties[x.index-S.firstgid]){x.properties=s.Utils.mixin(S.tileProperties[x.index-S.firstgid],x.properties)}}}}return e}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Tileset=function(t,e,i,r,s,n,a){if(i===undefined||i<=0){i=32}if(r===undefined||r<=0){r=32}if(s===undefined){s=0}if(n===undefined){n=0}this.name=t;this.firstgid=e|0;this.tileWidth=i|0;this.tileHeight=r|0;this.tileMargin=s|0;this.tileSpacing=n|0;this.properties=a||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};s.Tileset.prototype={draw:function(t,e,i,r){var s=r-this.firstgid<<1;if(s>=0&&s+1<this.drawCoords.length){t.drawImage(this.image,this.drawCoords[s],this.drawCoords[s+1],this.tileWidth,this.tileHeight,e,i,this.tileWidth,this.tileHeight)}},containsTileIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total},setImage:function(t){this.image=t;this.updateTileData(t.width,t.height)},setSpacing:function(t,e){this.tileMargin=t|0;this.tileSpacing=e|0;if(this.image){this.updateTileData(this.image.width,this.image.height)}},updateTileData:function(t,e){var i=(e-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing);var r=(t-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);if(i%1!==0||r%1!==0){console.warn("Phaser.Tileset - "+this.name+" image tile area is not an even multiple of tile size")}i=Math.floor(i);r=Math.floor(r);if(this.rows&&this.rows!==i||this.columns&&this.columns!==r){console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ")}this.rows=i;this.columns=r;this.total=i*r;this.drawCoords.length=0;var s=this.tileMargin;var n=this.tileMargin;for(var a=0;a<this.rows;a++){for(var o=0;o<this.columns;o++){this.drawCoords.push(s);this.drawCoords.push(n);s+=this.tileWidth+this.tileSpacing}s=this.tileMargin;n+=this.tileHeight+this.tileSpacing}}};s.Tileset.prototype.constructor=s.Tileset;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Particle=function(t,e,i,r,n){s.Sprite.call(this,t,e,i,r,n);this.autoScale=false;this.scaleData=null;this._s=0;this.autoAlpha=false;this.alphaData=null;this._a=0};s.Particle.prototype=Object.create(s.Sprite.prototype);s.Particle.prototype.constructor=s.Particle;s.Particle.prototype.update=function(){if(this.autoScale){this._s--;if(this._s){this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y)}else{this.autoScale=false}}if(this.autoAlpha){this._a--;if(this._a){this.alpha=this.alphaData[this._a].v}else{this.autoAlpha=false}}};s.Particle.prototype.onEmit=function(){};s.Particle.prototype.setAlphaData=function(t){this.alphaData=t;this._a=t.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=true};s.Particle.prototype.setScaleData=function(t){this.scaleData=t;this._s=t.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=true};s.Particle.prototype.reset=function(t,e,i){s.Component.Reset.prototype.reset.call(this,t,e,i);this.alpha=1;this.scale.set(1);this.autoScale=false;this.autoAlpha=false;return this};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Particles=function(t){this.game=t;this.emitters={};this.ID=0};s.Particles.prototype={add:function(t){this.emitters[t.name]=t;return t},remove:function(t){delete this.emitters[t.name]},update:function(){for(var t in this.emitters){if(this.emitters[t].exists){this.emitters[t].update()}}}};s.Particles.prototype.constructor=s.Particles;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Particles.Arcade={};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Particles.Arcade.Emitter=function(t,e,i,r){this.maxParticles=r||50;s.Group.call(this,t);this.name="emitter"+this.game.particles.ID++;this.type=s.EMITTER;this.physicsType=s.GROUP;this.area=new s.Rectangle(e,i,1,1);this.minParticleSpeed=new s.Point(-100,-100);this.maxParticleSpeed=new s.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=s.Particle;this.particleDrag=new s.Point;this.angularDrag=0;this.frequency=100;this.lifespan=2e3;this.bounce=new s.Point;this.on=false;this.particleAnchor=new s.Point(.5,.5);this.blendMode=s.blendModes.NORMAL;this.emitX=e;this.emitY=i;this.autoScale=false;this.autoAlpha=false;this.particleBringToTop=false;this.particleSendToBack=false;this._minParticleScale=new s.Point(1,1);this._maxParticleScale=new s.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._flowQuantity=0;this._flowTotal=0;this._explode=true;this._frames=null};s.Particles.Arcade.Emitter.prototype=Object.create(s.Group.prototype);s.Particles.Arcade.Emitter.prototype.constructor=s.Particles.Arcade.Emitter;s.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer){this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion;if(this._flowTotal!==0){if(this._flowQuantity>0){for(var t=0;t<this._flowQuantity;t++){if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false;break}}}}else{if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false}}}}else{if(this.emitParticle()){this._counter++;if(this._quantity>0&&this._counter>=this._quantity){this.on=false}}}}var t=this.children.length;while(t--){if(this.children[t].exists){this.children[t].update()}}};s.Particles.Arcade.Emitter.prototype.makeParticles=function(t,e,i,r,s){if(e===undefined){e=0}if(i===undefined){i=this.maxParticles}if(r===undefined){r=false}if(s===undefined){s=false}var n;var a=0;var o=t;var h=e;this._frames=e;if(i>this.maxParticles){this.maxParticles=i}while(a<i){if(Array.isArray(t)){o=this.game.rnd.pick(t)}if(Array.isArray(e)){h=this.game.rnd.pick(e)}n=new this.particleClass(this.game,0,0,o,h);this.game.physics.arcade.enable(n,false);if(r){n.body.checkCollision.any=true;n.body.checkCollision.none=false}else{n.body.checkCollision.none=true}n.body.collideWorldBounds=s;n.body.skipQuadTree=true;n.exists=false;n.visible=false;n.anchor.copyFrom(this.particleAnchor);this.add(n);a++}return this};s.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false;return this};s.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true;return this};s.Particles.Arcade.Emitter.prototype.explode=function(t,e){this._flowTotal=0;this.start(true,t,0,e,false);return this};s.Particles.Arcade.Emitter.prototype.flow=function(t,e,i,r,s){if(i===undefined||i===0){i=1}if(r===undefined){r=-1}if(s===undefined){s=true}if(i>this.maxParticles){i=this.maxParticles}this._counter=0;this._flowQuantity=i;this._flowTotal=r;if(s){this.start(true,t,e,i);this._counter+=i;this.on=true;this._timer=this.game.time.time+e*this.game.time.slowMotion}else{this.start(false,t,e,i)}return this};s.Particles.Arcade.Emitter.prototype.start=function(t,e,i,r,s){if(t===undefined){t=true}if(e===undefined){e=0}if(i===undefined||i===null){i=250}if(r===undefined){r=0}if(s===undefined){s=false}if(r>this.maxParticles){r=this.maxParticles}this.revive();this.visible=true;this.lifespan=e;this.frequency=i;if(t||s){for(var n=0;n<r;n++){this.emitParticle()}}else{this.on=true;this._quantity=r;this._counter=0;this._timer=this.game.time.time+i*this.game.time.slowMotion}return this};s.Particles.Arcade.Emitter.prototype.emitParticle=function(t,e,i,r){if(t===undefined){t=null}if(e===undefined){e=null}var s=this.getFirstExists(false);if(s===null){return false}var n=this.game.rnd;if(i!==undefined&&r!==undefined){s.loadTexture(i,r)}else if(i!==undefined){s.loadTexture(i)}var a=this.emitX;var o=this.emitY;if(t!==null){a=t}else if(this.width>1){a=n.between(this.left,this.right)}if(e!==null){o=e}else if(this.height>1){o=n.between(this.top,this.bottom)}s.reset(a,o);s.angle=0;s.lifespan=this.lifespan;if(this.particleBringToTop){this.bringToTop(s)}else if(this.particleSendToBack){this.sendToBack(s)}if(this.autoScale){s.setScaleData(this.scaleData)}else if(this.minParticleScale!==1||this.maxParticleScale!==1){s.scale.set(n.realInRange(this.minParticleScale,this.maxParticleScale))}else if(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y){s.scale.set(n.realInRange(this._minParticleScale.x,this._maxParticleScale.x),n.realInRange(this._minParticleScale.y,this._maxParticleScale.y))}if(r===undefined){if(Array.isArray(this._frames)){s.frame=this.game.rnd.pick(this._frames)}else{s.frame=this._frames}}if(this.autoAlpha){s.setAlphaData(this.alphaData)}else{s.alpha=n.realInRange(this.minParticleAlpha,this.maxParticleAlpha)}s.blendMode=this.blendMode;var h=s.body;h.updateBounds();h.bounce.copyFrom(this.bounce);h.drag.copyFrom(this.particleDrag);h.velocity.x=n.between(this.minParticleSpeed.x,this.maxParticleSpeed.x);h.velocity.y=n.between(this.minParticleSpeed.y,this.maxParticleSpeed.y);h.angularVelocity=n.between(this.minRotation,this.maxRotation);h.gravity.y=this.gravity;h.angularDrag=this.angularDrag;s.onEmit();return true};s.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);s.Group.prototype.destroy.call(this,true,false)};s.Particles.Arcade.Emitter.prototype.setSize=function(t,e){this.area.width=t;this.area.height=e;return this};s.Particles.Arcade.Emitter.prototype.setXSpeed=function(t,e){t=t||0;e=e||0;this.minParticleSpeed.x=t;this.maxParticleSpeed.x=e;return this};s.Particles.Arcade.Emitter.prototype.setYSpeed=function(t,e){t=t||0;e=e||0;this.minParticleSpeed.y=t;this.maxParticleSpeed.y=e;return this};s.Particles.Arcade.Emitter.prototype.setRotation=function(t,e){t=t||0;e=e||0;this.minRotation=t;this.maxRotation=e;return this};s.Particles.Arcade.Emitter.prototype.setAlpha=function(t,e,i,r,n){if(t===undefined){t=1}if(e===undefined){e=1}if(i===undefined){i=0}if(r===undefined){r=s.Easing.Linear.None}if(n===undefined){n=false}this.minParticleAlpha=t;this.maxParticleAlpha=e;this.autoAlpha=false;if(i>0&&t!==e){var a={v:t};var o=this.game.make.tween(a).to({v:e},i,r);o.yoyo(n);this.alphaData=o.generateData(60);this.alphaData.reverse();this.autoAlpha=true}return this};s.Particles.Arcade.Emitter.prototype.setScale=function(t,e,i,r,n,a,o){if(t===undefined){t=1}if(e===undefined){e=1}if(i===undefined){i=1}if(r===undefined){r=1}if(n===undefined){n=0}if(a===undefined){a=s.Easing.Linear.None}if(o===undefined){o=false}this.minParticleScale=1;this.maxParticleScale=1;this._minParticleScale.set(t,i);this._maxParticleScale.set(e,r);this.autoScale=false;if(n>0&&(t!==e||i!==r)){var h={x:t,y:i};var l=this.game.make.tween(h).to({x:e,y:r},n,a);l.yoyo(o);this.scaleData=l.generateData(60);this.scaleData.reverse();this.autoScale=true}return this};s.Particles.Arcade.Emitter.prototype.at=function(t){if(t.center){this.emitX=t.center.x;this.emitY=t.center.y}else{this.emitX=t.world.x+t.anchor.x*t.width;this.emitY=t.world.y+t.anchor.y*t.height}return this};Object.defineProperty(s.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(t){this.area.width=t}});Object.defineProperty(s.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(t){this.area.height=t}});Object.defineProperty(s.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(t){this.emitX=t}});Object.defineProperty(s.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(t){this.emitY=t}});Object.defineProperty(s.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}});Object.defineProperty(s.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}});Object.defineProperty(s.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}});Object.defineProperty(s.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Weapon=function(t,e){s.Plugin.call(this,t,e);this.bullets=null;this.autoExpandBulletsGroup=false;this.autofire=false;this.shots=0;this.fireLimit=0;this.fireRate=100;this.fireRateVariance=0;this.fireFrom=new s.Rectangle(0,0,1,1);this.fireAngle=s.ANGLE_UP;this.bulletInheritSpriteSpeed=false;this.bulletAnimation="";this.bulletFrameRandom=false;this.bulletFrameCycle=false;this.bulletWorldWrap=false;this.bulletWorldWrapPadding=0;this.bulletAngleOffset=0;this.bulletAngleVariance=0;this.bulletSpeed=200;this.bulletSpeedVariance=0;this.bulletLifespan=0;this.bulletKillDistance=0;this.bulletGravity=new s.Point(0,0);this.bulletRotateToVelocity=false;this.bulletKey="";this.bulletFrame="";this._bulletClass=s.Bullet;this._bulletCollideWorldBounds=false;this._bulletKillType=s.Weapon.KILL_WORLD_BOUNDS;this._data={customBody:false,width:0,height:0,offsetX:0,offsetY:0};this.bounds=new s.Rectangle;this.bulletBounds=t.world.bounds;this.bulletFrames=[];this.bulletFrameIndex=0;this.anims={};this.onFire=new s.Signal;this.onKill=new s.Signal;this.onFireLimit=new s.Signal;this.trackedSprite=null;this.trackedPointer=null;this.trackRotation=false;this.trackOffset=new s.Point;this._nextFire=0;this._rotatedPoint=new s.Point};s.Weapon.prototype=Object.create(s.Plugin.prototype);s.Weapon.prototype.constructor=s.Weapon;s.Weapon.KILL_NEVER=0;s.Weapon.KILL_LIFESPAN=1;s.Weapon.KILL_DISTANCE=2;s.Weapon.KILL_WEAPON_BOUNDS=3;s.Weapon.KILL_CAMERA_BOUNDS=4;s.Weapon.KILL_WORLD_BOUNDS=5;s.Weapon.KILL_STATIC_BOUNDS=6;s.Weapon.prototype.createBullets=function(t,e,i,r){if(t===undefined){t=1}if(r===undefined){r=this.game.world}if(!this.bullets){this.bullets=this.game.add.physicsGroup(s.Physics.ARCADE,r);this.bullets.classType=this._bulletClass}if(t!==0){if(t===-1){this.autoExpandBulletsGroup=true;t=1}this.bullets.createMultiple(t,e,i);this.bullets.setAll("data.bulletManager",this);this.bulletKey=e;this.bulletFrame=i}return this};s.Weapon.prototype.forEach=function(t,e){this.bullets.forEachExists(t,e,arguments);return this};s.Weapon.prototype.pauseAll=function(){this.bullets.setAll("body.enable",false);return this};s.Weapon.prototype.resumeAll=function(){this.bullets.setAll("body.enable",true);return this};s.Weapon.prototype.killAll=function(){this.bullets.callAllExists("kill",true);this.bullets.setAll("body.enable",true);return this};s.Weapon.prototype.resetShots=function(t){this.shots=0;if(t!==undefined){this.fireLimit=t}return this};s.Weapon.prototype.destroy=function(){this.parent.remove(this,false);this.bullets.destroy();this.game=null;this.parent=null;this.active=false;this.visible=false};s.Weapon.prototype.update=function(){if(this._bulletKillType===s.Weapon.KILL_WEAPON_BOUNDS){if(this.trackedSprite){this.trackedSprite.updateTransform();this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)}else if(this.trackedPointer){this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)}}if(this.autofire){this.fire()}};s.Weapon.prototype.trackSprite=function(t,e,i,r){if(e===undefined){e=0}if(i===undefined){i=0}if(r===undefined){r=false}this.trackedPointer=null;this.trackedSprite=t;this.trackRotation=r;this.trackOffset.set(e,i);return this};s.Weapon.prototype.trackPointer=function(t,e,i){if(t===undefined){t=this.game.input.activePointer}if(e===undefined){e=0}if(i===undefined){i=0}this.trackedPointer=t;this.trackedSprite=null;this.trackRotation=false;this.trackOffset.set(e,i);return this};s.Weapon.prototype.fire=function(t,e,i){if(this.game.time.now<this._nextFire||this.fireLimit>0&&this.shots===this.fireLimit){return false}var r=this.bulletSpeed;if(this.bulletSpeedVariance!==0){r+=s.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)}if(t){if(this.fireFrom.width>1){this.fireFrom.centerOn(t.x,t.y)}else{this.fireFrom.x=t.x;this.fireFrom.y=t.y}}else if(this.trackedSprite){if(this.trackRotation){this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y);this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.rotation);if(this.fireFrom.width>1){this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y)}else{this.fireFrom.x=this._rotatedPoint.x;this.fireFrom.y=this._rotatedPoint.y}}else{if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y}}if(this.bulletInheritSpriteSpeed){r+=this.trackedSprite.body.speed}}else if(this.trackedPointer){if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y}}var n=this.fireFrom.width>1?this.fireFrom.randomX:this.fireFrom.x;var a=this.fireFrom.height>1?this.fireFrom.randomY:this.fireFrom.y;var o=this.trackRotation?this.trackedSprite.angle:this.fireAngle;if(e!==undefined&&i!==undefined){o=this.game.math.radToDeg(Math.atan2(i-a,e-n))}if(this.bulletAngleVariance!==0){o+=s.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance)}var h=0;var l=0;if(o===0||o===180){h=Math.cos(this.game.math.degToRad(o))*r}else if(o===90||o===270){l=Math.sin(this.game.math.degToRad(o))*r}else{h=Math.cos(this.game.math.degToRad(o))*r;l=Math.sin(this.game.math.degToRad(o))*r}var u=null;if(this.autoExpandBulletsGroup){u=this.bullets.getFirstExists(false,true,n,a,this.bulletKey,this.bulletFrame);u.data.bulletManager=this}else{u=this.bullets.getFirstExists(false)}if(u){u.reset(n,a);u.data.fromX=n;u.data.fromY=a;u.data.killType=this.bulletKillType;u.data.killDistance=this.bulletKillDistance;u.data.rotateToVelocity=this.bulletRotateToVelocity;if(this.bulletKillType===s.Weapon.KILL_LIFESPAN){u.lifespan=this.bulletLifespan}u.angle=o+this.bulletAngleOffset;if(this.bulletAnimation!==""){if(u.animations.getAnimation(this.bulletAnimation)===null){var c=this.anims[this.bulletAnimation];u.animations.add(c.name,c.frames,c.frameRate,c.loop,c.useNumericIndex)}u.animations.play(this.bulletAnimation)}else{if(this.bulletFrameCycle){u.frame=this.bulletFrames[this.bulletFrameIndex];this.bulletFrameIndex++;if(this.bulletFrameIndex>=this.bulletFrames.length){this.bulletFrameIndex=0}}else if(this.bulletFrameRandom){u.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]}}if(u.data.bodyDirty){if(this._data.customBody){u.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY)}u.body.collideWorldBounds=this.bulletCollideWorldBounds;u.data.bodyDirty=false}u.body.velocity.set(h,l);u.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y);if(this.bulletSpeedVariance!==0){var f=this.fireRate;f+=s.Math.between(-this.fireRateVariance,this.fireRateVariance);if(f<0){f=0}this._nextFire=this.game.time.now+f}else{this._nextFire=this.game.time.now+this.fireRate}this.shots++;this.onFire.dispatch(u,this,r);if(this.fireLimit>0&&this.shots===this.fireLimit){this.onFireLimit.dispatch(this,this.fireLimit)}}return u};s.Weapon.prototype.fireAtPointer=function(t){if(t===undefined){t=this.game.input.activePointer}return this.fire(null,t.worldX,t.worldY)};s.Weapon.prototype.fireAtSprite=function(t){return this.fire(null,t.world.x,t.world.y)};s.Weapon.prototype.fireAtXY=function(t,e){return this.fire(null,t,e)};s.Weapon.prototype.setBulletBodyOffset=function(t,e,i,r){if(i===undefined){i=0}if(r===undefined){r=0}this._data.customBody=true;this._data.width=t;this._data.height=e;this._data.offsetX=i;this._data.offsetY=r;this.bullets.callAll("body.setSize","body",t,e,i,r);this.bullets.setAll("data.bodyDirty",false);return this};s.Weapon.prototype.setBulletFrames=function(t,e,i,r){if(i===undefined){i=true}if(r===undefined){r=false}this.bulletFrames=s.ArrayUtils.numberArray(t,e);this.bulletFrameIndex=0;this.bulletFrameCycle=i;this.bulletFrameRandom=r;return this};s.Weapon.prototype.addBulletAnimation=function(t,e,i,r,s){this.anims[t]={name:t,frames:e,frameRate:i,loop:r,useNumericIndex:s};this.bullets.callAll("animations.add","animations",t,e,i,r,s);this.bulletAnimation=t;return this};s.Weapon.prototype.debug=function(t,e,i){if(t===undefined){t=16}if(e===undefined){e=32}if(i===undefined){i=false}this.game.debug.text("Weapon Plugin",t,e);this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,t,e+24);if(i){this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")}};Object.defineProperty(s.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(t){this._bulletClass=t;this.bullets.classType=this._bulletClass}});Object.defineProperty(s.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(t){switch(t){case s.Weapon.KILL_STATIC_BOUNDS:case s.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case s.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case s.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds;break}this._bulletKillType=t}});Object.defineProperty(s.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(t){this._bulletCollideWorldBounds=t;this.bullets.setAll("body.collideWorldBounds",t);this.bullets.setAll("data.bodyDirty",false)}});Object.defineProperty(s.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(t){this.fireFrom.x=t}});Object.defineProperty(s.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(t){this.fireFrom.y=t}});/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Bullet=function(t,e,i,r,n){s.Sprite.call(this,t,e,i,r,n);this.anchor.set(.5);this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:true,rotateToVelocity:false,killType:0,killDistance:0}};s.Bullet.prototype=Object.create(s.Sprite.prototype);s.Bullet.prototype.constructor=s.Bullet;s.Bullet.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;this.data.bulletManager.onKill.dispatch(this);return this};s.Bullet.prototype.update=function(){if(!this.exists){return}if(this.data.killType>s.Weapon.KILL_LIFESPAN){if(this.data.killType===s.Weapon.KILL_DISTANCE){if(this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,true)>this.data.killDistance){this.kill()}}else{if(!this.data.bulletManager.bulletBounds.intersects(this)){this.kill()}}}if(this.data.rotateToVelocity){this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)}if(this.data.bulletManager.bulletWorldWrap){this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding)}};/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
s.Video=function(t,e,i){if(e===undefined){e=null}if(i===undefined){i=null}this.game=t;this.key=e;this.width=0;this.height=0;this.type=s.VIDEO;this.disableTextureUpload=false;this.touchLocked=false;this.onPlay=new s.Signal;this.onChangeSource=new s.Signal;this.onComplete=new s.Signal;this.onAccess=new s.Signal;this.onError=new s.Signal;this.onTimeout=new s.Signal;this.timeout=15e3;this._timeOutID=null;this.video=null;this.videoStream=null;this.isStreaming=false;this.retryLimit=20;this.retry=0;this.retryInterval=500;this._retryID=null;this._codeMuted=false;this._muted=false;this._codePaused=false;this._paused=false;this._pending=false;this._autoplay=false;this._endCallback=null;this._playCallback=null;if(e&&this.game.cache.checkVideoKey(e)){var r=this.game.cache.getVideo(e);if(r.isBlob){this.createVideoFromBlob(r.data)}else{this.video=r.data}this.width=this.video.videoWidth;this.height=this.video.videoHeight}else if(i){this.createVideoFromURL(i,false)}if(this.video&&!i){this.baseTexture=new PIXI.BaseTexture(this.video);this.baseTexture.forceLoaded(this.width,this.height)}else{this.baseTexture=new PIXI.BaseTexture(s.Cache.DEFAULT.baseTexture.source);this.baseTexture.forceLoaded(this.width,this.height)}this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new s.Frame(0,0,0,this.width,this.height,"video");this.texture.setFrame(this.textureFrame);this.texture.valid=false;if(e!==null&&this.video){this.texture.valid=this.video.canplay}this.snapshot=null;if(s.BitmapData){this.snapshot=new s.BitmapData(this.game,"",this.width,this.height)}if(!this.game.device.cocoonJS&&(this.game.device.iOS||this.game.device.android)||window["PhaserGlobal"]&&window["PhaserGlobal"].fakeiOSTouchLock){this.setTouchLock()}else{if(r){r.locked=false}}};s.Video.prototype={connectToMediaStream:function(t,e){if(t&&e){this.video=t;this.videoStream=e;this.isStreaming=true;this.baseTexture.source=this.video;this.updateTexture(null,this.video.videoWidth,this.video.videoHeight);this.onAccess.dispatch(this)}return this},startMediaStream:function(t,e,i){if(t===undefined){t=false}if(e===undefined){e=null}if(i===undefined){i=null}if(!this.game.device.getUserMedia){this.onError.dispatch(this,"No getUserMedia");return false}if(this.videoStream!==null){if(this.videoStream["active"]){this.videoStream.active=false}else{this.videoStream.stop()}}this.removeVideoElement();this.video=document.createElement("video");this.video.setAttribute("autoplay","autoplay");if(e!==null){this.video.width=e}if(i!==null){this.video.height=i}this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:t,video:true},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(t){this.getUserMediaError(t)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID);this.onTimeout.dispatch(this)},getUserMediaError:function(t){clearTimeout(this._timeOutID);this.onError.dispatch(this,t)},getUserMediaSuccess:function(t){clearTimeout(this._timeOutID);this.videoStream=t;if(this.video.mozSrcObject!==undefined){this.video.mozSrcObject=t}else{this.video.src=window.URL&&window.URL.createObjectURL(t)||t}var e=this;this.video.onloadeddata=function(){var t=10;function i(){if(t>0){if(e.video.videoWidth>0){var r=e.video.videoWidth;var s=e.video.videoHeight;if(isNaN(e.video.videoHeight)){s=r/(4/3)}e.video.play();e.isStreaming=true;e.baseTexture.source=e.video;e.updateTexture(null,r,s);e.onAccess.dispatch(e)}else{window.setTimeout(i,500)}}else{console.warn("Unable to connect to video stream. Webcam error?")}t--}i()}},createVideoFromBlob:function(t){var e=this;this.video=document.createElement("video");this.video.controls=false;this.video.setAttribute("autoplay","autoplay");this.video.addEventListener("loadeddata",function(t){e.updateTexture(t)},true);this.video.src=window.URL.createObjectURL(t);this.video.canplay=true;return this},createVideoFromURL:function(t,e){if(e===undefined){e=false}if(this.texture){this.texture.valid=false}this.video=document.createElement("video");this.video.controls=false;if(e){this.video.setAttribute("autoplay","autoplay")}this.video.src=t;this.video.canplay=true;this.video.load();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.key=t;return this},updateTexture:function(t,e,i){var r=false;if(e===undefined||e===null){e=this.video.videoWidth;r=true}if(i===undefined||i===null){i=this.video.videoHeight}this.width=e;this.height=i;if(this.baseTexture.source!==this.video){this.baseTexture.source=this.video}this.baseTexture.forceLoaded(e,i);this.texture.frame.resize(e,i);this.texture.width=e;this.texture.height=i;this.texture.valid=true;if(this.snapshot){this.snapshot.resize(e,i)}if(r&&this.key!==null){this.onChangeSource.dispatch(this,e,i);if(this._autoplay){this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate)}}},complete:function(){this.onComplete.dispatch(this)},play:function(t,e){if(t===undefined){t=false}if(e===undefined){e=1}if(this.game.sound.onMute){this.game.sound.onMute.add(this.setMute,this);this.game.sound.onUnMute.add(this.unsetMute,this);if(this.game.sound.mute){this.setMute()}}this.game.onPause.add(this.setPause,this);this.game.onResume.add(this.setResume,this);this._endCallback=this.complete.bind(this);this.video.addEventListener("ended",this._endCallback,true);this.video.addEventListener("webkitendfullscreen",this._endCallback,true);if(t){this.video.loop="loop"}else{this.video.loop=""}this.video.playbackRate=e;if(this.touchLocked){this._pending=true}else{this._pending=false;if(this.key!==null){if(this.video.readyState!==4){this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{this._playCallback=this.playHandler.bind(this);this.video.addEventListener("playing",this._playCallback,true)}}this.video.play();this.onPlay.dispatch(this,t,e)}return this},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,true);this.updateTexture()},stop:function(){if(this.game.sound.onMute){this.game.sound.onMute.remove(this.setMute,this);this.game.sound.onUnMute.remove(this.unsetMute,this)}this.game.onPause.remove(this.setPause,this);this.game.onResume.remove(this.setResume,this);if(this.isStreaming){if(this.video.mozSrcObject){this.video.mozSrcObject.stop();this.video.src=null}else{this.video.src="";if(this.videoStream["active"]){this.videoStream.active=false}else{if(this.videoStream.getTracks){this.videoStream.getTracks().forEach(function(t){t.stop()})}else{this.videoStream.stop()}}}this.videoStream=null;this.isStreaming=false}else{this.video.removeEventListener("ended",this._endCallback,true);this.video.removeEventListener("webkitendfullscreen",this._endCallback,true);this.video.removeEventListener("playing",this._playCallback,true);if(this.touchLocked){this._pending=false}else{this.video.pause()}}return this},add:function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){if(t[e]["loadTexture"]){t[e].loadTexture(this)}}}else{t.loadTexture(this)}return this},addToWorld:function(t,e,i,r,s,n){s=s||1;n=n||1;var a=this.game.add.image(t,e,this);a.anchor.set(i,r);a.scale.set(s,n);return a},render:function(){if(!this.disableTextureUpload&&this.playing){this.baseTexture.dirty()}},setMute:function(){if(this._muted){return}this._muted=true;this.video.muted=true},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;this.video.muted=false},setPause:function(){if(this._paused||this.touchLocked){return}this._paused=true;this.video.pause()},setResume:function(){if(!this._paused||this._codePaused||this.touchLocked){return}this._paused=false;if(!this.video.ended){this.video.play()}},changeSource:function(t,e){if(e===undefined){e=true}this.texture.valid=false;this.video.pause();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.video.src=t;this.video.load();this._autoplay=e;if(!e){this.paused=true}return this},checkVideoProgress:function(){if(this.video.readyState===4){this.updateTexture()}else{this.retry--;if(this.retry>0){this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming)}}},setTouchLock:function(){this.game.input.touch.addTouchLockCallback(this.unlock,this);this.touchLocked=true},unlock:function(){this.touchLocked=false;this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate);if(this.key){var t=this.game.cache.getVideo(this.key);if(t&&!t.isBlob){t.locked=false}}return true},grab:function(t,e,i){if(t===undefined){t=false}if(e===undefined){e=1}if(i===undefined){i=null}if(this.snapshot===null){console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable");return}if(t){this.snapshot.cls()}this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,e,i);return this.snapshot},removeVideoElement:function(){if(!this.video){return}if(this.video.parentNode){this.video.parentNode.removeChild(this.video)}while(this.video.hasChildNodes()){this.video.removeChild(this.video.firstChild)}this.video.removeAttribute("autoplay");this.video.removeAttribute("src");this.video=null},destroy:function(){this.stop();this.removeVideoElement();if(this.touchLocked){this.game.input.touch.removeTouchLockCallback(this.unlock,this)}if(this._retryID){window.clearTimeout(this._retryID)}}};Object.defineProperty(s.Video.prototype,"currentTime",{get:function(){return this.video?this.video.currentTime:0},set:function(t){this.video.currentTime=t}});Object.defineProperty(s.Video.prototype,"duration",{get:function(){return this.video?this.video.duration:0}});Object.defineProperty(s.Video.prototype,"progress",{get:function(){return this.video?this.video.currentTime/this.video.duration:0}});Object.defineProperty(s.Video.prototype,"mute",{get:function(){return this._muted},set:function(t){t=t||null;if(t){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(s.Video.prototype,"paused",{get:function(){return this._paused},set:function(t){t=t||null;if(this.touchLocked){return}if(t){if(this._paused){return}this._codePaused=true;this.setPause()}else{if(!this._paused){return}this._codePaused=false;this.setResume()}}});Object.defineProperty(s.Video.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(t){if(t<0){t=0}else if(t>1){t=1}if(this.video){this.video.volume=t}}});Object.defineProperty(s.Video.prototype,"playbackRate",{get:function(){return this.video?this.video.playbackRate:1},set:function(t){if(this.video){this.video.playbackRate=t}}});Object.defineProperty(s.Video.prototype,"loop",{get:function(){return this.video?this.video.loop:false},set:function(t){if(t&&this.video){this.video.loop="loop"}else if(this.video){this.video.loop=""}}});Object.defineProperty(s.Video.prototype,"playing",{get:function(){return!(this.video.paused&&this.video.ended)}});s.Video.prototype.constructor=s.Video;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
if(PIXI.blendModes===undefined){PIXI.blendModes=s.blendModes}if(PIXI.scaleModes===undefined){PIXI.scaleModes=s.scaleModes}if(PIXI.Texture.emptyTexture===undefined){PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture)}if(PIXI.DisplayObject._tempMatrix===undefined){PIXI.DisplayObject._tempMatrix=new PIXI.Matrix}if(PIXI.RenderTexture.tempMatrix===undefined){PIXI.RenderTexture.tempMatrix=new PIXI.Matrix}if(PIXI.Graphics&&PIXI.Graphics.POLY===undefined){PIXI.Graphics.POLY=s.POLYGON;PIXI.Graphics.RECT=s.RECTANGLE;PIXI.Graphics.CIRC=s.CIRCLE;PIXI.Graphics.ELIP=s.ELLIPSE;PIXI.Graphics.RREC=s.ROUNDEDRECTANGLE}PIXI.TextureSilentFail=true;/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2016 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
if(true){if(typeof t!=="undefined"&&t.exports){e=t.exports=s}e.Phaser=s}else if(typeof define!=="undefined"&&define.amd){define("Phaser",function(){return r.Phaser=s}())}else{r.Phaser=s}return s}).call(this)}).call(e,i(7))},function(t,e,i){(function(t,r){var s;(function(){var n;var a="4.13.1";var o=200;var h="Expected a function";var l="__lodash_hash_undefined__";var u="__lodash_placeholder__";var c=1,f=2,d=4,p=8,g=16,v=32,m=64,y=128,x=256,b=512;var w=1,_=2;var P=30,T="...";var C=150,S=16;var A=1,E=2,I=3;var M=1/0,R=9007199254740991,B=1.7976931348623157e308,L=0/0;var k=4294967295,O=k-1,F=k>>>1;var D="[object Arguments]",U="[object Array]",G="[object Boolean]",N="[object Date]",X="[object Error]",j="[object Function]",W="[object GeneratorFunction]",z="[object Map]",V="[object Number]",q="[object Object]",H="[object Promise]",Y="[object RegExp]",K="[object Set]",$="[object String]",J="[object Symbol]",Z="[object WeakMap]",Q="[object WeakSet]";var tt="[object ArrayBuffer]",et="[object DataView]",it="[object Float32Array]",rt="[object Float64Array]",st="[object Int8Array]",nt="[object Int16Array]",at="[object Int32Array]",ot="[object Uint8Array]",ht="[object Uint8ClampedArray]",lt="[object Uint16Array]",ut="[object Uint32Array]";var ct=/\b__p \+= '';/g,ft=/\b(__p \+=) '' \+/g,dt=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var pt=/&(?:amp|lt|gt|quot|#39|#96);/g,gt=/[&<>"'`]/g,vt=RegExp(pt.source),mt=RegExp(gt.source);var yt=/<%-([\s\S]+?)%>/g,xt=/<%([\s\S]+?)%>/g,bt=/<%=([\s\S]+?)%>/g;var wt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,_t=/^\w*$/,Pt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g;var Tt=/[\\^$.*+?()[\]{}|]/g,Ct=RegExp(Tt.source);var St=/^\s+|\s+$/g,At=/^\s+/,Et=/\s+$/;var It=/[a-zA-Z0-9]+/g;var Mt=/\\(\\)?/g;var Rt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var Bt=/\w*$/;var Lt=/^0x/i;var kt=/^[-+]0x[0-9a-f]+$/i;var Ot=/^0b[01]+$/i;var Ft=/^\[object .+?Constructor\]$/;var Dt=/^0o[0-7]+$/i;var Ut=/^(?:0|[1-9]\d*)$/;var Gt=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g;var Nt=/($^)/;var Xt=/['\n\r\u2028\u2029\\]/g;var jt="\\ud800-\\udfff",Wt="\\u0300-\\u036f\\ufe20-\\ufe23",zt="\\u20d0-\\u20f0",Vt="\\u2700-\\u27bf",qt="a-z\\xdf-\\xf6\\xf8-\\xff",Ht="\\xac\\xb1\\xd7\\xf7",Yt="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Kt="\\u2000-\\u206f",$t=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Jt="A-Z\\xc0-\\xd6\\xd8-\\xde",Zt="\\ufe0e\\ufe0f",Qt=Ht+Yt+Kt+$t;var te="['’]",ee="["+jt+"]",ie="["+Qt+"]",re="["+Wt+zt+"]",se="\\d+",ne="["+Vt+"]",ae="["+qt+"]",oe="[^"+jt+Qt+se+Vt+qt+Jt+"]",he="\\ud83c[\\udffb-\\udfff]",le="(?:"+re+"|"+he+")",ue="[^"+jt+"]",ce="(?:\\ud83c[\\udde6-\\uddff]){2}",fe="[\\ud800-\\udbff][\\udc00-\\udfff]",de="["+Jt+"]",pe="\\u200d";var ge="(?:"+ae+"|"+oe+")",ve="(?:"+de+"|"+oe+")",me="(?:"+te+"(?:d|ll|m|re|s|t|ve))?",ye="(?:"+te+"(?:D|LL|M|RE|S|T|VE))?",xe=le+"?",be="["+Zt+"]?",we="(?:"+pe+"(?:"+[ue,ce,fe].join("|")+")"+be+xe+")*",_e=be+xe+we,Pe="(?:"+[ne,ce,fe].join("|")+")"+_e,Te="(?:"+[ue+re+"?",re,ce,fe,ee].join("|")+")";var Ce=RegExp(te,"g");var Se=RegExp(re,"g");var Ae=RegExp(he+"(?="+he+")|"+Te+_e,"g");var Ee=RegExp([de+"?"+ae+"+"+me+"(?="+[ie,de,"$"].join("|")+")",ve+"+"+ye+"(?="+[ie,de+ge,"$"].join("|")+")",de+"?"+ge+"+"+me,de+"+"+ye,se,Pe].join("|"),"g");var Ie=RegExp("["+pe+jt+Wt+zt+Zt+"]");var Me=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var Re=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","Reflect","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","isFinite","parseInt","setTimeout"];var Be=-1;var Le={};Le[it]=Le[rt]=Le[st]=Le[nt]=Le[at]=Le[ot]=Le[ht]=Le[lt]=Le[ut]=true;Le[D]=Le[U]=Le[tt]=Le[G]=Le[et]=Le[N]=Le[X]=Le[j]=Le[z]=Le[V]=Le[q]=Le[Y]=Le[K]=Le[$]=Le[Z]=false;var ke={};ke[D]=ke[U]=ke[tt]=ke[et]=ke[G]=ke[N]=ke[it]=ke[rt]=ke[st]=ke[nt]=ke[at]=ke[z]=ke[V]=ke[q]=ke[Y]=ke[K]=ke[$]=ke[J]=ke[ot]=ke[ht]=ke[lt]=ke[ut]=true;ke[X]=ke[j]=ke[Z]=false;var Oe={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"};var Fe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};var De={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"};var Ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var Ge=parseFloat,Ne=parseInt;var Xe=typeof e=="object"&&e;var je=Xe&&typeof t=="object"&&t;var We=je&&je.exports===Xe;var ze=Ti(typeof r=="object"&&r);var Ve=Ti(typeof self=="object"&&self);var qe=Ti(typeof this=="object"&&this);var He=ze||Ve||qe||Function("return this")();function Ye(t,e){t.set(e[0],e[1]);return t}function Ke(t,e){t.add(e);return t}function $e(t,e,i){var r=i.length;switch(r){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}function Je(t,e,i,r){var s=-1,n=t?t.length:0;while(++s<n){var a=t[s];e(r,a,i(a),t)}return r}function Ze(t,e){var i=-1,r=t?t.length:0;while(++i<r){if(e(t[i],i,t)===false){break}}return t}function Qe(t,e){var i=t?t.length:0;while(i--){if(e(t[i],i,t)===false){break}}return t}function ti(t,e){var i=-1,r=t?t.length:0;while(++i<r){if(!e(t[i],i,t)){return false}}return true}function ei(t,e){var i=-1,r=t?t.length:0,s=0,n=[];while(++i<r){var a=t[i];if(e(a,i,t)){n[s++]=a}}return n}function ii(t,e){var i=t?t.length:0;return!!i&&ci(t,e,0)>-1}function ri(t,e,i){var r=-1,s=t?t.length:0;while(++r<s){if(i(e,t[r])){return true}}return false}function si(t,e){var i=-1,r=t?t.length:0,s=Array(r);while(++i<r){s[i]=e(t[i],i,t)}return s}function ni(t,e){var i=-1,r=e.length,s=t.length;while(++i<r){t[s+i]=e[i]}return t}function ai(t,e,i,r){var s=-1,n=t?t.length:0;if(r&&n){i=t[++s]}while(++s<n){i=e(i,t[s],s,t)}return i}function oi(t,e,i,r){var s=t?t.length:0;if(r&&s){i=t[--s]}while(s--){i=e(i,t[s],s,t)}return i}function hi(t,e){var i=-1,r=t?t.length:0;while(++i<r){if(e(t[i],i,t)){return true}}return false}function li(t,e,i){var r;i(t,function(t,i,s){if(e(t,i,s)){r=i;return false}});return r}function ui(t,e,i,r){var s=t.length,n=i+(r?1:-1);while(r?n--:++n<s){if(e(t[n],n,t)){return n}}return-1}function ci(t,e,i){if(e!==e){return Mi(t,i)}var r=i-1,s=t.length;while(++r<s){if(t[r]===e){return r}}return-1}function fi(t,e,i,r){var s=i-1,n=t.length;while(++s<n){if(r(t[s],e)){return s}}return-1}function di(t,e){var i=t?t.length:0;return i?vi(t,e)/i:L}function pi(t,e,i,r,s){s(t,function(t,s,n){i=r?(r=false,t):e(i,t,s,n)});return i}function gi(t,e){var i=t.length;t.sort(e);while(i--){t[i]=t[i].value}return t}function vi(t,e){var i,r=-1,s=t.length;while(++r<s){var a=e(t[r]);if(a!==n){i=i===n?a:i+a}}return i}function mi(t,e){var i=-1,r=Array(t);while(++i<t){r[i]=e(i)}return r}function yi(t,e){return si(e,function(e){return[e,t[e]]})}function xi(t){return function(e){return t(e)}}function bi(t,e){return si(e,function(e){return t[e]})}function wi(t,e){return t.has(e)}function _i(t,e){var i=-1,r=t.length;while(++i<r&&ci(e,t[i],0)>-1){}return i}function Pi(t,e){var i=t.length;while(i--&&ci(e,t[i],0)>-1){}return i}function Ti(t){return t&&t.Object===Object?t:null}function Ci(t,e){var i=t.length,r=0;while(i--){if(t[i]===e){r++}}return r}function Si(t){return Oe[t]}function Ai(t){return Fe[t]}function Ei(t){return"\\"+Ue[t]}function Ii(t,e){return t==null?n:t[e]}function Mi(t,e,i){var r=t.length,s=e+(i?1:-1);while(i?s--:++s<r){var n=t[s];if(n!==n){return s}}return-1}function Ri(t){var e=false;if(t!=null&&typeof t.toString!="function"){try{e=!!(t+"")}catch(t){}}return e}function Bi(t){var e,i=[];while(!(e=t.next()).done){i.push(e.value)}return i}function Li(t){var e=-1,i=Array(t.size);t.forEach(function(t,r){i[++e]=[r,t]});return i}function ki(t,e){var i=-1,r=t.length,s=0,n=[];while(++i<r){var a=t[i];if(a===e||a===u){t[i]=u;n[s++]=i}}return n}function Oi(t){var e=-1,i=Array(t.size);t.forEach(function(t){i[++e]=t});return i}function Fi(t){var e=-1,i=Array(t.size);t.forEach(function(t){i[++e]=[t,t]});return i}function Di(t){if(!(t&&Ie.test(t))){return t.length}var e=Ae.lastIndex=0;while(Ae.test(t)){e++}return e}function Ui(t){return t.match(Ae)}function Gi(t){return De[t]}function Ni(t){t=t?Xi.defaults({},t,Xi.pick(He,Re)):He;var e=t.Date,i=t.Error,r=t.Math,s=t.RegExp,jt=t.TypeError;var Wt=t.Array.prototype,zt=t.Object.prototype,Vt=t.String.prototype;var qt=t["__core-js_shared__"];var Ht=function(){var t=/[^.]+$/.exec(qt&&qt.keys&&qt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Yt=t.Function.prototype.toString;var Kt=zt.hasOwnProperty;var $t=0;var Jt=Yt.call(Object);var Zt=zt.toString;var Qt=He._;var te=s("^"+Yt.call(Kt).replace(Tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ee=We?t.Buffer:n,ie=t.Reflect,re=t.Symbol,se=t.Uint8Array,ne=ie?ie.enumerate:n,ae=Object.getOwnPropertySymbols,oe=typeof(oe=re&&re.iterator)=="symbol"?oe:n,he=Object.create,le=zt.propertyIsEnumerable,ue=Wt.splice;var ce=function(e,i){return t.setTimeout.call(He,e,i)};var fe=r.ceil,de=r.floor,pe=Object.getPrototypeOf,ge=t.isFinite,ve=Wt.join,me=Object.keys,ye=r.max,xe=r.min,be=t.parseInt,we=r.random,_e=Vt.replace,Pe=Wt.reverse,Te=Vt.split;var Ae=$n(t,"DataView"),Oe=$n(t,"Map"),Fe=$n(t,"Promise"),De=$n(t,"Set"),Ue=$n(t,"WeakMap"),Xe=$n(Object,"create");var je=Ue&&new Ue;var ze=!le.call({valueOf:1},"valueOf");var Ve={};var qe=Sa(Ae),Ti=Sa(Oe),ji=Sa(Fe),Wi=Sa(De),zi=Sa(Ue);var Vi=re?re.prototype:n,qi=Vi?Vi.valueOf:n,Hi=Vi?Vi.toString:n;function Yi(t){if(yl(t)&&!el(t)&&!(t instanceof Ji)){if(t instanceof $i){return t}if(Kt.call(t,"__wrapped__")){return Aa(t)}}return new $i(t)}function Ki(){}function $i(t,e){this.__wrapped__=t;this.__actions__=[];this.__chain__=!!e;this.__index__=0;this.__values__=n}Yi.templateSettings={escape:yt,evaluate:xt,interpolate:bt,variable:"",imports:{_:Yi}};Yi.prototype=Ki.prototype;Yi.prototype.constructor=Yi;$i.prototype=Ur(Ki.prototype);$i.prototype.constructor=$i;function Ji(t){this.__wrapped__=t;this.__actions__=[];this.__dir__=1;this.__filtered__=false;this.__iteratees__=[];this.__takeCount__=k;this.__views__=[]}function Zi(){var t=new Ji(this.__wrapped__);t.__actions__=cn(this.__actions__);t.__dir__=this.__dir__;t.__filtered__=this.__filtered__;t.__iteratees__=cn(this.__iteratees__);t.__takeCount__=this.__takeCount__;t.__views__=cn(this.__views__);return t}function Qi(){if(this.__filtered__){var t=new Ji(this);t.__dir__=-1;t.__filtered__=true}else{t=this.clone();t.__dir__*=-1}return t}function tr(){var t=this.__wrapped__.value(),e=this.__dir__,i=el(t),r=e<0,s=i?t.length:0,n=ea(0,s,this.__views__),a=n.start,h=n.end,l=h-a,u=r?h:a-1,c=this.__iteratees__,f=c.length,d=0,p=xe(l,this.__takeCount__);if(!i||s<o||s==l&&p==l){return Vs(t,this.__actions__)}var g=[];t:while(l--&&d<p){u+=e;var v=-1,m=t[u];while(++v<f){var y=c[v],x=y.iteratee,b=y.type,w=x(m);if(b==E){m=w}else if(!w){if(b==A){continue t}else{break t}}}g[d++]=m}return g}Ji.prototype=Ur(Ki.prototype);Ji.prototype.constructor=Ji;function er(t){var e=-1,i=t?t.length:0;this.clear();while(++e<i){var r=t[e];this.set(r[0],r[1])}}function ir(){this.__data__=Xe?Xe(null):{}}function rr(t){return this.has(t)&&delete this.__data__[t]}function sr(t){var e=this.__data__;if(Xe){var i=e[t];return i===l?n:i}return Kt.call(e,t)?e[t]:n}function nr(t){var e=this.__data__;return Xe?e[t]!==n:Kt.call(e,t)}function ar(t,e){var i=this.__data__;i[t]=Xe&&e===n?l:e;return this}er.prototype.clear=ir;er.prototype["delete"]=rr;er.prototype.get=sr;er.prototype.has=nr;er.prototype.set=ar;function or(t){var e=-1,i=t?t.length:0;this.clear();while(++e<i){var r=t[e];this.set(r[0],r[1])}}function hr(){this.__data__=[]}function lr(t){var e=this.__data__,i=Rr(e,t);if(i<0){return false}var r=e.length-1;if(i==r){e.pop()}else{ue.call(e,i,1)}return true}function ur(t){var e=this.__data__,i=Rr(e,t);return i<0?n:e[i][1]}function cr(t){return Rr(this.__data__,t)>-1}function fr(t,e){var i=this.__data__,r=Rr(i,t);if(r<0){i.push([t,e])}else{i[r][1]=e}return this}or.prototype.clear=hr;or.prototype["delete"]=lr;or.prototype.get=ur;or.prototype.has=cr;or.prototype.set=fr;function dr(t){var e=-1,i=t?t.length:0;this.clear();while(++e<i){var r=t[e];this.set(r[0],r[1])}}function pr(){this.__data__={hash:new er,map:new(Oe||or),string:new er}}function gr(t){return Yn(this,t)["delete"](t)}function vr(t){return Yn(this,t).get(t)}function mr(t){return Yn(this,t).has(t)}function yr(t,e){Yn(this,t).set(t,e);return this}dr.prototype.clear=pr;dr.prototype["delete"]=gr;dr.prototype.get=vr;dr.prototype.has=mr;dr.prototype.set=yr;function xr(t){var e=-1,i=t?t.length:0;this.__data__=new dr;while(++e<i){this.add(t[e])}}function br(t){this.__data__.set(t,l);return this}function wr(t){return this.__data__.has(t)}xr.prototype.add=xr.prototype.push=br;xr.prototype.has=wr;function _r(t){this.__data__=new or(t)}function Pr(){this.__data__=new or}function Tr(t){return this.__data__["delete"](t)}function Cr(t){return this.__data__.get(t)}function Sr(t){return this.__data__.has(t)}function Ar(t,e){var i=this.__data__;if(i instanceof or&&i.__data__.length==o){i=this.__data__=new dr(i.__data__)}i.set(t,e);return this}_r.prototype.clear=Pr;_r.prototype["delete"]=Tr;_r.prototype.get=Cr;_r.prototype.has=Sr;_r.prototype.set=Ar;function Er(t,e,i,r){if(t===n||Jh(t,zt[i])&&!Kt.call(r,i)){return e}return t}function Ir(t,e,i){if(i!==n&&!Jh(t[e],i)||typeof e=="number"&&i===n&&!(e in t)){t[e]=i}}function Mr(t,e,i){var r=t[e];if(!(Kt.call(t,e)&&Jh(r,i))||i===n&&!(e in t)){t[e]=i}}function Rr(t,e){var i=t.length;while(i--){if(Jh(t[i][0],e)){return i}}return-1}function Br(t,e,i,r){Xr(t,function(t,s,n){e(r,t,i(t),n)});return r}function Lr(t,e){return t&&fn(e,gu(e),t)}function kr(t,e){var i=-1,r=t==null,s=e.length,a=Array(s);while(++i<s){a[i]=r?n:lu(t,e[i])}return a}function Or(t,e,i){if(t===t){if(i!==n){t=t<=i?t:i}if(e!==n){t=t>=e?t:e}}return t}function Fr(t,e,i,r,s,a,o){var h;if(r){h=a?r(t,s,a,o):r(t)}if(h!==n){return h}if(!ml(t)){return t}var l=el(t);if(l){h=ra(t);if(!e){return cn(t,h)}}else{var u=ta(t),c=u==j||u==W;if(al(t)){return Zs(t,e)}if(u==q||u==D||c&&!a){if(Ri(t)){return a?t:{}}h=sa(c?{}:t);if(!e){return dn(t,Lr(h,t))}}else{if(!ke[u]){return a?t:{}}h=na(t,u,Fr,e)}}o||(o=new _r);var f=o.get(t);if(f){return f}o.set(t,h);if(!l){var d=i?Xn(t):gu(t)}Ze(d||t,function(s,n){if(d){n=s;s=t[n]}Mr(h,n,Fr(s,e,i,r,n,t,o))});return h}function Dr(t){var e=gu(t),i=e.length;return function(r){if(r==null){return!i}var s=i;while(s--){var a=e[s],o=t[a],h=r[a];if(h===n&&!(a in Object(r))||!o(h)){return false}}return true}}function Ur(t){return ml(t)?he(t):{}}function Gr(t,e,i){if(typeof t!="function"){throw new jt(h)}return ce(function(){t.apply(n,i)},e)}function Nr(t,e,i,r){var s=-1,n=ii,a=true,h=t.length,l=[],u=e.length;if(!h){return l}if(i){e=si(e,xi(i))}if(r){n=ri;a=false}else if(e.length>=o){n=wi;a=false;e=new xr(e)}t:while(++s<h){var c=t[s],f=i?i(c):c;c=r||c!==0?c:0;if(a&&f===f){var d=u;while(d--){if(e[d]===f){continue t}}l.push(c)}else if(!n(e,f,r)){l.push(c)}}return l}var Xr=vn($r);var jr=vn(Jr,true);function Wr(t,e){var i=true;Xr(t,function(t,r,s){i=!!e(t,r,s);return i});return i}function zr(t,e,i){var r=-1,s=t.length;while(++r<s){var a=t[r],o=e(a);if(o!=null&&(h===n?o===o&&!Bl(o):i(o,h))){var h=o,l=a}}return l}function Vr(t,e,i,r){var s=t.length;i=Xl(i);if(i<0){i=-i>s?0:s+i}r=r===n||r>s?s:Xl(r);if(r<0){r+=s}r=i>r?0:jl(r);while(i<r){t[i++]=e}return t}function qr(t,e){var i=[];Xr(t,function(t,r,s){if(e(t,r,s)){i.push(t)}});return i}function Hr(t,e,i,r,s){var n=-1,a=t.length;i||(i=oa);s||(s=[]);while(++n<a){var o=t[n];if(e>0&&i(o)){if(e>1){Hr(o,e-1,i,r,s)}else{ni(s,o)}}else if(!r){s[s.length]=o}}return s}var Yr=mn();var Kr=mn(true);function $r(t,e){return t&&Yr(t,e,gu)}function Jr(t,e){return t&&Kr(t,e,gu)}function Zr(t,e){return ei(e,function(e){return pl(t[e])})}function Qr(t,e){e=ca(e,t)?[e]:$s(e);var i=0,r=e.length;while(t!=null&&i<r){t=t[Ca(e[i++])]}return i&&i==r?t:n}function ts(t,e,i){var r=e(t);return el(t)?r:ni(r,i(t))}function es(t,e){return t>e}function is(t,e){return t!=null&&(Kt.call(t,e)||typeof t=="object"&&e in t&&Jn(t)===null)}function rs(t,e){return t!=null&&e in Object(t)}function ss(t,e,i){return t>=xe(e,i)&&t<ye(e,i)}function ns(t,e,i){var r=i?ri:ii,s=t[0].length,a=t.length,o=a,h=Array(a),l=Infinity,u=[];while(o--){var c=t[o];if(o&&e){c=si(c,xi(e))}l=xe(c.length,l);h[o]=!i&&(e||s>=120&&c.length>=120)?new xr(o&&c):n}c=t[0];var f=-1,d=h[0];t:while(++f<s&&u.length<l){var p=c[f],g=e?e(p):p;p=i||p!==0?p:0;if(!(d?wi(d,g):r(u,g,i))){o=a;while(--o){var v=h[o];if(!(v?wi(v,g):r(t[o],g,i))){continue t}}if(d){d.push(g)}u.push(p)}}return u}function as(t,e,i,r){$r(t,function(t,s,n){e(r,i(t),s,n)});return r}function os(t,e,i){if(!ca(e,t)){e=$s(e);t=wa(t,e);e=Za(e)}var r=t==null?t:t[Ca(e)];return r==null?n:$e(r,t,i)}function hs(t,e,i,r,s){if(t===e){return true}if(t==null||e==null||!ml(t)&&!yl(e)){return t!==t&&e!==e}return ls(t,e,hs,i,r,s)}function ls(t,e,i,r,s,n){var a=el(t),o=el(e),h=U,l=U;if(!a){h=ta(t);h=h==D?q:h}if(!o){l=ta(e);l=l==D?q:l}var u=h==q&&!Ri(t),c=l==q&&!Ri(e),f=h==l;if(f&&!u){n||(n=new _r);return a||Ll(t)?Un(t,e,i,r,s,n):Gn(t,e,h,i,r,s,n)}if(!(s&_)){var d=u&&Kt.call(t,"__wrapped__"),p=c&&Kt.call(e,"__wrapped__");if(d||p){var g=d?t.value():t,v=p?e.value():e;n||(n=new _r);return i(g,v,r,s,n)}}if(!f){return false}n||(n=new _r);return Nn(t,e,i,r,s,n)}function us(t,e,i,r){var s=i.length,a=s,o=!r;if(t==null){return!a}t=Object(t);while(s--){var h=i[s];if(o&&h[2]?h[1]!==t[h[0]]:!(h[0]in t)){return false}}while(++s<a){h=i[s];var l=h[0],u=t[l],c=h[1];if(o&&h[2]){if(u===n&&!(l in t)){return false}}else{var f=new _r;if(r){var d=r(u,c,l,t,e,f)}if(!(d===n?hs(c,u,r,w|_,f):d)){return false}}}return true}function cs(t){if(!ml(t)||pa(t)){return false}var e=pl(t)||Ri(t)?te:Ft;return e.test(Sa(t))}function fs(t){if(typeof t=="function"){return t}if(t==null){return _c}if(typeof t=="object"){return el(t)?ys(t[0],t[1]):ms(t)}return Oc(t)}function ds(t){return me(Object(t))}function ps(t){t=t==null?t:Object(t);var e=[];for(var i in t){e.push(i)}return e}if(ne&&!le.call({valueOf:1},"valueOf")){ps=function(t){return Bi(ne(t))}}function gs(t,e){return t<e}function vs(t,e){var i=-1,r=rl(t)?Array(t.length):[];Xr(t,function(t,s,n){r[++i]=e(t,s,n)});return r}function ms(t){var e=Kn(t);if(e.length==1&&e[0][2]){return ya(e[0][0],e[0][1])}return function(i){return i===t||us(i,t,e)}}function ys(t,e){if(ca(t)&&ma(e)){return ya(Ca(t),e)}return function(i){var r=lu(i,t);return r===n&&r===e?cu(i,t):hs(e,r,n,w|_)}}function xs(t,e,i,r,s){if(t===e){return}if(!(el(e)||Ll(e))){var a=vu(e)}Ze(a||e,function(o,h){if(a){h=o;o=e[h]}if(ml(o)){s||(s=new _r);bs(t,e,h,i,xs,r,s)}else{var l=r?r(t[h],o,h+"",t,e,s):n;if(l===n){l=o}Ir(t,h,l)}})}function bs(t,e,i,r,s,a,o){var h=t[i],l=e[i],u=o.get(l);if(u){Ir(t,i,u);return}var c=a?a(h,l,i+"",t,e,o):n;var f=c===n;if(f){c=l;if(el(l)||Ll(l)){if(el(h)){c=h}else if(sl(h)){c=cn(h)}else{f=false;c=Fr(l,true)}}else if(Al(l)||tl(l)){if(tl(h)){c=zl(h)}else if(!ml(h)||r&&pl(h)){f=false;c=Fr(l,true)}else{c=h}}else{f=false}}o.set(l,c);if(f){s(c,l,r,a,o)}o["delete"](l);Ir(t,i,c)}function ws(t,e){var i=t.length;if(!i){return}e+=e<0?i:0;return la(e,i)?t[e]:n}function _s(t,e,i){var r=-1;e=si(e.length?e:[_c],xi(qn()));var s=vs(t,function(t,i,s){var n=si(e,function(e){return e(t)});return{criteria:n,index:++r,value:t}});return gi(s,function(t,e){return hn(t,e,i)})}function Ps(t,e){t=Object(t);return ai(e,function(e,i){if(i in t){e[i]=t[i]}return e},{})}function Ts(t,e){var i=-1,r=jn(t),s=r.length,n={};while(++i<s){var a=r[i],o=t[a];if(e(o,a)){n[a]=o}}return n}function Cs(t){return function(e){return e==null?n:e[t]}}function Ss(t){return function(e){return Qr(e,t)}}function As(t,e,i,r){var s=r?fi:ci,n=-1,a=e.length,o=t;if(t===e){e=cn(e)}if(i){o=si(t,xi(i))}while(++n<a){var h=0,l=e[n],u=i?i(l):l;while((h=s(o,u,h,r))>-1){if(o!==t){ue.call(o,h,1)}ue.call(t,h,1)}}return t}function Es(t,e){var i=t?e.length:0,r=i-1;while(i--){var s=e[i];if(i==r||s!==n){var n=s;if(la(s)){ue.call(t,s,1)}else if(!ca(s,t)){var a=$s(s),o=wa(t,a);if(o!=null){delete o[Ca(Za(a))]}}else{delete t[Ca(s)]}}}return t}function Is(t,e){return t+de(we()*(e-t+1))}function Ms(t,e,i,r){var s=-1,n=ye(fe((e-t)/(i||1)),0),a=Array(n);while(n--){a[r?n:++s]=t;t+=i}return a}function Rs(t,e){var i="";if(!t||e<1||e>R){return i}do{if(e%2){i+=t}e=de(e/2);if(e){t+=t}}while(e);return i}function Bs(t,e,i,r){e=ca(e,t)?[e]:$s(e);var s=-1,a=e.length,o=a-1,h=t;while(h!=null&&++s<a){var l=Ca(e[s]);if(ml(h)){var u=i;if(s!=o){var c=h[l];u=r?r(c,l,h):n;if(u===n){u=c==null?la(e[s+1])?[]:{}:c}}Mr(h,l,u)}h=h[l]}return t}var Ls=!je?_c:function(t,e){je.set(t,e);return t};function ks(t,e,i){var r=-1,s=t.length;if(e<0){e=-e>s?0:s+e}i=i>s?s:i;if(i<0){i+=s}s=e>i?0:i-e>>>0;e>>>=0;var n=Array(s);while(++r<s){n[r]=t[r+e]}return n}function Os(t,e){var i;Xr(t,function(t,r,s){i=e(t,r,s);return!i});return!!i}function Fs(t,e,i){var r=0,s=t?t.length:r;if(typeof e=="number"&&e===e&&s<=F){while(r<s){var n=r+s>>>1,a=t[n];if(a!==null&&!Bl(a)&&(i?a<=e:a<e)){r=n+1}else{s=n}}return s}return Ds(t,e,_c,i)}function Ds(t,e,i,r){e=i(e);var s=0,a=t?t.length:0,o=e!==e,h=e===null,l=Bl(e),u=e===n;while(s<a){var c=de((s+a)/2),f=i(t[c]),d=f!==n,p=f===null,g=f===f,v=Bl(f);if(o){var m=r||g}else if(u){m=g&&(r||d)}else if(h){m=g&&d&&(r||!p)}else if(l){m=g&&d&&!p&&(r||!v)}else if(p||v){m=false}else{m=r?f<=e:f<e}if(m){s=c+1}else{a=c}}return xe(a,O)}function Us(t,e){var i=-1,r=t.length,s=0,n=[];while(++i<r){var a=t[i],o=e?e(a):a;if(!i||!Jh(o,h)){var h=o;n[s++]=a===0?0:a}}return n}function Gs(t){if(typeof t=="number"){return t}if(Bl(t)){return L}return+t}function Ns(t){if(typeof t=="string"){return t}if(Bl(t)){return Hi?Hi.call(t):""}var e=t+"";return e=="0"&&1/t==-M?"-0":e}function Xs(t,e,i){var r=-1,s=ii,n=t.length,a=true,h=[],l=h;if(i){a=false;s=ri}else if(n>=o){var u=e?null:On(t);if(u){return Oi(u)}a=false;s=wi;l=new xr}else{l=e?[]:h}t:while(++r<n){var c=t[r],f=e?e(c):c;c=i||c!==0?c:0;if(a&&f===f){var d=l.length;while(d--){if(l[d]===f){continue t}}if(e){l.push(f)}h.push(c)}else if(!s(l,f,i)){if(l!==h){l.push(f)}h.push(c)}}return h}function js(t,e){e=ca(e,t)?[e]:$s(e);t=wa(t,e);var i=Ca(Za(e));return!(t!=null&&is(t,i))||delete t[i]}function Ws(t,e,i,r){return Bs(t,e,i(Qr(t,e)),r)}function zs(t,e,i,r){var s=t.length,n=r?s:-1;while((r?n--:++n<s)&&e(t[n],n,t)){}return i?ks(t,r?0:n,r?n+1:s):ks(t,r?n+1:0,r?s:n)}function Vs(t,e){var i=t;if(i instanceof Ji){i=i.value()}return ai(e,function(t,e){return e.func.apply(e.thisArg,ni([t],e.args))},i)}function qs(t,e,i){var r=-1,s=t.length;while(++r<s){var n=n?ni(Nr(n,t[r],e,i),Nr(t[r],n,e,i)):t[r]}return n&&n.length?Xs(n,e,i):[]}function Hs(t,e,i){var r=-1,s=t.length,a=e.length,o={};while(++r<s){var h=r<a?e[r]:n;i(o,t[r],h)}return o}function Ys(t){return sl(t)?t:[]}function Ks(t){return typeof t=="function"?t:_c}function $s(t){return el(t)?t:Ta(t)}function Js(t,e,i){var r=t.length;i=i===n?r:i;return!e&&i>=r?t:ks(t,e,i)}function Zs(t,e){if(e){return t.slice()}var i=new t.constructor(t.length);t.copy(i);return i}function Qs(t){var e=new t.constructor(t.byteLength);new se(e).set(new se(t));return e}function tn(t,e){var i=e?Qs(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}function en(t,e,i){var r=e?i(Li(t),true):Li(t);return ai(r,Ye,new t.constructor)}function rn(t){var e=new t.constructor(t.source,Bt.exec(t));e.lastIndex=t.lastIndex;return e}function sn(t,e,i){var r=e?i(Oi(t),true):Oi(t);return ai(r,Ke,new t.constructor)}function nn(t){return qi?Object(qi.call(t)):{}}function an(t,e){var i=e?Qs(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}function on(t,e){if(t!==e){var i=t!==n,r=t===null,s=t===t,a=Bl(t);var o=e!==n,h=e===null,l=e===e,u=Bl(e);if(!h&&!u&&!a&&t>e||a&&o&&l&&!h&&!u||r&&o&&l||!i&&l||!s){return 1}if(!r&&!a&&!u&&t<e||u&&i&&s&&!r&&!a||h&&i&&s||!o&&s||!l){return-1}}return 0}function hn(t,e,i){var r=-1,s=t.criteria,n=e.criteria,a=s.length,o=i.length;while(++r<a){var h=on(s[r],n[r]);if(h){if(r>=o){return h}var l=i[r];return h*(l=="desc"?-1:1)}}return t.index-e.index}function ln(t,e,i,r){var s=-1,n=t.length,a=i.length,o=-1,h=e.length,l=ye(n-a,0),u=Array(h+l),c=!r;while(++o<h){u[o]=e[o]}while(++s<a){if(c||s<n){u[i[s]]=t[s]}}while(l--){u[o++]=t[s++]}return u}function un(t,e,i,r){var s=-1,n=t.length,a=-1,o=i.length,h=-1,l=e.length,u=ye(n-o,0),c=Array(u+l),f=!r;while(++s<u){c[s]=t[s]}var d=s;while(++h<l){c[d+h]=e[h]}while(++a<o){if(f||s<n){c[d+i[a]]=t[s++]}}return c}function cn(t,e){var i=-1,r=t.length;e||(e=Array(r));while(++i<r){e[i]=t[i]}return e}function fn(t,e,i,r){i||(i={});var s=-1,n=e.length;while(++s<n){var a=e[s];var o=r?r(i[a],t[a],a,i,t):t[a];Mr(i,a,o)}return i}function dn(t,e){return fn(t,Zn(t),e)}function pn(t,e){return function(i,r){var s=el(i)?Je:Br,n=e?e():{};return s(i,t,qn(r),n)}}function gn(t){return Xh(function(e,i){var r=-1,s=i.length,a=s>1?i[s-1]:n,o=s>2?i[2]:n;a=t.length>3&&typeof a=="function"?(s--,a):n;if(o&&ua(i[0],i[1],o)){a=s<3?n:a;s=1}e=Object(e);while(++r<s){var h=i[r];if(h){t(e,h,r,a)}}return e})}function vn(t,e){return function(i,r){if(i==null){return i}if(!rl(i)){return t(i,r)}var s=i.length,n=e?s:-1,a=Object(i);while(e?n--:++n<s){if(r(a[n],n,a)===false){break}}return i}}function mn(t){return function(e,i,r){var s=-1,n=Object(e),a=r(e),o=a.length;while(o--){var h=a[t?o:++s];if(i(n[h],h,n)===false){break}}return e}}function yn(t,e,i){var r=e&c,s=wn(t);function n(){var e=this&&this!==He&&this instanceof n?s:t;return e.apply(r?i:this,arguments)}return n}function xn(t){return function(e){e=ql(e);var i=Ie.test(e)?Ui(e):n;var r=i?i[0]:e.charAt(0);var s=i?Js(i,1).join(""):e.slice(1);return r[t]()+s}}function bn(t){return function(e){return ai(pc(Xu(e).replace(Ce,"")),t,"")}}function wn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=Ur(t.prototype),r=t.apply(i,e);return ml(r)?r:i}}function _n(t,e,i){var r=wn(t);function s(){var a=arguments.length,o=Array(a),h=a,l=Vn(s);while(h--){o[h]=arguments[h]}var u=a<3&&o[0]!==l&&o[a-1]!==l?[]:ki(o,l);a-=u.length;if(a<i){return Ln(t,e,Cn,s.placeholder,n,o,u,n,n,i-a)}var c=this&&this!==He&&this instanceof s?r:t;return $e(c,this,o)}return s}function Pn(t){return function(e,i,r){var s=Object(e);i=qn(i,3);if(!rl(e)){var a=gu(e)}var o=t(a||e,function(t,e){if(a){e=t;t=s[e]}return i(t,e,s)},r);return o>-1?e[a?a[o]:o]:n}}function Tn(t){return Xh(function(e){e=Hr(e,1);var i=e.length,r=i,s=$i.prototype.thru;if(t){e.reverse()}while(r--){var a=e[r];if(typeof a!="function"){throw new jt(h)}if(s&&!l&&zn(a)=="wrapper"){var l=new $i([],true)}}r=l?r:i;while(++r<i){a=e[r];var u=zn(a),c=u=="wrapper"?Wn(a):n;if(c&&da(c[0])&&c[1]==(y|p|v|x)&&!c[4].length&&c[9]==1){l=l[zn(c[0])].apply(l,c[3])}else{l=a.length==1&&da(a)?l[u]():l.thru(a)}}return function(){var t=arguments,r=t[0];if(l&&t.length==1&&el(r)&&r.length>=o){return l.plant(r).value()}var s=0,n=i?e[s].apply(this,t):r;while(++s<i){n=e[s].call(this,n)}return n}})}function Cn(t,e,i,r,s,a,o,h,l,u){var d=e&y,v=e&c,m=e&f,x=e&(p|g),w=e&b,_=m?n:wn(t);function P(){var n=arguments.length,c=Array(n),f=n;while(f--){c[f]=arguments[f]}if(x){var p=Vn(P),g=Ci(c,p)}if(r){c=ln(c,r,s,x)}if(a){c=un(c,a,o,x)}n-=g;if(x&&n<u){var y=ki(c,p);return Ln(t,e,Cn,P.placeholder,i,c,y,h,l,u-n)}var b=v?i:this,T=m?b[t]:t;n=c.length;if(h){c=_a(c,h)}else if(w&&n>1){c.reverse()}if(d&&l<n){c.length=l}if(this&&this!==He&&this instanceof P){T=_||wn(T)}return T.apply(b,c)}return P}function Sn(t,e){return function(i,r){return as(i,t,e(r),{})}}function An(t){return function(e,i){var r;if(e===n&&i===n){return 0}if(e!==n){r=e}if(i!==n){if(r===n){return i}if(typeof e=="string"||typeof i=="string"){e=Ns(e);i=Ns(i)}else{e=Gs(e);i=Gs(i)}r=t(e,i)}return r}}function En(t){return Xh(function(e){e=e.length==1&&el(e[0])?si(e[0],xi(qn())):si(Hr(e,1,ha),xi(qn()));return Xh(function(i){var r=this;return t(e,function(t){return $e(t,r,i)})})})}function In(t,e){e=e===n?" ":Ns(e);var i=e.length;if(i<2){return i?Rs(e,t):e}var r=Rs(e,fe(t/Di(e)));return Ie.test(e)?Js(Ui(r),0,t).join(""):r.slice(0,t)}function Mn(t,e,i,r){var s=e&c,n=wn(t);function a(){var e=-1,o=arguments.length,h=-1,l=r.length,u=Array(l+o),c=this&&this!==He&&this instanceof a?n:t;while(++h<l){u[h]=r[h]}while(o--){u[h++]=arguments[++e]}return $e(c,s?i:this,u)}return a}function Rn(t){return function(e,i,r){if(r&&typeof r!="number"&&ua(e,i,r)){i=r=n}e=Wl(e);e=e===e?e:0;if(i===n){i=e;e=0}else{i=Wl(i)||0}r=r===n?e<i?1:-1:Wl(r)||0;return Ms(e,i,r,t)}}function Bn(t){return function(e,i){if(!(typeof e=="string"&&typeof i=="string")){e=Wl(e);i=Wl(i)}return t(e,i)}}function Ln(t,e,i,r,s,a,o,h,l,u){var g=e&p,y=g?o:n,x=g?n:o,b=g?a:n,w=g?n:a;e|=g?v:m;e&=~(g?m:v);if(!(e&d)){e&=~(c|f)}var _=[t,e,s,b,y,w,x,h,l,u];var P=i.apply(n,_);if(da(t)){Pa(P,_)}P.placeholder=r;return P}function kn(t){var e=r[t];return function(t,i){t=Wl(t);i=xe(Xl(i),292);if(i){var r=(ql(t)+"e").split("e"),s=e(r[0]+"e"+(+r[1]+i));r=(ql(s)+"e").split("e");return+(r[0]+"e"+(+r[1]-i))}return e(t)}}var On=!(De&&1/Oi(new De([,-0]))[1]==M)?Mc:function(t){return new De(t)};function Fn(t){return function(e){var i=ta(e);if(i==z){return Li(e)}if(i==K){return Fi(e)}return yi(e,t(e))}}function Dn(t,e,i,r,s,a,o,l){var u=e&f;if(!u&&typeof t!="function"){throw new jt(h)}var d=r?r.length:0;if(!d){e&=~(v|m);r=s=n}o=o===n?o:ye(Xl(o),0);l=l===n?l:Xl(l);d-=s?s.length:0;if(e&m){var y=r,x=s;r=s=n}var b=u?n:Wn(t);var w=[t,e,i,r,s,y,x,a,o,l];if(b){xa(w,b)}t=w[0];e=w[1];i=w[2];r=w[3];s=w[4];l=w[9]=w[9]==null?u?0:t.length:ye(w[9]-d,0);if(!l&&e&(p|g)){e&=~(p|g)}if(!e||e==c){var _=yn(t,e,i)}else if(e==p||e==g){_=_n(t,e,l)}else if((e==v||e==(c|v))&&!s.length){_=Mn(t,e,i,r)}else{_=Cn.apply(n,w)}var P=b?Ls:Pa;return P(_,w)}function Un(t,e,i,r,s,a){var o=s&_,h=t.length,l=e.length;if(h!=l&&!(o&&l>h)){return false}var u=a.get(t);if(u){return u==e}var c=-1,f=true,d=s&w?new xr:n;a.set(t,e);while(++c<h){var p=t[c],g=e[c];if(r){var v=o?r(g,p,c,e,t,a):r(p,g,c,t,e,a)}if(v!==n){if(v){continue}f=false;break}if(d){if(!hi(e,function(t,e){if(!d.has(e)&&(p===t||i(p,t,r,s,a))){return d.add(e)}})){f=false;break}}else if(!(p===g||i(p,g,r,s,a))){f=false;break}}a["delete"](t);return f}function Gn(t,e,i,r,s,n,a){switch(i){case et:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset){return false}t=t.buffer;e=e.buffer;case tt:if(t.byteLength!=e.byteLength||!r(new se(t),new se(e))){return false}return true;case G:case N:return+t==+e;case X:return t.name==e.name&&t.message==e.message;case V:return t!=+t?e!=+e:t==+e;case Y:case $:return t==e+"";case z:var o=Li;case K:var h=n&_;o||(o=Oi);if(t.size!=e.size&&!h){return false}var l=a.get(t);if(l){return l==e}n|=w;a.set(t,e);return Un(o(t),o(e),r,s,n,a);case J:if(qi){return qi.call(t)==qi.call(e)}}return false}function Nn(t,e,i,r,s,a){var o=s&_,h=gu(t),l=h.length,u=gu(e),c=u.length;if(l!=c&&!o){return false}var f=l;while(f--){var d=h[f];if(!(o?d in e:is(e,d))){return false}}var p=a.get(t);if(p){return p==e}var g=true;a.set(t,e);var v=o;while(++f<l){d=h[f];var m=t[d],y=e[d];if(r){var x=o?r(y,m,d,e,t,a):r(m,y,d,t,e,a)}if(!(x===n?m===y||i(m,y,r,s,a):x)){g=false;break}v||(v=d=="constructor")}if(g&&!v){var b=t.constructor,w=e.constructor;if(b!=w&&("constructor"in t&&"constructor"in e)&&!(typeof b=="function"&&b instanceof b&&typeof w=="function"&&w instanceof w)){g=false}}a["delete"](t);return g}function Xn(t){return ts(t,gu,Zn)}function jn(t){return ts(t,vu,Qn)}var Wn=!je?Mc:function(t){return je.get(t)};function zn(t){var e=t.name+"",i=Ve[e],r=Kt.call(Ve,e)?i.length:0;while(r--){var s=i[r],n=s.func;if(n==null||n==t){return s.name}}return e}function Vn(t){var e=Kt.call(Yi,"placeholder")?Yi:t;return e.placeholder}function qn(){var t=Yi.iteratee||Pc;t=t===Pc?fs:t;return arguments.length?t(arguments[0],arguments[1]):t}var Hn=Cs("length");function Yn(t,e){var i=t.__data__;return fa(e)?i[typeof e=="string"?"string":"hash"]:i.map}function Kn(t){var e=gu(t),i=e.length;while(i--){var r=e[i],s=t[r];e[i]=[r,s,ma(s)]}return e}function $n(t,e){var i=Ii(t,e);return cs(i)?i:n}function Jn(t){return pe(Object(t))}function Zn(t){return ae(Object(t))}if(!ae){Zn=Gc}var Qn=!ae?Zn:function(t){var e=[];while(t){ni(e,Zn(t));t=Jn(t)}return e};function ta(t){return Zt.call(t)}if(Ae&&ta(new Ae(new ArrayBuffer(1)))!=et||Oe&&ta(new Oe)!=z||Fe&&ta(Fe.resolve())!=H||De&&ta(new De)!=K||Ue&&ta(new Ue)!=Z){ta=function(t){var e=Zt.call(t),i=e==q?t.constructor:n,r=i?Sa(i):n;if(r){switch(r){case qe:return et;case Ti:return z;case ji:return H;case Wi:return K;case zi:return Z}}return e}}function ea(t,e,i){var r=-1,s=i.length;while(++r<s){var n=i[r],a=n.size;switch(n.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=xe(e,t+a);break;case"takeRight":t=ye(t,e-a);break}}return{start:t,end:e}}function ia(t,e,i){e=ca(e,t)?[e]:$s(e);var r,s=-1,n=e.length;while(++s<n){var a=Ca(e[s]);if(!(r=t!=null&&i(t,a))){break}t=t[a]}if(r){return r}var n=t?t.length:0;return!!n&&vl(n)&&la(a,n)&&(el(t)||Rl(t)||tl(t))}function ra(t){var e=t.length,i=t.constructor(e);if(e&&typeof t[0]=="string"&&Kt.call(t,"index")){i.index=t.index;i.input=t.input}return i}function sa(t){return typeof t.constructor=="function"&&!va(t)?Ur(Jn(t)):{}}function na(t,e,i,r){var s=t.constructor;switch(e){case tt:return Qs(t);case G:case N:return new s(+t);case et:return tn(t,r);case it:case rt:case st:case nt:case at:case ot:case ht:case lt:case ut:return an(t,r);case z:return en(t,r,i);case V:case $:return new s(t);case Y:return rn(t);case K:return sn(t,r,i);case J:return nn(t)}}function aa(t){var e=t?t.length:n;if(vl(e)&&(el(t)||Rl(t)||tl(t))){return mi(e,String)}return null}function oa(t){return el(t)||tl(t)}function ha(t){return el(t)&&!(t.length==2&&!pl(t[0]))}function la(t,e){e=e==null?R:e;return!!e&&(typeof t=="number"||Ut.test(t))&&(t>-1&&t%1==0&&t<e)}function ua(t,e,i){if(!ml(i)){return false}var r=typeof e;if(r=="number"?rl(i)&&la(e,i.length):r=="string"&&e in i){return Jh(i[e],t)}return false}function ca(t,e){if(el(t)){return false}var i=typeof t;if(i=="number"||i=="symbol"||i=="boolean"||t==null||Bl(t)){return true}return _t.test(t)||!wt.test(t)||e!=null&&t in Object(e)}function fa(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function da(t){var e=zn(t),i=Yi[e];if(typeof i!="function"||!(e in Ji.prototype)){return false}if(t===i){return true}var r=Wn(i);return!!r&&t===r[0]}function pa(t){return!!Ht&&Ht in t}var ga=qt?pl:Nc;function va(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||zt;return t===i}function ma(t){return t===t&&!ml(t)}function ya(t,e){return function(i){if(i==null){return false}return i[t]===e&&(e!==n||t in Object(i))}}function xa(t,e){var i=t[1],r=e[1],s=i|r,n=s<(c|f|y);var a=r==y&&i==p||r==y&&i==x&&t[7].length<=e[8]||r==(y|x)&&e[7].length<=e[8]&&i==p;if(!(n||a)){return t}if(r&c){t[2]=e[2];s|=i&c?0:d}var o=e[3];if(o){var h=t[3];t[3]=h?ln(h,o,e[4]):o;t[4]=h?ki(t[3],u):e[4]}o=e[5];if(o){h=t[5];t[5]=h?un(h,o,e[6]):o;t[6]=h?ki(t[5],u):e[6]}o=e[7];if(o){t[7]=o}if(r&y){t[8]=t[8]==null?e[8]:xe(t[8],e[8])}if(t[9]==null){t[9]=e[9]}t[0]=e[0];t[1]=s;return t}function ba(t,e,i,r,s,a){if(ml(t)&&ml(e)){xs(t,e,n,ba,a.set(e,t))}return t}function wa(t,e){return e.length==1?t:Qr(t,ks(e,0,-1))}function _a(t,e){var i=t.length,r=xe(e.length,i),s=cn(t);while(r--){var a=e[r];t[r]=la(a,i)?s[a]:n}return t}var Pa=function(){var t=0,e=0;return function(i,r){var s=_h(),n=S-(s-e);e=s;if(n>0){if(++t>=C){return i}}else{t=0}return Ls(i,r)}}();var Ta=kh(function(t){var e=[];ql(t).replace(Pt,function(t,i,r,s){e.push(r?s.replace(Mt,"$1"):i||t)});return e});function Ca(t){if(typeof t=="string"||Bl(t)){return t}var e=t+"";return e=="0"&&1/t==-M?"-0":e}function Sa(t){if(t!=null){try{return Yt.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Aa(t){if(t instanceof Ji){return t.clone()}var e=new $i(t.__wrapped__,t.__chain__);e.__actions__=cn(t.__actions__);e.__index__=t.__index__;e.__values__=t.__values__;return e}function Ea(t,e,i){if(i?ua(t,e,i):e===n){e=1}else{e=ye(Xl(e),0)}var r=t?t.length:0;if(!r||e<1){return[]}var s=0,a=0,o=Array(fe(r/e));while(s<r){o[a++]=ks(t,s,s+=e)}return o}function Ia(t){var e=-1,i=t?t.length:0,r=0,s=[];while(++e<i){var n=t[e];if(n){s[r++]=n}}return s}function Ma(){var t=arguments.length,e=Array(t?t-1:0),i=arguments[0],r=t;while(r--){e[r-1]=arguments[r]}return t?ni(el(i)?cn(i):[i],Hr(e,1)):[]}var Ra=Xh(function(t,e){return sl(t)?Nr(t,Hr(e,1,sl,true)):[]});var Ba=Xh(function(t,e){var i=Za(e);if(sl(i)){i=n}return sl(t)?Nr(t,Hr(e,1,sl,true),qn(i)):[]});var La=Xh(function(t,e){var i=Za(e);if(sl(i)){i=n}return sl(t)?Nr(t,Hr(e,1,sl,true),n,i):[]});function ka(t,e,i){var r=t?t.length:0;if(!r){return[]}e=i||e===n?1:Xl(e);return ks(t,e<0?0:e,r)}function Oa(t,e,i){var r=t?t.length:0;if(!r){return[]}e=i||e===n?1:Xl(e);e=r-e;return ks(t,0,e<0?0:e)}function Fa(t,e){return t&&t.length?zs(t,qn(e,3),true,true):[]}function Da(t,e){return t&&t.length?zs(t,qn(e,3),true):[]}function Ua(t,e,i,r){var s=t?t.length:0;if(!s){return[]}if(i&&typeof i!="number"&&ua(t,e,i)){i=0;r=s}return Vr(t,e,i,r)}function Ga(t,e,i){var r=t?t.length:0;if(!r){return-1}var s=i==null?0:Xl(i);if(s<0){s=ye(r+s,0)}return ui(t,qn(e,3),s)}function Na(t,e,i){var r=t?t.length:0;if(!r){return-1}var s=r-1;if(i!==n){s=Xl(i);s=i<0?ye(r+s,0):xe(s,r-1)}return ui(t,qn(e,3),s,true)}function Xa(t){var e=t?t.length:0;return e?Hr(t,1):[]}function ja(t){var e=t?t.length:0;return e?Hr(t,M):[]}function Wa(t,e){var i=t?t.length:0;if(!i){return[]}e=e===n?1:Xl(e);return Hr(t,e)}function za(t){var e=-1,i=t?t.length:0,r={};while(++e<i){var s=t[e];r[s[0]]=s[1]}return r}function Va(t){return t&&t.length?t[0]:n}function qa(t,e,i){var r=t?t.length:0;if(!r){return-1}var s=i==null?0:Xl(i);if(s<0){s=ye(r+s,0)}return ci(t,e,s)}function Ha(t){return Oa(t,1)}var Ya=Xh(function(t){var e=si(t,Ys);return e.length&&e[0]===t[0]?ns(e):[]});var Ka=Xh(function(t){var e=Za(t),i=si(t,Ys);if(e===Za(i)){e=n}else{i.pop()}return i.length&&i[0]===t[0]?ns(i,qn(e)):[]});var $a=Xh(function(t){var e=Za(t),i=si(t,Ys);if(e===Za(i)){e=n}else{i.pop()}return i.length&&i[0]===t[0]?ns(i,n,e):[]});function Ja(t,e){return t?ve.call(t,e):""}function Za(t){var e=t?t.length:0;return e?t[e-1]:n}function Qa(t,e,i){var r=t?t.length:0;if(!r){return-1}var s=r;if(i!==n){s=Xl(i);s=(s<0?ye(r+s,0):xe(s,r-1))+1}if(e!==e){return Mi(t,s-1,true)}while(s--){if(t[s]===e){return s}}return-1}function to(t,e){return t&&t.length?ws(t,Xl(e)):n}var eo=Xh(io);function io(t,e){return t&&t.length&&e&&e.length?As(t,e):t}function ro(t,e,i){return t&&t.length&&e&&e.length?As(t,e,qn(i)):t}function so(t,e,i){return t&&t.length&&e&&e.length?As(t,e,n,i):t}var no=Xh(function(t,e){e=Hr(e,1);var i=t?t.length:0,r=kr(t,e);Es(t,si(e,function(t){return la(t,i)?+t:t}).sort(on));return r});function ao(t,e){var i=[];if(!(t&&t.length)){return i}var r=-1,s=[],n=t.length;e=qn(e,3);while(++r<n){var a=t[r];if(e(a,r,t)){i.push(a);s.push(r)}}Es(t,s);return i}function oo(t){return t?Pe.call(t):t}function ho(t,e,i){var r=t?t.length:0;if(!r){return[]}if(i&&typeof i!="number"&&ua(t,e,i)){e=0;i=r}else{e=e==null?0:Xl(e);i=i===n?r:Xl(i)}return ks(t,e,i)}function lo(t,e){return Fs(t,e)}function uo(t,e,i){return Ds(t,e,qn(i))}function co(t,e){var i=t?t.length:0;if(i){var r=Fs(t,e);if(r<i&&Jh(t[r],e)){return r}}return-1}function fo(t,e){return Fs(t,e,true)}function po(t,e,i){return Ds(t,e,qn(i),true)}function go(t,e){var i=t?t.length:0;if(i){var r=Fs(t,e,true)-1;if(Jh(t[r],e)){return r}}return-1}function vo(t){return t&&t.length?Us(t):[]}function mo(t,e){return t&&t.length?Us(t,qn(e)):[]}function yo(t){return ka(t,1)}function xo(t,e,i){if(!(t&&t.length)){return[]}e=i||e===n?1:Xl(e);return ks(t,0,e<0?0:e)}function bo(t,e,i){var r=t?t.length:0;if(!r){return[]}e=i||e===n?1:Xl(e);e=r-e;return ks(t,e<0?0:e,r)}function wo(t,e){return t&&t.length?zs(t,qn(e,3),false,true):[]}function _o(t,e){return t&&t.length?zs(t,qn(e,3)):[]}var Po=Xh(function(t){return Xs(Hr(t,1,sl,true))});var To=Xh(function(t){var e=Za(t);if(sl(e)){e=n}return Xs(Hr(t,1,sl,true),qn(e))});var Co=Xh(function(t){var e=Za(t);if(sl(e)){e=n}return Xs(Hr(t,1,sl,true),n,e)});function So(t){return t&&t.length?Xs(t):[]}function Ao(t,e){return t&&t.length?Xs(t,qn(e)):[]}function Eo(t,e){return t&&t.length?Xs(t,n,e):[]}function Io(t){if(!(t&&t.length)){return[]}var e=0;t=ei(t,function(t){if(sl(t)){e=ye(t.length,e);return true}});return mi(e,function(e){return si(t,Cs(e))})}function Mo(t,e){if(!(t&&t.length)){return[]}var i=Io(t);if(e==null){return i}return si(i,function(t){return $e(e,n,t)})}var Ro=Xh(function(t,e){return sl(t)?Nr(t,e):[]});var Bo=Xh(function(t){return qs(ei(t,sl))});var Lo=Xh(function(t){var e=Za(t);if(sl(e)){e=n}return qs(ei(t,sl),qn(e))});var ko=Xh(function(t){var e=Za(t);if(sl(e)){e=n}return qs(ei(t,sl),n,e)});var Oo=Xh(Io);function Fo(t,e){return Hs(t||[],e||[],Mr)}function Do(t,e){return Hs(t||[],e||[],Bs)}var Uo=Xh(function(t){var e=t.length,i=e>1?t[e-1]:n;i=typeof i=="function"?(t.pop(),i):n;return Mo(t,i)});function Go(t){var e=Yi(t);e.__chain__=true;return e}function No(t,e){e(t);return t}function Xo(t,e){return e(t)}var jo=Xh(function(t){t=Hr(t,1);var e=t.length,i=e?t[0]:0,r=this.__wrapped__,s=function(e){return kr(e,t)};if(e>1||this.__actions__.length||!(r instanceof Ji)||!la(i)){return this.thru(s)}r=r.slice(i,+i+(e?1:0));r.__actions__.push({func:Xo,args:[s],thisArg:n});return new $i(r,this.__chain__).thru(function(t){if(e&&!t.length){t.push(n)}return t})});function Wo(){return Go(this)}function zo(){return new $i(this.value(),this.__chain__)}function Vo(){if(this.__values__===n){this.__values__=Gl(this.value())}var t=this.__index__>=this.__values__.length,e=t?n:this.__values__[this.__index__++];return{done:t,value:e}}function qo(){return this}function Ho(t){var e,i=this;while(i instanceof Ki){var r=Aa(i);r.__index__=0;r.__values__=n;if(e){s.__wrapped__=r}else{e=r}var s=r;i=i.__wrapped__}s.__wrapped__=t;return e}function Yo(){var t=this.__wrapped__;if(t instanceof Ji){var e=t;if(this.__actions__.length){e=new Ji(this)}e=e.reverse();e.__actions__.push({func:Xo,args:[oo],thisArg:n});return new $i(e,this.__chain__)}return this.thru(oo)}function Ko(){return Vs(this.__wrapped__,this.__actions__)}var $o=pn(function(t,e,i){Kt.call(t,i)?++t[i]:t[i]=1});function Jo(t,e,i){var r=el(t)?ti:Wr;if(i&&ua(t,e,i)){e=n}return r(t,qn(e,3))}function Zo(t,e){var i=el(t)?ei:qr;return i(t,qn(e,3))}var Qo=Pn(Ga);var th=Pn(Na);function eh(t,e){return Hr(uh(t,e),1)}function ih(t,e){return Hr(uh(t,e),M)}function rh(t,e,i){i=i===n?1:Xl(i);return Hr(uh(t,e),i)}function sh(t,e){var i=el(t)?Ze:Xr;return i(t,qn(e,3))}function nh(t,e){var i=el(t)?Qe:jr;return i(t,qn(e,3))}var ah=pn(function(t,e,i){if(Kt.call(t,i)){t[i].push(e)}else{t[i]=[e]}});function oh(t,e,i,r){t=rl(t)?t:ku(t);i=i&&!r?Xl(i):0;var s=t.length;if(i<0){i=ye(s+i,0)}return Rl(t)?i<=s&&t.indexOf(e,i)>-1:!!s&&ci(t,e,i)>-1}var hh=Xh(function(t,e,i){var r=-1,s=typeof e=="function",a=ca(e),o=rl(t)?Array(t.length):[];Xr(t,function(t){var h=s?e:a&&t!=null?t[e]:n;o[++r]=h?$e(h,t,i):os(t,e,i)});return o});var lh=pn(function(t,e,i){t[i]=e});function uh(t,e){var i=el(t)?si:vs;return i(t,qn(e,3))}function ch(t,e,i,r){if(t==null){return[]}if(!el(e)){e=e==null?[]:[e]}i=r?n:i;if(!el(i)){i=i==null?[]:[i]}return _s(t,e,i)}var fh=pn(function(t,e,i){t[i?0:1].push(e)},function(){return[[],[]]});function dh(t,e,i){var r=el(t)?ai:pi,s=arguments.length<3;return r(t,qn(e,4),i,s,Xr)}function ph(t,e,i){var r=el(t)?oi:pi,s=arguments.length<3;return r(t,qn(e,4),i,s,jr)}function gh(t,e){var i=el(t)?ei:qr;e=qn(e,3);return i(t,function(t,i,r){return!e(t,i,r)})}function vh(t){var e=rl(t)?t:ku(t),i=e.length;return i>0?e[Is(0,i-1)]:n}function mh(t,e,i){var r=-1,s=Gl(t),a=s.length,o=a-1;if(i?ua(t,e,i):e===n){e=1}else{e=Or(Xl(e),0,a)}while(++r<e){var h=Is(r,o),l=s[h];s[h]=s[r];s[r]=l}s.length=e;return s}function yh(t){return mh(t,k)}function xh(t){if(t==null){return 0}if(rl(t)){var e=t.length;return e&&Rl(t)?Di(t):e}if(yl(t)){var i=ta(t);if(i==z||i==K){return t.size}}return gu(t).length}function bh(t,e,i){var r=el(t)?hi:Os;if(i&&ua(t,e,i)){e=n}return r(t,qn(e,3))}var wh=Xh(function(t,e){if(t==null){return[]}var i=e.length;if(i>1&&ua(t,e[0],e[1])){e=[]}else if(i>2&&ua(e[0],e[1],e[2])){e=[e[0]]}e=e.length==1&&el(e[0])?e[0]:Hr(e,1,ha);return _s(t,e,[])});function _h(){return e.now()}function Ph(t,e){if(typeof e!="function"){throw new jt(h)}t=Xl(t);return function(){if(--t<1){return e.apply(this,arguments)}}}function Th(t,e,i){e=i?n:e;e=t&&e==null?t.length:e;return Dn(t,y,n,n,n,n,e)}function Ch(t,e){var i;if(typeof e!="function"){throw new jt(h)}t=Xl(t);return function(){if(--t>0){i=e.apply(this,arguments)}if(t<=1){e=n}return i}}var Sh=Xh(function(t,e,i){var r=c;if(i.length){var s=ki(i,Vn(Sh));r|=v}return Dn(t,r,e,i,s)});var Ah=Xh(function(t,e,i){var r=c|f;if(i.length){var s=ki(i,Vn(Ah));r|=v}return Dn(e,r,t,i,s)});function Eh(t,e,i){e=i?n:e;var r=Dn(t,p,n,n,n,n,n,e);r.placeholder=Eh.placeholder;return r}function Ih(t,e,i){e=i?n:e;var r=Dn(t,g,n,n,n,n,n,e);r.placeholder=Ih.placeholder;return r}function Mh(t,e,i){var r,s,a,o,l,u,c=0,f=false,d=false,p=true;if(typeof t!="function"){throw new jt(h)}e=Wl(e)||0;if(ml(i)){f=!!i.leading;d="maxWait"in i;a=d?ye(Wl(i.maxWait)||0,e):a;p="trailing"in i?!!i.trailing:p}function g(e){var i=r,a=s;r=s=n;c=e;o=t.apply(a,i);return o}function v(t){c=t;l=ce(x,e);return f?g(t):o}function m(t){var i=t-u,r=t-c,s=e-i;return d?xe(s,a-r):s}function y(t){var i=t-u,r=t-c;return u===n||i>=e||i<0||d&&r>=a}function x(){var t=_h();if(y(t)){return b(t)}l=ce(x,m(t))}function b(t){l=n;if(p&&r){return g(t)}r=s=n;return o}function w(){c=0;r=u=s=l=n}function _(){return l===n?o:b(_h())}function P(){var t=_h(),i=y(t);r=arguments;s=this;u=t;if(i){if(l===n){return v(u)}if(d){l=ce(x,e);return g(u)}}if(l===n){l=ce(x,e)}return o}P.cancel=w;P.flush=_;return P}var Rh=Xh(function(t,e){return Gr(t,1,e)});var Bh=Xh(function(t,e,i){return Gr(t,Wl(e)||0,i)});function Lh(t){return Dn(t,b)}function kh(t,e){if(typeof t!="function"||e&&typeof e!="function"){throw new jt(h)}var i=function(){var r=arguments,s=e?e.apply(this,r):r[0],n=i.cache;if(n.has(s)){return n.get(s)}var a=t.apply(this,r);i.cache=n.set(s,a);return a};i.cache=new(kh.Cache||dr);return i}kh.Cache=dr;function Oh(t){if(typeof t!="function"){throw new jt(h)}return function(){return!t.apply(this,arguments)}}function Fh(t){return Ch(2,t)}var Dh=Xh(function(t,e){e=e.length==1&&el(e[0])?si(e[0],xi(qn())):si(Hr(e,1,ha),xi(qn()));var i=e.length;return Xh(function(r){var s=-1,n=xe(r.length,i);while(++s<n){r[s]=e[s].call(this,r[s])}return $e(t,this,r)})});var Uh=Xh(function(t,e){var i=ki(e,Vn(Uh));return Dn(t,v,n,e,i)});var Gh=Xh(function(t,e){var i=ki(e,Vn(Gh));return Dn(t,m,n,e,i)});var Nh=Xh(function(t,e){return Dn(t,x,n,n,n,Hr(e,1))});function Xh(t,e){if(typeof t!="function"){throw new jt(h)}e=ye(e===n?t.length-1:Xl(e),0);return function(){var i=arguments,r=-1,s=ye(i.length-e,0),n=Array(s);while(++r<s){n[r]=i[e+r]}switch(e){case 0:return t.call(this,n);case 1:return t.call(this,i[0],n);case 2:return t.call(this,i[0],i[1],n)}var a=Array(e+1);r=-1;while(++r<e){a[r]=i[r]}a[e]=n;return $e(t,this,a)}}function jh(t,e){if(typeof t!="function"){throw new jt(h)}e=e===n?0:ye(Xl(e),0);return Xh(function(i){var r=i[e],s=Js(i,0,e);if(r){ni(s,r)}return $e(t,this,s)})}function Wh(t,e,i){var r=true,s=true;if(typeof t!="function"){throw new jt(h)}if(ml(i)){r="leading"in i?!!i.leading:r;s="trailing"in i?!!i.trailing:s}return Mh(t,e,{leading:r,maxWait:e,trailing:s})}function zh(t){return Th(t,1)}function Vh(t,e){e=e==null?_c:e;return Uh(e,t)}function qh(){if(!arguments.length){return[]}var t=arguments[0];return el(t)?t:[t]}function Hh(t){return Fr(t,false,true)}function Yh(t,e){return Fr(t,false,true,e)}function Kh(t){return Fr(t,true,true)}function $h(t,e){return Fr(t,true,true,e)}function Jh(t,e){return t===e||t!==t&&e!==e}var Zh=Bn(es);var Qh=Bn(function(t,e){return t>=e});function tl(t){return sl(t)&&Kt.call(t,"callee")&&(!le.call(t,"callee")||Zt.call(t)==D)}var el=Array.isArray;function il(t){return yl(t)&&Zt.call(t)==tt}function rl(t){return t!=null&&vl(Hn(t))&&!pl(t)}function sl(t){return yl(t)&&rl(t)}function nl(t){return t===true||t===false||yl(t)&&Zt.call(t)==G}var al=!ee?Nc:function(t){return t instanceof ee};function ol(t){return yl(t)&&Zt.call(t)==N}function hl(t){return!!t&&t.nodeType===1&&yl(t)&&!Al(t)}function ll(t){if(rl(t)&&(el(t)||Rl(t)||pl(t.splice)||tl(t)||al(t))){return!t.length}if(yl(t)){var e=ta(t);if(e==z||e==K){return!t.size}}for(var i in t){if(Kt.call(t,i)){return false}}return!(ze&&gu(t).length)}function ul(t,e){return hs(t,e)}function cl(t,e,i){i=typeof i=="function"?i:n;var r=i?i(t,e):n;return r===n?hs(t,e,i):!!r}function fl(t){if(!yl(t)){return false}return Zt.call(t)==X||typeof t.message=="string"&&typeof t.name=="string"}function dl(t){return typeof t=="number"&&ge(t)}function pl(t){var e=ml(t)?Zt.call(t):"";return e==j||e==W}function gl(t){return typeof t=="number"&&t==Xl(t)}function vl(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=R}function ml(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function yl(t){return!!t&&typeof t=="object"}function xl(t){return yl(t)&&ta(t)==z}function bl(t,e){return t===e||us(t,e,Kn(e))}function wl(t,e,i){i=typeof i=="function"?i:n;return us(t,e,Kn(e),i)}function _l(t){return Sl(t)&&t!=+t}function Pl(t){if(ga(t)){throw new i("This method is not supported with `core-js`. Try https://github.com/es-shims.")}return cs(t)}function Tl(t){return t===null}function Cl(t){return t==null}function Sl(t){return typeof t=="number"||yl(t)&&Zt.call(t)==V}function Al(t){if(!yl(t)||Zt.call(t)!=q||Ri(t)){return false}var e=Jn(t);if(e===null){return true}var i=Kt.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&Yt.call(i)==Jt}function El(t){return ml(t)&&Zt.call(t)==Y}function Il(t){return gl(t)&&t>=-R&&t<=R}function Ml(t){return yl(t)&&ta(t)==K}function Rl(t){return typeof t=="string"||!el(t)&&yl(t)&&Zt.call(t)==$}function Bl(t){return typeof t=="symbol"||yl(t)&&Zt.call(t)==J}function Ll(t){return yl(t)&&vl(t.length)&&!!Le[Zt.call(t)]}function kl(t){return t===n}function Ol(t){return yl(t)&&ta(t)==Z}function Fl(t){return yl(t)&&Zt.call(t)==Q}var Dl=Bn(gs);var Ul=Bn(function(t,e){return t<=e});function Gl(t){if(!t){return[]}if(rl(t)){return Rl(t)?Ui(t):cn(t)}if(oe&&t[oe]){return Bi(t[oe]())}var e=ta(t),i=e==z?Li:e==K?Oi:ku;return i(t)}function Nl(t){if(!t){return t===0?t:0}t=Wl(t);if(t===M||t===-M){var e=t<0?-1:1;return e*B}return t===t?t:0}function Xl(t){var e=Nl(t),i=e%1;return e===e?i?e-i:e:0}function jl(t){return t?Or(Xl(t),0,k):0}function Wl(t){if(typeof t=="number"){return t}if(Bl(t)){return L}if(ml(t)){var e=pl(t.valueOf)?t.valueOf():t;t=ml(e)?e+"":e}if(typeof t!="string"){return t===0?t:+t}t=t.replace(St,"");var i=Ot.test(t);return i||Dt.test(t)?Ne(t.slice(2),i?2:8):kt.test(t)?L:+t}function zl(t){return fn(t,vu(t))}function Vl(t){return Or(Xl(t),-R,R)}function ql(t){return t==null?"":Ns(t)}var Hl=gn(function(t,e){if(ze||va(e)||rl(e)){fn(e,gu(e),t);return}for(var i in e){if(Kt.call(e,i)){Mr(t,i,e[i])}}});var Yl=gn(function(t,e){if(ze||va(e)||rl(e)){fn(e,vu(e),t);return}for(var i in e){Mr(t,i,e[i])}});var Kl=gn(function(t,e,i,r){fn(e,vu(e),t,r)});var $l=gn(function(t,e,i,r){fn(e,gu(e),t,r)});var Jl=Xh(function(t,e){return kr(t,Hr(e,1))});function Zl(t,e){var i=Ur(t);return e?Lr(i,e):i}var Ql=Xh(function(t){t.push(n,Er);return $e(Kl,n,t)});var tu=Xh(function(t){t.push(n,ba);return $e(bu,n,t)});function eu(t,e){return li(t,qn(e,3),$r)}function iu(t,e){return li(t,qn(e,3),Jr)}function ru(t,e){return t==null?t:Yr(t,qn(e,3),vu)}function su(t,e){return t==null?t:Kr(t,qn(e,3),vu)}function nu(t,e){return t&&$r(t,qn(e,3))}function au(t,e){return t&&Jr(t,qn(e,3))}function ou(t){return t==null?[]:Zr(t,gu(t))}function hu(t){return t==null?[]:Zr(t,vu(t))}function lu(t,e,i){var r=t==null?n:Qr(t,e);return r===n?i:r}function uu(t,e){return t!=null&&ia(t,e,is)}function cu(t,e){return t!=null&&ia(t,e,rs)}var fu=Sn(function(t,e,i){t[e]=i},xc(_c));var du=Sn(function(t,e,i){if(Kt.call(t,e)){t[e].push(i)}else{t[e]=[i]}},qn);var pu=Xh(os);function gu(t){var e=va(t);if(!(e||rl(t))){return ds(t)}var i=aa(t),r=!!i,s=i||[],n=s.length;for(var a in t){if(is(t,a)&&!(r&&(a=="length"||la(a,n)))&&!(e&&a=="constructor")){s.push(a)}}return s}function vu(t){var e=-1,i=va(t),r=ps(t),s=r.length,n=aa(t),a=!!n,o=n||[],h=o.length;while(++e<s){var l=r[e];if(!(a&&(l=="length"||la(l,h)))&&!(l=="constructor"&&(i||!Kt.call(t,l)))){o.push(l)}}return o}function mu(t,e){var i={};e=qn(e,3);$r(t,function(t,r,s){i[e(t,r,s)]=t});return i}function yu(t,e){var i={};e=qn(e,3);$r(t,function(t,r,s){i[r]=e(t,r,s)});return i}var xu=gn(function(t,e,i){xs(t,e,i)});var bu=gn(function(t,e,i,r){xs(t,e,i,r)});var wu=Xh(function(t,e){if(t==null){return{}}e=si(Hr(e,1),Ca);return Ps(t,Nr(jn(t),e))});function _u(t,e){e=qn(e);return Ts(t,function(t,i){return!e(t,i)})}var Pu=Xh(function(t,e){return t==null?{}:Ps(t,si(Hr(e,1),Ca))});function Tu(t,e){return t==null?{}:Ts(t,qn(e))}function Cu(t,e,i){e=ca(e,t)?[e]:$s(e);var r=-1,s=e.length;if(!s){t=n;s=1}while(++r<s){var a=t==null?n:t[Ca(e[r])];if(a===n){r=s;a=i}t=pl(a)?a.call(t):a}return t}function Su(t,e,i){return t==null?t:Bs(t,e,i)}function Au(t,e,i,r){r=typeof r=="function"?r:n;return t==null?t:Bs(t,e,i,r)}var Eu=Fn(gu);var Iu=Fn(vu);function Mu(t,e,i){var r=el(t)||Ll(t);e=qn(e,4);if(i==null){if(r||ml(t)){var s=t.constructor;if(r){i=el(t)?new s:[]}else{i=pl(s)?Ur(Jn(t)):{}}}else{i={}}}(r?Ze:$r)(t,function(t,r,s){return e(i,t,r,s)});return i}function Ru(t,e){return t==null?true:js(t,e)}function Bu(t,e,i){return t==null?t:Ws(t,e,Ks(i))}function Lu(t,e,i,r){r=typeof r=="function"?r:n;return t==null?t:Ws(t,e,Ks(i),r)}function ku(t){return t?bi(t,gu(t)):[]}function Ou(t){return t==null?[]:bi(t,vu(t))}function Fu(t,e,i){if(i===n){i=e;e=n}if(i!==n){i=Wl(i);i=i===i?i:0}if(e!==n){e=Wl(e);e=e===e?e:0}return Or(Wl(t),e,i)}function Du(t,e,i){e=Wl(e)||0;if(i===n){i=e;e=0}else{i=Wl(i)||0}t=Wl(t);return ss(t,e,i)}function Uu(t,e,i){if(i&&typeof i!="boolean"&&ua(t,e,i)){e=i=n}if(i===n){if(typeof e=="boolean"){i=e;e=n}else if(typeof t=="boolean"){i=t;t=n}}if(t===n&&e===n){t=0;e=1}else{t=Wl(t)||0;if(e===n){e=t;t=0}else{e=Wl(e)||0}}if(t>e){var r=t;t=e;e=r}if(i||t%1||e%1){var s=we();return xe(t+s*(e-t+Ge("1e-"+((s+"").length-1))),e)}return Is(t,e)}var Gu=bn(function(t,e,i){e=e.toLowerCase();return t+(i?Nu(e):e)});function Nu(t){return dc(ql(t).toLowerCase())}function Xu(t){t=ql(t);return t&&t.replace(Gt,Si).replace(Se,"")}function ju(t,e,i){t=ql(t);e=Ns(e);var r=t.length;i=i===n?r:Or(Xl(i),0,r);i-=e.length;return i>=0&&t.indexOf(e,i)==i}function Wu(t){t=ql(t);return t&&mt.test(t)?t.replace(gt,Ai):t}function zu(t){t=ql(t);return t&&Ct.test(t)?t.replace(Tt,"\\$&"):t}var Vu=bn(function(t,e,i){return t+(i?"-":"")+e.toLowerCase()});var qu=bn(function(t,e,i){return t+(i?" ":"")+e.toLowerCase()});var Hu=xn("toLowerCase");function Yu(t,e,i){t=ql(t);e=Xl(e);var r=e?Di(t):0;if(!e||r>=e){return t}var s=(e-r)/2;return In(de(s),i)+t+In(fe(s),i)}function Ku(t,e,i){t=ql(t);e=Xl(e);var r=e?Di(t):0;return e&&r<e?t+In(e-r,i):t}function $u(t,e,i){t=ql(t);e=Xl(e);var r=e?Di(t):0;return e&&r<e?In(e-r,i)+t:t}function Ju(t,e,i){if(i||e==null){e=0}else if(e){e=+e}t=ql(t).replace(St,"");return be(t,e||(Lt.test(t)?16:10))}function Zu(t,e,i){if(i?ua(t,e,i):e===n){e=1}else{e=Xl(e)}return Rs(ql(t),e)}function Qu(){var t=arguments,e=ql(t[0]);return t.length<3?e:_e.call(e,t[1],t[2])}var tc=bn(function(t,e,i){return t+(i?"_":"")+e.toLowerCase()});function ec(t,e,i){if(i&&typeof i!="number"&&ua(t,e,i)){e=i=n}i=i===n?k:i>>>0;if(!i){return[]}t=ql(t);if(t&&(typeof e=="string"||e!=null&&!El(e))){e=Ns(e);if(e==""&&Ie.test(t)){return Js(Ui(t),0,i)}}return Te.call(t,e,i)}var ic=bn(function(t,e,i){return t+(i?" ":"")+dc(e)});function rc(t,e,i){t=ql(t);i=Or(Xl(i),0,t.length);return t.lastIndexOf(Ns(e),i)==i}function sc(t,e,i){var r=Yi.templateSettings;if(i&&ua(t,e,i)){e=n}t=ql(t);e=Kl({},e,r,Er);var a=Kl({},e.imports,r.imports,Er),o=gu(a),h=bi(a,o);var l,u,c=0,f=e.interpolate||Nt,d="__p += '";var p=s((e.escape||Nt).source+"|"+f.source+"|"+(f===bt?Rt:Nt).source+"|"+(e.evaluate||Nt).source+"|$","g");var g="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++Be+"]")+"\n";t.replace(p,function(e,i,r,s,n,a){r||(r=s);d+=t.slice(c,a).replace(Xt,Ei);if(i){l=true;d+="' +\n__e("+i+") +\n'"}if(n){u=true;d+="';\n"+n+";\n__p += '"}if(r){d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"}c=a+e.length;return e});d+="';\n";var v=e.variable;if(!v){d="with (obj) {\n"+d+"\n}\n"}d=(u?d.replace(ct,""):d).replace(ft,"$1").replace(dt,"$1;");d="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(l?", __e = _.escape":"")+(u?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var m=gc(function(){return Function(o,g+"return "+d).apply(n,h)});m.source=d;if(fl(m)){throw m}return m}function nc(t){return ql(t).toLowerCase()}function ac(t){return ql(t).toUpperCase()}function oc(t,e,i){t=ql(t);if(t&&(i||e===n)){return t.replace(St,"")}if(!t||!(e=Ns(e))){return t}var r=Ui(t),s=Ui(e),a=_i(r,s),o=Pi(r,s)+1;return Js(r,a,o).join("")}function hc(t,e,i){t=ql(t);if(t&&(i||e===n)){return t.replace(Et,"")}if(!t||!(e=Ns(e))){return t}var r=Ui(t),s=Pi(r,Ui(e))+1;return Js(r,0,s).join("")}function lc(t,e,i){t=ql(t);if(t&&(i||e===n)){return t.replace(At,"")}if(!t||!(e=Ns(e))){return t}var r=Ui(t),s=_i(r,Ui(e));return Js(r,s).join("")}function uc(t,e){var i=P,r=T;if(ml(e)){var a="separator"in e?e.separator:a;i="length"in e?Xl(e.length):i;r="omission"in e?Ns(e.omission):r}t=ql(t);var o=t.length;if(Ie.test(t)){var h=Ui(t);o=h.length}if(i>=o){return t}var l=i-Di(r);if(l<1){return r}var u=h?Js(h,0,l).join(""):t.slice(0,l);if(a===n){return u+r}if(h){l+=u.length-l}if(El(a)){if(t.slice(l).search(a)){var c,f=u;if(!a.global){a=s(a.source,ql(Bt.exec(a))+"g")}a.lastIndex=0;while(c=a.exec(f)){var d=c.index}u=u.slice(0,d===n?l:d)}}else if(t.indexOf(Ns(a),l)!=l){var p=u.lastIndexOf(a);if(p>-1){u=u.slice(0,p)}}return u+r}function cc(t){t=ql(t);return t&&vt.test(t)?t.replace(pt,Gi):t}var fc=bn(function(t,e,i){return t+(i?" ":"")+e.toUpperCase()});var dc=xn("toUpperCase");function pc(t,e,i){t=ql(t);e=i?n:e;if(e===n){e=Me.test(t)?Ee:It}return t.match(e)||[]}var gc=Xh(function(t,e){try{return $e(t,n,e)}catch(t){return fl(t)?t:new i(t)}});var vc=Xh(function(t,e){Ze(Hr(e,1),function(e){e=Ca(e);t[e]=Sh(t[e],t)});return t});function mc(t){var e=t?t.length:0,i=qn();t=!e?[]:si(t,function(t){if(typeof t[1]!="function"){throw new jt(h)}return[i(t[0]),t[1]]});return Xh(function(i){var r=-1;while(++r<e){var s=t[r];if($e(s[0],this,i)){return $e(s[1],this,i)}}})}function yc(t){return Dr(Fr(t,true))}function xc(t){return function(){return t}}var bc=Tn();var wc=Tn(true);function _c(t){return t}function Pc(t){return fs(typeof t=="function"?t:Fr(t,true))}function Tc(t){return ms(Fr(t,true))}function Cc(t,e){return ys(t,Fr(e,true))}var Sc=Xh(function(t,e){return function(i){return os(i,t,e)}});var Ac=Xh(function(t,e){return function(i){return os(t,i,e)}});function Ec(t,e,i){var r=gu(e),s=Zr(e,r);if(i==null&&!(ml(e)&&(s.length||!r.length))){i=e;e=t;t=this;s=Zr(e,gu(e))}var n=!(ml(i)&&"chain"in i)||!!i.chain,a=pl(t);Ze(s,function(i){var r=e[i];t[i]=r;if(a){t.prototype[i]=function(){var e=this.__chain__;if(n||e){var i=t(this.__wrapped__),s=i.__actions__=cn(this.__actions__);s.push({func:r,args:arguments,thisArg:t});i.__chain__=e;return i}return r.apply(t,ni([this.value()],arguments))}}});return t}function Ic(){if(He._===this){He._=Qt}return this}function Mc(){}function Rc(t){t=Xl(t);return Xh(function(e){return ws(e,t)})}var Bc=En(si);var Lc=En(ti);var kc=En(hi);function Oc(t){return ca(t)?Cs(Ca(t)):Ss(t)}function Fc(t){return function(e){return t==null?n:Qr(t,e)}}var Dc=Rn();var Uc=Rn(true);function Gc(){return[]}function Nc(){return false}function Xc(){return{}}function jc(){return""}function Wc(){return true}function zc(t,e){t=Xl(t);if(t<1||t>R){return[]}var i=k,r=xe(t,k);e=qn(e);t-=k;var s=mi(r,e);while(++i<t){e(i)}return s}function Vc(t){if(el(t)){return si(t,Ca)}return Bl(t)?[t]:cn(Ta(t))}function qc(t){var e=++$t;return ql(t)+e}var Hc=An(function(t,e){return t+e});var Yc=kn("ceil");var Kc=An(function(t,e){return t/e});var $c=kn("floor");function Jc(t){return t&&t.length?zr(t,_c,es):n}function Zc(t,e){return t&&t.length?zr(t,qn(e),es):n}function Qc(t){return di(t,_c)}function tf(t,e){return di(t,qn(e))}function ef(t){return t&&t.length?zr(t,_c,gs):n}function rf(t,e){return t&&t.length?zr(t,qn(e),gs):n}var sf=An(function(t,e){return t*e});var nf=kn("round");var af=An(function(t,e){return t-e});function of(t){return t&&t.length?vi(t,_c):0}function hf(t,e){return t&&t.length?vi(t,qn(e)):0}Yi.after=Ph;Yi.ary=Th;Yi.assign=Hl;Yi.assignIn=Yl;Yi.assignInWith=Kl;Yi.assignWith=$l;Yi.at=Jl;Yi.before=Ch;Yi.bind=Sh;Yi.bindAll=vc;Yi.bindKey=Ah;Yi.castArray=qh;Yi.chain=Go;Yi.chunk=Ea;Yi.compact=Ia;Yi.concat=Ma;Yi.cond=mc;Yi.conforms=yc;Yi.constant=xc;Yi.countBy=$o;Yi.create=Zl;Yi.curry=Eh;Yi.curryRight=Ih;Yi.debounce=Mh;Yi.defaults=Ql;Yi.defaultsDeep=tu;Yi.defer=Rh;Yi.delay=Bh;Yi.difference=Ra;Yi.differenceBy=Ba;Yi.differenceWith=La;Yi.drop=ka;Yi.dropRight=Oa;Yi.dropRightWhile=Fa;Yi.dropWhile=Da;Yi.fill=Ua;Yi.filter=Zo;Yi.flatMap=eh;Yi.flatMapDeep=ih;Yi.flatMapDepth=rh;Yi.flatten=Xa;Yi.flattenDeep=ja;Yi.flattenDepth=Wa;Yi.flip=Lh;Yi.flow=bc;Yi.flowRight=wc;Yi.fromPairs=za;Yi.functions=ou;Yi.functionsIn=hu;Yi.groupBy=ah;Yi.initial=Ha;Yi.intersection=Ya;Yi.intersectionBy=Ka;Yi.intersectionWith=$a;Yi.invert=fu;Yi.invertBy=du;Yi.invokeMap=hh;Yi.iteratee=Pc;Yi.keyBy=lh;Yi.keys=gu;Yi.keysIn=vu;Yi.map=uh;Yi.mapKeys=mu;Yi.mapValues=yu;Yi.matches=Tc;Yi.matchesProperty=Cc;Yi.memoize=kh;Yi.merge=xu;Yi.mergeWith=bu;Yi.method=Sc;Yi.methodOf=Ac;Yi.mixin=Ec;Yi.negate=Oh;Yi.nthArg=Rc;Yi.omit=wu;Yi.omitBy=_u;Yi.once=Fh;Yi.orderBy=ch;Yi.over=Bc;Yi.overArgs=Dh;Yi.overEvery=Lc;Yi.overSome=kc;Yi.partial=Uh;Yi.partialRight=Gh;Yi.partition=fh;Yi.pick=Pu;Yi.pickBy=Tu;Yi.property=Oc;Yi.propertyOf=Fc;Yi.pull=eo;Yi.pullAll=io;Yi.pullAllBy=ro;Yi.pullAllWith=so;Yi.pullAt=no;Yi.range=Dc;Yi.rangeRight=Uc;Yi.rearg=Nh;Yi.reject=gh;Yi.remove=ao;Yi.rest=Xh;Yi.reverse=oo;Yi.sampleSize=mh;Yi.set=Su;Yi.setWith=Au;Yi.shuffle=yh;Yi.slice=ho;Yi.sortBy=wh;Yi.sortedUniq=vo;Yi.sortedUniqBy=mo;Yi.split=ec;Yi.spread=jh;Yi.tail=yo;Yi.take=xo;Yi.takeRight=bo;Yi.takeRightWhile=wo;Yi.takeWhile=_o;Yi.tap=No;Yi.throttle=Wh;Yi.thru=Xo;Yi.toArray=Gl;Yi.toPairs=Eu;Yi.toPairsIn=Iu;Yi.toPath=Vc;Yi.toPlainObject=zl;Yi.transform=Mu;Yi.unary=zh;Yi.union=Po;Yi.unionBy=To;Yi.unionWith=Co;Yi.uniq=So;Yi.uniqBy=Ao;Yi.uniqWith=Eo;Yi.unset=Ru;Yi.unzip=Io;Yi.unzipWith=Mo;Yi.update=Bu;Yi.updateWith=Lu;Yi.values=ku;Yi.valuesIn=Ou;Yi.without=Ro;Yi.words=pc;Yi.wrap=Vh;Yi.xor=Bo;Yi.xorBy=Lo;Yi.xorWith=ko;Yi.zip=Oo;Yi.zipObject=Fo;Yi.zipObjectDeep=Do;Yi.zipWith=Uo;Yi.entries=Eu;Yi.entriesIn=Iu;Yi.extend=Yl;Yi.extendWith=Kl;Ec(Yi,Yi);Yi.add=Hc;Yi.attempt=gc;Yi.camelCase=Gu;Yi.capitalize=Nu;Yi.ceil=Yc;Yi.clamp=Fu;Yi.clone=Hh;Yi.cloneDeep=Kh;Yi.cloneDeepWith=$h;Yi.cloneWith=Yh;Yi.deburr=Xu;Yi.divide=Kc;Yi.endsWith=ju;Yi.eq=Jh;Yi.escape=Wu;Yi.escapeRegExp=zu;Yi.every=Jo;Yi.find=Qo;Yi.findIndex=Ga;Yi.findKey=eu;Yi.findLast=th;Yi.findLastIndex=Na;Yi.findLastKey=iu;Yi.floor=$c;Yi.forEach=sh;Yi.forEachRight=nh;Yi.forIn=ru;Yi.forInRight=su;Yi.forOwn=nu;Yi.forOwnRight=au;Yi.get=lu;Yi.gt=Zh;Yi.gte=Qh;Yi.has=uu;Yi.hasIn=cu;Yi.head=Va;Yi.identity=_c;Yi.includes=oh;Yi.indexOf=qa;Yi.inRange=Du;Yi.invoke=pu;Yi.isArguments=tl;Yi.isArray=el;Yi.isArrayBuffer=il;Yi.isArrayLike=rl;Yi.isArrayLikeObject=sl;Yi.isBoolean=nl;Yi.isBuffer=al;Yi.isDate=ol;Yi.isElement=hl;Yi.isEmpty=ll;Yi.isEqual=ul;Yi.isEqualWith=cl;Yi.isError=fl;Yi.isFinite=dl;Yi.isFunction=pl;Yi.isInteger=gl;Yi.isLength=vl;Yi.isMap=xl;Yi.isMatch=bl;Yi.isMatchWith=wl;Yi.isNaN=_l;Yi.isNative=Pl;Yi.isNil=Cl;Yi.isNull=Tl;Yi.isNumber=Sl;Yi.isObject=ml;Yi.isObjectLike=yl;Yi.isPlainObject=Al;Yi.isRegExp=El;Yi.isSafeInteger=Il;Yi.isSet=Ml;Yi.isString=Rl;Yi.isSymbol=Bl;Yi.isTypedArray=Ll;Yi.isUndefined=kl;Yi.isWeakMap=Ol;Yi.isWeakSet=Fl;Yi.join=Ja;Yi.kebabCase=Vu;Yi.last=Za;Yi.lastIndexOf=Qa;Yi.lowerCase=qu;Yi.lowerFirst=Hu;Yi.lt=Dl;Yi.lte=Ul;Yi.max=Jc;Yi.maxBy=Zc;Yi.mean=Qc;Yi.meanBy=tf;Yi.min=ef;Yi.minBy=rf;Yi.stubArray=Gc;Yi.stubFalse=Nc;Yi.stubObject=Xc;Yi.stubString=jc;Yi.stubTrue=Wc;Yi.multiply=sf;Yi.nth=to;Yi.noConflict=Ic;Yi.noop=Mc;Yi.now=_h;Yi.pad=Yu;Yi.padEnd=Ku;Yi.padStart=$u;Yi.parseInt=Ju;Yi.random=Uu;Yi.reduce=dh;Yi.reduceRight=ph;Yi.repeat=Zu;Yi.replace=Qu;Yi.result=Cu;Yi.round=nf;Yi.runInContext=Ni;Yi.sample=vh;Yi.size=xh;Yi.snakeCase=tc;Yi.some=bh;Yi.sortedIndex=lo;Yi.sortedIndexBy=uo;Yi.sortedIndexOf=co;Yi.sortedLastIndex=fo;Yi.sortedLastIndexBy=po;Yi.sortedLastIndexOf=go;Yi.startCase=ic;Yi.startsWith=rc;Yi.subtract=af;Yi.sum=of;Yi.sumBy=hf;Yi.template=sc;Yi.times=zc;Yi.toFinite=Nl;Yi.toInteger=Xl;Yi.toLength=jl;Yi.toLower=nc;Yi.toNumber=Wl;Yi.toSafeInteger=Vl;Yi.toString=ql;Yi.toUpper=ac;Yi.trim=oc;Yi.trimEnd=hc;Yi.trimStart=lc;Yi.truncate=uc;Yi.unescape=cc;Yi.uniqueId=qc;Yi.upperCase=fc;Yi.upperFirst=dc;Yi.each=sh;Yi.eachRight=nh;Yi.first=Va;Ec(Yi,function(){var t={};$r(Yi,function(e,i){if(!Kt.call(Yi.prototype,i)){t[i]=e}});return t}(),{chain:false});Yi.VERSION=a;Ze(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){Yi[t].placeholder=Yi});Ze(["drop","take"],function(t,e){Ji.prototype[t]=function(i){var r=this.__filtered__;if(r&&!e){return new Ji(this)}i=i===n?1:ye(Xl(i),0);var s=this.clone();if(r){s.__takeCount__=xe(i,s.__takeCount__)}else{s.__views__.push({size:xe(i,k),type:t+(s.__dir__<0?"Right":"")})}return s};Ji.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}});Ze(["filter","map","takeWhile"],function(t,e){var i=e+1,r=i==A||i==I;Ji.prototype[t]=function(t){var e=this.clone();e.__iteratees__.push({iteratee:qn(t,3),type:i});e.__filtered__=e.__filtered__||r;return e}});Ze(["head","last"],function(t,e){var i="take"+(e?"Right":"");Ji.prototype[t]=function(){return this[i](1).value()[0]}});Ze(["initial","tail"],function(t,e){var i="drop"+(e?"":"Right");Ji.prototype[t]=function(){return this.__filtered__?new Ji(this):this[i](1)}});Ji.prototype.compact=function(){return this.filter(_c)};Ji.prototype.find=function(t){return this.filter(t).head()};Ji.prototype.findLast=function(t){return this.reverse().find(t)};Ji.prototype.invokeMap=Xh(function(t,e){if(typeof t=="function"){return new Ji(this)}return this.map(function(i){return os(i,t,e)})});Ji.prototype.reject=function(t){t=qn(t,3);return this.filter(function(e){return!t(e)})};Ji.prototype.slice=function(t,e){t=Xl(t);var i=this;if(i.__filtered__&&(t>0||e<0)){return new Ji(i)}if(t<0){i=i.takeRight(-t)}else if(t){i=i.drop(t)}if(e!==n){e=Xl(e);i=e<0?i.dropRight(-e):i.take(e-t)}return i};Ji.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()};Ji.prototype.toArray=function(){return this.take(k)};$r(Ji.prototype,function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),s=Yi[r?"take"+(e=="last"?"Right":""):e],a=r||/^find/.test(e);if(!s){return}Yi.prototype[e]=function(){var e=this.__wrapped__,o=r?[1]:arguments,h=e instanceof Ji,l=o[0],u=h||el(e);var c=function(t){var e=s.apply(Yi,ni([t],o));return r&&f?e[0]:e};if(u&&i&&typeof l=="function"&&l.length!=1){h=u=false}var f=this.__chain__,d=!!this.__actions__.length,p=a&&!f,g=h&&!d;if(!a&&u){e=g?e:new Ji(this);var v=t.apply(e,o);v.__actions__.push({func:Xo,args:[c],thisArg:n});return new $i(v,f)}if(p&&g){return t.apply(this,o)}v=this.thru(c);return p?r?v.value()[0]:v.value():v}});Ze(["pop","push","shift","sort","splice","unshift"],function(t){var e=Wt[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Yi.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var s=this.value();return e.apply(el(s)?s:[],t)}return this[i](function(i){return e.apply(el(i)?i:[],t)})}});$r(Ji.prototype,function(t,e){var i=Yi[e];if(i){var r=i.name+"",s=Ve[r]||(Ve[r]=[]);s.push({name:e,func:i})}});Ve[Cn(n,f).name]=[{name:"wrapper",func:n}];Ji.prototype.clone=Zi;Ji.prototype.reverse=Qi;Ji.prototype.value=tr;Yi.prototype.at=jo;Yi.prototype.chain=Wo;Yi.prototype.commit=zo;Yi.prototype.next=Vo;Yi.prototype.plant=Ho;Yi.prototype.reverse=Yo;Yi.prototype.toJSON=Yi.prototype.valueOf=Yi.prototype.value=Ko;if(oe){Yi.prototype[oe]=qo}return Yi}var Xi=Ni();(Ve||{})._=Xi;if(true){!(s=function(){return Xi}.call(e,i,e,t),s!==n&&(t.exports=s))}else if(je){(je.exports=Xi)._=Xi;Xe._=Xi}else{He._=Xi}}).call(this)}).call(e,i(10)(t),i(11))},function(t,e,i){"use strict";var r={};r.randInRange=function(t,e){var i=Math.random()*360*(Math.PI/180);var r=Math.random()*e*.5;return{x:t.x+Math.cos(i)*r,y:t.y+Math.sin(i)*r}};r.mod=function(t,e){return(t%e+e)%e};r.angleBetween=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)};r.angleBetweenRad=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)*(180/Math.PI)};r.radPos=function(t,e,i){var r=e*(Math.PI/180);return{x:t.x+Math.cos(r)*i,y:t.y+Math.sin(r)*i}};r.dist=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))};r.setBtn=function(t,e){if(e===undefined)e=null;if(!t)return;if(!t.inputEnabled)t.inputEnabled=true;if(!t.input)return;t.input.useHandCursor=true;if(e){t.events.onInputUp.add(function(t){e(t)})}return t};r.setBtnHold=function(t,e,i){if(e===undefined)e=null;if(!t)return;if(!t.inputEnabled)t.inputEnabled=true;if(!t.input)return;t.input.useHandCursor=true;if(e){t.events.onInputDown.add(function(t){e(t)})}if(i){t.events.onInputUp.add(function(t){i(t)})}return t};r.loadAssets=function(t,e){var i;for(i in e.atlas){t.load.atlasJSONHash(i,e.atlas[i].image,e.atlas[i].jsonUrl,e.atlas[i].json)}for(i in e.images)t.load.image(i,e.images[i]);for(i in e.sprites)t.load.spritesheet(i,e.sprites[i].image,e.sprites[i].width,e.sprites[i].height,e.sprites[i].frames);for(i in e.audio)t.load.audio(i,e.audio[i])};r.setHover=function(t,e,i){if(e===undefined)e=null;if(i===undefined)i=null;if(!t)return;if(!t.inputEnabled)t.inputEnabled=true;if(!t.input)return;t.input.useHandCursor=true;if(e){t.events.onInputOver.add(function(t){e(t)})}if(i){t.events.onInputOut.add(function(t){i(t)})}return t};r.isEven=function(t){return t%2==0};r.isOdd=function(t){return!!(t%2)};t.exports=r},function(t,e,i){"use strict";t.exports={skin:{frames:1,name:"Skin",icon:6,mode:"profile",maxColors:1,banZ:[1,2,3,4,5,6,7,8,9,10]},shirt:{frames:21,name:"Shirt",icon:3,layers:[1,[0,2,4,5,6,7,8,10,12,14,16,17,18,19,20,21],[0,3,0,0,0,0,9,11,13,15,0,0,0,0,0,0]],arrows:{female:[[30,140],[170,140]],male:[[10,170],[190,170]]},mode:"uniform",maxColors:3,banZ:[11,12,13]},short:{frames:11,name:"Short",icon:1,layers:[1,[0,2,4,5,6,7,9,10,11],[0,3,0,0,0,8,0,0,0]],arrows:{female:[[30,190],[175,190]],male:[[20,240],[180,240]]},mode:"uniform",maxColors:3,banZ:[11,12,13]},socks:{frames:9,name:"Socks",icon:0,layers:[1,[0,2,4,5,7,8],[0,3,0,6,0,9]],arrows:{female:[[25,260],[185,260]],male:[[20,310],[185,310]]},mode:"uniform",maxColors:3,banZ:[11,12,13]},shoes:{frames:7,name:"Cleats",icon:2,arrows:{female:[[35,330],[195,330]],male:[[0,350],[200,350]]},layers:[1,[2,3,4,5,6,7]],mode:"profile",maxColors:3,banZ:[11,12,13]},hair:{frames:5,name:"Hair",icon:4,arrows:{female:[[0,70],[210,70]],male:[[0,70],[205,70]]},mode:"profile",maxColors:2,banZ:[11,12,13]},eyeBkg:{frames:5},eye:{frames:5,name:"Eyes",icon:5,link:"eyeBkg",arrows:{female:[[20,70],[185,70]],male:[[20,80],[185,80]]},mode:"profile",maxColors:1,banZ:[10,8,7,6,11,12,13,9,5]}}},function(t,e,i){"use strict";t.exports={0:{color:"0000aa",x:58.4,y:16.4,z:7},1:{color:"1100aa",x:71.3,y:16.4,z:7},2:{color:"3300aa",x:84.6,y:16.4,z:7},3:{color:"5500aa",x:97.7,y:16.4,z:7},4:{color:"7700aa",x:111,y:16.4,z:7},5:{color:"9900aa",x:124.1,y:16.4,z:7},6:{color:"aa00aa",x:137.1,y:16.4,z:7},7:{color:"0022aa",x:51.9,y:28.3,z:7},8:{color:"0005C5",x:65,y:28.3,z:6},9:{color:"2000C5",x:78.1,y:28.3,z:6},10:{color:"4B00C5",x:91.2,y:28.3,z:6},11:{color:"7900C5",x:104.5,y:28.3,z:6},12:{color:"A500C5",x:117.6,y:28.3,z:6},13:{color:"C500C0",x:130.6,y:28.3,z:6},14:{color:"aa0088",x:143.9,y:28.3,z:7},15:{color:"0044aa",x:45.3,y:39.9,z:7},16:{color:"0029C5",x:58.5,y:39.9,z:6},17:{color:"0A11FF",x:71.5,y:39.9,z:5},18:{color:"3F0AFF",x:84.6,y:39.9,z:5},19:{color:"840AFF",x:97.9,y:39.9,z:5},20:{color:"CA0AFF",x:111,y:39.9,z:5},21:{color:"FF0AF8",x:124,y:39.9,z:5},22:{color:"C5009B",x:137.3,y:39.9,z:6},23:{color:"aa0077",x:149.7,y:40,z:7},24:{color:"0055aa",x:38.4,y:51.6,z:7},25:{color:"0052C5",x:51.6,y:51.6,z:6},26:{color:"0A4AFF",x:64.8,y:51.6,z:5},27:{color:"4E53FF",x:78,y:51.6,z:4},28:{color:"844EFF",x:91.2,y:51.6,z:4},29:{color:"C84EFF",x:104.4,y:51.6,z:4},30:{color:"FF4EFA",x:117.4,y:51.6,z:4},31:{color:"FF0ABE",x:130.6,y:51.6,z:5},32:{color:"C50072",x:143.8,y:51.7,z:6},33:{color:"aa0055",x:157,y:51.7,z:7},34:{color:"0077aa",x:31.8,y:63.4,z:7},35:{color:"007CC5",x:45,y:63.4,z:6},36:{color:"0A8BFF",x:58.2,y:63.4,z:5},37:{color:"4E8CFF",x:71.3,y:63.4,z:4},38:{color:"9396FF",x:84.6,y:63.4,z:3},39:{color:"C993FF",x:97.7,y:63.4,z:3},40:{color:"FF93FC",x:110.8,y:63.4,z:3},41:{color:"FF4EC1",x:124,y:63.4,z:4},42:{color:"FF0A7E",x:137.2,y:63.4,z:5},43:{color:"C50048",x:150.4,y:63.4,z:6},44:{color:"aa0033",x:163.6,y:63.4,z:7},45:{color:"0099aa",x:25.2,y:75,z:7},46:{color:"00A3C5",x:38.4,y:75,z:6},47:{color:"0AC9FF",x:51.6,y:75,z:5},48:{color:"4ECAFF",x:64.8,y:75,z:4},49:{color:"93CBFF",x:78,y:75,z:3},50:{color:"D7D8FF",x:91.2,y:75,z:2},51:{color:"FFD7FD",x:104.2,y:75,z:2},52:{color:"FF93C6",x:117.4,y:75,z:3},53:{color:"FF4E83",x:130.6,y:75.1,z:4},54:{color:"FF0A3F",x:143.9,y:75.1,z:5},55:{color:"C50021",x:157,y:75.1,z:6},56:{color:"aa0011",x:170.2,y:75,z:7},57:{color:"00aaaa",x:18.6,y:86.7,z:7},58:{color:"00C5C5",x:31.7,y:86.7,z:6},59:{color:"00FFFF",x:45,y:86.7,z:5},60:{color:"4EFFFF",x:58.1,y:86.7,z:4},61:{color:"93FFFF",x:71.3,y:86.7,z:3},62:{color:"D7FFFF",x:84.5,y:86.7,z:2},63:{color:"FFFFFF",x:97.5,y:86.7,z:1},64:{color:"FFD7D7",x:110.8,y:86.7,z:2},65:{color:"FF9393",x:124,y:86.8,z:3},66:{color:"FF4E4E",x:137.2,y:86.8,z:4},67:{color:"FF0000",x:150.4,y:86.8,z:5},68:{color:"C50000",x:163.6,y:86.7,z:6},69:{color:"aa0000",x:176.8,y:86.7,z:7},70:{color:"00aa99",x:25.2,y:98.6,z:7},71:{color:"00C5A3",x:38.3,y:98.6,z:6},72:{color:"0AFFC9",x:51.5,y:98.6,z:5},73:{color:"4EFFCA",x:64.7,y:98.6,z:4},74:{color:"93FFCB",x:77.9,y:98.6,z:3},75:{color:"D7FFD8",x:91.1,y:98.6,z:2},76:{color:"FFFDD7",x:104.1,y:98.6,z:2},77:{color:"FFC693",x:117.3,y:98.6,z:3},78:{color:"FF834E",x:130.6,y:98.6,z:4},79:{color:"FF3F0A",x:143.8,y:98.6,z:5},80:{color:"C52100",x:156.9,y:98.6,z:6},81:{color:"aa1100",x:170.2,y:98.6,z:7},82:{color:"00aa77",x:31.7,y:110.2,z:7},83:{color:"00C57C",x:44.9,y:110.2,z:6},84:{color:"0AFF8B",x:58.1,y:110.2,z:5},85:{color:"4EFF8C",x:71.3,y:110.2,z:4},86:{color:"93FF96",x:84.5,y:110.2,z:3},87:{color:"C9FF93",x:97.7,y:110.2,z:3},88:{color:"FEFB93",x:110.7,y:110.2,z:3},89:{color:"FEC04E",x:123.9,y:110.2,z:4},90:{color:"FF7E0A",x:137.1,y:110.3,z:5},91:{color:"C54800",x:150.3,y:110.3,z:6},92:{color:"aa3300",x:163.5,y:110.3,z:7},93:{color:"00aa55",x:38.3,y:122.2,z:7},94:{color:"00C552",x:51.5,y:122.2,z:6},95:{color:"0AFF4A",x:64.7,y:122.2,z:5},96:{color:"4EFF53",x:77.9,y:122.2,z:4},97:{color:"84FF4E",x:91.1,y:122.2,z:4},98:{color:"C8FF4E",x:104.3,y:122.2,z:4},99:{color:"FDF84E",x:117.3,y:122.2,z:4},100:{color:"FFBE0A",x:130.5,y:122.2,z:5},101:{color:"C57200",x:143.7,y:122.2,z:6},102:{color:"aa5500",x:156.9,y:122.2,z:7},103:{color:"00aa44",x:45,y:134,z:7},104:{color:"00C529",x:58.2,y:134,z:6},105:{color:"0AFF11",x:71.4,y:134,z:5},106:{color:"3FFF0A",x:84.6,y:134,z:5},107:{color:"84FF0A",x:97.8,y:134,z:5},108:{color:"C9FE0A",x:111,y:134,z:5},109:{color:"FDF60A",x:124,y:134,z:5},110:{color:"C59B00",x:137.2,y:134,z:6},111:{color:"aa7700",x:150.4,y:134.1,z:7},112:{color:"00aa22",x:51.6,y:145.9,z:7},113:{color:"00C505",x:64.8,y:145.9,z:6},114:{color:"20C500",x:78,y:145.9,z:6},115:{color:"4BC500",x:91.2,y:145.9,z:6},116:{color:"79C500",x:104.4,y:145.9,z:6},117:{color:"A5C500",x:117.5,y:145.9,z:6},118:{color:"C5C000",x:130.6,y:145.9,z:6},119:{color:"aa8800",x:143.8,y:145.9,z:7},120:{color:"00aa00",x:58.1,y:157.8,z:7},121:{color:"11aa00",x:71.3,y:157.8,z:7},122:{color:"33aa00",x:84.5,y:157.8,z:7},123:{color:"55aa00",x:97.7,y:157.8,z:7},124:{color:"77aa00",x:110.9,y:157.8,z:7},125:{color:"99aa00",x:124,y:157.8,z:7},126:{color:"aaaa00",x:137.1,y:157.8,z:7},127:{color:"f2f2f2",x:169.9,y:158.6,z:9},128:{color:"FFFFFF",x:162.5,y:170.4,z:9},129:{color:"E3E3E3",x:176.3,y:147.3,z:9},130:{color:"D2D2D2",x:182.7,y:136,z:9},131:{color:"BCBCBC",x:189.5,y:124,z:9},132:{color:"ACACAC",x:196.6,y:112.5,z:9},133:{color:"a0a0a0",x:203.4,y:101.5,z:9},134:{color:"969696",x:175.3,y:170.7,z:10},135:{color:"919191",x:182.7,y:158.6,z:10},136:{color:"828282",x:188.9,y:147.3,z:10},137:{color:"737373",x:195.4,y:135.9,z:10},138:{color:"646464",x:202.1,y:124.2,z:10},139:{color:"4e4e4e",x:209,y:113.9,z:10},140:{color:"2a2a2a",x:215.3,y:101.6,z:10},143:{color:"116600",x:63.3,y:169.3,z:8},144:{color:"226600",x:76.5,y:169.3,z:8},145:{color:"335500",x:89.7,y:169.3,z:8},146:{color:"335500",x:102.9,y:169.3,z:8},147:{color:"446600",x:116.1,y:169.3,z:8},148:{color:"556600",x:129.4,y:169.3,z:8},149:{color:"666600",x:142.6,y:169.3,z:8},150:{color:"665500",x:149.9,y:157.8,z:8},151:{color:"664400",x:157,y:145.9,z:8},152:{color:"663300",x:163.1,y:134.4,z:8},153:{color:"663300",x:169.8,y:122.4,z:8},154:{color:"552200",x:176.1,y:110,z:8},155:{color:"661100",x:183,y:98.6,z:8},156:{color:"660000",x:189.3,y:86.8,z:8},157:{color:"660011",x:183,y:75,z:8},158:{color:"660022",x:176.1,y:63.4,z:8},159:{color:"660033",x:169.8,y:51.6,z:8},160:{color:"660033",x:162.8,y:40,z:8},161:{color:"660044",x:156.5,y:28.3,z:8},162:{color:"660055",x:149.6,y:15.8,z:8},163:{color:"660066",x:142.9,y:4.6,z:8},164:{color:"550066",x:130.8,y:4.6,z:8},165:{color:"440066",x:117.6,y:4.6,z:8},166:{color:"330066",x:105,y:4.6,z:8},167:{color:"220066",x:92.2,y:4.6,z:8},168:{color:"220066",x:79,y:4.6,z:8},169:{color:"110066",x:65.8,y:4.6,z:8},170:{color:"000066",x:52.7,y:4.6,z:8},171:{color:"001166",x:45.4,y:16.5,z:8},172:{color:"002266",x:38.9,y:28.6,z:8},173:{color:"003366",x:32.2,y:40.3,z:8},174:{color:"004466",x:25.4,y:51.8,z:8},175:{color:"004466",x:19.3,y:63.4,z:8},176:{color:"005566",x:12.3,y:75.1,z:8},177:{color:"006666",x:6.6,y:87.1,z:8},178:{color:"006655",x:12.3,y:99.5,z:8},179:{color:"006644",x:19,y:110.9,z:8},180:{color:"006633",x:25,y:122.4,z:8},181:{color:"006633",x:32.2,y:134.4,z:8},182:{color:"006622",x:38.3,y:145.9,z:8},183:{color:"006611",x:44.9,y:157.5,z:8},184:{color:"006600",x:50.1,y:169.3,z:8},185:{color:"8D3E38",x:84.6,y:63.4,z:13},186:{color:"F0BE72",x:97.7,y:63.4,z:13},187:{color:"FFBF95",x:110.8,y:63.4,z:13},188:{color:"661D00",x:78,y:75,z:13},189:{color:"FEFDE8",x:91.2,y:75,z:12},190:{color:"FFE7D9",x:104.2,y:75,z:12},191:{color:"FFB28C",x:117.4,y:75,z:13},192:{color:"803616",x:71.3,y:86.7,z:13},193:{color:"FAD8BD",x:84.5,y:86.7,z:12},194:{color:"FFF2E8",x:97.5,y:86.7,z:11},195:{color:"FDCEAF",x:110.8,y:86.7,z:12},196:{color:"F9B2A8",x:124,y:86.8,z:13},197:{color:"A76F48",x:77.9,y:98.6,z:13},198:{color:"FEE2C6",x:91.1,y:98.6,z:12},199:{color:"FEDDB8",x:104.1,y:98.6,z:12},200:{color:"FFC693",x:117.3,y:98.6,z:13},201:{color:"F9AF9C",x:84.5,y:110.2,z:13},202:{color:"D29776",x:97.7,y:110.2,z:13},203:{color:"D8A482",x:110.7,y:110.2,z:13}}},function(t,e,i){"use strict";var r=i(1);var s=i(0);var n={options:{width:470,height:440,where:"master-canvas"}};var a=s.game=new r.Game(n.options.width,n.options.height,r.CANVAS,n.options.where,null);s.craft=i(8)(a);a.state.add("preload",i(9));a.state.add("game",i(12));a.state.start("preload")},function(t,e){var i=t.exports={};var r;var s;function n(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){r=setTimeout}else{r=n}}catch(t){r=n}try{if(typeof clearTimeout==="function"){s=clearTimeout}else{s=a}}catch(t){s=a}})();function o(t){if(r===setTimeout){return setTimeout(t,0)}if((r===n||!r)&&setTimeout){r=setTimeout;return setTimeout(t,0)}try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}function h(t){if(s===clearTimeout){return clearTimeout(t)}if((s===a||!s)&&clearTimeout){s=clearTimeout;return clearTimeout(t)}try{return s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}var l=[];var u=false;var c;var f=-1;function d(){if(!u||!c){return}u=false;if(c.length){l=c.concat(l)}else{f=-1}if(l.length){p()}}function p(){if(u){return}var t=o(d);u=true;var e=l.length;while(e){c=l;l=[];while(++f<e){if(c){c[f].run()}}f=-1;e=l.length}c=null;u=false;h(t)}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}}l.push(new g(t,e));if(l.length===1&&!u){o(p)}};function g(t,e){this.fun=t;this.array=e}g.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=true;i.env={};i.argv=[];i.version="";i.versions={};function v(){}i.on=v;i.addListener=v;i.once=v;i.off=v;i.removeListener=v;i.removeAllListeners=v;i.emit=v;i.prependListener=v;i.prependOnceListener=v;i.listeners=function(t){return[]};i.binding=function(t){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(t){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}},function(t,e,i){(function i(r,s){if(true)t.exports=s();else if(typeof define==="function"&&define.amd)define([],s);else if(typeof e==="object")e["craft"]=s();else r["craft"]=s()})(this,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var s=e[r]={exports:{},id:r,loaded:false};t[r].call(s.exports,s,s.exports,i);s.loaded=true;return s.exports}i.m=t;i.c=e;i.p="";return i(0)}([function(t,e,i){"use strict";var r=i(1);var s=i(2);var n=i(3);console.log("%c Craft v"+n+" ","background: #002874; color: #ffffff");t.exports=function t(e){var r={};s.game=e;return[{name:"$sprite",method:i(4),aliases:["$s"]},{name:"$tileSprite",method:i(16)},{name:"$text",method:i(17),aliases:["$t"]},{name:"$circle",method:i(18),aliases:["$t"]},{name:"$graphic",method:i(19),aliases:["$t"]},{name:"$dot",method:i(20),aliases:["$d"]},{name:"$rect",method:i(21),aliases:["$box"]},{name:"$group",method:i(22),aliases:["$g"]},{name:"$shape",method:i(23)},{name:"$stroke",method:i(24)}].reduce(function(t,e,i){var r=t[e.name]=e.method;if(e.aliases){e.aliases.forEach(function(e){t[e]=r})}return t},r)}},function(t,e){"use strict";t.exports={sprite:{$set:true,$tint:true,$into:true,$mid:true,$scale:true,$atlasImg:true,$atlasAnims:true,$fixPos:true,$copyPos:true,$align:true},graphic:{$set:true,$tint:true,$into:true,$scale:true,$mid:true,$fixPos:true,$copyPos:true,$align:true},text:{$set:true,$tint:true,$into:true,$scale:true,$fixPos:true,$copyPos:true,$align:true},group:{$set:true,$into:true,$fixPos:true,$scale:true,$add:true,$copyPos:true,$align:true}}},function(t,e){"use strict";t.exports={}},function(t,e){"use strict";t.exports="2.3.0"},function(t,e,i){"use strict";var r=i(5);var s=i(6);var n=i(2);var a=n.game;t.exports=function t(e,i){if(typeof i=="string")i={frame:i};var n={x:0,y:0,frame:undefined,group:undefined};i=r.extend({},n,i);var o=a.add.sprite(i.x,i.y,e,i.frame,i.group);s(o,"sprite");return o}},function(t,e,i){"use strict";var r={};var s=i(2);var n=s.game;r.colorCase=function(t){return t.indexOf("#")!=-1?"0x"+t.replace(/#/g,""):t};r.extend=Phaser.Utils.extend.bind(null,true);r.colorShapeBmd=function(t,e){var i=arguments.length<=2||arguments[2]===undefined?undefined:arguments[2];var r=n.make.sprite(0,0,t,i);var s=Phaser.Color.hexToColor(e);var a=n.make.bitmapData(r.width,r.height);a.fill(s.r,s.g,s.b);var o=a;o.blendDestinationAtop();o.draw(r,0,0,r.texture.crop.width,r.texture.crop.height);r.pendingDestroy=true;return o};t.exports=r},function(t,e,i){"use strict";var r=i(5);var s=i(1);var n={$set:i(7),$scale:i(8),$tint:i(9),$into:i(10),$mid:i(11),$copyPos:i(12),$fixPos:i(13),$add:i(14),$align:i(15)};t.exports=function t(e){var i=arguments.length<=1||arguments[1]===undefined?"sprite":arguments[1];for(var r in s[i]){if(!s[i][r]||!n[r])continue;e[r]=n[r]}}},function(t,e){"use strict";t.exports=function t(e,i){if(typeof e==="string"&&!!i){this[e]=i}else{for(var r in e)this[r]=e[r]}return this}},function(t,e){"use strict";t.exports=function t(){var e=arguments.length<=0||arguments[0]===undefined?null:arguments[0];var i=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(!this.scale)return this;var r=this.scale.set?this.scale.set:this.scale.setTo;if(e!==null&&i!==null){this.scale.setTo(e,i)}else if(e!==null){this.scale.setTo(e)}return this}},function(t,e,i){"use strict";var r=i(5);t.exports=function t(){var e=arguments.length<=0||arguments[0]===undefined?"ffffff":arguments[0];this.tint=r.colorCase(e);return this}},function(t,e){"use strict";t.exports=function t(e){e.add(this);return this}},function(t,e){"use strict";t.exports=function t(){this.anchor.setTo(.5);return this}},function(t,e){"use strict";t.exports=function(t){this.x=t.x;this.y=t.y;return this}},function(t,e){"use strict";t.exports=function t(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this}},function(t,e){"use strict";t.exports=function t(e){var i=this;if(!Array.isArray(e))e=[e];e.forEach(function(t){i.add(t)});return this}},function(t,e){"use strict";t.exports=function(){var t=arguments.length<=0||arguments[0]===undefined?null:arguments[0];var e=arguments.length<=1||arguments[1]===undefined?null:arguments[1];if(t){if(t=="left"){this.x=0}else if(t=="center"){this.x=~~(this.game.width*.5)-(!this.anchor||this.anchor.x==0?this.width*.5:0)}else if(t=="right"){this.x=this.game.width-this.width}}if(e){if(t=="top"){this.y=0}else if(t=="center"){this.y=~~(this.game.height*.5)-(!this.anchor||this.anchor.y==0?this.height*.5:0)}else if(t=="bot"){this.y=this.game.width-this.height}}return this}},function(t,e,i){"use strict";var r=i(5);var s=i(6);var n=i(2);var a=n.game;t.exports=function t(e,i,n,o){if(typeof i=="string")i={frame:i};var h={x:0,y:0,frame:undefined,group:undefined};i=r.extend({},h,i);var l=a.add.tileSprite(i.x,i.y,n,o,e,i.frame);s(l,"sprite");return l}},function(t,e,i){"use strict";var r=i(5);var s=i(6);var n=i(2);var a=n.game;t.exports=function t(e,i){if(typeof i=="string")i={frame:i};var n={x:0,y:0,bold:false,size:15,font:"'Helvetica Neue', Helvetica, Arial, sans-serif",stroke:{size:0,color:"#000000"},align:"center",color:"#000000"};i=r.extend({},n,i);var o=a.add.text(0,0,e,{font:[i.bold?"bold":"",i.size+"px",i.font].join(" "),align:i.align,fill:i.color,stroke:i.stroke.color,strokeThickness:i.stroke.size});s(o,"text");return o}},function(t,e,i){"use strict";var r=i(5);var s=i(6);var n=i(2);var a=n.game;t.exports=function t(e){if(typeof e=="number")e={size:e};var i={x:0,y:0,group:undefined,fill:"#ff0000",size:10,alpha:1,stroke:{size:0,color:"#000",alpha:1}};e=r.extend({},i,e);var n=a.add.graphics(e.x,e.y,e.group);s(n,"graphic");if(e.fill)n.beginFill(r.colorCase(e.fill),e.alpha);if(e.stroke.size>0)n.lineStyle(e.stroke.size,r.colorCase(e.stroke.color),e.stroke.alpha);return n.drawCircle(0,0,e.size)}},function(t,e,i){"use strict";var r=i(5);var s=i(6);var n=i(2);var a=n.game;t.exports=function t(e){var i={x:0,y:0,group:undefined};e=r.extend({},i,e);var n=a.add.graphics(e.x,e.y,e.group);s(n,"graphic");return n}},function(t,e,i){"use strict";var r=i(5);var s=i(18);t.exports=function t(e,i,n){if(e===undefined)e=5;if(i===undefined)i="#ff0000";var a={fill:i,size:e};n=r.extend({},a,n);return s(n)}},function(t,e,i){"use strict";var r=i(5);var s=i(6);var n=i(2);var a=n.game;t.exports=function t(e){if(typeof e=="number")e={size:e};var i={x:0,y:0,group:undefined,fill:"#ff0000",width:100,height:100,size:0,alpha:1,round:0,stroke:{size:0,color:"#000000",alpha:1}};e=r.extend({},i,e);var n=a.add.graphics(e.x,e.y,e.group);if(e.size)e.height=e.width=e.size;s(n,"graphic");if(e.fill)n.beginFill(r.colorCase(e.fill),e.alpha);if(e.stroke.size>0)n.lineStyle(e.stroke.size,r.colorCase(e.stroke.color),e.stroke.alpha);if(e.round===0){return n.drawRect(0,0,e.width,e.height)}else{return n.drawRoundedRect(0,0,e.width,e.height,e.round)}}},function(t,e,i){"use strict";var r=i(5);var s=i(6);var n=i(2);var a=n.game;t.exports=function t(e){var i={parent:undefined,name:undefined,addToStage:undefined,enableBody:undefined,physicsBodyType:undefined};e=r.extend({},e,i);var n=a.add.group(e.parent,e.name,e.addToStage,e.enableBody,e.physicsBodyType);s(n,"group");return n}},function(t,e,i){"use strict";var r=i(5);var s=i(6);var n=i(2);var a=n.game;var o=i(4);t.exports=function t(e,i,s){if(i===undefined)i=undefined;if(typeof i==="object"){var n=s;s=i?i:{};i=n}var h={frame:i,x:0,y:0,group:undefined,cache:true,color:"#FF0000"};s=r.extend({},h,s);var l=["$fill",e,s.frame].filter(Boolean).join("_");if(s.cache&&!a.cache.checkImageKey(l)){var u=r.colorShapeBmd(e,s.color,s.frame);u.generateTexture(l);l=u;u.pendingDestroy=true}else if(!s.cache){l=r.colorShapeBmd(e,s.color,s.frame)}var c=Object.assign({},s);delete c["cache"];delete c["frame"];return o(l,c)}},function(t,e,i){"use strict";var r=i(5);var s=i(6);var n=i(2);var a=n.game;var o=i(4);var h=function t(e,i){var s=a.make.sprite(0,0,e,i.frame);var n=i.size;var o=i.pixel;var h=a.make.bitmapData(s.width+n*2,s.height+n*2);var l=r.colorShapeBmd(e,i.color,i.frame);for(var u=0;u<n*2*(1/o)+1;u++){for(var c=0;c<n*2*(1/o)+1;c++){h.draw(l,u*o,c*o)}}if(i.inside)h.draw(s,n,n,s.texture.crop.width,s.texture.crop.height);s.pendingDestroy=true;return h};t.exports=function t(e,i,s){if(i===undefined)i=undefined;if(typeof i==="object"){var n=s;s=i?i:{};i=n}var l={frame:i,x:0,y:0,group:undefined,cache:true,size:1,pixel:1,inside:true,color:"#FF0000"};s=r.extend({},l,s);var u=["$stoke",e,s.frame].filter(Boolean).join("_");if(s.cache&&!a.cache.checkImageKey(u)){var c=h(e,s);c.generateTexture(u);c.pendingDestroy=true;u=c}else if(!s.cache){u=h(s)}var f=Object.assign({},s);["cache","color","pixel","inside","frame","size"].forEach(function(t){delete f[t]});return o(u,f)}}])})},function(t,e,i){"use strict";var r=i(3);var s=i(2);var n=i(1);var a=i(0);var o=a.game;var h=a.craft;var l={images:{},sprites:{},audio:{},atlas:{avatar:{image:"texture_sheets/atlas.png",jsonUrl:"texture_sheets/atlas.json"},main:{image:"texture_sheets/misc.png",jsonUrl:"texture_sheets/misc.json"}}};t.exports=function(){var t={};t.init=function(){};t.preload=function(){o.stage.disableVisibilityChange=false;o.stage.backgroundColor="#fff";r.loadAssets(o,l);o.load.start()};t.create=function(){o.state.start("game")};return t}},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){t.deprecate=function(){};t.paths=[];if(!t.children)t.children=[];Object.defineProperty(t,"loaded",{enumerable:true,get:function(){return t.l}});Object.defineProperty(t,"id",{enumerable:true,get:function(){return t.i}});t.webpackPolyfill=1}return t}},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(1,eval)("this")}catch(t){if(typeof window==="object")i=window}t.exports=i},function(t,e,i){"use strict";var r=i(3);var s=i(2);var n=i(1);var a=i(0);var o=i(0);var h=o.scope;var l=o.game;var u=o.craft;t.exports=function(){var t={};t.init=function(){var t=arguments.length<=0||arguments[0]===undefined?"female":arguments[0];var e=arguments.length<=1||arguments[1]===undefined?null:arguments[1];h=a.scope=i(13)(t);h._default=e};t.preload=function(){l.stage.disableVisibilityChange=false;l.stage.backgroundColor="#fff";l.load.start()};t.create=function(){i(14)();i(15)();i(16)();i(17)();i(18)();i(19)();i(20)();i(21)();i(22)();i(23)();i(24)();h.setPart("hair");if(h._default){h.load(h._default);h._default=null}else{h.load()}};return t}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);t.exports=function(){var t=arguments.length<=0||arguments[0]===undefined?"female":arguments[0];var e=i(0);var r=e.scope;var s=e.game;var n=e.craft;var r={gender:t,active:true,parts:{},selColor:0,_default:null,selPart:"hair"};return r}},function(t,e,i){"use strict";var r=i(3);var s=i(2);var n=i(1);t.exports=function(){var t=i(0);var e=t.scope;var r=t.game;var n=t.craft;var a=e.layers=s.reduce(["bot","mid","top"],function(t,e){t[e]=n.$g();return t},{})}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);t.exports=function(){var t=i(0);var e=t.scope;var s=t.game;var n=t.craft;var a=t.params;var o=e.ui={};o.text=function(t,e){var i={size:20,color:"#FFFFFF",borderColor:"#161616",borderSize:10,align:"center",bold:false,font:"nexa",gap:3};e=r.extend({},i,e);var a=n.$g();a.front=s.add.text(0,0,t,{font:(e.bold?"bold":"")+" "+e.size+"px "+e.font+", Helvetica, Arial, sans-serif",align:"center",fill:e.borderColor,stroke:e.borderColor,strokeThickness:e.borderSize+2});a.bkg=s.add.text(0,0,t,{font:(e.bold?"bold":"")+" "+e.size+"px "+e.font+", Helvetica, Arial, sans-serif",align:"center",fill:e.color,stroke:e.borderColor,strokeThickness:e.borderSize});a.setText=function(t){a.front.text=a.bkg.text=t;if(e.align=="center")a.front.x=-a.front.width*.5;a.front.y=-a.front.height*.5;a.bkg.x=a.front.x;a.bkg.y=a.front.y+e.gap};if(e.align=="center")a.front.x=-a.front.width*.5;a.front.y=-a.front.height*.5;a.bkg.x=a.front.x;a.bkg.y=a.front.y+e.gap;a.add(a.front);a.add(a.bkg);return a};o.btn=function(){var t=arguments.length<=0||arguments[0]===undefined?"test":arguments[0];var e=arguments.length<=1||arguments[1]===undefined?100:arguments[1];var i=n.$g();var r=n.$sprite("main","btn_green/1.png").$into(i);var s=n.$sprite("main","btn_green/2.png").$set({x:r.width,width:e}).$into(i);var a=n.$sprite("main","btn_green/3.png").$set({x:r.width+s.width}).$into(i);var o=i.area=n.$rect({width:i.width,height:i.height}).$set({alpha:0}).$into(i);var h=n.$text(t,{size:16,bold:true}).$set({y:5}).$into(i);h.x=i.width/2-h.width/2;return i}}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);t.exports=function(){var t=i(0);var e=t.scope;var r=t.game;var s=t.craft}},function(t,e,i){"use strict";var r=i(2);var s=i(1);t.exports=function(){var t=i(0);var e=t.scope;var n=t.game;var a=t.craft;var o=e.events=r.transform(["start","colorClick","setColorSel","changeStyle","setPart"],function(t,e,i){t[e]=new s.Signal},{});o.start.add(function(){});o.colorClick.add(function(t,i){e.avatar[e.selPart].layers[e.selColor].$tint(t);e.colorsBtns.btns[e.selColor].bkg.$tint(t);e.parts[e.selPart].colors[e.selColor]=i});o.setPart.add(function(t){e.setPart(t)});o.setColorSel.add(function(t){});o.changeStyle.add(function(t){e.changeStyle(t)})}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);var a=i(5);t.exports=function(){var t=i(0);var e=t.scope;var s=t.game;var o=t.craft;var h=t.params;var l=i(4);var u=e.colorPicker=o.$g().$set({x:230,y:240}).$into(e.layers.top);e.colorPicker.cells=r.map(a,function(t,i){var r=o.$sprite("main","colorCell.png").$set({x:t.x,y:t.y,name:i,zone:t.z}).$tint("#"+t.color).$into(e.colorPicker);n.setBtn(r,function(){e.events.colorClick.dispatch("#"+t.color,i)});r.input.pixelPerfectAlpha=true;r.input.pixelPerfectClick=true;return r});u.showZone=function(t){var e=l[t];r.each(u.cells,function(t){t.visible=!r.includes(e.banZ,t.zone)})}}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);t.exports=function(){var t=i(0);var e=t.scope;var s=t.game;var n=t.craft;var a=t.params;var o=i(4);var h={male:{x:30,y:0},female:{x:0,y:0}};var l=e.avatar=n.$g().$set(h[e.gender]).$into(e.layers.mid);var u={origin:{male:{width:300,height:786},female:{width:438,height:750}},normal:{male:{width:150,height:393},female:{width:219,height:375}},md:{male:{width:120,height:314},female:{width:175,height:300}},sm:{male:{width:90,height:236},female:{width:131,height:224}},xs:{male:{width:45,height:118},female:{width:66,height:113}}};r.each(o,function(t,i){l[i]=n.$g().$set({f:0}).$into(l);e.parts[i]={colors:["63","63","63"]};l[i].layers=r.times(t.layers?t.layers.length:1,function(t){var r=n.$sprite("avatar",e.gender+"/"+i+"/1.png").$set({x:0,y:0}).$into(l[i]);return r})})}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);t.exports=function(){var t=i(0);var e=t.scope;var s=t.game;var a=t.craft;var o=t.params;var h=i(4);var l=e.partBtns=a.$g().$set({x:210}).$into(e.layers.top);var u=["skin","hair","eye","shoes","shirt","short","socks"];var c=function t(){var e=a.$g().$into(l);var i=e.bkg=a.$sprite("main","part_btn_01.png").$into(e);var r=e.icon=a.$sprite("main","icons_01.png").$set({x:11,y:13}).$into(e);var s=e.label=a.$text("",{font:"12px 'Helvetica Neue', Helvetica, Arial, sans-serif"}).$set({x:0,y:70}).$into(e);return e};l.btns=r.map(u,function(t,i){var s=c().$set({x:i*60,part:t});if(i>3){s.y=75;s.x=s.x-210}s.label.text=h[t].name;s.label.x=Math.floor(s.width/2)-Math.floor(s.label.width/2);s.icon.frameName="icons_"+r.padStart(h[t].icon+1,2,"0")+".png";n.setBtn(s.bkg,function(i){e.events.setPart.dispatch(t)});return s});l.setBtn=function(t){r.each(l.btns,function(e){e.bkg.frameName=e.part==t?"part_btn_02.png":"part_btn_01.png"})};return l}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);var a=i(5);t.exports=function(){var t=i(0);var e=t.scope;var s=t.game;var o=t.craft;var h=t.params;var l=e.colorsBtns=o.$g().$set({x:255,y:175}).$into(e.layers.top);var u=function t(){var e=o.$g().$into(l);var i=e.bkg=o.$sprite("main","color_btn_01.png").$into(e);var r=e.sel=o.$sprite("main","color_btn_02.png").$set({visible:false}).$into(e);var s=e.label=o.$text("",{font:"12px 'Helvetica Neue', Helvetica, Arial, sans-serif"}).$set({x:12,y:46}).$into(e);return e};l.btns=r.times(3,function(t){var i=u();i.x=t*60;i.label.text="Color "+(t+1);i.sel.visible=false;i.n=t+1;i.label.x=Math.floor(i.width/2)-Math.floor(i.label.width/2);n.setBtn(i.bkg,function(){l.setColorSel(t);e.events.setColorSel.dispatch(t+1)});return i});l.refresh=function(){r.each(l.btns,function(t,i){if(!e.parts[e.selPart]||e.parts[e.selPart].colors[i]===undefined)return true;t.bkg.$tint("#"+a[e.parts[e.selPart].colors[i]].color)})};l.setVisible=function(t,i){var s=e.getLayersNumInFrame(t,i);r.each(l.btns,function(t,e){t.visible=e<s})};l.setColorSel=function(t){e.selColor=t;r.each(l.btns,function(e,i){e.sel.visible=i==t})}}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);t.exports=function(){var t=i(0);var e=t.scope;var s=t.game;var a=t.craft;var o=t.params;e.arrows=r.transform([{x:1,name:"left",val:false},{name:"right",x:-1,val:true}],function(t,i,r){var s=t[i.name]=a.$sprite("main","arrow.png").$into(e.layers.top);s.scale.x=i.x;n.setBtn(s,function(){e.events.changeStyle.dispatch(i.val)});return t},{})}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);var a=i(5);t.exports=function(){var t=i(0);var e=t.scope;var s=t.game;var n=t.craft;var o=t.params;var h=i(4);var l={female:{skin:{colors:["194","63","63"],style:0},shirt:{colors:["67","140","63"],style:6},short:{colors:["140","67","63"],style:1},socks:{colors:["140","67","63"],style:3},shoes:{colors:["67","63","63"],style:1},hair:{colors:["67","63","63"],style:3},eyeBkg:{colors:["63","63","63"],style:0},eye:{colors:["96","63","63"],style:0}},male:{skin:{colors:["194","63","63"],style:0},shirt:{colors:["184","63","63"],style:2},short:{colors:["184","63","63"],style:3},socks:{colors:["184","63","63"],style:5},shoes:{colors:["63","184","63"],style:4},hair:{colors:["121","63","63"],style:0},eyeBkg:{colors:["63","63","63"],style:0},eye:{colors:["62","63","63"],style:0}}};e.setFramePart=function(t,i){var s=h[t];if(!s.layers){e.avatar[t].layers[0].visible=true;e.avatar[t].layers[0].frameName=e.gender+"/"+t+"/"+(i+1)+".png"}else{r.each(s.layers,function(r,s){var n=typeof r=="number"?r-1:r[i]-1;if(n==-1){e.avatar[t].layers[s].visible=false}else{e.avatar[t].layers[s].visible=true;e.avatar[t].layers[s].frameName=e.gender+"/"+t+"/"+(n+1)+".png"}})}e.avatar[t].f=i;e.parts[t].style=i;if(s.link)e.setFramePart(s.link,i)};e.getLayersNumInFrame=function(t,e){var i=h[t];if(!i.layers){return 1}else{var s=0;r.times(i.layers.length,function(t){var r=typeof i.layers[t]=="number"?i.layers[t]-1:i.layers[t][e]-1;if(r==-1){return}else{s++}});return s}};var u=function t(e){var i=h[e];if(i&&!i.layers){return i.frames}else{var s=0;r.times(i.layers?i.layers.length:1,function(t){var e=typeof i.layers[t]=="number"?1:i.layers[t].length;if(e>s)s=e});return s}};e.setPart=function(t){var i=h[t];e.colorPicker.showZone(t);e.partBtns.setBtn(t);e.arrows.left.visible=e.arrows.right.visible=!!i.arrows;if(!!i.arrows){e.arrows.left.x=i.arrows[e.gender][0][0];e.arrows.left.y=i.arrows[e.gender][0][1];e.arrows.right.x=i.arrows[e.gender][1][0];e.arrows.right.y=i.arrows[e.gender][1][1]}e.selPart=t;e.colorsBtns.refresh();e.colorsBtns.setVisible(e.selPart,e.avatar[e.selPart].f);e.colorsBtns.setColorSel(0);e.setFramePart(t,e.avatar[t].f)};e.changeStyle=function(){var t=arguments.length<=0||arguments[0]===undefined?true:arguments[0];var i=e.selPart;var r=u(i);if(t){var s=e.avatar[i].f+1>=r?0:e.avatar[i].f+1}else{var s=e.avatar[i].f-1<0?r-1:e.avatar[i].f-1}e.setFramePart(i,s);e.colorsBtns.setVisible(i,s)};e.load=function(t){if(t){var i=t}else{var i=l[e.gender]}r.each(i,function(t,i){e.setFramePart(i,t.style);r.each(t.colors,function(r,s){if(!e.avatar[i]||!e.avatar[i].layers[s])return true;e.avatar[i].layers[s].$tint("#"+a[r].color);e.parts[i].colors[s]=r;e.parts[i].style=t.style})});e.colorsBtns.refresh()};$("#saveButton").unbind("click");$("#saveButton").click(function(){var t={parts:e.parts,gender:e.gender};var i=JSON.stringify(t);$.post("/fn/readerWriter/holoTextWrite",i,function(t){$("#hash").val(t)})});$("#loadButton").unbind("click");$("#loadButton").click(function(){$.post("/fn/readerWriter/holoTextRead",$("#load").val(),function(t){var i=$.parseJSON(t);e.gender=i.gender;s.state.restart(true,false,e.gender,i.parts)})})}},function(t,e,i){"use strict";var r=i(2);var s=i(1);var n=i(3);t.exports=function(){var t=i(0);var e=t.scope;var s=t.game;var a=t.craft;var o=t.params;var h=60;var l=a.$g().$set({x:80,y:s.height-40});r.each([{name:"Male",x:-h},{name:"Female",x:h}],function(t){var i=e.ui.btn(t.name).$set({x:t.x}).$into(l);n.setBtn(i.area,function(){s.state.restart(true,false,r.toLower(t.name))})})}}])});